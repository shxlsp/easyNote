# 小窗拖拽能力迭代
## 需求描述
当前我们已经实现了小窗拖拽移动的前端能力，需要在主进程实现真实的移动，在jsBridge中已经触发了像主进程发送拖拽的事件。
现在需要实现：
1. main进程的位置改变方法，入参为data，类型为{x:number, y:number}。
2. 当拖拽结束后，系统会自动检测当前窗口的位置，保持 y 轴坐标不变，若 x 轴位置在屏幕左侧，则小窗会吸附到左侧屏幕边缘；若在右侧，则吸附到右侧屏幕边缘。

注意：需要实现在bizController/index.ts文件中



# 切换小窗口，自动吸附逻辑问题修复
## 需求描述
现在我们已经实现了，通过前端发送事件，切换小窗模式，并根据当前窗口位置，动态计算应该吸附在屏幕左侧还是右侧。但现在存在几个问题需要修复：
1. 自动吸附屏幕左侧和右侧的逻辑中，没有计算当前dock栏的位置，导致吸附存在问题，需要通过workArea的位置和大小bounds的大小来计算，这样在吸附时，可以不压住dock栏。
2. 自动吸附逻辑中，需要加入一些margin，防止贴屏幕太近，margin大小为10
3. 当前屏幕获取存在问题，获取的是主屏幕，当遇到多屏幕时，计算会存在问题。需要根据当前窗口的位置，通过screen的getDisplayNearestPoint方法，获取离改点最近的screen实例。

## 代码位置
@main/service/easyNoteWinPosition.ts文件中的setEasyNoteFloatingMode方法




# 修复拖拽后自动吸附问题，通用逻辑抽离
## 需求描述
在src/main/service/easyNoteWinPosition.ts文件的setEasyNoteFloatingMode方法中，我们实现了切换小窗模式时，根据窗口当前位置，自动进行屏幕左侧或右侧的吸附操作。在该文件下还有easyNoteMove方法，在移动结束后，也会执行相同的逻辑，并且该方法实现存在问题。
1. easyNoteMove方法移动结束后，逻辑需要更改为setEasyNoteFloatingMode方法中的实现一致。
2. 把逻辑中相同的部分抽象出来，抽离到utils文件中，提供一个统一的吸附方法


# 新增菜单功能
## 需求描述
1. 关闭小记：提供关闭小记应用的操作选项。
2. 展开模式选择
    - 居中模式：将小记页面展开至屏幕中央。
    - 跟随模式：根据小窗当前位置进行展开。
3. 开启轻记默认操作
    - 新建轻记：快速创建新的轻记内容。
    - 打开轻记列表：查看已有的轻记列表。（当前默认行为）
## 代码实现
1. 菜单功能实现如上文描述所示
2. 展开模式和开启轻记默认操作 数据需要缓存记录。
    2.1 使用electron-store缓存到本地。electron-store我已经引入
    2.2 数据存储放在src/main/model目录下。
3. 展开方法代码已有实现，在src/main/service/easyNoteWinPosition.ts目录中的setEasyNoteNormalgMode方法。这个方法需要更改
    3.1 新增缓存读取功能，根据缓存的模式，选择开启方式
    3.2 居中模式，开启窗口移动到屏幕中央
    3.3 跟随模式，系统会自动检测当前窗口的位置，若小窗此时吸附在右侧，则向左侧展开；若吸附在左侧，则向右侧展开。
4. 开启轻记默认操作功能
    4.1 在src/main/controller/bizController中实现发送方法，当菜单中的选项被点击时，向所有的窗口发送消息。
    4.2 在src/main/preloads/jsBridgePreload.ts中实现接收方法，缓存在window.__easyNoteStore中。
    

# 一个编辑器+列表能力实现
在src/easyNote/src/index.tsx目录下，我们需要实现编辑器+列表组件
项目结构为
- mainPage
    - list
    - detail
1. mainPage
    1.1. 通用头部组件，左侧展示「轻记」名称，右侧展示关闭icon和视图模式切换，支持「列表视图」、「卡片视图」切换
    1.2. 根据状态判断当前渲染组件
        1.2.1 当存在detailId时，展示详情组件
        1.2.2 当不存在detailId时，展示列表组件
2. list
    2.1 列表数据从主进程获取
    2.2 列表渲染，支持2种模式，「列表视图」、「卡片视图」，展示模式的状态由mainPage组件下发
    2.3 列表中元素
        2.3.1 元素内容支持展开收起，当高度大于150px时，展示展开按钮，点击展开后，展示元素全部内容
        2.3.2 元素支持hover后，右上角展示操作按钮，操作按钮展示编辑、更多。点击编辑后，展示详情组件。点击更多后，展开下拉弹窗，下拉弹窗中有「置顶/取消置顶(由当前状态决定)」「删除」功能，点击「置顶」功能，展示到列表顶部，如果当前已经置顶，则还原默认列表顺序。点击「删除」功能，删除该元素。
3. detail
    3.1 详情功能，主要由编辑器构成，编辑器使用业界成熟的开源组件库，请从github上找到目前开源项目中热度最高的编辑器项目。支持markdown格式识别。
    3.2 编辑器工具栏，「撤销」「重做」「加粗」「横划线」「字体」「列表」「checkbox」「图片上传」等功能
    3.3 当进入详情后，头部组件操作功能改为，左侧为返回，右侧为关闭。
        

# electron应用规划数据库设计及api设计
在electron app中，renderer实现了笔记能力，页面是列表页、详情页，列表页中也能展示详情的静态数据，详情是支持图片上传的编辑器。现在需要在main进程中实现本地存储这些数据，期望使用SQLite进行存储。
你需要帮忙规划以下内容
1. 图片上传设计，图片上传最终会直接存储到默认app缓存的位置，返回支持返回当前文件path，需要对图片进行去重和加密，使用数据库缓存每个图片的md5值，每次上传时，进行对比，如果存在，则直接返回当前图片的path。
2. 数据库表结构设计，每个表包含的数据使用table展示，列中字段分别为key 类型 描述
3. 数据库curd实现设计，在service层中实现接口。
4. renderer层接口实现设计，在bizController中添加监听事件

## 注意
1. 用户的规划中，存在一些规则和限制，但可能并不完善，你需要基于用户设计的规则，进行合理的补充，补充完成后，自行二次确认本次规划的合理性

# 规划生成结果↓
根据您的反馈，修改后的规划方案如下：

图片上传设计

去重和加密：在图片上传时，首先计算图片的MD5值。使用数据库缓存每个图片的MD5值，并在上传时进行对比。如果存在相同的MD5值，则直接返回当前图片的路径。
存储位置：图片将存储在默认的应用缓存目录。我们可以使用Electron的app.getPath('userData')来获取缓存位置。
路径返回：上传成功后，返回图片的路径。
数据库表结构设计

图片表：用于存储图片信息，包括图片路径、MD5值等。
| Key        | 类型          | 描述          |
|------------|--------------|---------------|
| id         | INTEGER      | 主键          |
| path       | TEXT         | 图片存储路径  |
| md5        | TEXT         | 图片的MD5值   |

笔记表：用于存储笔记信息，包括标题、内容、创建时间、更新时间、是否置顶等。
| Key        | 类型          | 描述          |
|------------|--------------|---------------|
| id         | INTEGER      | 主键          |
| title      | TEXT         | 笔记标题      |
| content    | TEXT         | 笔记内容      |
| created_at | DATETIME     | 创建时间      |
| updated_at | DATETIME     | 更新时间      |
| is_pinned  | BOOLEAN      | 是否置顶      |

数据库CRUD实现设计

在service层中，我们将创建一个数据库服务类，提供CRUD接口以操作SQLite数据库。
接口设计：
createNote：创建笔记
readNote：读取笔记
updateNote：更新笔记
deleteNote：删除笔记
listNotes：按时间顺序读取笔记列表
uploadImage：处理图片上传及去重
renderer层接口实现设计

在bizController中添加事件监听，处理与main进程的通信。
接口设计：
onNoteCreated：监听笔记创建事件
onNoteUpdated：监听笔记更新事件
onNoteDeleted：监听笔记删除事件
onNotesListed：监听笔记列表读取事件
onImageUploaded：监听图片上传事件
请您确认这些修改后的规划是否符合您的需求，或者是否需要进一步的调整和补充。


# electron渲染进程对接主进程接口，完善应用能力
以下是我们应用的介绍和一些需求规则，需要你完善这些规划，生成一份详细的技术实现描述。

我们是一款笔记应用，已经在src/main/controller/bizController/index.ts实现了笔记的增删改查，及图片上传的接口。现在需要在src/easyNote/src/component/MainPage/index.tsx依赖的list和detail中，进行接口对接。

1. list是笔记列表， 笔记列表中支持卡片/列表模式展示，本质上的内容是一致的，都是渲染笔记的内容。
2. detail 是笔记详情，通过接口取到笔记value，回显笔记内容。编辑后，调用接口进行更新，注意调用时需要节流。



为了进一步完善应用能力，我们可以考虑以下几点优化：

错误处理：虽然已经有基本的错误处理，但可以考虑添加更详细的错误信息，以帮助用户理解发生了什么问题。

加载状态：可以为单个笔记的操作（如置顶、删除）添加加载状态，以提供更好的用户体验。

批量操作：如果需要，可以考虑添加批量删除或批量置顶等功能。

搜索功能：可以在 List 组件中添加搜索功能，通过标题或内容搜索笔记。

分页或虚拟滚动：如果笔记数量可能很大，可以考虑实现分页加载或虚拟滚动以提高性能。

数据同步：可以考虑添加一个手动刷新按钮，允许用户主动从服务器获取最新数据。

可以考虑实现搜索功能、批量操作、分页加载等高级特性。


# 问题修复
现在轻记的页面中有两个问题。
1. 列表中展示的卡片数据为slate json的原始数据，我需要展示为更好看的组件，请编写一个解析器组件，只进行slate数据的渲染
2. 详情页面现在编辑之后，无法回显数据。需要修复回显问题。

列表页面为src/easyNote/src/component/List/index.tsx
详情页面为src/easyNote/src/component/Detail/index.tsx