var Gg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yg(ao){return ao&&ao.__esModule&&Object.prototype.hasOwnProperty.call(ao,"default")?ao.default:ao}function Jg(ao){if(ao.__esModule)return ao;var Qd=ao.default;if(typeof Qd=="function"){var ks=function rs(){return this instanceof rs?Reflect.construct(Qd,arguments,this.constructor):Qd.apply(this,arguments)};ks.prototype=Qd.prototype}else ks={};return Object.defineProperty(ks,"__esModule",{value:!0}),Object.keys(ao).forEach(function(rs){var Vh=Object.getOwnPropertyDescriptor(ao,rs);Object.defineProperty(ks,rs,Vh.get?Vh:{enumerable:!0,get:function(){return ao[rs]}})}),ks}var Lg={exports:{}},Zg;function Qg(){return Zg||(Zg=1,function(ao,Qd){(function(ks,rs){ao.exports=rs()})(Gg,function(){var ks,rs,Vh;function Ep(v,C){if(!ks)ks=C;else if(!rs)rs=C;else{var fe="var sharedChunk = {}; ("+ks+")(sharedChunk); ("+rs+")(sharedChunk);",Yr={};ks(Yr),Vh=C(Yr),typeof window<"u"&&(Vh.workerUrl=window.URL.createObjectURL(new Blob([fe],{type:"text/javascript"})))}}return Ep(["exports"],function(v){function C(e,i){return i={exports:{}},e(i,i.exports),i.exports}var fe="1.13.4",Yr=Jr;function Jr(e,i,a,h){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=h,this.p2x=a,this.p2y=h}Jr.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},Jr.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},Jr.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},Jr.prototype.solveCurveX=function(e,i){typeof i>"u"&&(i=1e-6);var a,h,p,x,E;for(p=e,E=0;E<8;E++){if(x=this.sampleCurveX(p)-e,Math.abs(x)<i)return p;var M=this.sampleCurveDerivativeX(p);if(Math.abs(M)<1e-6)break;p=p-x/M}if(a=0,h=1,p=e,p<a)return a;if(p>h)return h;for(;a<h;){if(x=this.sampleCurveX(p),Math.abs(x-e)<i)return p;e>x?a=p:h=p,p=(h-a)*.5+a}return p},Jr.prototype.solve=function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))};var pe=ha;function ha(e,i){this.x=e,this.y=i}ha.prototype={clone:function(){return new ha(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,a=e.y-this.y;return i*i+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[0]*this.x+e[1]*this.y,a=e[2]*this.x+e[3]*this.y;return this.x=i,this.y=a,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),a=Math.sin(e),h=i*this.x-a*this.y,p=a*this.x+i*this.y;return this.x=h,this.y=p,this},_rotateAround:function(e,i){var a=Math.cos(e),h=Math.sin(e),p=i.x+a*(this.x-i.x)-h*(this.y-i.y),x=i.y+h*(this.x-i.x)+a*(this.y-i.y);return this.x=p,this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ha.convert=function(e){return e instanceof ha?e:Array.isArray(e)?new ha(e[0],e[1]):e};var me=typeof self<"u"?self:{};function Qt(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(var a=0;a<e.length;a++)if(!Qt(e[a],i[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object")return!1;var h=Object.keys(e);if(h.length!==Object.keys(i).length)return!1;for(var p in e)if(!Qt(e[p],i[p]))return!1;return!0}return e===i}var ca=Math.pow(2,53)-1;function In(e){if(e<=0)return 0;if(e>=1)return 1;var i=e*e,a=i*e;return 4*(e<.5?a:3*(e-i)+a-.75)}function ns(e,i,a,h){var p=new Yr(e,i,a,h);return function(x){return p.solve(x)}}var Fa=ns(.25,.1,.25,1);function fa(e,i,a){return Math.min(a,Math.max(i,e))}function zo(e,i,a){var h=a-i,p=((e-i)%h+h)%h+i;return p===i?a:p}function ml(e,i,a){if(!e.length)return a(null,[]);var h=e.length,p=new Array(e.length),x=null;e.forEach(function(E,M){i(E,function(L,V){L&&(x=L),p[M]=V,--h===0&&a(x,p)})})}function an(e){var i=[];for(var a in e)i.push(e[a]);return i}function Fs(e,i){var a=[];for(var h in e)h in i||a.push(h);return a}function Or(e){for(var i=[],a=arguments.length-1;a-- >0;)i[a]=arguments[a+1];for(var h=0,p=i;h<p.length;h+=1){var x=p[h];for(var E in x)e[E]=x[E]}return e}function _l(e,i){for(var a={},h=0;h<i.length;h++){var p=i[h];p in e&&(a[p]=e[p])}return a}var da=1;function Ls(){return da++}function pa(){function e(i){return i?(i^Math.random()*16>>i/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}return e()}function gs(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Rs(e){return e?/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e):!1}function Jl(e,i){e.forEach(function(a){i[a]&&(i[a]=i[a].bind(i))})}function Do(e,i){return e.indexOf(i,e.length-i.length)!==-1}function La(e,i,a){var h={};for(var p in e)h[p]=i.call(a||this,e[p],p,e);return h}function Ra(e,i,a){var h={};for(var p in e)i.call(a||this,e[p],p,e)&&(h[p]=e[p]);return h}function qr(e){return Array.isArray(e)?e.map(qr):typeof e=="object"&&e?La(e,qr):e}function so(e,i){for(var a=0;a<e.length;a++)if(i.indexOf(e[a])>=0)return!0;return!1}var ko={};function rr(e){ko[e]||(typeof console<"u"&&console.warn(e),ko[e]=!0)}function mn(e,i,a){return(a.y-e.y)*(i.x-e.x)>(i.y-e.y)*(a.x-e.x)}function Ql(e){for(var i=0,a=0,h=e.length,p=h-1,x=void 0,E=void 0;a<h;p=a++)x=e[a],E=e[p],i+=(E.x-x.x)*(x.y+E.y);return i}function Fo(e){var i=e[0],a=e[1],h=e[2];return a+=90,a*=Math.PI/180,h*=Math.PI/180,{x:i*Math.cos(a)*Math.sin(h),y:i*Math.sin(a)*Math.sin(h),z:i*Math.cos(h)}}function sn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Lo(e){var i=/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,a={};if(e.replace(i,function(p,x,E,M){var L=E||M;return a[x]=L?L.toLowerCase():!0,""}),a["max-age"]){var h=parseInt(a["max-age"],10);isNaN(h)?delete a["max-age"]:a["max-age"]=h}return a}var On=null;function Ba(e){if(On==null){var i=e.navigator?e.navigator.userAgent:null;On=!!e.safari||!!(i&&(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return On}function Qi(e){try{var i=me[e];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function Oa(e){return me.btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(i,a){return String.fromCharCode(+("0x"+a))}))}function oo(e){return decodeURIComponent(me.atob(e).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""))}var oh=me.performance&&me.performance.now?me.performance.now.bind(me.performance):Date.now.bind(Date),$l=me.requestAnimationFrame||me.mozRequestAnimationFrame||me.webkitRequestAnimationFrame||me.msRequestAnimationFrame,lo=me.cancelAnimationFrame||me.mozCancelAnimationFrame||me.webkitCancelAnimationFrame||me.msCancelAnimationFrame,ma,Cn,Bs={now:oh,frame:function(i){var a=$l(i);return{cancel:function(){return lo(a)}}},getImageData:function(i,a){a===void 0&&(a=0);var h=me.document.createElement("canvas"),p=h.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return h.width=i.width,h.height=i.height,p.drawImage(i,0,0,i.width,i.height),p.getImageData(-a,-a,i.width+2*a,i.height+2*a)},resolveURL:function(i){return ma||(ma=me.document.createElement("a")),ma.href=i,ma.href},hardwareConcurrency:me.navigator&&me.navigator.hardwareConcurrency||4,get devicePixelRatio(){return me.devicePixelRatio},get prefersReducedMotion(){return me.matchMedia?(Cn==null&&(Cn=me.matchMedia("(prefers-reduced-motion: reduce)")),Cn.matches):!1}},zi={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},uo={supported:!1,testSupport:bi},on,_n=!1,Qn,Va=!1;me.document&&(Qn=me.document.createElement("img"),Qn.onload=function(){on&&Ro(on),on=null,Va=!0},Qn.onerror=function(){_n=!0,on=null},Qn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");function bi(e){_n||!Qn||(Va?Ro(e):on=e)}function Ro(e){var i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Qn),e.isContextLost())return;uo.supported=!0}catch{}e.deleteTexture(i),_n=!0}var Os="01";function ys(){for(var e="1",i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",a="",h=0;h<10;h++)a+=i[Math.floor(Math.random()*62)];var p=12*60*60*1e3,x=[e,Os,a].join(""),E=Date.now()+p;return{token:x,tokenExpiresAt:E}}var ln=function(i,a){this._transformRequestFn=i,this._customAccessToken=a,this._createSkuToken()};ln.prototype._createSkuToken=function(){var i=ys();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt},ln.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ln.prototype.transformRequest=function(i,a){return this._transformRequestFn?this._transformRequestFn(i,a)||{url:i}:{url:i}},ln.prototype.normalizeStyleURL=function(i,a){if(!un(i))return i;var h=Pn(i);return h.path="/styles/v1"+h.path,this._makeAPIURL(h,this._customAccessToken||a)},ln.prototype.normalizeGlyphsURL=function(i,a){if(!un(i))return i;var h=Pn(i);return h.path="/fonts/v1"+h.path,this._makeAPIURL(h,this._customAccessToken||a)},ln.prototype.normalizeSourceURL=function(i,a){if(!un(i))return i;var h=Pn(i);return h.path="/v4/"+h.authority+".json",h.params.push("secure"),this._makeAPIURL(h,this._customAccessToken||a)},ln.prototype.normalizeSpriteURL=function(i,a,h,p){var x=Pn(i);return un(i)?(x.path="/styles/v1"+x.path+"/sprite"+a+h,this._makeAPIURL(x,this._customAccessToken||p)):(x.path+=""+a+h,ta(x))},ln.prototype.normalizeTileURL=function(i,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!un(i))return i;var h=Pn(i),p=/(\.(png|jpg)\d*)(?=$)/,x=/^.+\/v4\//,E=Bs.devicePixelRatio>=2||a===512?"@2x":"",M=uo.supported?".webp":"$1";h.path=h.path.replace(p,""+E+M),h.path=h.path.replace(x,"/"),h.path="/v4"+h.path;var L=this._customAccessToken||Au(h.params)||zi.ACCESS_TOKEN;return zi.REQUIRE_ACCESS_TOKEN&&L&&this._skuToken&&h.params.push("sku="+this._skuToken),this._makeAPIURL(h,L)},ln.prototype.canonicalizeTileURL=function(i,a){var h="/v4/",p=/\.[\w]+$/,x=Pn(i);if(!x.path.match(/(^\/v4\/)/)||!x.path.match(p))return i;var E="mapbox://tiles/";E+=x.path.replace(h,"");var M=x.params;return a&&(M=M.filter(function(L){return!L.match(/^access_token=/)})),M.length&&(E+="?"+M.join("&")),E},ln.prototype.canonicalizeTileset=function(i,a){for(var h=a?un(a):!1,p=[],x=0,E=i.tiles||[];x<E.length;x+=1){var M=E[x];$n(M)?p.push(this.canonicalizeTileURL(M,h)):p.push(M)}return p},ln.prototype._makeAPIURL=function(i,a){var h="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=Pn(zi.API_URL);if(i.protocol=p.protocol,i.authority=p.authority,i.protocol==="http"){var x=i.params.indexOf("secure");x>=0&&i.params.splice(x,1)}if(p.path!=="/"&&(i.path=""+p.path+i.path),!zi.REQUIRE_ACCESS_TOKEN)return ta(i);if(a=a||zi.ACCESS_TOKEN,!a)throw new Error("An API access token is required to use Mapbox GL. "+h);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+h);return i.params=i.params.filter(function(E){return E.indexOf("access_token")===-1}),i.params.push("access_token="+a),ta(i)};function un(e){return e.indexOf("mapbox:")===0}var Vn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function $n(e){return Vn.test(e)}function Ua(e){return e.indexOf("sku=")>0&&$n(e)}function Au(e){for(var i=0,a=e;i<a.length;i+=1){var h=a[i],p=h.match(/^access_token=(.*)$/);if(p)return p[1]}return null}var Bo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Pn(e){var i=e.match(Bo);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function ta(e){var i=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+i}var gl="mapbox.eventData";function yl(e){if(!e)return null;var i=e.split(".");if(!i||i.length!==3)return null;try{var a=JSON.parse(oo(i[1]));return a}catch{return null}}var ea=function(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ea.prototype.getStorageKey=function(i){var a=yl(zi.ACCESS_TOKEN),h="";return a&&a.u?h=Oa(a.u):h=zi.ACCESS_TOKEN||"",i?gl+"."+i+":"+h:gl+":"+h},ea.prototype.fetchEventData=function(){var i=Qi("localStorage"),a=this.getStorageKey(),h=this.getStorageKey("uuid");if(i)try{var p=me.localStorage.getItem(a);p&&(this.eventData=JSON.parse(p));var x=me.localStorage.getItem(h);x&&(this.anonId=x)}catch{rr("Unable to read from LocalStorage")}},ea.prototype.saveEventData=function(){var i=Qi("localStorage"),a=this.getStorageKey(),h=this.getStorageKey("uuid");if(i)try{me.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&me.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{rr("Unable to write to LocalStorage")}},ea.prototype.processRequests=function(i){},ea.prototype.postEvent=function(i,a,h,p){var x=this;if(zi.EVENTS_URL){var E=Pn(zi.EVENTS_URL);E.params.push("access_token="+(p||zi.ACCESS_TOKEN||""));var M={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:fe,skuId:Os,userId:this.anonId},L=a?Or(M,a):M,V={url:ta(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=It(V,function(Z){x.pendingRequest=null,h(Z),x.saveEventData(),x.processRequests(p)})}},ea.prototype.queueRequest=function(i,a){this.queue.push(i),this.processRequests(a)};var vl=function(e){function i(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.postMapLoadEvent=function(h,p,x,E){this.skuToken=x,(zi.EVENTS_URL&&E||zi.ACCESS_TOKEN&&Array.isArray(h)&&h.some(function(M){return un(M)||$n(M)}))&&this.queueRequest({id:p,timestamp:Date.now()},E)},i.prototype.processRequests=function(h){var p=this;if(!(this.pendingRequest||this.queue.length===0)){var x=this.queue.shift(),E=x.id,M=x.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),Rs(this.anonId)||(this.anonId=pa()),this.postEvent(M,{skuToken:this.skuToken},function(L){L||E&&(p.success[E]=!0)},h))}},i}(ea),xl=function(e){function i(a){e.call(this,"appUserTurnstile"),this._customAccessToken=a}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.postTurnstileEvent=function(h,p){zi.EVENTS_URL&&zi.ACCESS_TOKEN&&Array.isArray(h)&&h.some(function(x){return un(x)||$n(x)})&&this.queueRequest(Date.now(),p)},i.prototype.processRequests=function(h){var p=this;if(!(this.pendingRequest||this.queue.length===0)){(!this.anonId||!this.eventData.lastSuccess||!this.eventData.tokenU)&&this.fetchEventData();var x=yl(zi.ACCESS_TOKEN),E=x?x.u:zi.ACCESS_TOKEN,M=E!==this.eventData.tokenU;Rs(this.anonId)||(this.anonId=pa(),M=!0);var L=this.queue.shift();if(this.eventData.lastSuccess){var V=new Date(this.eventData.lastSuccess),Z=new Date(L),Y=(L-this.eventData.lastSuccess)/(24*60*60*1e3);M=M||Y>=1||Y<-1||V.getDate()!==Z.getDate()}else M=!0;if(!M)return this.processRequests();this.postEvent(L,{"enabled.telemetry":!1},function(rt){rt||(p.eventData.lastSuccess=L,p.eventData.tokenU=E)},h)}},i}(ea),Un=new xl,bl=Un.postTurnstileEvent.bind(Un),Oo=new vl,ho=Oo.postMapLoadEvent.bind(Oo),Vr="mapbox-tiles",Vo=500,tu=50,Uo=1e3*60*7,Na;function co(){me.caches&&!Na&&(Na=me.caches.open(Vr))}var Nn;function vs(e,i){if(Nn===void 0)try{new Response(new ReadableStream),Nn=!0}catch{Nn=!1}Nn?i(e.body):e.blob().then(i)}function eu(e,i,a){if(co(),!!Na){var h={status:i.status,statusText:i.statusText,headers:new me.Headers};i.headers.forEach(function(E,M){return h.headers.set(M,E)});var p=Lo(i.headers.get("Cache-Control")||"");if(!p["no-store"]){p["max-age"]&&h.headers.set("Expires",new Date(a+p["max-age"]*1e3).toUTCString());var x=new Date(h.headers.get("Expires")).getTime()-a;x<Uo||vs(i,function(E){var M=new me.Response(E,h);co(),Na&&Na.then(function(L){return L.put(iu(e.url),M)}).catch(function(L){return rr(L.message)})})}}}function iu(e){var i=e.indexOf("?");return i<0?e:e.slice(0,i)}function ru(e,i){if(co(),!Na)return i(null);var a=iu(e.url);Na.then(function(h){h.match(a).then(function(p){var x=wl(p);h.delete(a),x&&h.put(a,p.clone()),i(null,p,x)}).catch(i)}).catch(i)}function wl(e){if(!e)return!1;var i=new Date(e.headers.get("Expires")||0),a=Lo(e.headers.get("Cache-Control")||"");return i>Date.now()&&!a["no-cache"]}var Sl=1/0;function dt(e){Sl++,Sl>tu&&(e.getActor().send("enforceCacheSizeLimit",Vo),Sl=0)}function tt(e){co(),Na&&Na.then(function(i){i.keys().then(function(a){for(var h=0;h<a.length-e;h++)i.delete(a[h])})})}function Q(e){var i=me.caches.delete(Vr);e&&i.catch(e).then(function(){return e()})}function lt(e,i){Vo=e,tu=i}var gt;function Pt(){return gt==null&&(gt=me.OffscreenCanvas&&new me.OffscreenCanvas(1,1).getContext("2d")&&typeof me.createImageBitmap=="function"),gt}var Nt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Nt);var Mt=function(e){function i(a,h,p){h===401&&$n(p)&&(a+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,a),this.status=h,this.url=p,this.name=this.constructor.name,this.message=a}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},i}(Error),N=sn()?function(){return self.worker&&self.worker.referrer}:function(){return(me.location.protocol==="blob:"?me.parent:me).location.href},O=function(e){return/^file:/.test(e)||/^file:/.test(N())&&!/^\w+:/.test(e)};function H(e,i){var a=new me.AbortController,h=new me.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:N(),signal:a.signal}),p=!1,x=!1,E=Ua(h.url);e.type==="json"&&h.headers.set("Accept","application/json");var M=function(V,Z,Y){if(!x){if(V&&V.message!=="SecurityError"&&rr(V),Z&&Y)return L(Z);var rt=Date.now();me.fetch(h).then(function(it){if(it.ok){var ht=E?it.clone():null;return L(it,ht,rt)}else return i(new Mt(it.statusText,it.status,e.url))}).catch(function(it){it.code!==20&&i(new Error(it.message))})}},L=function(V,Z,Y){(e.type==="arrayBuffer"?V.arrayBuffer():e.type==="json"?V.json():V.text()).then(function(rt){x||(Z&&Y&&eu(h,Z,Y),p=!0,i(null,rt,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(function(rt){x||i(new Error(rt.message))})};return E?ru(h,M):M(null,null),{cancel:function(){x=!0,p||a.abort()}}}function W(e,i){var a=new me.XMLHttpRequest;a.open(e.method||"GET",e.url,!0),e.type==="arrayBuffer"&&(a.responseType="arraybuffer");for(var h in e.headers)a.setRequestHeader(h,e.headers[h]);return e.type==="json"&&(a.responseType="text",a.setRequestHeader("Accept","application/json")),a.withCredentials=e.credentials==="include",a.onerror=function(){i(new Error(a.statusText))},a.onload=function(){if((a.status>=200&&a.status<300||a.status===0)&&a.response!==null){var p=a.response;if(e.type==="json")try{p=JSON.parse(a.response)}catch(x){return i(x)}i(null,p,a.getResponseHeader("Cache-Control"),a.getResponseHeader("Expires"))}else i(new Mt(a.statusText,a.status,e.url))},a.send(e.body),{cancel:function(){return a.abort()}}}var nt=function(e,i){if(!O(e.url)){if(me.fetch&&me.Request&&me.AbortController&&me.Request.prototype.hasOwnProperty("signal"))return H(e,i);if(sn()&&self.worker&&self.worker.actor){var a=!0;return self.worker.actor.send("getResource",e,i,void 0,a)}}return W(e,i)},ft=function(e,i){return nt(Or(e,{type:"json"}),i)},St=function(e,i){return nt(Or(e,{type:"arrayBuffer"}),i)},It=function(e,i){return nt(Or(e,{method:"POST"}),i)};function Lt(e){var i=me.document.createElement("a");return i.href=e,i.protocol===me.document.location.protocol&&i.host===me.document.location.host}var Vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function qt(e,i,a,h){var p=new me.Image,x=me.URL;p.onload=function(){i(null,p),x.revokeObjectURL(p.src),p.onload=null,me.requestAnimationFrame(function(){p.src=Vt})},p.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var E=new me.Blob([new Uint8Array(e)],{type:"image/png"});p.cacheControl=a,p.expires=h,p.src=e.byteLength?x.createObjectURL(E):Vt}function ee(e,i){var a=new me.Blob([new Uint8Array(e)],{type:"image/png"});me.createImageBitmap(a).then(function(h){i(null,h)}).catch(function(h){i(new Error("Could not load image because of "+h.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}var Jt,se,Ae=function(){Jt=[],se=0};Ae();var Ie=function(e,i){if(uo.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),se>=zi.MAX_PARALLEL_IMAGE_REQUESTS){var a={requestParameters:e,callback:i,cancelled:!1,cancel:function(){this.cancelled=!0}};return Jt.push(a),a}se++;var h=!1,p=function(){if(!h)for(h=!0,se--;Jt.length&&se<zi.MAX_PARALLEL_IMAGE_REQUESTS;){var E=Jt.shift(),M=E.requestParameters,L=E.callback,V=E.cancelled;V||(E.cancel=Ie(M,L).cancel)}},x=St(e,function(E,M,L,V){p(),E?i(E):M&&(Pt()?ee(M,i):qt(M,i,L,V))});return{cancel:function(){x.cancel(),p()}}},We=function(e,i){var a=me.document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(var h=0;h<e.length;h++){var p=me.document.createElement("source");Lt(e[h])||(a.crossOrigin="Anonymous"),p.src=e[h],a.appendChild(p)}return{cancel:function(){}}};function di(e,i,a){var h=a[e]&&a[e].indexOf(i)!==-1;h||(a[e]=a[e]||[],a[e].push(i))}function mi(e,i,a){if(a&&a[e]){var h=a[e].indexOf(i);h!==-1&&a[e].splice(h,1)}}var Ht=function(i,a){a===void 0&&(a={}),Or(this,a),this.type=i},ii=function(e){function i(a,h){h===void 0&&(h={}),e.call(this,"error",Or({error:a},h))}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i}(Ht),tr=function(){};tr.prototype.on=function(i,a){return this._listeners=this._listeners||{},di(i,a,this._listeners),this},tr.prototype.off=function(i,a){return mi(i,a,this._listeners),mi(i,a,this._oneTimeListeners),this},tr.prototype.once=function(i,a){return this._oneTimeListeners=this._oneTimeListeners||{},di(i,a,this._oneTimeListeners),this},tr.prototype.fire=function(i,a){typeof i=="string"&&(i=new Ht(i,a||{}));var h=i.type;if(this.listens(h)){i.target=this;for(var p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[],x=0,E=p;x<E.length;x+=1){var M=E[x];M.call(this,i)}for(var L=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[],V=0,Z=L;V<Z.length;V+=1){var Y=Z[V];mi(h,Y,this._oneTimeListeners),Y.call(this,i)}var rt=this._eventedParent;rt&&(Or(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),rt.fire(i))}else i instanceof ii&&console.error(i.error);return this},tr.prototype.listens=function(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)},tr.prototype.setEventedParent=function(i,a){return this._eventedParent=i,this._eventedParentData=a,this};var Qr=8,Ei={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},er={"*":{type:"source"}},xs=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],qn={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},_a={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},as={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},No={type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},mr={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Vs={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},pi={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},qa=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],Tl={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},_e={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},fo={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},po={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Ac={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},nu={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Me={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Di={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Ci={type:"array",value:"*"},Za={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},Mu={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},vi={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},wf={type:"array",value:"*",minimum:1},gn={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},ja=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],Zn={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},Us={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},Ns={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},Ga={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},zr={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},pd={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},mo={"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},Uh={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},qo={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},An={"*":{type:"string"}},ue={$version:Qr,$root:Ei,sources:er,source:xs,source_vector:qn,source_raster:_a,source_raster_dem:as,source_geojson:No,source_video:mr,source_image:Vs,layer:pi,layout:qa,layout_background:Tl,layout_fill:_e,layout_circle:fo,layout_heatmap:po,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:Ac,layout_symbol:nu,layout_raster:Me,layout_hillshade:Di,filter:Ci,filter_operator:Za,geometry_type:Mu,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:vi,expression:wf,light:gn,paint:ja,paint_fill:Zn,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:Us,paint_circle:Ns,paint_heatmap:Ga,paint_symbol:zr,paint_raster:pd,paint_hillshade:mo,paint_background:Uh,transition:qo,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:An},Ue=function(i,a,h,p){this.message=(i?i+": ":"")+h,p&&(this.identifier=p),a!=null&&a.__line__&&(this.line=a.__line__)};function zu(e){var i=e.key,a=e.value;return a?[new Ue(i,a,"constants have been deprecated as of v8")]:[]}function au(e){for(var i=[],a=arguments.length-1;a-- >0;)i[a]=arguments[a+1];for(var h=0,p=i;h<p.length;h+=1){var x=p[h];for(var E in x)e[E]=x[E]}return e}function vr(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function qs(e){if(Array.isArray(e))return e.map(qs);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var i={};for(var a in e)i[a]=qs(e[a]);return i}return vr(e)}var _o=function(e){function i(a,h){e.call(this,h),this.message=h,this.key=a}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i}(Error),lh=function(i,a){a===void 0&&(a=[]),this.parent=i,this.bindings={};for(var h=0,p=a;h<p.length;h+=1){var x=p[h],E=x[0],M=x[1];this.bindings[E]=M}};lh.prototype.concat=function(i){return new lh(this,i)},lh.prototype.get=function(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(i+" not found in scope.")},lh.prototype.has=function(i){return this.bindings[i]?!0:this.parent?this.parent.has(i):!1};var Du={kind:"null"},ze={kind:"number"},ki={kind:"string"},xi={kind:"boolean"},bs={kind:"color"},Zo={kind:"object"},Si={kind:"value"},su={kind:"error"},ou={kind:"collator"},El={kind:"formatted"},uh={kind:"resolvedImage"};function ws(e,i){return{kind:"array",itemType:e,N:i}}function br(e){if(e.kind==="array"){var i=br(e.itemType);return typeof e.N=="number"?"array<"+i+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+i+">"}else return e.kind}var lu=[Du,ze,ki,xi,bs,El,Zo,ws(Si),uh];function Ss(e,i){if(i.kind==="error")return null;if(e.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Ss(e.itemType,i.itemType))&&(typeof e.N!="number"||e.N===i.N))return null}else{if(e.kind===i.kind)return null;if(e.kind==="value")for(var a=0,h=lu;a<h.length;a+=1){var p=h[a];if(!Ss(p,i))return null}}return"Expected "+br(e)+" but found "+br(i)+" instead."}function Nh(e,i){return i.some(function(a){return a.kind===e.kind})}function hh(e,i){return i.some(function(a){return a==="null"?e===null:a==="array"?Array.isArray(e):a==="object"?e&&!Array.isArray(e)&&typeof e=="object":a===typeof e})}var cr=C(function(e,i){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(V){return V=Math.round(V),V<0?0:V>255?255:V}function p(V){return V<0?0:V>1?1:V}function x(V){return V[V.length-1]==="%"?h(parseFloat(V)/100*255):h(parseInt(V))}function E(V){return V[V.length-1]==="%"?p(parseFloat(V)/100):p(parseFloat(V))}function M(V,Z,Y){return Y<0?Y+=1:Y>1&&(Y-=1),Y*6<1?V+(Z-V)*Y*6:Y*2<1?Z:Y*3<2?V+(Z-V)*(2/3-Y)*6:V}function L(V){var Z=V.replace(/ /g,"").toLowerCase();if(Z in a)return a[Z].slice();if(Z[0]==="#"){if(Z.length===4){var Y=parseInt(Z.substr(1),16);return Y>=0&&Y<=4095?[(Y&3840)>>4|(Y&3840)>>8,Y&240|(Y&240)>>4,Y&15|(Y&15)<<4,1]:null}else if(Z.length===7){var Y=parseInt(Z.substr(1),16);return Y>=0&&Y<=16777215?[(Y&16711680)>>16,(Y&65280)>>8,Y&255,1]:null}return null}var rt=Z.indexOf("("),it=Z.indexOf(")");if(rt!==-1&&it+1===Z.length){var ht=Z.substr(0,rt),_t=Z.substr(rt+1,it-(rt+1)).split(","),zt=1;switch(ht){case"rgba":if(_t.length!==4)return null;zt=E(_t.pop());case"rgb":return _t.length!==3?null:[x(_t[0]),x(_t[1]),x(_t[2]),zt];case"hsla":if(_t.length!==4)return null;zt=E(_t.pop());case"hsl":if(_t.length!==3)return null;var Ct=(parseFloat(_t[0])%360+360)%360/360,jt=E(_t[1]),Rt=E(_t[2]),Zt=Rt<=.5?Rt*(jt+1):Rt+jt-Rt*jt,Wt=Rt*2-Zt;return[h(M(Wt,Zt,Ct+1/3)*255),h(M(Wt,Zt,Ct)*255),h(M(Wt,Zt,Ct-1/3)*255),zt];default:return null}}return null}try{i.parseCSSColor=L}catch{}}),qh=cr.parseCSSColor,Ki=function(i,a,h,p){p===void 0&&(p=1),this.r=i,this.g=a,this.b=h,this.a=p};Ki.parse=function(i){if(i){if(i instanceof Ki)return i;if(typeof i=="string"){var a=qh(i);if(a)return new Ki(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},Ki.prototype.toString=function(){var i=this.toArray(),a=i[0],h=i[1],p=i[2],x=i[3];return"rgba("+Math.round(a)+","+Math.round(h)+","+Math.round(p)+","+x+")"},Ki.prototype.toArray=function(){var i=this,a=i.r,h=i.g,p=i.b,x=i.a;return x===0?[0,0,0,0]:[a*255/x,h*255/x,p*255/x,x]},Ki.black=new Ki(0,0,0,1),Ki.white=new Ki(1,1,1,1),Ki.transparent=new Ki(0,0,0,0),Ki.red=new Ki(1,0,0,1);var jn=function(i,a,h){i?this.sensitivity=a?"variant":"case":this.sensitivity=a?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};jn.prototype.compare=function(i,a){return this.collator.compare(i,a)},jn.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ga=function(i,a,h,p,x){this.text=i,this.image=a,this.scale=h,this.fontStack=p,this.textColor=x},Mn=function(i){this.sections=i};Mn.fromString=function(i){return new Mn([new ga(i,null,null,null,null)])},Mn.prototype.isEmpty=function(){return this.sections.length===0?!0:!this.sections.some(function(i){return i.text.length!==0||i.image&&i.image.name.length!==0})},Mn.factory=function(i){return i instanceof Mn?i:Mn.fromString(i)},Mn.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(i){return i.text}).join("")},Mn.prototype.serialize=function(){for(var i=["format"],a=0,h=this.sections;a<h.length;a+=1){var p=h[a];if(p.image){i.push(["image",p.image.name]);continue}i.push(p.text);var x={};p.fontStack&&(x["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(x["font-scale"]=p.scale),p.textColor&&(x["text-color"]=["rgba"].concat(p.textColor.toArray())),i.push(x)}return i};var Pr=function(i){this.name=i.name,this.available=i.available};Pr.prototype.toString=function(){return this.name},Pr.fromString=function(i){return i?new Pr({name:i,available:!1}):null},Pr.prototype.serialize=function(){return["image",this.name]};function ss(e,i,a,h){if(!(typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255)){var p=typeof h=="number"?[e,i,a,h]:[e,i,a];return"Invalid rgba value ["+p.join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}return typeof h>"u"||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[e,i,a,h].join(", ")+"]: 'a' must be between 0 and 1."}function ch(e){if(e===null)return!0;if(typeof e=="string")return!0;if(typeof e=="boolean")return!0;if(typeof e=="number")return!0;if(e instanceof Ki)return!0;if(e instanceof jn)return!0;if(e instanceof Mn)return!0;if(e instanceof Pr)return!0;if(Array.isArray(e)){for(var i=0,a=e;i<a.length;i+=1){var h=a[i];if(!ch(h))return!1}return!0}else if(typeof e=="object"){for(var p in e)if(!ch(e[p]))return!1;return!0}else return!1}function Dr(e){if(e===null)return Du;if(typeof e=="string")return ki;if(typeof e=="boolean")return xi;if(typeof e=="number")return ze;if(e instanceof Ki)return bs;if(e instanceof jn)return ou;if(e instanceof Mn)return El;if(e instanceof Pr)return uh;if(Array.isArray(e)){for(var i=e.length,a,h=0,p=e;h<p.length;h+=1){var x=p[h],E=Dr(x);if(!a)a=E;else{if(a===E)continue;a=Si;break}}return ws(a||Si,i)}else return Zo}function kr(e){var i=typeof e;return e===null?"":i==="string"||i==="number"||i==="boolean"?String(e):e instanceof Ki||e instanceof Mn||e instanceof Pr?e.toString():JSON.stringify(e)}var ya=function(i,a){this.type=i,this.value=a};ya.parse=function(i,a){if(i.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(!ch(i[1]))return a.error("invalid value");var h=i[1],p=Dr(h),x=a.expectedType;return p.kind==="array"&&p.N===0&&x&&x.kind==="array"&&(typeof x.N!="number"||x.N===0)&&(p=x),new ya(p,h)},ya.prototype.evaluate=function(){return this.value},ya.prototype.eachChild=function(){},ya.prototype.outputDefined=function(){return!0},ya.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ki?["rgba"].concat(this.value.toArray()):this.value instanceof Mn?this.value.serialize():this.value};var Fr=function(i){this.name="ExpressionEvaluationError",this.message=i};Fr.prototype.toJSON=function(){return this.message};var Ur={string:ki,number:ze,boolean:xi,object:Zo},zn=function(i,a){this.type=i,this.args=a};zn.parse=function(i,a){if(i.length<2)return a.error("Expected at least one argument.");var h=1,p,x=i[0];if(x==="array"){var E;if(i.length>2){var M=i[1];if(typeof M!="string"||!(M in Ur)||M==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ur[M],h++}else E=Si;var L;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);L=i[2],h++}p=ws(E,L)}else p=Ur[x];for(var V=[];h<i.length;h++){var Z=a.parse(i[h],h,Si);if(!Z)return null;V.push(Z)}return new zn(p,V)},zn.prototype.evaluate=function(i){for(var a=0;a<this.args.length;a++){var h=this.args[a].evaluate(i),p=Ss(this.type,Dr(h));if(p){if(a===this.args.length-1)throw new Fr("Expected value to be of type "+br(this.type)+", but found "+br(Dr(h))+" instead.")}else return h}return null},zn.prototype.eachChild=function(i){this.args.forEach(i)},zn.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},zn.prototype.serialize=function(){var i=this.type,a=[i.kind];if(i.kind==="array"){var h=i.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){a.push(h.kind);var p=i.N;(typeof p=="number"||this.args.length>1)&&a.push(p)}}return a.concat(this.args.map(function(x){return x.serialize()}))};var yn=function(i){this.type=El,this.sections=i};yn.parse=function(i,a){if(i.length<2)return a.error("Expected at least one argument.");var h=i[1];if(!Array.isArray(h)&&typeof h=="object")return a.error("First argument must be an image or text section.");for(var p=[],x=!1,E=1;E<=i.length-1;++E){var M=i[E];if(x&&typeof M=="object"&&!Array.isArray(M)){x=!1;var L=null;if(M["font-scale"]&&(L=a.parse(M["font-scale"],1,ze),!L))return null;var V=null;if(M["text-font"]&&(V=a.parse(M["text-font"],1,ws(ki)),!V))return null;var Z=null;if(M["text-color"]&&(Z=a.parse(M["text-color"],1,bs),!Z))return null;var Y=p[p.length-1];Y.scale=L,Y.font=V,Y.textColor=Z}else{var rt=a.parse(i[E],1,Si);if(!rt)return null;var it=rt.type.kind;if(it!=="string"&&it!=="value"&&it!=="null"&&it!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,p.push({content:rt,scale:null,font:null,textColor:null})}}return new yn(p)},yn.prototype.evaluate=function(i){var a=function(h){var p=h.content.evaluate(i);return Dr(p)===uh?new ga("",p,null,null,null):new ga(kr(p),null,h.scale?h.scale.evaluate(i):null,h.font?h.font.evaluate(i).join(","):null,h.textColor?h.textColor.evaluate(i):null)};return new Mn(this.sections.map(a))},yn.prototype.eachChild=function(i){for(var a=0,h=this.sections;a<h.length;a+=1){var p=h[a];i(p.content),p.scale&&i(p.scale),p.font&&i(p.font),p.textColor&&i(p.textColor)}},yn.prototype.outputDefined=function(){return!1},yn.prototype.serialize=function(){for(var i=["format"],a=0,h=this.sections;a<h.length;a+=1){var p=h[a];i.push(p.content.serialize());var x={};p.scale&&(x["font-scale"]=p.scale.serialize()),p.font&&(x["text-font"]=p.font.serialize()),p.textColor&&(x["text-color"]=p.textColor.serialize()),i.push(x)}return i};var jo=function(i){this.type=uh,this.input=i};jo.parse=function(i,a){if(i.length!==2)return a.error("Expected two arguments.");var h=a.parse(i[1],1,ki);return h?new jo(h):a.error("No image name provided.")},jo.prototype.evaluate=function(i){var a=this.input.evaluate(i),h=Pr.fromString(a);return h&&i.availableImages&&(h.available=i.availableImages.indexOf(a)>-1),h},jo.prototype.eachChild=function(i){i(this.input)},jo.prototype.outputDefined=function(){return!1},jo.prototype.serialize=function(){return["image",this.input.serialize()]};var Il={"to-boolean":xi,"to-color":bs,"to-number":ze,"to-string":ki},Ts=function(i,a){this.type=i,this.args=a};Ts.parse=function(i,a){if(i.length<2)return a.error("Expected at least one argument.");var h=i[0];if((h==="to-boolean"||h==="to-string")&&i.length!==2)return a.error("Expected one argument.");for(var p=Il[h],x=[],E=1;E<i.length;E++){var M=a.parse(i[E],E,Si);if(!M)return null;x.push(M)}return new Ts(p,x)},Ts.prototype.evaluate=function(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){for(var a,h,p=0,x=this.args;p<x.length;p+=1){var E=x[p];if(a=E.evaluate(i),h=null,a instanceof Ki)return a;if(typeof a=="string"){var M=i.parseColor(a);if(M)return M}else if(Array.isArray(a)&&(a.length<3||a.length>4?h="Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":h=ss(a[0],a[1],a[2],a[3]),!h))return new Ki(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Fr(h||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}else if(this.type.kind==="number"){for(var L=null,V=0,Z=this.args;V<Z.length;V+=1){var Y=Z[V];if(L=Y.evaluate(i),L===null)return 0;var rt=Number(L);if(!isNaN(rt))return rt}throw new Fr("Could not convert "+JSON.stringify(L)+" to number.")}else return this.type.kind==="formatted"?Mn.fromString(kr(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Pr.fromString(kr(this.args[0].evaluate(i))):kr(this.args[0].evaluate(i))},Ts.prototype.eachChild=function(i){this.args.forEach(i)},Ts.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},Ts.prototype.serialize=function(){if(this.type.kind==="formatted")return new yn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new jo(this.args[0]).serialize();var i=["to-"+this.type.kind];return this.eachChild(function(a){i.push(a.serialize())}),i};var Sf=["Unknown","Point","LineString","Polygon"],Zs=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Zs.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Zs.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Sf[this.feature.type]:this.feature.type:null},Zs.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Zs.prototype.canonicalID=function(){return this.canonical},Zs.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Zs.prototype.parseColor=function(i){var a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=Ki.parse(i)),a};var hn=function(i,a,h,p){this.name=i,this.type=a,this._evaluate=h,this.args=p};hn.prototype.evaluate=function(i){return this._evaluate(i,this.args)},hn.prototype.eachChild=function(i){this.args.forEach(i)},hn.prototype.outputDefined=function(){return!1},hn.prototype.serialize=function(){return[this.name].concat(this.args.map(function(i){return i.serialize()}))},hn.parse=function(i,a){var h,p=i[0],x=hn.definitions[p];if(!x)return a.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(x)?x[0]:x.type,M=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,L=M.filter(function(Oe){var Ve=Oe[0];return!Array.isArray(Ve)||Ve.length===i.length-1}),V=null,Z=0,Y=L;Z<Y.length;Z+=1){var rt=Y[Z],it=rt[0],ht=rt[1];V=new Ho(a.registry,a.path,null,a.scope);for(var _t=[],zt=!1,Ct=1;Ct<i.length;Ct++){var jt=i[Ct],Rt=Array.isArray(it)?it[Ct-1]:it.type,Zt=V.parse(jt,1+_t.length,Rt);if(!Zt){zt=!0;break}_t.push(Zt)}if(!zt){if(Array.isArray(it)&&it.length!==_t.length){V.error("Expected "+it.length+" arguments, but found "+_t.length+" instead.");continue}for(var Wt=0;Wt<_t.length;Wt++){var le=Array.isArray(it)?it[Wt]:it.type,xe=_t[Wt];V.concat(Wt+1).checkSubtype(le,xe.type)}if(V.errors.length===0)return new hn(p,E,ht,_t)}}if(L.length===1)(h=a.errors).push.apply(h,V.errors);else{for(var ve=L.length?L:M,Be=ve.map(function(Oe){var Ve=Oe[0];return Zh(Ve)}).join(" | "),Te=[],De=1;De<i.length;De++){var oi=a.parse(i[De],1+Te.length);if(!oi)return null;Te.push(br(oi.type))}a.error("Expected arguments of type "+Be+", but found ("+Te.join(", ")+") instead.")}return null},hn.register=function(i,a){hn.definitions=a;for(var h in a)i[h]=hn};function Zh(e){return Array.isArray(e)?"("+e.map(br).join(", ")+")":"("+br(e.type)+"...)"}var go=function(i,a,h){this.type=ou,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=a};go.parse=function(i,a){if(i.length!==2)return a.error("Expected one argument.");var h=i[1];if(typeof h!="object"||Array.isArray(h))return a.error("Collator options argument must be an object.");var p=a.parse(h["case-sensitive"]===void 0?!1:h["case-sensitive"],1,xi);if(!p)return null;var x=a.parse(h["diacritic-sensitive"]===void 0?!1:h["diacritic-sensitive"],1,xi);if(!x)return null;var E=null;return h.locale&&(E=a.parse(h.locale,1,ki),!E)?null:new go(p,x,E)},go.prototype.evaluate=function(i){return new jn(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)},go.prototype.eachChild=function(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)},go.prototype.outputDefined=function(){return!1},go.prototype.serialize=function(){var i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]};var yo=8192;function ku(e,i){e[0]=Math.min(e[0],i[0]),e[1]=Math.min(e[1],i[1]),e[2]=Math.max(e[2],i[0]),e[3]=Math.max(e[3],i[1])}function Mc(e){return(180+e)/360}function zc(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function uu(e,i){return!(e[0]<=i[0]||e[2]>=i[2]||e[1]<=i[1]||e[3]>=i[3])}function jh(e,i){var a=Mc(e[0]),h=zc(e[1]),p=Math.pow(2,i.z);return[Math.round(a*p*yo),Math.round(h*p*yo)]}function fh(e,i,a){var h=e[0]-i[0],p=e[1]-i[1],x=e[0]-a[0],E=e[1]-a[1];return h*E-x*p===0&&h*x<=0&&p*E<=0}function md(e,i,a){return i[1]>e[1]!=a[1]>e[1]&&e[0]<(a[0]-i[0])*(e[1]-i[1])/(a[1]-i[1])+i[0]}function Dc(e,i){for(var a=!1,h=0,p=i.length;h<p;h++)for(var x=i[h],E=0,M=x.length;E<M-1;E++){if(fh(e,x[E],x[E+1]))return!1;md(e,x[E],x[E+1])&&(a=!a)}return a}function Tf(e,i){for(var a=0;a<i.length;a++)if(Dc(e,i[a]))return!0;return!1}function _d(e,i){return e[0]*i[1]-e[1]*i[0]}function Ef(e,i,a,h){var p=e[0]-a[0],x=e[1]-a[1],E=i[0]-a[0],M=i[1]-a[1],L=h[0]-a[0],V=h[1]-a[1],Z=p*V-L*x,Y=E*V-L*M;return Z>0&&Y<0||Z<0&&Y>0}function hu(e,i,a,h){var p=[i[0]-e[0],i[1]-e[1]],x=[h[0]-a[0],h[1]-a[1]];return _d(x,p)===0?!1:!!(Ef(e,i,a,h)&&Ef(a,h,e,i))}function gd(e,i,a){for(var h=0,p=a;h<p.length;h+=1)for(var x=p[h],E=0;E<x.length-1;++E)if(hu(e,i,x[E],x[E+1]))return!0;return!1}function dh(e,i){for(var a=0;a<e.length;++a)if(!Dc(e[a],i))return!1;for(var h=0;h<e.length-1;++h)if(gd(e[h],e[h+1],i))return!1;return!0}function yd(e,i){for(var a=0;a<i.length;a++)if(dh(e,i[a]))return!0;return!1}function kc(e,i,a){for(var h=[],p=0;p<e.length;p++){for(var x=[],E=0;E<e[p].length;E++){var M=jh(e[p][E],a);ku(i,M),x.push(M)}h.push(x)}return h}function Dn(e,i,a){for(var h=[],p=0;p<e.length;p++){var x=kc(e[p],i,a);h.push(x)}return h}function Pi(e,i,a,h){if(e[0]<a[0]||e[0]>a[2]){var p=h*.5,x=e[0]-a[0]>p?-h:a[0]-e[0]>p?h:0;x===0&&(x=e[0]-a[2]>p?-h:a[2]-e[0]>p?h:0),e[0]+=x}ku(i,e)}function Fc(e){e[0]=e[1]=1/0,e[2]=e[3]=-1/0}function Fu(e,i,a,h){for(var p=Math.pow(2,h.z)*yo,x=[h.x*yo,h.y*yo],E=[],M=0,L=e;M<L.length;M+=1)for(var V=L[M],Z=0,Y=V;Z<Y.length;Z+=1){var rt=Y[Z],it=[rt.x+x[0],rt.y+x[1]];Pi(it,i,a,p),E.push(it)}return E}function Lc(e,i,a,h){for(var p=Math.pow(2,h.z)*yo,x=[h.x*yo,h.y*yo],E=[],M=0,L=e;M<L.length;M+=1){for(var V=L[M],Z=[],Y=0,rt=V;Y<rt.length;Y+=1){var it=rt[Y],ht=[it.x+x[0],it.y+x[1]];ku(i,ht),Z.push(ht)}E.push(Z)}if(i[2]-i[0]<=p/2){Fc(i);for(var _t=0,zt=E;_t<zt.length;_t+=1)for(var Ct=zt[_t],jt=0,Rt=Ct;jt<Rt.length;jt+=1){var Zt=Rt[jt];Pi(Zt,i,a,p)}}return E}function vd(e,i){var a=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=e.canonicalID();if(i.type==="Polygon"){var x=kc(i.coordinates,h,p),E=Fu(e.geometry(),a,h,p);if(!uu(a,h))return!1;for(var M=0,L=E;M<L.length;M+=1){var V=L[M];if(!Dc(V,x))return!1}}if(i.type==="MultiPolygon"){var Z=Dn(i.coordinates,h,p),Y=Fu(e.geometry(),a,h,p);if(!uu(a,h))return!1;for(var rt=0,it=Y;rt<it.length;rt+=1){var ht=it[rt];if(!Tf(ht,Z))return!1}}return!0}function xd(e,i){var a=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=e.canonicalID();if(i.type==="Polygon"){var x=kc(i.coordinates,h,p),E=Lc(e.geometry(),a,h,p);if(!uu(a,h))return!1;for(var M=0,L=E;M<L.length;M+=1){var V=L[M];if(!dh(V,x))return!1}}if(i.type==="MultiPolygon"){var Z=Dn(i.coordinates,h,p),Y=Lc(e.geometry(),a,h,p);if(!uu(a,h))return!1;for(var rt=0,it=Y;rt<it.length;rt+=1){var ht=it[rt];if(!yd(ht,Z))return!1}}return!0}var js=function(i,a){this.type=xi,this.geojson=i,this.geometries=a};js.parse=function(i,a){if(i.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(ch(i[1])){var h=i[1];if(h.type==="FeatureCollection")for(var p=0;p<h.features.length;++p){var x=h.features[p].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new js(h,h.features[p].geometry)}else if(h.type==="Feature"){var E=h.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new js(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new js(h,h)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},js.prototype.evaluate=function(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return vd(i,this.geometries);if(i.geometryType()==="LineString")return xd(i,this.geometries)}return!1},js.prototype.eachChild=function(){},js.prototype.outputDefined=function(){return!0},js.prototype.serialize=function(){return["within",this.geojson]};function Gh(e){if(e instanceof hn){if(e.name==="get"&&e.args.length===1)return!1;if(e.name==="feature-state")return!1;if(e.name==="has"&&e.args.length===1)return!1;if(e.name==="properties"||e.name==="geometry-type"||e.name==="id")return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof js)return!1;var i=!0;return e.eachChild(function(a){i&&!Gh(a)&&(i=!1)}),i}function cu(e){if(e instanceof hn&&e.name==="feature-state")return!1;var i=!0;return e.eachChild(function(a){i&&!cu(a)&&(i=!1)}),i}function Lu(e,i){if(e instanceof hn&&i.indexOf(e.name)>=0)return!1;var a=!0;return e.eachChild(function(h){a&&!Lu(h,i)&&(a=!1)}),a}var Go=function(i,a){this.type=a.type,this.name=i,this.boundExpression=a};Go.parse=function(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var h=i[1];return a.scope.has(h)?new Go(h,a.scope.get(h)):a.error('Unknown variable "'+h+'". Make sure "'+h+'" has been bound in an enclosing "let" expression before using it.',1)},Go.prototype.evaluate=function(i){return this.boundExpression.evaluate(i)},Go.prototype.eachChild=function(){},Go.prototype.outputDefined=function(){return!1},Go.prototype.serialize=function(){return["var",this.name]};var Ho=function(i,a,h,p,x){a===void 0&&(a=[]),p===void 0&&(p=new lh),x===void 0&&(x=[]),this.registry=i,this.path=a,this.key=a.map(function(E){return"["+E+"]"}).join(""),this.scope=p,this.errors=x,this.expectedType=h};Ho.prototype.parse=function(i,a,h,p,x){return x===void 0&&(x={}),a?this.concat(a,h,p)._parse(i,x):this._parse(i,x)},Ho.prototype._parse=function(i,a){(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number")&&(i=["literal",i]);function h(Z,Y,rt){return rt==="assert"?new zn(Y,[Z]):rt==="coerce"?new Ts(Y,[Z]):Z}if(Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=i[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var x=this.registry[p];if(x){var E=x.parse(i,this);if(!E)return null;if(this.expectedType){var M=this.expectedType,L=E.type;if((M.kind==="string"||M.kind==="number"||M.kind==="boolean"||M.kind==="object"||M.kind==="array")&&L.kind==="value")E=h(E,M,a.typeAnnotation||"assert");else if((M.kind==="color"||M.kind==="formatted"||M.kind==="resolvedImage")&&(L.kind==="value"||L.kind==="string"))E=h(E,M,a.typeAnnotation||"coerce");else if(this.checkSubtype(M,L))return null}if(!(E instanceof ya)&&E.type.kind!=="resolvedImage"&&Rc(E)){var V=new Zs;try{E=new ya(E.type,E.evaluate(V))}catch(Z){return this.error(Z.message),null}}return E}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}else return typeof i>"u"?this.error("'undefined' value invalid. Use null instead."):typeof i=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof i+" instead.")},Ho.prototype.concat=function(i,a,h){var p=typeof i=="number"?this.path.concat(i):this.path,x=h?this.scope.concat(h):this.scope;return new Ho(this.registry,p,a||null,x,this.errors)},Ho.prototype.error=function(i){for(var a=[],h=arguments.length-1;h-- >0;)a[h]=arguments[h+1];var p=""+this.key+a.map(function(x){return"["+x+"]"}).join("");this.errors.push(new _o(p,i))},Ho.prototype.checkSubtype=function(i,a){var h=Ss(i,a);return h&&this.error(h),h};function Rc(e){if(e instanceof Go)return Rc(e.boundExpression);if(e instanceof hn&&e.name==="error")return!1;if(e instanceof go)return!1;if(e instanceof js)return!1;var i=e instanceof Ts||e instanceof zn,a=!0;return e.eachChild(function(h){i?a=a&&Rc(h):a=a&&h instanceof ya}),a?Gh(e)&&Lu(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]):!1}function Hh(e,i){for(var a=e.length-1,h=0,p=a,x=0,E,M;h<=p;)if(x=Math.floor((h+p)/2),E=e[x],M=e[x+1],E<=i){if(x===a||i<M)return x;h=x+1}else if(E>i)p=x-1;else throw new Fr("Input is not a number.");return 0}var Xo=function(i,a,h){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(var p=0,x=h;p<x.length;p+=1){var E=x[p],M=E[0],L=E[1];this.labels.push(M),this.outputs.push(L)}};Xo.parse=function(i,a){if(i.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!==0)return a.error("Expected an even number of arguments.");var h=a.parse(i[1],1,ze);if(!h)return null;var p=[],x=null;a.expectedType&&a.expectedType.kind!=="value"&&(x=a.expectedType);for(var E=1;E<i.length;E+=2){var M=E===1?-1/0:i[E],L=i[E+1],V=E,Z=E+1;if(typeof M!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(p.length&&p[p.length-1][0]>=M)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',V);var Y=a.parse(L,Z,x);if(!Y)return null;x=x||Y.type,p.push([M,Y])}return new Xo(x,h,p)},Xo.prototype.evaluate=function(i){var a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(i);var p=this.input.evaluate(i);if(p<=a[0])return h[0].evaluate(i);var x=a.length;if(p>=a[x-1])return h[x-1].evaluate(i);var E=Hh(a,p);return h[E].evaluate(i)},Xo.prototype.eachChild=function(i){i(this.input);for(var a=0,h=this.outputs;a<h.length;a+=1){var p=h[a];i(p)}},Xo.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},Xo.prototype.serialize=function(){for(var i=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i};function $r(e,i,a){return e*(1-a)+i*a}function Ru(e,i,a){return new Ki($r(e.r,i.r,a),$r(e.g,i.g,a),$r(e.b,i.b,a),$r(e.a,i.a,a))}function bd(e,i,a){return e.map(function(h,p){return $r(h,i[p],a)})}var Xh=Object.freeze({__proto__:null,number:$r,color:Ru,array:bd}),If=.95047,Cf=1,Bc=1.08883,Oc=4/29,Wo=6/29,Wh=3*Wo*Wo,Kh=Wo*Wo*Wo,Vc=Math.PI/180,Uc=180/Math.PI;function Es(e){return e>Kh?Math.pow(e,1/3):e/Wh+Oc}function Nc(e){return e>Wo?e*e*e:Wh*(e-Oc)}function ph(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function qc(e){return e/=255,e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Zc(e){var i=qc(e.r),a=qc(e.g),h=qc(e.b),p=Es((.4124564*i+.3575761*a+.1804375*h)/If),x=Es((.2126729*i+.7151522*a+.072175*h)/Cf),E=Es((.0193339*i+.119192*a+.9503041*h)/Bc);return{l:116*x-16,a:500*(p-x),b:200*(x-E),alpha:e.a}}function Pf(e){var i=(e.l+16)/116,a=isNaN(e.a)?i:i+e.a/500,h=isNaN(e.b)?i:i-e.b/200;return i=Cf*Nc(i),a=If*Nc(a),h=Bc*Nc(h),new Ki(ph(3.2404542*a-1.5371385*i-.4985314*h),ph(-.969266*a+1.8760108*i+.041556*h),ph(.0556434*a-.2040259*i+1.0572252*h),e.alpha)}function wr(e,i,a){return{l:$r(e.l,i.l,a),a:$r(e.a,i.a,a),b:$r(e.b,i.b,a),alpha:$r(e.alpha,i.alpha,a)}}function mh(e){var i=Zc(e),a=i.l,h=i.a,p=i.b,x=Math.atan2(p,h)*Uc;return{h:x<0?x+360:x,c:Math.sqrt(h*h+p*p),l:a,alpha:e.a}}function Cl(e){var i=e.h*Vc,a=e.c,h=e.l;return Pf({l:h,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:e.alpha})}function jc(e,i,a){var h=i-e;return e+a*(h>180||h<-180?h-360*Math.round(h/360):h)}function Gc(e,i,a){return{h:jc(e.h,i.h,a),c:$r(e.c,i.c,a),l:$r(e.l,i.l,a),alpha:$r(e.alpha,i.alpha,a)}}var Ko={forward:Zc,reverse:Pf,interpolate:wr},_h={forward:mh,reverse:Cl,interpolate:Gc},fu=Object.freeze({__proto__:null,lab:Ko,hcl:_h}),kn=function(i,a,h,p,x){this.type=i,this.operator=a,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(var E=0,M=x;E<M.length;E+=1){var L=M[E],V=L[0],Z=L[1];this.labels.push(V),this.outputs.push(Z)}};kn.interpolationFactor=function(i,a,h,p){var x=0;if(i.name==="exponential")x=gh(a,i.base,h,p);else if(i.name==="linear")x=gh(a,1,h,p);else if(i.name==="cubic-bezier"){var E=i.controlPoints,M=new Yr(E[0],E[1],E[2],E[3]);x=M.solve(gh(a,1,h,p))}return x},kn.parse=function(i,a){var h=i[0],p=i[1],x=i[2],E=i.slice(3);if(!Array.isArray(p)||p.length===0)return a.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var M=p[1];if(typeof M!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:M}}else if(p[0]==="cubic-bezier"){var L=p.slice(1);if(L.length!==4||L.some(function(Ct){return typeof Ct!="number"||Ct<0||Ct>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:L}}else return a.error("Unknown interpolation type "+String(p[0]),1,0);if(i.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!==0)return a.error("Expected an even number of arguments.");if(x=a.parse(x,2,ze),!x)return null;var V=[],Z=null;h==="interpolate-hcl"||h==="interpolate-lab"?Z=bs:a.expectedType&&a.expectedType.kind!=="value"&&(Z=a.expectedType);for(var Y=0;Y<E.length;Y+=2){var rt=E[Y],it=E[Y+1],ht=Y+3,_t=Y+4;if(typeof rt!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ht);if(V.length&&V[V.length-1][0]>=rt)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ht);var zt=a.parse(it,_t,Z);if(!zt)return null;Z=Z||zt.type,V.push([rt,zt])}return Z.kind!=="number"&&Z.kind!=="color"&&!(Z.kind==="array"&&Z.itemType.kind==="number"&&typeof Z.N=="number")?a.error("Type "+br(Z)+" is not interpolatable."):new kn(Z,h,p,x,V)},kn.prototype.evaluate=function(i){var a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(i);var p=this.input.evaluate(i);if(p<=a[0])return h[0].evaluate(i);var x=a.length;if(p>=a[x-1])return h[x-1].evaluate(i);var E=Hh(a,p),M=a[E],L=a[E+1],V=kn.interpolationFactor(this.interpolation,p,M,L),Z=h[E].evaluate(i),Y=h[E+1].evaluate(i);return this.operator==="interpolate"?Xh[this.type.kind.toLowerCase()](Z,Y,V):this.operator==="interpolate-hcl"?_h.reverse(_h.interpolate(_h.forward(Z),_h.forward(Y),V)):Ko.reverse(Ko.interpolate(Ko.forward(Z),Ko.forward(Y),V))},kn.prototype.eachChild=function(i){i(this.input);for(var a=0,h=this.outputs;a<h.length;a+=1){var p=h[a];i(p)}},kn.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},kn.prototype.serialize=function(){var i;this.interpolation.name==="linear"?i=["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?i=["linear"]:i=["exponential",this.interpolation.base]:i=["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,i,this.input.serialize()],h=0;h<this.labels.length;h++)a.push(this.labels[h],this.outputs[h].serialize());return a};function gh(e,i,a,h){var p=h-a,x=e-a;return p===0?0:i===1?x/p:(Math.pow(i,x)-1)/(Math.pow(i,p)-1)}var Yo=function(i,a){this.type=i,this.args=a};Yo.parse=function(i,a){if(i.length<2)return a.error("Expectected at least one argument.");var h=null,p=a.expectedType;p&&p.kind!=="value"&&(h=p);for(var x=[],E=0,M=i.slice(1);E<M.length;E+=1){var L=M[E],V=a.parse(L,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!V)return null;h=h||V.type,x.push(V)}var Z=p&&x.some(function(Y){return Ss(p,Y.type)});return Z?new Yo(Si,x):new Yo(h,x)},Yo.prototype.evaluate=function(i){for(var a=null,h=0,p,x=0,E=this.args;x<E.length;x+=1){var M=E[x];if(h++,a=M.evaluate(i),a&&a instanceof Pr&&!a.available&&(p||(p=a.name),a=null,h===this.args.length&&(a=p)),a!==null)break}return a},Yo.prototype.eachChild=function(i){this.args.forEach(i)},Yo.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},Yo.prototype.serialize=function(){var i=["coalesce"];return this.eachChild(function(a){i.push(a.serialize())}),i};var Pl=function(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a};Pl.prototype.evaluate=function(i){return this.result.evaluate(i)},Pl.prototype.eachChild=function(i){for(var a=0,h=this.bindings;a<h.length;a+=1){var p=h[a];i(p[1])}i(this.result)},Pl.parse=function(i,a){if(i.length<4)return a.error("Expected at least 3 arguments, but found "+(i.length-1)+" instead.");for(var h=[],p=1;p<i.length-1;p+=2){var x=i[p];if(typeof x!="string")return a.error("Expected string, but found "+typeof x+" instead.",p);if(/[^a-zA-Z0-9_]/.test(x))return a.error("Variable names must contain only alphanumeric characters or '_'.",p);var E=a.parse(i[p+1],p+1);if(!E)return null;h.push([x,E])}var M=a.parse(i[i.length-1],i.length-1,a.expectedType,h);return M?new Pl(h,M):null},Pl.prototype.outputDefined=function(){return this.result.outputDefined()},Pl.prototype.serialize=function(){for(var i=["let"],a=0,h=this.bindings;a<h.length;a+=1){var p=h[a],x=p[0],E=p[1];i.push(x,E.serialize())}return i.push(this.result.serialize()),i};var Al=function(i,a,h){this.type=i,this.index=a,this.input=h};Al.parse=function(i,a){if(i.length!==3)return a.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var h=a.parse(i[1],1,ze),p=a.parse(i[2],2,ws(a.expectedType||Si));if(!h||!p)return null;var x=p.type;return new Al(x.itemType,h,p)},Al.prototype.evaluate=function(i){var a=this.index.evaluate(i),h=this.input.evaluate(i);if(a<0)throw new Fr("Array index out of bounds: "+a+" < 0.");if(a>=h.length)throw new Fr("Array index out of bounds: "+a+" > "+(h.length-1)+".");if(a!==Math.floor(a))throw new Fr("Array index must be an integer, but found "+a+" instead.");return h[a]},Al.prototype.eachChild=function(i){i(this.index),i(this.input)},Al.prototype.outputDefined=function(){return!1},Al.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Jo=function(i,a){this.type=xi,this.needle=i,this.haystack=a};Jo.parse=function(i,a){if(i.length!==3)return a.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var h=a.parse(i[1],1,Si),p=a.parse(i[2],2,Si);return!h||!p?null:Nh(h.type,[xi,ki,ze,Du,Si])?new Jo(h,p):a.error("Expected first argument to be of type boolean, string, number or null, but found "+br(h.type)+" instead")},Jo.prototype.evaluate=function(i){var a=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!h)return!1;if(!hh(a,["boolean","string","number","null"]))throw new Fr("Expected first argument to be of type boolean, string, number or null, but found "+br(Dr(a))+" instead.");if(!hh(h,["string","array"]))throw new Fr("Expected second argument to be of type array or string, but found "+br(Dr(h))+" instead.");return h.indexOf(a)>=0},Jo.prototype.eachChild=function(i){i(this.needle),i(this.haystack)},Jo.prototype.outputDefined=function(){return!0},Jo.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Gs=function(i,a,h){this.type=ze,this.needle=i,this.haystack=a,this.fromIndex=h};Gs.parse=function(i,a){if(i.length<=2||i.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var h=a.parse(i[1],1,Si),p=a.parse(i[2],2,Si);if(!h||!p)return null;if(!Nh(h.type,[xi,ki,ze,Du,Si]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+br(h.type)+" instead");if(i.length===4){var x=a.parse(i[3],3,ze);return x?new Gs(h,p,x):null}else return new Gs(h,p)},Gs.prototype.evaluate=function(i){var a=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!hh(a,["boolean","string","number","null"]))throw new Fr("Expected first argument to be of type boolean, string, number or null, but found "+br(Dr(a))+" instead.");if(!hh(h,["string","array"]))throw new Fr("Expected second argument to be of type array or string, but found "+br(Dr(h))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(i);return h.indexOf(a,p)}return h.indexOf(a)},Gs.prototype.eachChild=function(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)},Gs.prototype.outputDefined=function(){return!1},Gs.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Qo=function(i,a,h,p,x,E){this.inputType=i,this.type=a,this.input=h,this.cases=p,this.outputs=x,this.otherwise=E};Qo.parse=function(i,a){if(i.length<5)return a.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if(i.length%2!==1)return a.error("Expected an even number of arguments.");var h,p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);for(var x={},E=[],M=2;M<i.length-1;M+=2){var L=i[M],V=i[M+1];Array.isArray(L)||(L=[L]);var Z=a.concat(M);if(L.length===0)return Z.error("Expected at least one branch label.");for(var Y=0,rt=L;Y<rt.length;Y+=1){var it=rt[Y];if(typeof it!="number"&&typeof it!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof it=="number"&&Math.abs(it)>Number.MAX_SAFE_INTEGER)return Z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof it=="number"&&Math.floor(it)!==it)return Z.error("Numeric branch labels must be integer values.");if(!h)h=Dr(it);else if(Z.checkSubtype(h,Dr(it)))return null;if(typeof x[String(it)]<"u")return Z.error("Branch labels must be unique.");x[String(it)]=E.length}var ht=a.parse(V,M,p);if(!ht)return null;p=p||ht.type,E.push(ht)}var _t=a.parse(i[1],1,Si);if(!_t)return null;var zt=a.parse(i[i.length-1],i.length-1,p);return!zt||_t.type.kind!=="value"&&a.concat(1).checkSubtype(h,_t.type)?null:new Qo(h,p,_t,x,E,zt)},Qo.prototype.evaluate=function(i){var a=this.input.evaluate(i),h=Dr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise;return h.evaluate(i)},Qo.prototype.eachChild=function(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)},Qo.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})&&this.otherwise.outputDefined()},Qo.prototype.serialize=function(){for(var i=this,a=["match",this.input.serialize()],h=Object.keys(this.cases).sort(),p=[],x={},E=0,M=h;E<M.length;E+=1){var L=M[E],V=x[this.cases[L]];V===void 0?(x[this.cases[L]]=p.length,p.push([this.cases[L],[L]])):p[V][1].push(L)}for(var Z=function(_t){return i.inputType.kind==="number"?Number(_t):_t},Y=0,rt=p;Y<rt.length;Y+=1){var it=rt[Y],V=it[0],ht=it[1];ht.length===1?a.push(Z(ht[0])):a.push(ht.map(Z)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var Ml=function(i,a,h){this.type=i,this.branches=a,this.otherwise=h};Ml.parse=function(i,a){if(i.length<4)return a.error("Expected at least 3 arguments, but found only "+(i.length-1)+".");if(i.length%2!==0)return a.error("Expected an odd number of arguments.");var h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);for(var p=[],x=1;x<i.length-1;x+=2){var E=a.parse(i[x],x,xi);if(!E)return null;var M=a.parse(i[x+1],x+1,h);if(!M)return null;p.push([E,M]),h=h||M.type}var L=a.parse(i[i.length-1],i.length-1,h);return L?new Ml(h,p,L):null},Ml.prototype.evaluate=function(i){for(var a=0,h=this.branches;a<h.length;a+=1){var p=h[a],x=p[0],E=p[1];if(x.evaluate(i))return E.evaluate(i)}return this.otherwise.evaluate(i)},Ml.prototype.eachChild=function(i){for(var a=0,h=this.branches;a<h.length;a+=1){var p=h[a],x=p[0],E=p[1];i(x),i(E)}i(this.otherwise)},Ml.prototype.outputDefined=function(){return this.branches.every(function(i){i[0];var a=i[1];return a.outputDefined()})&&this.otherwise.outputDefined()},Ml.prototype.serialize=function(){var i=["case"];return this.eachChild(function(a){i.push(a.serialize())}),i};var $o=function(i,a,h,p){this.type=i,this.input=a,this.beginIndex=h,this.endIndex=p};$o.parse=function(i,a){if(i.length<=2||i.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var h=a.parse(i[1],1,Si),p=a.parse(i[2],2,ze);if(!h||!p)return null;if(!Nh(h.type,[ws(Si),ki,Si]))return a.error("Expected first argument to be of type array or string, but found "+br(h.type)+" instead");if(i.length===4){var x=a.parse(i[3],3,ze);return x?new $o(h.type,h,p,x):null}else return new $o(h.type,h,p)},$o.prototype.evaluate=function(i){var a=this.input.evaluate(i),h=this.beginIndex.evaluate(i);if(!hh(a,["string","array"]))throw new Fr("Expected first argument to be of type array or string, but found "+br(Dr(a))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(i);return a.slice(h,p)}return a.slice(h)},$o.prototype.eachChild=function(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)},$o.prototype.outputDefined=function(){return!1},$o.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};function Yh(e,i){return e==="=="||e==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Af(e,i,a){return i===a}function wd(e,i,a){return i!==a}function du(e,i,a){return i<a}function Mf(e,i,a){return i>a}function Sd(e,i,a){return i<=a}function zf(e,i,a){return i>=a}function Bu(e,i,a,h){return h.compare(i,a)===0}function Df(e,i,a,h){return!Bu(e,i,a,h)}function Jh(e,i,a,h){return h.compare(i,a)<0}function Hc(e,i,a,h){return h.compare(i,a)>0}function kf(e,i,a,h){return h.compare(i,a)<=0}function Td(e,i,a,h){return h.compare(i,a)>=0}function pu(e,i,a){var h=e!=="=="&&e!=="!=";return function(){function p(x,E,M){this.type=xi,this.lhs=x,this.rhs=E,this.collator=M,this.hasUntypedArgument=x.type.kind==="value"||E.type.kind==="value"}return p.parse=function(E,M){if(E.length!==3&&E.length!==4)return M.error("Expected two or three arguments.");var L=E[0],V=M.parse(E[1],1,Si);if(!V)return null;if(!Yh(L,V.type))return M.concat(1).error('"'+L+`" comparisons are not supported for type '`+br(V.type)+"'.");var Z=M.parse(E[2],2,Si);if(!Z)return null;if(!Yh(L,Z.type))return M.concat(2).error('"'+L+`" comparisons are not supported for type '`+br(Z.type)+"'.");if(V.type.kind!==Z.type.kind&&V.type.kind!=="value"&&Z.type.kind!=="value")return M.error("Cannot compare types '"+br(V.type)+"' and '"+br(Z.type)+"'.");h&&(V.type.kind==="value"&&Z.type.kind!=="value"?V=new zn(Z.type,[V]):V.type.kind!=="value"&&Z.type.kind==="value"&&(Z=new zn(V.type,[Z])));var Y=null;if(E.length===4){if(V.type.kind!=="string"&&Z.type.kind!=="string"&&V.type.kind!=="value"&&Z.type.kind!=="value")return M.error("Cannot use collator to compare non-string types.");if(Y=M.parse(E[3],3,ou),!Y)return null}return new p(V,Z,Y)},p.prototype.evaluate=function(E){var M=this.lhs.evaluate(E),L=this.rhs.evaluate(E);if(h&&this.hasUntypedArgument){var V=Dr(M),Z=Dr(L);if(V.kind!==Z.kind||!(V.kind==="string"||V.kind==="number"))throw new Fr('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+V.kind+", "+Z.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var Y=Dr(M),rt=Dr(L);if(Y.kind!=="string"||rt.kind!=="string")return i(E,M,L)}return this.collator?a(E,M,L,this.collator.evaluate(E)):i(E,M,L)},p.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},p.prototype.outputDefined=function(){return!0},p.prototype.serialize=function(){var E=[e];return this.eachChild(function(M){E.push(M.serialize())}),E},p}()}var Ff=pu("==",Af,Bu),Lf=pu("!=",wd,Df),Xc=pu("<",du,Jh),Wc=pu(">",Mf,Hc),Kc=pu("<=",Sd,kf),Rf=pu(">=",zf,Td),vo=function(i,a,h,p,x){this.type=ki,this.number=i,this.locale=a,this.currency=h,this.minFractionDigits=p,this.maxFractionDigits=x};vo.parse=function(i,a){if(i.length!==3)return a.error("Expected two arguments.");var h=a.parse(i[1],1,ze);if(!h)return null;var p=i[2];if(typeof p!="object"||Array.isArray(p))return a.error("NumberFormat options argument must be an object.");var x=null;if(p.locale&&(x=a.parse(p.locale,1,ki),!x))return null;var E=null;if(p.currency&&(E=a.parse(p.currency,1,ki),!E))return null;var M=null;if(p["min-fraction-digits"]&&(M=a.parse(p["min-fraction-digits"],1,ze),!M))return null;var L=null;return p["max-fraction-digits"]&&(L=a.parse(p["max-fraction-digits"],1,ze),!L)?null:new vo(h,x,E,M,L)},vo.prototype.evaluate=function(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))},vo.prototype.eachChild=function(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)},vo.prototype.outputDefined=function(){return!1},vo.prototype.serialize=function(){var i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]};var va=function(i){this.type=ze,this.input=i};va.parse=function(i,a){if(i.length!==2)return a.error("Expected 1 argument, but found "+(i.length-1)+" instead.");var h=a.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+br(h.type)+" instead."):new va(h):null},va.prototype.evaluate=function(i){var a=this.input.evaluate(i);if(typeof a=="string")return a.length;if(Array.isArray(a))return a.length;throw new Fr("Expected value to be of type string or array, but found "+br(Dr(a))+" instead.")},va.prototype.eachChild=function(i){i(this.input)},va.prototype.outputDefined=function(){return!1},va.prototype.serialize=function(){var i=["length"];return this.eachChild(function(a){i.push(a.serialize())}),i};var zl={"==":Ff,"!=":Lf,">":Wc,"<":Xc,">=":Rf,"<=":Kc,array:zn,at:Al,boolean:zn,case:Ml,coalesce:Yo,collator:go,format:yn,image:jo,in:Jo,"index-of":Gs,interpolate:kn,"interpolate-hcl":kn,"interpolate-lab":kn,length:va,let:Pl,literal:ya,match:Qo,number:zn,"number-format":vo,object:zn,slice:$o,step:Xo,string:zn,"to-boolean":Ts,"to-color":Ts,"to-number":Ts,"to-string":Ts,var:Go,within:js};function Ou(e,i){var a=i[0],h=i[1],p=i[2],x=i[3];a=a.evaluate(e),h=h.evaluate(e),p=p.evaluate(e);var E=x?x.evaluate(e):1,M=ss(a,h,p,E);if(M)throw new Fr(M);return new Ki(a/255*E,h/255*E,p/255*E,E)}function tl(e,i){return e in i}function Yi(e,i){var a=i[e];return typeof a>"u"?null:a}function Yc(e,i,a,h){for(;a<=h;){var p=a+h>>1;if(i[p]===e)return!0;i[p]>e?h=p-1:a=p+1}return!1}function os(e){return{type:e}}hn.register(zl,{error:[su,[ki],function(e,i){var a=i[0];throw new Fr(a.evaluate(e))}],typeof:[ki,[Si],function(e,i){var a=i[0];return br(Dr(a.evaluate(e)))}],"to-rgba":[ws(ze,4),[bs],function(e,i){var a=i[0];return a.evaluate(e).toArray()}],rgb:[bs,[ze,ze,ze],Ou],rgba:[bs,[ze,ze,ze,ze],Ou],has:{type:xi,overloads:[[[ki],function(e,i){var a=i[0];return tl(a.evaluate(e),e.properties())}],[[ki,Zo],function(e,i){var a=i[0],h=i[1];return tl(a.evaluate(e),h.evaluate(e))}]]},get:{type:Si,overloads:[[[ki],function(e,i){var a=i[0];return Yi(a.evaluate(e),e.properties())}],[[ki,Zo],function(e,i){var a=i[0],h=i[1];return Yi(a.evaluate(e),h.evaluate(e))}]]},"feature-state":[Si,[ki],function(e,i){var a=i[0];return Yi(a.evaluate(e),e.featureState||{})}],properties:[Zo,[],function(e){return e.properties()}],"geometry-type":[ki,[],function(e){return e.geometryType()}],id:[Si,[],function(e){return e.id()}],zoom:[ze,[],function(e){return e.globals.zoom}],"heatmap-density":[ze,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[ze,[],function(e){return e.globals.lineProgress||0}],accumulated:[Si,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[ze,os(ze),function(e,i){for(var a=0,h=0,p=i;h<p.length;h+=1){var x=p[h];a+=x.evaluate(e)}return a}],"*":[ze,os(ze),function(e,i){for(var a=1,h=0,p=i;h<p.length;h+=1){var x=p[h];a*=x.evaluate(e)}return a}],"-":{type:ze,overloads:[[[ze,ze],function(e,i){var a=i[0],h=i[1];return a.evaluate(e)-h.evaluate(e)}],[[ze],function(e,i){var a=i[0];return-a.evaluate(e)}]]},"/":[ze,[ze,ze],function(e,i){var a=i[0],h=i[1];return a.evaluate(e)/h.evaluate(e)}],"%":[ze,[ze,ze],function(e,i){var a=i[0],h=i[1];return a.evaluate(e)%h.evaluate(e)}],ln2:[ze,[],function(){return Math.LN2}],pi:[ze,[],function(){return Math.PI}],e:[ze,[],function(){return Math.E}],"^":[ze,[ze,ze],function(e,i){var a=i[0],h=i[1];return Math.pow(a.evaluate(e),h.evaluate(e))}],sqrt:[ze,[ze],function(e,i){var a=i[0];return Math.sqrt(a.evaluate(e))}],log10:[ze,[ze],function(e,i){var a=i[0];return Math.log(a.evaluate(e))/Math.LN10}],ln:[ze,[ze],function(e,i){var a=i[0];return Math.log(a.evaluate(e))}],log2:[ze,[ze],function(e,i){var a=i[0];return Math.log(a.evaluate(e))/Math.LN2}],sin:[ze,[ze],function(e,i){var a=i[0];return Math.sin(a.evaluate(e))}],cos:[ze,[ze],function(e,i){var a=i[0];return Math.cos(a.evaluate(e))}],tan:[ze,[ze],function(e,i){var a=i[0];return Math.tan(a.evaluate(e))}],asin:[ze,[ze],function(e,i){var a=i[0];return Math.asin(a.evaluate(e))}],acos:[ze,[ze],function(e,i){var a=i[0];return Math.acos(a.evaluate(e))}],atan:[ze,[ze],function(e,i){var a=i[0];return Math.atan(a.evaluate(e))}],min:[ze,os(ze),function(e,i){return Math.min.apply(Math,i.map(function(a){return a.evaluate(e)}))}],max:[ze,os(ze),function(e,i){return Math.max.apply(Math,i.map(function(a){return a.evaluate(e)}))}],abs:[ze,[ze],function(e,i){var a=i[0];return Math.abs(a.evaluate(e))}],round:[ze,[ze],function(e,i){var a=i[0],h=a.evaluate(e);return h<0?-Math.round(-h):Math.round(h)}],floor:[ze,[ze],function(e,i){var a=i[0];return Math.floor(a.evaluate(e))}],ceil:[ze,[ze],function(e,i){var a=i[0];return Math.ceil(a.evaluate(e))}],"filter-==":[xi,[ki,Si],function(e,i){var a=i[0],h=i[1];return e.properties()[a.value]===h.value}],"filter-id-==":[xi,[Si],function(e,i){var a=i[0];return e.id()===a.value}],"filter-type-==":[xi,[ki],function(e,i){var a=i[0];return e.geometryType()===a.value}],"filter-<":[xi,[ki,Si],function(e,i){var a=i[0],h=i[1],p=e.properties()[a.value],x=h.value;return typeof p==typeof x&&p<x}],"filter-id-<":[xi,[Si],function(e,i){var a=i[0],h=e.id(),p=a.value;return typeof h==typeof p&&h<p}],"filter->":[xi,[ki,Si],function(e,i){var a=i[0],h=i[1],p=e.properties()[a.value],x=h.value;return typeof p==typeof x&&p>x}],"filter-id->":[xi,[Si],function(e,i){var a=i[0],h=e.id(),p=a.value;return typeof h==typeof p&&h>p}],"filter-<=":[xi,[ki,Si],function(e,i){var a=i[0],h=i[1],p=e.properties()[a.value],x=h.value;return typeof p==typeof x&&p<=x}],"filter-id-<=":[xi,[Si],function(e,i){var a=i[0],h=e.id(),p=a.value;return typeof h==typeof p&&h<=p}],"filter->=":[xi,[ki,Si],function(e,i){var a=i[0],h=i[1],p=e.properties()[a.value],x=h.value;return typeof p==typeof x&&p>=x}],"filter-id->=":[xi,[Si],function(e,i){var a=i[0],h=e.id(),p=a.value;return typeof h==typeof p&&h>=p}],"filter-has":[xi,[Si],function(e,i){var a=i[0];return a.value in e.properties()}],"filter-has-id":[xi,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[xi,[ws(ki)],function(e,i){var a=i[0];return a.value.indexOf(e.geometryType())>=0}],"filter-id-in":[xi,[ws(Si)],function(e,i){var a=i[0];return a.value.indexOf(e.id())>=0}],"filter-in-small":[xi,[ki,ws(Si)],function(e,i){var a=i[0],h=i[1];return h.value.indexOf(e.properties()[a.value])>=0}],"filter-in-large":[xi,[ki,ws(Si)],function(e,i){var a=i[0],h=i[1];return Yc(e.properties()[a.value],h.value,0,h.value.length-1)}],all:{type:xi,overloads:[[[xi,xi],function(e,i){var a=i[0],h=i[1];return a.evaluate(e)&&h.evaluate(e)}],[os(xi),function(e,i){for(var a=0,h=i;a<h.length;a+=1){var p=h[a];if(!p.evaluate(e))return!1}return!0}]]},any:{type:xi,overloads:[[[xi,xi],function(e,i){var a=i[0],h=i[1];return a.evaluate(e)||h.evaluate(e)}],[os(xi),function(e,i){for(var a=0,h=i;a<h.length;a+=1){var p=h[a];if(p.evaluate(e))return!0}return!1}]]},"!":[xi,[xi],function(e,i){var a=i[0];return!a.evaluate(e)}],"is-supported-script":[xi,[ki],function(e,i){var a=i[0],h=e.globals&&e.globals.isSupportedScript;return h?h(a.evaluate(e)):!0}],upcase:[ki,[ki],function(e,i){var a=i[0];return a.evaluate(e).toUpperCase()}],downcase:[ki,[ki],function(e,i){var a=i[0];return a.evaluate(e).toLowerCase()}],concat:[ki,os(Si),function(e,i){return i.map(function(a){return kr(a.evaluate(e))}).join("")}],"resolved-locale":[ki,[ou],function(e,i){var a=i[0];return a.evaluate(e).resolvedLocale()}]});function Vu(e){return{result:"success",value:e}}function mu(e){return{result:"error",value:e}}function Uu(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function Bf(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Jc(e){return!!e.expression&&e.expression.interpolated}function fr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Qh(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Of(e){return e}function yh(e,i){var a=i.type==="color",h=e.stops&&typeof e.stops[0][0]=="object",p=h||e.property!==void 0,x=h||!p,E=e.type||(Jc(i)?"exponential":"interval");if(a&&(e=au({},e),e.stops&&(e.stops=e.stops.map(function(ve){return[ve[0],Ki.parse(ve[1])]})),e.default?e.default=Ki.parse(e.default):e.default=Ki.parse(i.default)),e.colorSpace&&e.colorSpace!=="rgb"&&!fu[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);var M,L,V;if(E==="exponential")M=Uf;else if(E==="interval")M=Vf;else if(E==="categorical"){M=vh,L=Object.create(null);for(var Z=0,Y=e.stops;Z<Y.length;Z+=1){var rt=Y[Z];L[rt[0]]=rt[1]}V=typeof e.stops[0][0]}else if(E==="identity")M=Ed;else throw new Error('Unknown function type "'+E+'"');if(h){for(var it={},ht=[],_t=0;_t<e.stops.length;_t++){var zt=e.stops[_t],Ct=zt[0].zoom;it[Ct]===void 0&&(it[Ct]={zoom:Ct,type:e.type,property:e.property,default:e.default,stops:[]},ht.push(Ct)),it[Ct].stops.push([zt[0].value,zt[1]])}for(var jt=[],Rt=0,Zt=ht;Rt<Zt.length;Rt+=1){var Wt=Zt[Rt];jt.push([it[Wt].zoom,yh(it[Wt],i)])}var le={name:"linear"};return{kind:"composite",interpolationType:le,interpolationFactor:kn.interpolationFactor.bind(void 0,le),zoomStops:jt.map(function(ve){return ve[0]}),evaluate:function(Be,Te){var De=Be.zoom;return Uf({stops:jt,base:e.base},i,De).evaluate(De,Te)}}}else if(x){var xe=E==="exponential"?{name:"exponential",base:e.base!==void 0?e.base:1}:null;return{kind:"camera",interpolationType:xe,interpolationFactor:kn.interpolationFactor.bind(void 0,xe),zoomStops:e.stops.map(function(ve){return ve[0]}),evaluate:function(ve){var Be=ve.zoom;return M(e,i,Be,L,V)}}}else return{kind:"source",evaluate:function(Be,Te){var De=Te&&Te.properties?Te.properties[e.property]:void 0;return De===void 0?Dl(e.default,i.default):M(e,i,De,L,V)}}}function Dl(e,i,a){if(e!==void 0)return e;if(i!==void 0)return i;if(a!==void 0)return a}function vh(e,i,a,h,p){var x=typeof a===p?h[a]:void 0;return Dl(x,e.default,i.default)}function Vf(e,i,a){if(fr(a)!=="number")return Dl(e.default,i.default);var h=e.stops.length;if(h===1||a<=e.stops[0][0])return e.stops[0][1];if(a>=e.stops[h-1][0])return e.stops[h-1][1];var p=Hh(e.stops.map(function(x){return x[0]}),a);return e.stops[p][1]}function Uf(e,i,a){var h=e.base!==void 0?e.base:1;if(fr(a)!=="number")return Dl(e.default,i.default);var p=e.stops.length;if(p===1||a<=e.stops[0][0])return e.stops[0][1];if(a>=e.stops[p-1][0])return e.stops[p-1][1];var x=Hh(e.stops.map(function(Y){return Y[0]}),a),E=Qc(a,h,e.stops[x][0],e.stops[x+1][0]),M=e.stops[x][1],L=e.stops[x+1][1],V=Xh[i.type]||Of;if(e.colorSpace&&e.colorSpace!=="rgb"){var Z=fu[e.colorSpace];V=function(Y,rt){return Z.reverse(Z.interpolate(Z.forward(Y),Z.forward(rt),E))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var rt=[],it=arguments.length;it--;)rt[it]=arguments[it];var ht=M.evaluate.apply(void 0,rt),_t=L.evaluate.apply(void 0,rt);if(!(ht===void 0||_t===void 0))return V(ht,_t,E)}}:V(M,L,E)}function Ed(e,i,a){return i.type==="color"?a=Ki.parse(a):i.type==="formatted"?a=Mn.fromString(a.toString()):i.type==="resolvedImage"?a=Pr.fromString(a.toString()):fr(a)!==i.type&&(i.type!=="enum"||!i.values[a])&&(a=void 0),Dl(a,e.default,i.default)}function Qc(e,i,a,h){var p=h-a,x=e-a;return p===0?0:i===1?x/p:(Math.pow(i,x)-1)/(Math.pow(i,p)-1)}var Hs=function(i,a){this.expression=i,this._warningHistory={},this._evaluator=new Zs,this._defaultValue=a?ic(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};Hs.prototype.evaluateWithoutErrorHandling=function(i,a,h,p,x,E){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=h,this._evaluator.canonical=p,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},Hs.prototype.evaluate=function(i,a,h,p,x,E){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E||null;try{var M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!==M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Fr("Expected value to be one of "+Object.keys(this._enumValues).map(function(L){return JSON.stringify(L)}).join(", ")+", but found "+JSON.stringify(M)+" instead.");return M}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}};function el(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in zl}function xa(e,i){var a=new Ho(zl,[],i?ec(i):void 0),h=a.parse(e,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Vu(new Hs(h,i)):mu(a.errors)}var xo=function(i,a){this.kind=i,this._styleExpression=a,this.isStateDependent=i!=="constant"&&!cu(a.expression)};xo.prototype.evaluateWithoutErrorHandling=function(i,a,h,p,x,E){return this._styleExpression.evaluateWithoutErrorHandling(i,a,h,p,x,E)},xo.prototype.evaluate=function(i,a,h,p,x,E){return this._styleExpression.evaluate(i,a,h,p,x,E)};var il=function(i,a,h,p){this.kind=i,this.zoomStops=h,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!cu(a.expression),this.interpolationType=p};il.prototype.evaluateWithoutErrorHandling=function(i,a,h,p,x,E){return this._styleExpression.evaluateWithoutErrorHandling(i,a,h,p,x,E)},il.prototype.evaluate=function(i,a,h,p,x,E){return this._styleExpression.evaluate(i,a,h,p,x,E)},il.prototype.interpolationFactor=function(i,a,h){return this.interpolationType?kn.interpolationFactor(this.interpolationType,i,a,h):0};function $h(e,i){if(e=xa(e,i),e.result==="error")return e;var a=e.value.expression,h=Gh(a);if(!h&&!Uu(i))return mu([new _o("","data expressions not supported")]);var p=Lu(a,["zoom"]);if(!p&&!Bf(i))return mu([new _o("","zoom expressions not supported")]);var x=tc(a);if(!x&&!p)return mu([new _o("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(x instanceof _o)return mu([x]);if(x instanceof kn&&!Jc(i))return mu([new _o("",'"interpolate" expressions cannot be used with this property')]);if(!x)return Vu(h?new xo("constant",e.value):new xo("source",e.value));var E=x instanceof kn?x.interpolation:void 0;return Vu(h?new il("camera",e.value,x.labels,E):new il("composite",e.value,x.labels,E))}var xh=function(i,a){this._parameters=i,this._specification=a,au(this,yh(this._parameters,this._specification))};xh.deserialize=function(i){return new xh(i._parameters,i._specification)},xh.serialize=function(i){return{_parameters:i._parameters,_specification:i._specification}};function _u(e,i){if(Qh(e))return new xh(e,i);if(el(e)){var a=$h(e,i);if(a.result==="error")throw new Error(a.value.map(function(p){return p.key+": "+p.message}).join(", "));return a.value}else{var h=e;return typeof e=="string"&&i.type==="color"&&(h=Ki.parse(e)),{kind:"constant",evaluate:function(){return h}}}}function tc(e){var i=null;if(e instanceof Pl)i=tc(e.result);else if(e instanceof Yo)for(var a=0,h=e.args;a<h.length;a+=1){var p=h[a];if(i=tc(p),i)break}else(e instanceof Xo||e instanceof kn)&&e.input instanceof hn&&e.input.name==="zoom"&&(i=e);return i instanceof _o||e.eachChild(function(x){var E=tc(x);E instanceof _o?i=E:!i&&E?i=new _o("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&E&&i!==E&&(i=new _o("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function ec(e){var i={color:bs,string:ki,number:ze,enum:ki,boolean:xi,formatted:El,resolvedImage:uh};return e.type==="array"?ws(i[e.value]||Si,e.length):i[e.type]}function ic(e){return e.type==="color"&&Qh(e.default)?new Ki(0,0,0,0):e.type==="color"?Ki.parse(e.default)||null:e.default===void 0?null:e.default}function ba(e){var i=e.key,a=e.value,h=e.valueSpec||{},p=e.objectElementValidators||{},x=e.style,E=e.styleSpec,M=[],L=fr(a);if(L!=="object")return[new Ue(i,a,"object expected, "+L+" found")];for(var V in a){var Z=V.split(".")[0],Y=h[Z]||h["*"],rt=void 0;if(p[Z])rt=p[Z];else if(h[Z])rt=ls;else if(p["*"])rt=p["*"];else if(h["*"])rt=ls;else{M.push(new Ue(i,a[V],'unknown property "'+V+'"'));continue}M=M.concat(rt({key:(i&&i+".")+V,value:a[V],valueSpec:Y,style:x,styleSpec:E,object:a,objectKey:V},a))}for(var it in h)p[it]||h[it].required&&h[it].default===void 0&&a[it]===void 0&&M.push(new Ue(i,a,'missing required property "'+it+'"'));return M}function Nu(e){var i=e.value,a=e.valueSpec,h=e.style,p=e.styleSpec,x=e.key,E=e.arrayElementValidator||ls;if(fr(i)!=="array")return[new Ue(x,i,"array expected, "+fr(i)+" found")];if(a.length&&i.length!==a.length)return[new Ue(x,i,"array length "+a.length+" expected, length "+i.length+" found")];if(a["min-length"]&&i.length<a["min-length"])return[new Ue(x,i,"array length at least "+a["min-length"]+" expected, length "+i.length+" found")];var M={type:a.value,values:a.values};p.$version<7&&(M.function=a.function),fr(a.value)==="object"&&(M=a.value);for(var L=[],V=0;V<i.length;V++)L=L.concat(E({array:i,arrayIndex:V,value:i[V],valueSpec:M,style:h,styleSpec:p,key:x+"["+V+"]"}));return L}function bh(e){var i=e.key,a=e.value,h=e.valueSpec,p=fr(a);return p==="number"&&a!==a&&(p="NaN"),p!=="number"?[new Ue(i,a,"number expected, "+p+" found")]:"minimum"in h&&a<h.minimum?[new Ue(i,a,a+" is less than the minimum value "+h.minimum)]:"maximum"in h&&a>h.maximum?[new Ue(i,a,a+" is greater than the maximum value "+h.maximum)]:[]}function rl(e){var i=e.valueSpec,a=vr(e.value.type),h,p={},x,E,M=a!=="categorical"&&e.value.property===void 0,L=!M,V=fr(e.value.stops)==="array"&&fr(e.value.stops[0])==="array"&&fr(e.value.stops[0][0])==="object",Z=ba({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:Y,default:ht}});return a==="identity"&&M&&Z.push(new Ue(e.key,e.value,'missing required property "property"')),a!=="identity"&&!e.value.stops&&Z.push(new Ue(e.key,e.value,'missing required property "stops"')),a==="exponential"&&e.valueSpec.expression&&!Jc(e.valueSpec)&&Z.push(new Ue(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(L&&!Uu(e.valueSpec)?Z.push(new Ue(e.key,e.value,"property functions not supported")):M&&!Bf(e.valueSpec)&&Z.push(new Ue(e.key,e.value,"zoom functions not supported"))),(a==="categorical"||V)&&e.value.property===void 0&&Z.push(new Ue(e.key,e.value,'"property" property is required')),Z;function Y(_t){if(a==="identity")return[new Ue(_t.key,_t.value,'identity function may not have a "stops" property')];var zt=[],Ct=_t.value;return zt=zt.concat(Nu({key:_t.key,value:Ct,valueSpec:_t.valueSpec,style:_t.style,styleSpec:_t.styleSpec,arrayElementValidator:rt})),fr(Ct)==="array"&&Ct.length===0&&zt.push(new Ue(_t.key,Ct,"array must have at least one stop")),zt}function rt(_t){var zt=[],Ct=_t.value,jt=_t.key;if(fr(Ct)!=="array")return[new Ue(jt,Ct,"array expected, "+fr(Ct)+" found")];if(Ct.length!==2)return[new Ue(jt,Ct,"array length 2 expected, length "+Ct.length+" found")];if(V){if(fr(Ct[0])!=="object")return[new Ue(jt,Ct,"object expected, "+fr(Ct[0])+" found")];if(Ct[0].zoom===void 0)return[new Ue(jt,Ct,"object stop key must have zoom")];if(Ct[0].value===void 0)return[new Ue(jt,Ct,"object stop key must have value")];if(E&&E>vr(Ct[0].zoom))return[new Ue(jt,Ct[0].zoom,"stop zoom values must appear in ascending order")];vr(Ct[0].zoom)!==E&&(E=vr(Ct[0].zoom),x=void 0,p={}),zt=zt.concat(ba({key:jt+"[0]",value:Ct[0],valueSpec:{zoom:{}},style:_t.style,styleSpec:_t.styleSpec,objectElementValidators:{zoom:bh,value:it}}))}else zt=zt.concat(it({key:jt+"[0]",value:Ct[0],style:_t.style,styleSpec:_t.styleSpec},Ct));return el(qs(Ct[1]))?zt.concat([new Ue(jt+"[1]",Ct[1],"expressions are not allowed in function stops.")]):zt.concat(ls({key:jt+"[1]",value:Ct[1],valueSpec:i,style:_t.style,styleSpec:_t.styleSpec}))}function it(_t,zt){var Ct=fr(_t.value),jt=vr(_t.value),Rt=_t.value!==null?_t.value:zt;if(!h)h=Ct;else if(Ct!==h)return[new Ue(_t.key,Rt,Ct+" stop domain type must match previous stop domain type "+h)];if(Ct!=="number"&&Ct!=="string"&&Ct!=="boolean")return[new Ue(_t.key,Rt,"stop domain value must be a number, string, or boolean")];if(Ct!=="number"&&a!=="categorical"){var Zt="number expected, "+Ct+" found";return Uu(i)&&a===void 0&&(Zt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ue(_t.key,Rt,Zt)]}return a==="categorical"&&Ct==="number"&&(!isFinite(jt)||Math.floor(jt)!==jt)?[new Ue(_t.key,Rt,"integer expected, found "+jt)]:a!=="categorical"&&Ct==="number"&&x!==void 0&&jt<x?[new Ue(_t.key,Rt,"stop domain values must appear in ascending order")]:(x=jt,a==="categorical"&&jt in p?[new Ue(_t.key,Rt,"stop domain values must be unique")]:(p[jt]=!0,[]))}function ht(_t){return ls({key:_t.key,value:_t.value,valueSpec:i,style:_t.style,styleSpec:_t.styleSpec})}}function Xs(e){var i=(e.expressionContext==="property"?$h:xa)(qs(e.value),e.valueSpec);if(i.result==="error")return i.value.map(function(h){return new Ue(""+e.key+h.key,e.value,h.message)});var a=i.value.expression||i.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!a.outputDefined())return[new Ue(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!cu(a))return[new Ue(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!cu(a))return[new Ue(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!Lu(a,["zoom","feature-state"]))return[new Ue(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!Gh(a))return[new Ue(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nf(e){var i=e.value,a=e.key,h=fr(i);return h!=="boolean"?[new Ue(a,i,"boolean expected, "+h+" found")]:[]}function $c(e){var i=e.key,a=e.value,h=fr(a);return h!=="string"?[new Ue(i,a,"color expected, "+h+" found")]:qh(a)===null?[new Ue(i,a,'color expected, "'+a+'" found')]:[]}function ji(e){var i=e.key,a=e.value,h=e.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(vr(a))===-1&&p.push(new Ue(i,a,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(a)+" found")):Object.keys(h.values).indexOf(vr(a))===-1&&p.push(new Ue(i,a,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(a)+" found")),p}function qu(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var i=0,a=e.slice(1);i<a.length;i+=1){var h=a[i];if(!qu(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}var qf={type:"boolean",default:!1};function Zu(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};qu(e)||(e=nc(e));var i=xa(e,qf);if(i.result==="error")throw new Error(i.value.map(function(h){return h.key+": "+h.message}).join(", "));var a=rc(e);return{filter:function(h,p,x){return i.value.evaluate(h,p,{},x)},needGeometry:a}}function Ir(e,i){return e<i?-1:e>i?1:0}function rc(e){if(!Array.isArray(e))return!1;if(e[0]==="within")return!0;for(var i=1;i<e.length;i++)if(rc(e[i]))return!0;return!1}function nc(e){if(!e)return!0;var i=e[0];if(e.length<=1)return i!=="any";var a=i==="=="?Ii(e[1],e[2],"=="):i==="!="?kl(Ii(e[1],e[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Ii(e[1],e[2],i):i==="any"?Id(e.slice(1)):i==="all"?["all"].concat(e.slice(1).map(nc)):i==="none"?["all"].concat(e.slice(1).map(nc).map(kl)):i==="in"?ac(e[1],e.slice(2)):i==="!in"?kl(ac(e[1],e.slice(2))):i==="has"?dr(e[1]):i==="!has"?kl(dr(e[1])):i==="within"?e:!0;return a}function Ii(e,i,a){switch(e){case"$type":return["filter-type-"+a,i];case"$id":return["filter-id-"+a,i];default:return["filter-"+a,e,i]}}function Id(e){return["any"].concat(e.map(nc))}function ac(e,i){if(i.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(function(a){return typeof a!=typeof i[0]})?["filter-in-large",e,["literal",i.sort(Ir)]]:["filter-in-small",e,["literal",i]]}}function dr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function kl(e){return["!",e]}function gu(e){return qu(qs(e.value))?Xs(au({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):nr(e)}function nr(e){var i=e.value,a=e.key;if(fr(i)!=="array")return[new Ue(a,i,"array expected, "+fr(i)+" found")];var h=e.styleSpec,p,x=[];if(i.length<1)return[new Ue(a,i,"filter array must have at least 1 element")];switch(x=x.concat(ji({key:a+"[0]",value:i[0],valueSpec:h.filter_operator,style:e.style,styleSpec:e.styleSpec})),vr(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&vr(i[1])==="$type"&&x.push(new Ue(a,i,'"$type" cannot be use with operator "'+i[0]+'"'));case"==":case"!=":i.length!==3&&x.push(new Ue(a,i,'filter array for operator "'+i[0]+'" must have 3 elements'));case"in":case"!in":i.length>=2&&(p=fr(i[1]),p!=="string"&&x.push(new Ue(a+"[1]",i[1],"string expected, "+p+" found")));for(var E=2;E<i.length;E++)p=fr(i[E]),vr(i[1])==="$type"?x=x.concat(ji({key:a+"["+E+"]",value:i[E],valueSpec:h.geometry_type,style:e.style,styleSpec:e.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&x.push(new Ue(a+"["+E+"]",i[E],"string, number, or boolean expected, "+p+" found"));break;case"any":case"all":case"none":for(var M=1;M<i.length;M++)x=x.concat(nr({key:a+"["+M+"]",value:i[M],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":p=fr(i[1]),i.length!==2?x.push(new Ue(a,i,'filter array for "'+i[0]+'" operator must have 2 elements')):p!=="string"&&x.push(new Ue(a+"[1]",i[1],"string expected, "+p+" found"));break;case"within":p=fr(i[1]),i.length!==2?x.push(new Ue(a,i,'filter array for "'+i[0]+'" operator must have 2 elements')):p!=="object"&&x.push(new Ue(a+"[1]",i[1],"object expected, "+p+" found"));break}return x}function Fl(e,i){var a=e.key,h=e.style,p=e.styleSpec,x=e.value,E=e.objectKey,M=p[i+"_"+e.layerType];if(!M)return[];var L=E.match(/^(.*)-transition$/);if(i==="paint"&&L&&M[L[1]]&&M[L[1]].transition)return ls({key:a,value:x,valueSpec:p.transition,style:h,styleSpec:p});var V=e.valueSpec||M[E];if(!V)return[new Ue(a,x,'unknown property "'+E+'"')];var Z;if(fr(x)==="string"&&Uu(V)&&!V.tokens&&(Z=/^{([^}]+)}$/.exec(x)))return[new Ue(a,x,'"'+E+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Z[1])+" }`.")];var Y=[];return e.layerType==="symbol"&&(E==="text-field"&&h&&!h.glyphs&&Y.push(new Ue(a,x,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&Qh(qs(x))&&vr(x.type)==="identity"&&Y.push(new Ue(a,x,'"text-font" does not support identity functions'))),Y.concat(ls({key:e.key,value:x,valueSpec:V,style:h,styleSpec:p,expressionContext:"property",propertyType:i,propertyKey:E}))}function tf(e){return Fl(e,"paint")}function ef(e){return Fl(e,"layout")}function ju(e){var i=[],a=e.value,h=e.key,p=e.style,x=e.styleSpec;!a.type&&!a.ref&&i.push(new Ue(h,a,'either "type" or "ref" is required'));var E=vr(a.type),M=vr(a.ref);if(a.id)for(var L=vr(a.id),V=0;V<e.arrayIndex;V++){var Z=p.layers[V];vr(Z.id)===L&&i.push(new Ue(h,a.id,'duplicate layer id "'+a.id+'", previously used at line '+Z.id.__line__))}if("ref"in a){["type","source","source-layer","filter","layout"].forEach(function(ht){ht in a&&i.push(new Ue(h,a[ht],'"'+ht+'" is prohibited for ref layers'))});var Y;p.layers.forEach(function(ht){vr(ht.id)===M&&(Y=ht)}),Y?Y.ref?i.push(new Ue(h,a.ref,"ref cannot reference another ref layer")):E=vr(Y.type):i.push(new Ue(h,a.ref,'ref layer "'+M+'" not found'))}else if(E!=="background")if(!a.source)i.push(new Ue(h,a,'missing required property "source"'));else{var rt=p.sources&&p.sources[a.source],it=rt&&vr(rt.type);rt?it==="vector"&&E==="raster"?i.push(new Ue(h,a.source,'layer "'+a.id+'" requires a raster source')):it==="raster"&&E!=="raster"?i.push(new Ue(h,a.source,'layer "'+a.id+'" requires a vector source')):it==="vector"&&!a["source-layer"]?i.push(new Ue(h,a,'layer "'+a.id+'" must specify a "source-layer"')):it==="raster-dem"&&E!=="hillshade"?i.push(new Ue(h,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):E==="line"&&a.paint&&a.paint["line-gradient"]&&(it!=="geojson"||!rt.lineMetrics)&&i.push(new Ue(h,a,'layer "'+a.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):i.push(new Ue(h,a.source,'source "'+a.source+'" not found'))}return i=i.concat(ba({key:h,value:a,valueSpec:x.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ls({key:h+".type",value:a.type,valueSpec:x.layer.type,style:e.style,styleSpec:e.styleSpec,object:a,objectKey:"type"})},filter:gu,layout:function(_t){return ba({layer:a,key:_t.key,value:_t.value,style:_t.style,styleSpec:_t.styleSpec,objectElementValidators:{"*":function(Ct){return ef(au({layerType:E},Ct))}}})},paint:function(_t){return ba({layer:a,key:_t.key,value:_t.value,style:_t.style,styleSpec:_t.styleSpec,objectElementValidators:{"*":function(Ct){return tf(au({layerType:E},Ct))}}})}}})),i}function Gu(e){var i=e.value,a=e.key,h=fr(i);return h!=="string"?[new Ue(a,i,"string expected, "+h+" found")]:[]}var Hu={promoteId:sc};function rf(e){var i=e.value,a=e.key,h=e.styleSpec,p=e.style;if(!i.type)return[new Ue(a,i,'"type" is required')];var x=vr(i.type),E;switch(x){case"vector":case"raster":case"raster-dem":return E=ba({key:a,value:i,valueSpec:h["source_"+x.replace("-","_")],style:e.style,styleSpec:h,objectElementValidators:Hu}),E;case"geojson":if(E=ba({key:a,value:i,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:Hu}),i.cluster)for(var M in i.clusterProperties){var L=i.clusterProperties[M],V=L[0],Z=L[1],Y=typeof V=="string"?[V,["accumulated"],["get",M]]:V;E.push.apply(E,Xs({key:a+"."+M+".map",value:Z,expressionContext:"cluster-map"})),E.push.apply(E,Xs({key:a+"."+M+".reduce",value:Y,expressionContext:"cluster-reduce"}))}return E;case"video":return ba({key:a,value:i,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return ba({key:a,value:i,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new Ue(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ji({key:a+".type",value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function sc(e){var i=e.key,a=e.value;if(fr(a)==="string")return Gu({key:i,value:a});var h=[];for(var p in a)h.push.apply(h,Gu({key:i+"."+p,value:a[p]}));return h}function oc(e){var i=e.value,a=e.styleSpec,h=a.light,p=e.style,x=[],E=fr(i);if(i===void 0)return x;if(E!=="object")return x=x.concat([new Ue("light",i,"object expected, "+E+" found")]),x;for(var M in i){var L=M.match(/^(.*)-transition$/);L&&h[L[1]]&&h[L[1]].transition?x=x.concat(ls({key:M,value:i[M],valueSpec:a.transition,style:p,styleSpec:a})):h[M]?x=x.concat(ls({key:M,value:i[M],valueSpec:h[M],style:p,styleSpec:a})):x=x.concat([new Ue(M,i[M],'unknown property "'+M+'"')])}return x}function Cd(e){return Gu(e).length===0?[]:Xs(e)}function lc(e){return Gu(e).length===0?[]:Xs(e)}var nf={"*":function(){return[]},array:Nu,boolean:Nf,number:bh,color:$c,constants:zu,enum:ji,filter:gu,function:rl,layer:ju,object:ba,source:rf,light:oc,string:Gu,formatted:Cd,resolvedImage:lc};function ls(e){var i=e.value,a=e.valueSpec,h=e.styleSpec;if(a.expression&&Qh(vr(i)))return rl(e);if(a.expression&&el(qs(i)))return Xs(e);if(a.type&&nf[a.type])return nf[a.type](e);var p=ba(au({},e,{valueSpec:a.type?h[a.type]:a}));return p}function _r(e){var i=e.value,a=e.key,h=Gu(e);return h.length||(i.indexOf("{fontstack}")===-1&&h.push(new Ue(a,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&h.push(new Ue(a,i,'"glyphs" url must include a "{range}" token'))),h}function Ws(e,i){i===void 0&&(i=ue);var a=[];return a=a.concat(ls({key:"",value:e,valueSpec:i.$root,styleSpec:i,style:e,objectElementValidators:{glyphs:_r,"*":function(){return[]}}})),e.constants&&(a=a.concat(zu({key:"constants",value:e.constants}))),yu(a)}Ws.source=us(rf),Ws.light=us(oc),Ws.layer=us(ju),Ws.filter=us(gu),Ws.paintProperty=us(tf),Ws.layoutProperty=us(ef);function yu(e){return[].concat(e).sort(function(i,a){return i.line-a.line})}function us(e){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];return yu(e.apply(this,i))}}var Xi=Ws,ar=Xi.light,uc=Xi.paintProperty,Ll=Xi.layoutProperty;function wh(e,i){var a=!1;if(i&&i.length)for(var h=0,p=i;h<p.length;h+=1){var x=p[h];e.fire(new ii(new Error(x.message))),a=!0}return a}var vu=sr,nl=3;function sr(e,i,a){var h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var p=new Int32Array(this.arrayBuffer);e=p[0],i=p[1],a=p[2],this.d=i+2*a;for(var x=0;x<this.d*this.d;x++){var E=p[nl+x],M=p[nl+x+1];h.push(E===M?null:p.subarray(E,M))}var L=p[nl+h.length],V=p[nl+h.length+1];this.keys=p.subarray(L,V),this.bboxes=p.subarray(V),this.insert=this._insertReadonly}else{this.d=i+2*a;for(var Z=0;Z<this.d*this.d;Z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=a,this.scale=i/e,this.uid=0;var Y=a/i*e;this.min=-Y,this.max=e+Y}sr.prototype.insert=function(e,i,a,h,p){this._forEachCell(i,a,h,p,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(p)},sr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},sr.prototype._insertCell=function(e,i,a,h,p,x){this.cells[p].push(x)},sr.prototype.query=function(e,i,a,h,p){var x=this.min,E=this.max;if(e<=x&&i<=x&&E<=a&&E<=h&&!p)return Array.prototype.slice.call(this.keys);var M=[],L={};return this._forEachCell(e,i,a,h,this._queryCell,M,L,p),M},sr.prototype._queryCell=function(e,i,a,h,p,x,E,M){var L=this.cells[p];if(L!==null)for(var V=this.keys,Z=this.bboxes,Y=0;Y<L.length;Y++){var rt=L[Y];if(E[rt]===void 0){var it=rt*4;(M?M(Z[it+0],Z[it+1],Z[it+2],Z[it+3]):e<=Z[it+2]&&i<=Z[it+3]&&a>=Z[it+0]&&h>=Z[it+1])?(E[rt]=!0,x.push(V[rt])):E[rt]=!1}}},sr.prototype._forEachCell=function(e,i,a,h,p,x,E,M){for(var L=this._convertToCellCoord(e),V=this._convertToCellCoord(i),Z=this._convertToCellCoord(a),Y=this._convertToCellCoord(h),rt=L;rt<=Z;rt++)for(var it=V;it<=Y;it++){var ht=this.d*it+rt;if(!(M&&!M(this._convertFromCellCoord(rt),this._convertFromCellCoord(it),this._convertFromCellCoord(rt+1),this._convertFromCellCoord(it+1)))&&p.call(this,e,i,a,h,ht,x,E,M))return}},sr.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},sr.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},sr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,i=nl+this.cells.length+1+1,a=0,h=0;h<this.cells.length;h++)a+=this.cells[h].length;var p=new Int32Array(i+a+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var x=i,E=0;E<e.length;E++){var M=e[E];p[nl+E]=x,p.set(M,x),x+=M.length}return p[nl+e.length]=x,p.set(this.keys,x),x+=this.keys.length,p[nl+e.length+1]=x,p.set(this.bboxes,x),x+=this.bboxes.length,p.buffer};var Rl=me.ImageData,vn=me.ImageBitmap,bo={};function Ne(e,i,a){a===void 0&&(a={}),Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),bo[e]={klass:i,omit:a.omit||[],shallow:a.shallow||[]}}Ne("Object",Object),vu.serialize=function(i,a){var h=i.toArrayBuffer();return a&&a.push(h),{buffer:h}},vu.deserialize=function(i){return new vu(i.buffer)},Ne("Grid",vu),Ne("Color",Ki),Ne("Error",Error),Ne("ResolvedImage",Pr),Ne("StylePropertyFunction",xh),Ne("StyleExpression",Hs,{omit:["_evaluator"]}),Ne("ZoomDependentExpression",il),Ne("ZoomConstantExpression",xo),Ne("CompoundExpression",hn,{omit:["_evaluate"]});for(var wa in zl)zl[wa]._classRegistryKey||Ne("Expression_"+wa,zl[wa]);function wo(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function Zf(e){return vn&&e instanceof vn}function Zr(e,i){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(wo(e)||Zf(e))return i&&i.push(e),e;if(ArrayBuffer.isView(e)){var a=e;return i&&i.push(a.buffer),a}if(e instanceof Rl)return i&&i.push(e.data.buffer),e;if(Array.isArray(e)){for(var h=[],p=0,x=e;p<x.length;p+=1){var E=x[p];h.push(Zr(E,i))}return h}if(typeof e=="object"){var M=e.constructor,L=M._classRegistryKey;if(!L)throw new Error("can't serialize object of unregistered class");var V=M.serialize?M.serialize(e,i):{};if(!M.serialize){for(var Z in e)if(e.hasOwnProperty(Z)&&!(bo[L].omit.indexOf(Z)>=0)){var Y=e[Z];V[Z]=bo[L].shallow.indexOf(Z)>=0?Y:Zr(Y,i)}e instanceof Error&&(V.message=e.message)}if(V.$name)throw new Error("$name property is reserved for worker serialization logic.");return L!=="Object"&&(V.$name=L),V}throw new Error("can't serialize object of type "+typeof e)}function Fn(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||wo(e)||Zf(e)||ArrayBuffer.isView(e)||e instanceof Rl)return e;if(Array.isArray(e))return e.map(Fn);if(typeof e=="object"){var i=e.$name||"Object",a=bo[i],h=a.klass;if(!h)throw new Error("can't deserialize unregistered class "+i);if(h.deserialize)return h.deserialize(e);for(var p=Object.create(h.prototype),x=0,E=Object.keys(e);x<E.length;x+=1){var M=E[x];if(M!=="$name"){var L=e[M];p[M]=bo[i].shallow.indexOf(M)>=0?L:Fn(L)}}return p}throw new Error("can't deserialize object of type "+typeof e)}var Sa=function(){this.first=!0};Sa.prototype.update=function(i,a){var h=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=a),i!==this.lastZoom?(this.lastZoom=i,this.lastFloorZoom=h,!0):!1)};var ke={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function hc(e){for(var i=0,a=e;i<a.length;i+=1){var h=a[i];if(Ha(h.charCodeAt(0)))return!0}return!1}function af(e){for(var i=0,a=e;i<a.length;i+=1){var h=a[i];if(!jf(h.charCodeAt(0)))return!1}return!0}function jf(e){return!(ke.Arabic(e)||ke["Arabic Supplement"](e)||ke["Arabic Extended-A"](e)||ke["Arabic Presentation Forms-A"](e)||ke["Arabic Presentation Forms-B"](e))}function sf(e){return e<11904?!1:!!(ke["Bopomofo Extended"](e)||ke.Bopomofo(e)||ke["CJK Compatibility Forms"](e)||ke["CJK Compatibility Ideographs"](e)||ke["CJK Compatibility"](e)||ke["CJK Radicals Supplement"](e)||ke["CJK Strokes"](e)||ke["CJK Symbols and Punctuation"](e)||ke["CJK Unified Ideographs Extension A"](e)||ke["CJK Unified Ideographs"](e)||ke["Enclosed CJK Letters and Months"](e)||ke["Halfwidth and Fullwidth Forms"](e)||ke.Hiragana(e)||ke["Ideographic Description Characters"](e)||ke["Kangxi Radicals"](e)||ke["Katakana Phonetic Extensions"](e)||ke.Katakana(e)||ke["Vertical Forms"](e)||ke["Yi Radicals"](e)||ke["Yi Syllables"](e))}function Ha(e){return e===746||e===747?!0:e<4352?!1:!!(ke["Bopomofo Extended"](e)||ke.Bopomofo(e)||ke["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||ke["CJK Compatibility Ideographs"](e)||ke["CJK Compatibility"](e)||ke["CJK Radicals Supplement"](e)||ke["CJK Strokes"](e)||ke["CJK Symbols and Punctuation"](e)&&!(e>=12296&&e<=12305)&&!(e>=12308&&e<=12319)&&e!==12336||ke["CJK Unified Ideographs Extension A"](e)||ke["CJK Unified Ideographs"](e)||ke["Enclosed CJK Letters and Months"](e)||ke["Hangul Compatibility Jamo"](e)||ke["Hangul Jamo Extended-A"](e)||ke["Hangul Jamo Extended-B"](e)||ke["Hangul Jamo"](e)||ke["Hangul Syllables"](e)||ke.Hiragana(e)||ke["Ideographic Description Characters"](e)||ke.Kanbun(e)||ke["Kangxi Radicals"](e)||ke["Katakana Phonetic Extensions"](e)||ke.Katakana(e)&&e!==12540||ke["Halfwidth and Fullwidth Forms"](e)&&e!==65288&&e!==65289&&e!==65293&&!(e>=65306&&e<=65310)&&e!==65339&&e!==65341&&e!==65343&&!(e>=65371&&e<=65503)&&e!==65507&&!(e>=65512&&e<=65519)||ke["Small Form Variants"](e)&&!(e>=65112&&e<=65118)&&!(e>=65123&&e<=65126)||ke["Unified Canadian Aboriginal Syllabics"](e)||ke["Unified Canadian Aboriginal Syllabics Extended"](e)||ke["Vertical Forms"](e)||ke["Yijing Hexagram Symbols"](e)||ke["Yi Syllables"](e)||ke["Yi Radicals"](e))}function Bl(e){return!!(ke["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ke["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ke["Letterlike Symbols"](e)||ke["Number Forms"](e)||ke["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ke["Control Pictures"](e)&&e!==9251||ke["Optical Character Recognition"](e)||ke["Enclosed Alphanumerics"](e)||ke["Geometric Shapes"](e)||ke["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ke["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ke["CJK Symbols and Punctuation"](e)||ke.Katakana(e)||ke["Private Use Area"](e)||ke["CJK Compatibility Forms"](e)||ke["Small Form Variants"](e)||ke["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}function Ta(e){return!(Ha(e)||Bl(e))}function Sh(e){return ke.Arabic(e)||ke["Arabic Supplement"](e)||ke["Arabic Extended-A"](e)||ke["Arabic Presentation Forms-A"](e)||ke["Arabic Presentation Forms-B"](e)}function cc(e){return e>=1424&&e<=2303||ke["Arabic Presentation Forms-A"](e)||ke["Arabic Presentation Forms-B"](e)}function fc(e,i){return!(!i&&cc(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||ke.Khmer(e))}function Gf(e){for(var i=0,a=e;i<a.length;i+=1){var h=a[i];if(cc(h.charCodeAt(0)))return!0}return!1}function Xa(e,i){for(var a=0,h=e;a<h.length;a+=1){var p=h[a];if(!fc(p.charCodeAt(0),i))return!1}return!0}var Ks={unavailable:"unavailable",deferred:"deferred",loading:"loading",loaded:"loaded",error:"error"},dc=null,ia=Ks.unavailable,xn=null,ra=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(ia=Ks.error),dc&&dc(e)};function Xu(){Wu.fire(new Ht("pluginStateChange",{pluginStatus:ia,pluginURL:xn}))}var Wu=new tr,So=function(){return ia},Th=function(e){return e({pluginStatus:ia,pluginURL:xn}),Wu.on("pluginStateChange",e),e},Is=function(e,i,a){if(a===void 0&&(a=!1),ia===Ks.deferred||ia===Ks.loading||ia===Ks.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");xn=Bs.resolveURL(e),ia=Ks.deferred,dc=i,Xu(),a||Wa()},Wa=function(){if(ia!==Ks.deferred||!xn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ia=Ks.loading,Xu(),xn&&St({url:xn},function(e){e?ra(e):(ia=Ks.loaded,Xu())})},Ea={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ia===Ks.loaded||Ea.applyArabicShaping!=null},isLoading:function(){return ia===Ks.loading},setState:function(i){ia=i.pluginStatus,xn=i.pluginURL},isParsed:function(){return Ea.applyArabicShaping!=null&&Ea.processBidirectionalText!=null&&Ea.processStyledBidirectionalText!=null},getPluginURL:function(){return xn}},hs=function(){!Ea.isLoading()&&!Ea.isLoaded()&&So()==="deferred"&&Wa()},Fi=function(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sa,this.transition={})};Fi.prototype.isSupportedScript=function(i){return Xa(i,Ea.isLoaded())},Fi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Fi.prototype.getCrossfadeParameters=function(){var i=this.zoom,a=i-Math.floor(i),h=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*a}};var Ku=function(i,a){this.property=i,this.value=a,this.expression=_u(a===void 0?i.specification.default:a,i.specification)};Ku.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Ku.prototype.possiblyEvaluate=function(i,a,h){return this.property.possiblyEvaluate(this,i,a,h)};var Eh=function(i){this.property=i,this.value=new Ku(i,void 0)};Eh.prototype.transitioned=function(i,a){return new of(this.property,this.value,a,Or({},i.transition,this.transition),i.now)},Eh.prototype.untransitioned=function(){return new of(this.property,this.value,null,{},0)};var Gn=function(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)};Gn.prototype.getValue=function(i){return qr(this._values[i].value.value)},Gn.prototype.setValue=function(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new Eh(this._values[i].property)),this._values[i].value=new Ku(this._values[i].property,a===null?void 0:qr(a))},Gn.prototype.getTransition=function(i){return qr(this._values[i].transition)},Gn.prototype.setTransition=function(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new Eh(this._values[i].property)),this._values[i].transition=qr(a)||void 0},Gn.prototype.serialize=function(){for(var i={},a=0,h=Object.keys(this._values);a<h.length;a+=1){var p=h[a],x=this.getValue(p);x!==void 0&&(i[p]=x);var E=this.getTransition(p);E!==void 0&&(i[p+"-transition"]=E)}return i},Gn.prototype.transitioned=function(i,a){for(var h=new Yu(this._properties),p=0,x=Object.keys(this._values);p<x.length;p+=1){var E=x[p];h._values[E]=this._values[E].transitioned(i,a._values[E])}return h},Gn.prototype.untransitioned=function(){for(var i=new Yu(this._properties),a=0,h=Object.keys(this._values);a<h.length;a+=1){var p=h[a];i._values[p]=this._values[p].untransitioned()}return i};var of=function(i,a,h,p,x){this.property=i,this.value=a,this.begin=x+p.delay||0,this.end=this.begin+p.duration||0,i.specification.transition&&(p.delay||p.duration)&&(this.prior=h)};of.prototype.possiblyEvaluate=function(i,a,h){var p=i.now||0,x=this.value.possiblyEvaluate(i,a,h),E=this.prior;if(E){if(p>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(p<this.begin)return E.possiblyEvaluate(i,a,h);var M=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(i,a,h),x,In(M))}else return x};var Yu=function(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)};Yu.prototype.possiblyEvaluate=function(i,a,h){for(var p=new Ar(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var M=E[x];p._values[M]=this._values[M].possiblyEvaluate(i,a,h)}return p},Yu.prototype.hasTransition=function(){for(var i=0,a=Object.keys(this._values);i<a.length;i+=1){var h=a[i];if(this._values[h].prior)return!0}return!1};var Ia=function(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)};Ia.prototype.getValue=function(i){return qr(this._values[i].value)},Ia.prototype.setValue=function(i,a){this._values[i]=new Ku(this._values[i].property,a===null?void 0:qr(a))},Ia.prototype.serialize=function(){for(var i={},a=0,h=Object.keys(this._values);a<h.length;a+=1){var p=h[a],x=this.getValue(p);x!==void 0&&(i[p]=x)}return i},Ia.prototype.possiblyEvaluate=function(i,a,h){for(var p=new Ar(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var M=E[x];p._values[M]=this._values[M].possiblyEvaluate(i,a,h)}return p};var tn=function(i,a,h){this.property=i,this.value=a,this.parameters=h};tn.prototype.isConstant=function(){return this.value.kind==="constant"},tn.prototype.constantOr=function(i){return this.value.kind==="constant"?this.value.value:i},tn.prototype.evaluate=function(i,a,h,p){return this.property.evaluate(this.value,this.parameters,i,a,h,p)};var Ar=function(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)};Ar.prototype.get=function(i){return this._values[i]};var Xt=function(i){this.specification=i};Xt.prototype.possiblyEvaluate=function(i,a){return i.expression.evaluate(a)},Xt.prototype.interpolate=function(i,a,h){var p=Xh[this.specification.type];return p?p(i,a,h):i};var Ke=function(i,a){this.specification=i,this.overrides=a};Ke.prototype.possiblyEvaluate=function(i,a,h,p){return i.expression.kind==="constant"||i.expression.kind==="camera"?new tn(this,{kind:"constant",value:i.expression.evaluate(a,null,{},h,p)},a):new tn(this,i.expression,a)},Ke.prototype.interpolate=function(i,a,h){if(i.value.kind!=="constant"||a.value.kind!=="constant")return i;if(i.value.value===void 0||a.value.value===void 0)return new tn(this,{kind:"constant",value:void 0},i.parameters);var p=Xh[this.specification.type];return p?new tn(this,{kind:"constant",value:p(i.value.value,a.value.value,h)},i.parameters):i},Ke.prototype.evaluate=function(i,a,h,p,x,E){return i.kind==="constant"?i.value:i.evaluate(a,h,p,x,E)};var Cs=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.possiblyEvaluate=function(h,p,x,E){if(h.value===void 0)return new tn(this,{kind:"constant",value:void 0},p);if(h.expression.kind==="constant"){var M=h.expression.evaluate(p,null,{},x,E),L=h.property.specification.type==="resolvedImage",V=L&&typeof M!="string"?M.name:M,Z=this._calculate(V,V,V,p);return new tn(this,{kind:"constant",value:Z},p)}else if(h.expression.kind==="camera"){var Y=this._calculate(h.expression.evaluate({zoom:p.zoom-1}),h.expression.evaluate({zoom:p.zoom}),h.expression.evaluate({zoom:p.zoom+1}),p);return new tn(this,{kind:"constant",value:Y},p)}else return new tn(this,h.expression,p)},i.prototype.evaluate=function(h,p,x,E,M,L){if(h.kind==="source"){var V=h.evaluate(p,x,E,M,L);return this._calculate(V,V,V,p)}else return h.kind==="composite"?this._calculate(h.evaluate({zoom:Math.floor(p.zoom)-1},x,E),h.evaluate({zoom:Math.floor(p.zoom)},x,E),h.evaluate({zoom:Math.floor(p.zoom)+1},x,E),p):h.value},i.prototype._calculate=function(h,p,x,E){var M=E.zoom;return M>E.zoomHistory.lastIntegerZoom?{from:h,to:p}:{from:x,to:p}},i.prototype.interpolate=function(h){return h},i}(Ke),Ca=function(i){this.specification=i};Ca.prototype.possiblyEvaluate=function(i,a,h,p){if(i.value!==void 0)if(i.expression.kind==="constant"){var x=i.expression.evaluate(a,null,{},h,p);return this._calculate(x,x,x,a)}else return this._calculate(i.expression.evaluate(new Fi(Math.floor(a.zoom-1),a)),i.expression.evaluate(new Fi(Math.floor(a.zoom),a)),i.expression.evaluate(new Fi(Math.floor(a.zoom+1),a)),a)},Ca.prototype._calculate=function(i,a,h,p){var x=p.zoom;return x>p.zoomHistory.lastIntegerZoom?{from:i,to:a}:{from:h,to:a}},Ca.prototype.interpolate=function(i){return i};var Ka=function(i){this.specification=i};Ka.prototype.possiblyEvaluate=function(i,a,h,p){return!!i.expression.evaluate(a,null,{},h,p)},Ka.prototype.interpolate=function(){return!1};var Nr=function(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(var a in i){var h=i[a];h.specification.overridable&&this.overridableProperties.push(a);var p=this.defaultPropertyValues[a]=new Ku(h,void 0),x=this.defaultTransitionablePropertyValues[a]=new Eh(h);this.defaultTransitioningPropertyValues[a]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=p.possiblyEvaluate({})}};Ne("DataDrivenProperty",Ke),Ne("DataConstantProperty",Xt),Ne("CrossFadedDataDrivenProperty",Cs),Ne("CrossFadedProperty",Ca),Ne("ColorRampProperty",Ka);var na="-transition",Ya=function(e){function i(a,h){if(e.call(this),this.id=a.id,this.type=a.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},a.type!=="custom"&&(a=a,this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),h.layout&&(this._unevaluatedLayout=new Ia(h.layout)),h.paint)){this._transitionablePaint=new Gn(h.paint);for(var p in a.paint)this.setPaintProperty(p,a.paint[p],{validate:!1});for(var x in a.layout)this.setLayoutProperty(x,a.layout[x],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ar(h.paint)}}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},i.prototype.getLayoutProperty=function(h){return h==="visibility"?this.visibility:this._unevaluatedLayout.getValue(h)},i.prototype.setLayoutProperty=function(h,p,x){if(x===void 0&&(x={}),p!=null){var E="layers."+this.id+".layout."+h;if(this._validate(Ll,E,h,p,x))return}if(h==="visibility"){this.visibility=p;return}this._unevaluatedLayout.setValue(h,p)},i.prototype.getPaintProperty=function(h){return Do(h,na)?this._transitionablePaint.getTransition(h.slice(0,-na.length)):this._transitionablePaint.getValue(h)},i.prototype.setPaintProperty=function(h,p,x){if(x===void 0&&(x={}),p!=null){var E="layers."+this.id+".paint."+h;if(this._validate(uc,E,h,p,x))return!1}if(Do(h,na))return this._transitionablePaint.setTransition(h.slice(0,-na.length),p||void 0),!1;var M=this._transitionablePaint._values[h],L=M.property.specification["property-type"]==="cross-faded-data-driven",V=M.value.isDataDriven(),Z=M.value;this._transitionablePaint.setValue(h,p),this._handleSpecialPaintPropertyUpdate(h);var Y=this._transitionablePaint._values[h].value,rt=Y.isDataDriven();return rt||V||L||this._handleOverridablePaintPropertyUpdate(h,Z,Y)},i.prototype._handleSpecialPaintPropertyUpdate=function(h){},i.prototype._handleOverridablePaintPropertyUpdate=function(h,p,x){return!1},i.prototype.isHidden=function(h){return this.minzoom&&h<this.minzoom||this.maxzoom&&h>=this.maxzoom?!0:this.visibility==="none"},i.prototype.updateTransitions=function(h){this._transitioningPaint=this._transitionablePaint.transitioned(h,this._transitioningPaint)},i.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},i.prototype.recalculate=function(h,p){h.getCrossfadeParameters&&(this._crossfadeParameters=h.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(h,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(h,void 0,p)},i.prototype.serialize=function(){var h={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(h.layout=h.layout||{},h.layout.visibility=this.visibility),Ra(h,function(p,x){return p!==void 0&&!(x==="layout"&&!Object.keys(p).length)&&!(x==="paint"&&!Object.keys(p).length)})},i.prototype._validate=function(h,p,x,E,M){return M===void 0&&(M={}),M&&M.validate===!1?!1:wh(this,h.call(Xi,{key:p,layerType:this.type,objectKey:x,value:E,styleSpec:ue,style:{glyphs:!0,sprite:!0}}))},i.prototype.is3D=function(){return!1},i.prototype.isTileClipped=function(){return!1},i.prototype.hasOffscreenPass=function(){return!1},i.prototype.resize=function(){},i.prototype.isStateDependent=function(){for(var h in this.paint._values){var p=this.paint.get(h);if(!(!(p instanceof tn)||!Uu(p.property.specification))&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},i}(tr),Oi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ol=function(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},jr=128,lf=5,Ri=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};Ri.serialize=function(i,a){return i._trim(),a&&(i.isTransferred=!0,a.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}},Ri.deserialize=function(i){var a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},Ri.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ri.prototype.clear=function(){this.length=0},Ri.prototype.resize=function(i){this.reserve(i),this.length=i},Ri.prototype.reserve=function(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(this.capacity*lf),jr),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},Ri.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};function Mr(e,i){i===void 0&&(i=1);var a=0,h=0,p=e.map(function(E){var M=al(E.type),L=a=Pd(a,Math.max(i,M)),V=E.components||1;return h=Math.max(h,M),a+=M*V,{name:E.name,type:E.type,components:V,offset:L}}),x=Pd(a,Math.max(h,i));return{members:p,size:x,alignment:i}}function al(e){return Oi[e].BYTES_PER_ELEMENT}function Pd(e,i){return Math.ceil(e/i)*i}var Vl=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p){var x=this.length;return this.resize(x+1),this.emplace(x,h,p)},i.prototype.emplace=function(h,p,x){var E=h*2;return this.int16[E+0]=p,this.int16[E+1]=x,h},i}(Ri);Vl.prototype.bytesPerElement=4,Ne("StructArrayLayout2i4",Vl);var uf=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E){var M=this.length;return this.resize(M+1),this.emplace(M,h,p,x,E)},i.prototype.emplace=function(h,p,x,E,M){var L=h*4;return this.int16[L+0]=p,this.int16[L+1]=x,this.int16[L+2]=E,this.int16[L+3]=M,h},i}(Ri);uf.prototype.bytesPerElement=8,Ne("StructArrayLayout4i8",uf);var To=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E,M,L){var V=this.length;return this.resize(V+1),this.emplace(V,h,p,x,E,M,L)},i.prototype.emplace=function(h,p,x,E,M,L,V){var Z=h*6;return this.int16[Z+0]=p,this.int16[Z+1]=x,this.int16[Z+2]=E,this.int16[Z+3]=M,this.int16[Z+4]=L,this.int16[Z+5]=V,h},i}(Ri);To.prototype.bytesPerElement=12,Ne("StructArrayLayout2i4i12",To);var Ul=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E,M,L){var V=this.length;return this.resize(V+1),this.emplace(V,h,p,x,E,M,L)},i.prototype.emplace=function(h,p,x,E,M,L,V){var Z=h*4,Y=h*8;return this.int16[Z+0]=p,this.int16[Z+1]=x,this.uint8[Y+4]=E,this.uint8[Y+5]=M,this.uint8[Y+6]=L,this.uint8[Y+7]=V,h},i}(Ri);Ul.prototype.bytesPerElement=8,Ne("StructArrayLayout2i4ub8",Ul);var Nl=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p){var x=this.length;return this.resize(x+1),this.emplace(x,h,p)},i.prototype.emplace=function(h,p,x){var E=h*2;return this.float32[E+0]=p,this.float32[E+1]=x,h},i}(Ri);Nl.prototype.bytesPerElement=8,Ne("StructArrayLayout2f8",Nl);var Hn=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E,M,L,V,Z,Y,rt){var it=this.length;return this.resize(it+1),this.emplace(it,h,p,x,E,M,L,V,Z,Y,rt)},i.prototype.emplace=function(h,p,x,E,M,L,V,Z,Y,rt,it){var ht=h*10;return this.uint16[ht+0]=p,this.uint16[ht+1]=x,this.uint16[ht+2]=E,this.uint16[ht+3]=M,this.uint16[ht+4]=L,this.uint16[ht+5]=V,this.uint16[ht+6]=Z,this.uint16[ht+7]=Y,this.uint16[ht+8]=rt,this.uint16[ht+9]=it,h},i}(Ri);Hn.prototype.bytesPerElement=20,Ne("StructArrayLayout10ui20",Hn);var ql=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E,M,L,V,Z,Y,rt,it,ht){var _t=this.length;return this.resize(_t+1),this.emplace(_t,h,p,x,E,M,L,V,Z,Y,rt,it,ht)},i.prototype.emplace=function(h,p,x,E,M,L,V,Z,Y,rt,it,ht,_t){var zt=h*12;return this.int16[zt+0]=p,this.int16[zt+1]=x,this.int16[zt+2]=E,this.int16[zt+3]=M,this.uint16[zt+4]=L,this.uint16[zt+5]=V,this.uint16[zt+6]=Z,this.uint16[zt+7]=Y,this.int16[zt+8]=rt,this.int16[zt+9]=it,this.int16[zt+10]=ht,this.int16[zt+11]=_t,h},i}(Ri);ql.prototype.bytesPerElement=24,Ne("StructArrayLayout4i4ui4i24",ql);var Ih=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x){var E=this.length;return this.resize(E+1),this.emplace(E,h,p,x)},i.prototype.emplace=function(h,p,x,E){var M=h*3;return this.float32[M+0]=p,this.float32[M+1]=x,this.float32[M+2]=E,h},i}(Ri);Ih.prototype.bytesPerElement=12,Ne("StructArrayLayout3f12",Ih);var pc=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h){var p=this.length;return this.resize(p+1),this.emplace(p,h)},i.prototype.emplace=function(h,p){var x=h*1;return this.uint32[x+0]=p,h},i}(Ri);pc.prototype.bytesPerElement=4,Ne("StructArrayLayout1ul4",pc);var Ju=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E,M,L,V,Z,Y){var rt=this.length;return this.resize(rt+1),this.emplace(rt,h,p,x,E,M,L,V,Z,Y)},i.prototype.emplace=function(h,p,x,E,M,L,V,Z,Y,rt){var it=h*10,ht=h*5;return this.int16[it+0]=p,this.int16[it+1]=x,this.int16[it+2]=E,this.int16[it+3]=M,this.int16[it+4]=L,this.int16[it+5]=V,this.uint32[ht+3]=Z,this.uint16[it+8]=Y,this.uint16[it+9]=rt,h},i}(Ri);Ju.prototype.bytesPerElement=20,Ne("StructArrayLayout6i1ul2ui20",Ju);var Ch=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E,M,L){var V=this.length;return this.resize(V+1),this.emplace(V,h,p,x,E,M,L)},i.prototype.emplace=function(h,p,x,E,M,L,V){var Z=h*6;return this.int16[Z+0]=p,this.int16[Z+1]=x,this.int16[Z+2]=E,this.int16[Z+3]=M,this.int16[Z+4]=L,this.int16[Z+5]=V,h},i}(Ri);Ch.prototype.bytesPerElement=12,Ne("StructArrayLayout2i2i2i12",Ch);var sl=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E,M){var L=this.length;return this.resize(L+1),this.emplace(L,h,p,x,E,M)},i.prototype.emplace=function(h,p,x,E,M,L){var V=h*4,Z=h*8;return this.float32[V+0]=p,this.float32[V+1]=x,this.float32[V+2]=E,this.int16[Z+6]=M,this.int16[Z+7]=L,h},i}(Ri);sl.prototype.bytesPerElement=16,Ne("StructArrayLayout2f1f2i16",sl);var aa=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E){var M=this.length;return this.resize(M+1),this.emplace(M,h,p,x,E)},i.prototype.emplace=function(h,p,x,E,M){var L=h*12,V=h*3;return this.uint8[L+0]=p,this.uint8[L+1]=x,this.float32[V+1]=E,this.float32[V+2]=M,h},i}(Ri);aa.prototype.bytesPerElement=12,Ne("StructArrayLayout2ub2f12",aa);var Ln=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x){var E=this.length;return this.resize(E+1),this.emplace(E,h,p,x)},i.prototype.emplace=function(h,p,x,E){var M=h*3;return this.uint16[M+0]=p,this.uint16[M+1]=x,this.uint16[M+2]=E,h},i}(Ri);Ln.prototype.bytesPerElement=6,Ne("StructArrayLayout3ui6",Ln);var gr=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E,M,L,V,Z,Y,rt,it,ht,_t,zt,Ct,jt,Rt){var Zt=this.length;return this.resize(Zt+1),this.emplace(Zt,h,p,x,E,M,L,V,Z,Y,rt,it,ht,_t,zt,Ct,jt,Rt)},i.prototype.emplace=function(h,p,x,E,M,L,V,Z,Y,rt,it,ht,_t,zt,Ct,jt,Rt,Zt){var Wt=h*24,le=h*12,xe=h*48;return this.int16[Wt+0]=p,this.int16[Wt+1]=x,this.uint16[Wt+2]=E,this.uint16[Wt+3]=M,this.uint32[le+2]=L,this.uint32[le+3]=V,this.uint32[le+4]=Z,this.uint16[Wt+10]=Y,this.uint16[Wt+11]=rt,this.uint16[Wt+12]=it,this.float32[le+7]=ht,this.float32[le+8]=_t,this.uint8[xe+36]=zt,this.uint8[xe+37]=Ct,this.uint8[xe+38]=jt,this.uint32[le+10]=Rt,this.int16[Wt+22]=Zt,h},i}(Ri);gr.prototype.bytesPerElement=48,Ne("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",gr);var Zl=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E,M,L,V,Z,Y,rt,it,ht,_t,zt,Ct,jt,Rt,Zt,Wt,le,xe,ve,Be,Te,De,oi,Oe,Ve){var gi=this.length;return this.resize(gi+1),this.emplace(gi,h,p,x,E,M,L,V,Z,Y,rt,it,ht,_t,zt,Ct,jt,Rt,Zt,Wt,le,xe,ve,Be,Te,De,oi,Oe,Ve)},i.prototype.emplace=function(h,p,x,E,M,L,V,Z,Y,rt,it,ht,_t,zt,Ct,jt,Rt,Zt,Wt,le,xe,ve,Be,Te,De,oi,Oe,Ve,gi){var ni=h*34,qi=h*17;return this.int16[ni+0]=p,this.int16[ni+1]=x,this.int16[ni+2]=E,this.int16[ni+3]=M,this.int16[ni+4]=L,this.int16[ni+5]=V,this.int16[ni+6]=Z,this.int16[ni+7]=Y,this.uint16[ni+8]=rt,this.uint16[ni+9]=it,this.uint16[ni+10]=ht,this.uint16[ni+11]=_t,this.uint16[ni+12]=zt,this.uint16[ni+13]=Ct,this.uint16[ni+14]=jt,this.uint16[ni+15]=Rt,this.uint16[ni+16]=Zt,this.uint16[ni+17]=Wt,this.uint16[ni+18]=le,this.uint16[ni+19]=xe,this.uint16[ni+20]=ve,this.uint16[ni+21]=Be,this.uint16[ni+22]=Te,this.uint32[qi+12]=De,this.float32[qi+13]=oi,this.float32[qi+14]=Oe,this.float32[qi+15]=Ve,this.float32[qi+16]=gi,h},i}(Ri);Zl.prototype.bytesPerElement=68,Ne("StructArrayLayout8i15ui1ul4f68",Zl);var ol=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h){var p=this.length;return this.resize(p+1),this.emplace(p,h)},i.prototype.emplace=function(h,p){var x=h*1;return this.float32[x+0]=p,h},i}(Ri);ol.prototype.bytesPerElement=4,Ne("StructArrayLayout1f4",ol);var mc=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x){var E=this.length;return this.resize(E+1),this.emplace(E,h,p,x)},i.prototype.emplace=function(h,p,x,E){var M=h*3;return this.int16[M+0]=p,this.int16[M+1]=x,this.int16[M+2]=E,h},i}(Ri);mc.prototype.bytesPerElement=6,Ne("StructArrayLayout3i6",mc);var Eo=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x){var E=this.length;return this.resize(E+1),this.emplace(E,h,p,x)},i.prototype.emplace=function(h,p,x,E){var M=h*2,L=h*4;return this.uint32[M+0]=p,this.uint16[L+2]=x,this.uint16[L+3]=E,h},i}(Ri);Eo.prototype.bytesPerElement=8,Ne("StructArrayLayout1ul2ui8",Eo);var xu=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p){var x=this.length;return this.resize(x+1),this.emplace(x,h,p)},i.prototype.emplace=function(h,p,x){var E=h*2;return this.uint16[E+0]=p,this.uint16[E+1]=x,h},i}(Ri);xu.prototype.bytesPerElement=4,Ne("StructArrayLayout2ui4",xu);var jl=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h){var p=this.length;return this.resize(p+1),this.emplace(p,h)},i.prototype.emplace=function(h,p){var x=h*1;return this.uint16[x+0]=p,h},i}(Ri);jl.prototype.bytesPerElement=2,Ne("StructArrayLayout1ui2",jl);var Xn=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},i.prototype.emplaceBack=function(h,p,x,E){var M=this.length;return this.resize(M+1),this.emplace(M,h,p,x,E)},i.prototype.emplace=function(h,p,x,E,M){var L=h*4;return this.float32[L+0]=p,this.float32[L+1]=x,this.float32[L+2]=E,this.float32[L+3]=M,h},i}(Ri);Xn.prototype.bytesPerElement=16,Ne("StructArrayLayout4f16",Xn);var Qu=function(e){function i(){e.apply(this,arguments)}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var a={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return a.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},a.x1.get=function(){return this._structArray.int16[this._pos2+2]},a.y1.get=function(){return this._structArray.int16[this._pos2+3]},a.x2.get=function(){return this._structArray.int16[this._pos2+4]},a.y2.get=function(){return this._structArray.int16[this._pos2+5]},a.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},a.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},a.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},a.anchorPoint.get=function(){return new pe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(i.prototype,a),i}(Ol);Qu.prototype.size=20;var Xe=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.get=function(h){return new Qu(this,h)},i}(Ju);Ne("CollisionBoxArray",Xe);var Ye=function(e){function i(){e.apply(this,arguments)}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var a={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return a.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},a.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},a.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},a.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},a.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},a.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},a.segment.get=function(){return this._structArray.uint16[this._pos2+10]},a.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},a.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},a.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},a.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},a.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},a.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},a.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},a.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},a.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},a.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},a.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},a.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(i.prototype,a),i}(Ol);Ye.prototype.size=48;var $u=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.get=function(h){return new Ye(this,h)},i}(gr);Ne("PlacedSymbolArray",$u);var ll=function(e){function i(){e.apply(this,arguments)}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var a={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return a.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},a.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},a.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},a.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},a.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},a.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},a.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},a.key.get=function(){return this._structArray.uint16[this._pos2+8]},a.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},a.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},a.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},a.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},a.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},a.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},a.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},a.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},a.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},a.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},a.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},a.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},a.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},a.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},a.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},a.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},a.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},a.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},a.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},a.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(i.prototype,a),i}(Ol);ll.prototype.size=68;var _c=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.get=function(h){return new ll(this,h)},i}(Zl);Ne("SymbolInstanceArray",_c);var Pa=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.getoffsetX=function(h){return this.float32[h*1+0]},i}(ol);Ne("GlyphOffsetArray",Pa);var Ja=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.getx=function(h){return this.int16[h*3+0]},i.prototype.gety=function(h){return this.int16[h*3+1]},i.prototype.gettileUnitDistanceFromAnchor=function(h){return this.int16[h*3+2]},i}(mc);Ne("SymbolLineVertexArray",Ja);var Ps=function(e){function i(){e.apply(this,arguments)}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var a={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return a.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},a.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},a.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(i.prototype,a),i}(Ol);Ps.prototype.size=8;var hf=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.get=function(h){return new Ps(this,h)},i}(Eo);Ne("FeatureIndexArray",hf);var Ph=Mr([{name:"a_pos",components:2,type:"Int16"}],4),Hf=Ph.members,Gr=function(i){i===void 0&&(i=[]),this.segments=i};Gr.prototype.prepareSegment=function(i,a,h,p){var x=this.segments[this.segments.length-1];return i>Gr.MAX_VERTEX_ARRAY_LENGTH&&rr("Max vertices per segment is "+Gr.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+i),(!x||x.vertexLength+i>Gr.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==p)&&(x={vertexOffset:a.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},p!==void 0&&(x.sortKey=p),this.segments.push(x)),x},Gr.prototype.get=function(){return this.segments},Gr.prototype.destroy=function(){for(var i=0,a=this.segments;i<a.length;i+=1){var h=a[i];for(var p in h.vaos)h.vaos[p].destroy()}},Gr.simpleSegment=function(i,a,h,p){return new Gr([{vertexOffset:i,primitiveOffset:a,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])},Gr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ne("SegmentVector",Gr);function d(e,i){return e=fa(Math.floor(e),0,255),i=fa(Math.floor(i),0,255),256*e+i}var l=Mr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),m=C(function(e){function i(a,h){var p,x,E,M,L,V,Z,Y;for(p=a.length&3,x=a.length-p,E=h,L=3432918353,V=461845907,Y=0;Y<x;)Z=a.charCodeAt(Y)&255|(a.charCodeAt(++Y)&255)<<8|(a.charCodeAt(++Y)&255)<<16|(a.charCodeAt(++Y)&255)<<24,++Y,Z=(Z&65535)*L+(((Z>>>16)*L&65535)<<16)&4294967295,Z=Z<<15|Z>>>17,Z=(Z&65535)*V+(((Z>>>16)*V&65535)<<16)&4294967295,E^=Z,E=E<<13|E>>>19,M=(E&65535)*5+(((E>>>16)*5&65535)<<16)&4294967295,E=(M&65535)+27492+(((M>>>16)+58964&65535)<<16);switch(Z=0,p){case 3:Z^=(a.charCodeAt(Y+2)&255)<<16;case 2:Z^=(a.charCodeAt(Y+1)&255)<<8;case 1:Z^=a.charCodeAt(Y)&255,Z=(Z&65535)*L+(((Z>>>16)*L&65535)<<16)&4294967295,Z=Z<<15|Z>>>17,Z=(Z&65535)*V+(((Z>>>16)*V&65535)<<16)&4294967295,E^=Z}return E^=a.length,E^=E>>>16,E=(E&65535)*2246822507+(((E>>>16)*2246822507&65535)<<16)&4294967295,E^=E>>>13,E=(E&65535)*3266489909+(((E>>>16)*3266489909&65535)<<16)&4294967295,E^=E>>>16,E>>>0}e.exports=i}),u=C(function(e){function i(a,h){for(var p=a.length,x=h^p,E=0,M;p>=4;)M=a.charCodeAt(E)&255|(a.charCodeAt(++E)&255)<<8|(a.charCodeAt(++E)&255)<<16|(a.charCodeAt(++E)&255)<<24,M=(M&65535)*1540483477+(((M>>>16)*1540483477&65535)<<16),M^=M>>>24,M=(M&65535)*1540483477+(((M>>>16)*1540483477&65535)<<16),x=(x&65535)*1540483477+(((x>>>16)*1540483477&65535)<<16)^M,p-=4,++E;switch(p){case 3:x^=(a.charCodeAt(E+2)&255)<<16;case 2:x^=(a.charCodeAt(E+1)&255)<<8;case 1:x^=a.charCodeAt(E)&255,x=(x&65535)*1540483477+(((x>>>16)*1540483477&65535)<<16)}return x^=x>>>13,x=(x&65535)*1540483477+(((x>>>16)*1540483477&65535)<<16),x^=x>>>15,x>>>0}e.exports=i}),_=m,I=m,P=u;_.murmur3=I,_.murmur2=P;var D=function(){this.ids=[],this.positions=[],this.indexed=!1};D.prototype.add=function(i,a,h,p){this.ids.push(G(i)),this.positions.push(a,h,p)},D.prototype.getPositions=function(i){for(var a=G(i),h=0,p=this.ids.length-1;h<p;){var x=h+p>>1;this.ids[x]>=a?p=x:h=x+1}for(var E=[];this.ids[h]===a;){var M=this.positions[3*h],L=this.positions[3*h+1],V=this.positions[3*h+2];E.push({index:M,start:L,end:V}),h++}return E},D.serialize=function(i,a){var h=new Float64Array(i.ids),p=new Uint32Array(i.positions);return et(h,p,0,h.length-1),a&&a.push(h.buffer,p.buffer),{ids:h,positions:p}},D.deserialize=function(i){var a=new D;return a.ids=i.ids,a.positions=i.positions,a.indexed=!0,a};var q=Math.pow(2,53)-1;function G(e){var i=+e;return!isNaN(i)&&i<=q?i:_(String(e))}function et(e,i,a,h){for(;a<h;){for(var p=e[a+h>>1],x=a-1,E=h+1;;){do x++;while(e[x]<p);do E--;while(e[E]>p);if(x>=E)break;ot(e,x,E),ot(i,3*x,3*E),ot(i,3*x+1,3*E+1),ot(i,3*x+2,3*E+2)}E-a<h-E?(et(e,i,a,E),a=E+1):(et(e,i,E+1,h),h=E)}}function ot(e,i,a){var h=e[i];e[i]=e[a],e[a]=h}Ne("FeaturePositionMap",D);var at=function(i,a){this.gl=i.gl,this.location=a},pt=function(e){function i(a,h){e.call(this,a,h),this.current=0}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.set=function(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))},i}(at),wt=function(e){function i(a,h){e.call(this,a,h),this.current=0}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.set=function(h){this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))},i}(at),bt=function(e){function i(a,h){e.call(this,a,h),this.current=[0,0]}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.set=function(h){(h[0]!==this.current[0]||h[1]!==this.current[1])&&(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))},i}(at),xt=function(e){function i(a,h){e.call(this,a,h),this.current=[0,0,0]}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.set=function(h){(h[0]!==this.current[0]||h[1]!==this.current[1]||h[2]!==this.current[2])&&(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))},i}(at),Et=function(e){function i(a,h){e.call(this,a,h),this.current=[0,0,0,0]}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.set=function(h){(h[0]!==this.current[0]||h[1]!==this.current[1]||h[2]!==this.current[2]||h[3]!==this.current[3])&&(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3]))},i}(at),kt=function(e){function i(a,h){e.call(this,a,h),this.current=Ki.transparent}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.set=function(h){(h.r!==this.current.r||h.g!==this.current.g||h.b!==this.current.b||h.a!==this.current.a)&&(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a))},i}(at),Gt=new Float32Array(16),Kt=function(e){function i(a,h){e.call(this,a,h),this.current=Gt}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.set=function(h){if(h[12]!==this.current[12]||h[0]!==this.current[0]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);return}for(var p=1;p<16;p++)if(h[p]!==this.current[p]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}},i}(at);function ae(e){return[d(255*e.r,255*e.g),d(255*e.b,255*e.a)]}var oe=function(i,a,h){this.value=i,this.uniformNames=a.map(function(p){return"u_"+p}),this.type=h};oe.prototype.setUniform=function(i,a,h){i.set(h.constantOr(this.value))},oe.prototype.getBinding=function(i,a,h){return this.type==="color"?new kt(i,a):new wt(i,a)};var ne=function(i,a){this.uniformNames=a.map(function(h){return"u_"+h}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ne.prototype.setConstantPatternPositions=function(i,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=i.tlbr},ne.prototype.setUniform=function(i,a,h,p){var x=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&i.set(x)},ne.prototype.getBinding=function(i,a,h){return h.substr(0,9)==="u_pattern"?new Et(i,a):new wt(i,a)};var he=function(i,a,h,p){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=a.map(function(x){return{name:"a_"+x,type:"Float32",components:h==="color"?2:1,offset:0}}),this.paintVertexArray=new p};he.prototype.populatePaintArray=function(i,a,h,p,x){var E=this.paintVertexArray.length,M=this.expression.evaluate(new Fi(0),a,{},p,[],x);this.paintVertexArray.resize(i),this._setPaintValue(E,i,M)},he.prototype.updatePaintArray=function(i,a,h,p){var x=this.expression.evaluate({zoom:0},h,p);this._setPaintValue(i,a,x)},he.prototype._setPaintValue=function(i,a,h){if(this.type==="color")for(var p=ae(h),x=i;x<a;x++)this.paintVertexArray.emplace(x,p[0],p[1]);else{for(var E=i;E<a;E++)this.paintVertexArray.emplace(E,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}},he.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},he.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ge=function(i,a,h,p,x,E){this.expression=i,this.uniformNames=a.map(function(M){return"u_"+M+"_t"}),this.type=h,this.useIntegerZoom=p,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=a.map(function(M){return{name:"a_"+M,type:"Float32",components:h==="color"?4:2,offset:0}}),this.paintVertexArray=new E};ge.prototype.populatePaintArray=function(i,a,h,p,x){var E=this.expression.evaluate(new Fi(this.zoom),a,{},p,[],x),M=this.expression.evaluate(new Fi(this.zoom+1),a,{},p,[],x),L=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(L,i,E,M)},ge.prototype.updatePaintArray=function(i,a,h,p){var x=this.expression.evaluate({zoom:this.zoom},h,p),E=this.expression.evaluate({zoom:this.zoom+1},h,p);this._setPaintValue(i,a,x,E)},ge.prototype._setPaintValue=function(i,a,h,p){if(this.type==="color")for(var x=ae(h),E=ae(p),M=i;M<a;M++)this.paintVertexArray.emplace(M,x[0],x[1],E[0],E[1]);else{for(var L=i;L<a;L++)this.paintVertexArray.emplace(L,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}},ge.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ge.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ge.prototype.setUniform=function(i,a){var h=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,p=fa(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(p)},ge.prototype.getBinding=function(i,a,h){return new wt(i,a)};var Se=function(i,a,h,p,x,E){this.expression=i,this.type=a,this.useIntegerZoom=h,this.zoom=p,this.layerId=E,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x};Se.prototype.populatePaintArray=function(i,a,h){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(p,i,a.patterns&&a.patterns[this.layerId],h)},Se.prototype.updatePaintArray=function(i,a,h,p,x){this._setPaintValues(i,a,h.patterns&&h.patterns[this.layerId],x)},Se.prototype._setPaintValues=function(i,a,h,p){if(!(!p||!h)){var x=h.min,E=h.mid,M=h.max,L=p[x],V=p[E],Z=p[M];if(!(!L||!V||!Z))for(var Y=i;Y<a;Y++)this.zoomInPaintVertexArray.emplace(Y,V.tl[0],V.tl[1],V.br[0],V.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],V.pixelRatio,L.pixelRatio),this.zoomOutPaintVertexArray.emplace(Y,V.tl[0],V.tl[1],V.br[0],V.br[1],Z.tl[0],Z.tl[1],Z.br[0],Z.br[1],V.pixelRatio,Z.pixelRatio)}},Se.prototype.upload=function(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,l.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,l.members,this.expression.isStateDependent))},Se.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Ce=function(i,a,h){this.binders={},this._buffers=[];var p=[];for(var x in i.paint._values)if(h(x)){var E=i.paint.get(x);if(!(!(E instanceof tn)||!Uu(E.property.specification))){var M=Je(x,i.type),L=E.value,V=E.property.specification.type,Z=E.property.useIntegerZoom,Y=E.property.specification["property-type"],rt=Y==="cross-faded"||Y==="cross-faded-data-driven";if(L.kind==="constant")this.binders[x]=rt?new ne(L.value,M):new oe(L.value,M,V),p.push("/u_"+x);else if(L.kind==="source"||rt){var it=_i(x,V,"source");this.binders[x]=rt?new Se(L,V,Z,a,it,i.id):new he(L,M,V,it),p.push("/a_"+x)}else{var ht=_i(x,V,"composite");this.binders[x]=new ge(L,M,V,Z,a,ht),p.push("/z_"+x)}}}this.cacheKey=p.sort().join("")};Ce.prototype.getMaxValue=function(i){var a=this.binders[i];return a instanceof he||a instanceof ge?a.maxValue:0},Ce.prototype.populatePaintArrays=function(i,a,h,p,x){for(var E in this.binders){var M=this.binders[E];(M instanceof he||M instanceof ge||M instanceof Se)&&M.populatePaintArray(i,a,h,p,x)}},Ce.prototype.setConstantPatternPositions=function(i,a){for(var h in this.binders){var p=this.binders[h];p instanceof ne&&p.setConstantPatternPositions(i,a)}},Ce.prototype.updatePaintArrays=function(i,a,h,p,x){var E=!1;for(var M in i)for(var L=a.getPositions(M),V=0,Z=L;V<Z.length;V+=1){var Y=Z[V],rt=h.feature(Y.index);for(var it in this.binders){var ht=this.binders[it];if((ht instanceof he||ht instanceof ge||ht instanceof Se)&&ht.expression.isStateDependent===!0){var _t=p.paint.get(it);ht.expression=_t.value,ht.updatePaintArray(Y.start,Y.end,rt,i[M],x),E=!0}}}return E},Ce.prototype.defines=function(){var i=[];for(var a in this.binders){var h=this.binders[a];(h instanceof oe||h instanceof ne)&&i.push.apply(i,h.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return i},Ce.prototype.getBinderAttributes=function(){var i=[];for(var a in this.binders){var h=this.binders[a];if(h instanceof he||h instanceof ge)for(var p=0;p<h.paintVertexAttributes.length;p++)i.push(h.paintVertexAttributes[p].name);else if(h instanceof Se)for(var x=0;x<l.members.length;x++)i.push(l.members[x].name)}return i},Ce.prototype.getBinderUniforms=function(){var i=[];for(var a in this.binders){var h=this.binders[a];if(h instanceof oe||h instanceof ne||h instanceof ge)for(var p=0,x=h.uniformNames;p<x.length;p+=1){var E=x[p];i.push(E)}}return i},Ce.prototype.getPaintVertexBuffers=function(){return this._buffers},Ce.prototype.getUniforms=function(i,a){var h=[];for(var p in this.binders){var x=this.binders[p];if(x instanceof oe||x instanceof ne||x instanceof ge)for(var E=0,M=x.uniformNames;E<M.length;E+=1){var L=M[E];if(a[L]){var V=x.getBinding(i,a[L],L);h.push({name:L,property:p,binding:V})}}}return h},Ce.prototype.setUniforms=function(i,a,h,p){for(var x=0,E=a;x<E.length;x+=1){var M=E[x],L=M.name,V=M.property,Z=M.binding;this.binders[V].setUniform(Z,p,h.get(V),L)}},Ce.prototype.updatePaintBuffers=function(i){this._buffers=[];for(var a in this.binders){var h=this.binders[a];if(i&&h instanceof Se){var p=i.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(h instanceof he||h instanceof ge)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}},Ce.prototype.upload=function(i){for(var a in this.binders){var h=this.binders[a];(h instanceof he||h instanceof ge||h instanceof Se)&&h.upload(i)}this.updatePaintBuffers()},Ce.prototype.destroy=function(){for(var i in this.binders){var a=this.binders[i];(a instanceof he||a instanceof ge||a instanceof Se)&&a.destroy()}};var Ee=function(i,a,h){h===void 0&&(h=function(){return!0}),this.programConfigurations={};for(var p=0,x=i;p<x.length;p+=1){var E=x[p];this.programConfigurations[E.id]=new Ce(E,a,h)}this.needsUpload=!1,this._featureMap=new D,this._bufferOffset=0};Ee.prototype.populatePaintArrays=function(i,a,h,p,x,E){for(var M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,a,p,x,E);a.id!==void 0&&this._featureMap.add(a.id,h,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0},Ee.prototype.updatePaintArrays=function(i,a,h,p){for(var x=0,E=h;x<E.length;x+=1){var M=E[x];this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(i,this._featureMap,a,M,p)||this.needsUpload}},Ee.prototype.get=function(i){return this.programConfigurations[i]},Ee.prototype.upload=function(i){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}},Ee.prototype.destroy=function(){for(var i in this.programConfigurations)this.programConfigurations[i].destroy()};function Je(e,i){var a={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]};return a[e]||[e.replace(i+"-","").replace(/-/g,"_")]}function Ai(e){var i={"line-pattern":{source:Hn,composite:Hn},"fill-pattern":{source:Hn,composite:Hn},"fill-extrusion-pattern":{source:Hn,composite:Hn}};return i[e]}function _i(e,i,a){var h={color:{source:Nl,composite:Xn},number:{source:ol,composite:Nl}},p=Ai(e);return p&&p[a]||h[i][a]}Ne("ConstantBinder",oe),Ne("CrossFadedConstantBinder",ne),Ne("SourceExpressionBinder",he),Ne("CrossFadedCompositeBinder",Se),Ne("CompositeExpressionBinder",ge),Ne("ProgramConfiguration",Ce,{omit:["_buffers"]}),Ne("ProgramConfigurationSet",Ee);var Re=8192,fi=15,si=Math.pow(2,fi-1)-1,Li=-si-1;function Mi(e){for(var i=Re/e.extent,a=e.loadGeometry(),h=0;h<a.length;h++)for(var p=a[h],x=0;x<p.length;x++){var E=p[x],M=Math.round(E.x*i),L=Math.round(E.y*i);E.x=fa(M,Li,si),E.y=fa(L,Li,si),(M<E.x||M>E.x+1||L<E.y||L>E.y+1)&&rr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return a}function or(e,i){return{type:e.type,id:e.id,properties:e.properties,geometry:i?Mi(e):[]}}function wi(e,i,a,h,p){e.emplaceBack(i*2+(h+1)/2,a*2+(p+1)/2)}var ir=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Vl,this.indexArray=new Ln,this.segments=new Gr,this.programConfigurations=new Ee(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};ir.prototype.populate=function(i,a,h){var p=this.layers[0],x=[],E=null;p.type==="circle"&&(E=p.layout.get("circle-sort-key"));for(var M=0,L=i;M<L.length;M+=1){var V=L[M],Z=V.feature,Y=V.id,rt=V.index,it=V.sourceLayerIndex,ht=this.layers[0]._featureFilter.needGeometry,_t=or(Z,ht);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),_t,h)){var zt=E?E.evaluate(_t,{},h):void 0,Ct={id:Y,properties:Z.properties,type:Z.type,sourceLayerIndex:it,index:rt,geometry:ht?_t.geometry:Mi(Z),patterns:{},sortKey:zt};x.push(Ct)}}E&&x.sort(function(Te,De){return Te.sortKey-De.sortKey});for(var jt=0,Rt=x;jt<Rt.length;jt+=1){var Zt=Rt[jt],Wt=Zt,le=Wt.geometry,xe=Wt.index,ve=Wt.sourceLayerIndex,Be=i[xe].feature;this.addFeature(Zt,le,xe,h),a.featureIndex.insert(Be,le,xe,ve,this.index)}},ir.prototype.update=function(i,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,h)},ir.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ir.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ir.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Hf),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},ir.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ir.prototype.addFeature=function(i,a,h,p){for(var x=0,E=a;x<E.length;x+=1)for(var M=E[x],L=0,V=M;L<V.length;L+=1){var Z=V[L],Y=Z.x,rt=Z.y;if(!(Y<0||Y>=Re||rt<0||rt>=Re)){var it=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),ht=it.vertexLength;wi(this.layoutVertexArray,Y,rt,-1,-1),wi(this.layoutVertexArray,Y,rt,1,-1),wi(this.layoutVertexArray,Y,rt,1,1),wi(this.layoutVertexArray,Y,rt,-1,1),this.indexArray.emplaceBack(ht,ht+1,ht+2),this.indexArray.emplaceBack(ht,ht+3,ht+2),it.vertexLength+=4,it.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},p)},Ne("CircleBucket",ir,{omit:["layers"]});function ri(e,i){for(var a=0;a<e.length;a++)if(za(i,e[a]))return!0;for(var h=0;h<i.length;h++)if(za(e,i[h]))return!0;return!!cs(e,i)}function Ti(e,i,a){return!!(za(e,i)||Ma(i,e,a))}function Lr(e,i){if(e.length===1)return Io(i,e[0]);for(var a=0;a<i.length;a++)for(var h=i[a],p=0;p<h.length;p++)if(za(e,h[p]))return!0;for(var x=0;x<e.length;x++)if(Io(i,e[x]))return!0;for(var E=0;E<i.length;E++)if(cs(e,i[E]))return!0;return!1}function cn(e,i,a){for(var h=0;h<i.length;h++){var p=i[h];if(e.length>=3){for(var x=0;x<p.length;x++)if(za(e,p[x]))return!0}if(As(e,p,a))return!0}return!1}function As(e,i,a){if(e.length>1){if(cs(e,i))return!0;for(var h=0;h<i.length;h++)if(Ma(i[h],e,a))return!0}for(var p=0;p<e.length;p++)if(Ma(e[p],i,a))return!0;return!1}function cs(e,i){if(e.length===0||i.length===0)return!1;for(var a=0;a<e.length-1;a++)for(var h=e[a],p=e[a+1],x=0;x<i.length-1;x++){var E=i[x],M=i[x+1];if(Aa(h,p,E,M))return!0}return!1}function Aa(e,i,a,h){return mn(e,a,h)!==mn(i,a,h)&&mn(e,i,a)!==mn(e,i,h)}function Ma(e,i,a){var h=a*a;if(i.length===1)return e.distSqr(i[0])<h;for(var p=1;p<i.length;p++){var x=i[p-1],E=i[p];if(bu(e,x,E)<h)return!0}return!1}function bu(e,i,a){var h=i.distSqr(a);if(h===0)return e.distSqr(i);var p=((e.x-i.x)*(a.x-i.x)+(e.y-i.y)*(a.y-i.y))/h;return p<0?e.distSqr(i):p>1?e.distSqr(a):e.distSqr(a.sub(i)._mult(p)._add(i))}function Io(e,i){for(var a=!1,h,p,x,E=0;E<e.length;E++){h=e[E];for(var M=0,L=h.length-1;M<h.length;L=M++)p=h[M],x=h[L],p.y>i.y!=x.y>i.y&&i.x<(x.x-p.x)*(i.y-p.y)/(x.y-p.y)+p.x&&(a=!a)}return a}function za(e,i){for(var a=!1,h=0,p=e.length-1;h<e.length;p=h++){var x=e[h],E=e[p];x.y>i.y!=E.y>i.y&&i.x<(E.x-x.x)*(i.y-x.y)/(E.y-x.y)+x.x&&(a=!a)}return a}function Ys(e,i,a,h,p){for(var x=0,E=e;x<E.length;x+=1){var M=E[x];if(i<=M.x&&a<=M.y&&h>=M.x&&p>=M.y)return!0}var L=[new pe(i,a),new pe(i,p),new pe(h,p),new pe(h,a)];if(e.length>2)for(var V=0,Z=L;V<Z.length;V+=1){var Y=Z[V];if(za(e,Y))return!0}for(var rt=0;rt<e.length-1;rt++){var it=e[rt],ht=e[rt+1];if(Qa(it,ht,L))return!0}return!1}function Qa(e,i,a){var h=a[0],p=a[2];if(e.x<h.x&&i.x<h.x||e.x>p.x&&i.x>p.x||e.y<h.y&&i.y<h.y||e.y>p.y&&i.y>p.y)return!1;var x=mn(e,i,a[0]);return x!==mn(e,i,a[1])||x!==mn(e,i,a[2])||x!==mn(e,i,a[3])}function Da(e,i,a){var h=i.paint.get(e).value;return h.kind==="constant"?h.value:a.programConfigurations.get(i.id).getMaxValue(e)}function Ms(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function $a(e,i,a,h,p){if(!i[0]&&!i[1])return e;var x=pe.convert(i)._mult(p);a==="viewport"&&x._rotate(-h);for(var E=[],M=0;M<e.length;M++){var L=e[M];E.push(L.sub(x))}return E}var fs=new Nr({"circle-sort-key":new Ke(ue.layout_circle["circle-sort-key"])}),gc=new Nr({"circle-radius":new Ke(ue.paint_circle["circle-radius"]),"circle-color":new Ke(ue.paint_circle["circle-color"]),"circle-blur":new Ke(ue.paint_circle["circle-blur"]),"circle-opacity":new Ke(ue.paint_circle["circle-opacity"]),"circle-translate":new Xt(ue.paint_circle["circle-translate"]),"circle-translate-anchor":new Xt(ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xt(ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xt(ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ke(ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ke(ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ke(ue.paint_circle["circle-stroke-opacity"])}),th={paint:gc,layout:fs},bn=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=arguments,i=0,a=arguments.length;a--;)i+=e[a]*e[a];return Math.sqrt(i)});function cf(){var e=new bn(4);return bn!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function yc(e,i,a){var h=i[0],p=i[1],x=i[2],E=i[3],M=Math.sin(a),L=Math.cos(a);return e[0]=h*L+x*M,e[1]=p*L+E*M,e[2]=h*-M+x*L,e[3]=p*-M+E*L,e}function lr(){var e=new bn(9);return bn!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function wu(e,i){var a=Math.sin(i),h=Math.cos(i);return e[0]=h,e[1]=a,e[2]=0,e[3]=-a,e[4]=h,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Su(){var e=new bn(16);return bn!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Tu(e){var i=new bn(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function w(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function t(e,i){var a=i[0],h=i[1],p=i[2],x=i[3],E=i[4],M=i[5],L=i[6],V=i[7],Z=i[8],Y=i[9],rt=i[10],it=i[11],ht=i[12],_t=i[13],zt=i[14],Ct=i[15],jt=a*M-h*E,Rt=a*L-p*E,Zt=a*V-x*E,Wt=h*L-p*M,le=h*V-x*M,xe=p*V-x*L,ve=Z*_t-Y*ht,Be=Z*zt-rt*ht,Te=Z*Ct-it*ht,De=Y*zt-rt*_t,oi=Y*Ct-it*_t,Oe=rt*Ct-it*zt,Ve=jt*Oe-Rt*oi+Zt*De+Wt*Te-le*Be+xe*ve;return Ve?(Ve=1/Ve,e[0]=(M*Oe-L*oi+V*De)*Ve,e[1]=(p*oi-h*Oe-x*De)*Ve,e[2]=(_t*xe-zt*le+Ct*Wt)*Ve,e[3]=(rt*le-Y*xe-it*Wt)*Ve,e[4]=(L*Te-E*Oe-V*Be)*Ve,e[5]=(a*Oe-p*Te+x*Be)*Ve,e[6]=(zt*Zt-ht*xe-Ct*Rt)*Ve,e[7]=(Z*xe-rt*Zt+it*Rt)*Ve,e[8]=(E*oi-M*Te+V*ve)*Ve,e[9]=(h*Te-a*oi-x*ve)*Ve,e[10]=(ht*le-_t*Zt+Ct*jt)*Ve,e[11]=(Y*Zt-Z*le-it*jt)*Ve,e[12]=(M*Be-E*De-L*ve)*Ve,e[13]=(a*De-h*Be+p*ve)*Ve,e[14]=(_t*Rt-ht*Wt-zt*jt)*Ve,e[15]=(Z*Wt-Y*Rt+rt*jt)*Ve,e):null}function o(e,i,a){var h=i[0],p=i[1],x=i[2],E=i[3],M=i[4],L=i[5],V=i[6],Z=i[7],Y=i[8],rt=i[9],it=i[10],ht=i[11],_t=i[12],zt=i[13],Ct=i[14],jt=i[15],Rt=a[0],Zt=a[1],Wt=a[2],le=a[3];return e[0]=Rt*h+Zt*M+Wt*Y+le*_t,e[1]=Rt*p+Zt*L+Wt*rt+le*zt,e[2]=Rt*x+Zt*V+Wt*it+le*Ct,e[3]=Rt*E+Zt*Z+Wt*ht+le*jt,Rt=a[4],Zt=a[5],Wt=a[6],le=a[7],e[4]=Rt*h+Zt*M+Wt*Y+le*_t,e[5]=Rt*p+Zt*L+Wt*rt+le*zt,e[6]=Rt*x+Zt*V+Wt*it+le*Ct,e[7]=Rt*E+Zt*Z+Wt*ht+le*jt,Rt=a[8],Zt=a[9],Wt=a[10],le=a[11],e[8]=Rt*h+Zt*M+Wt*Y+le*_t,e[9]=Rt*p+Zt*L+Wt*rt+le*zt,e[10]=Rt*x+Zt*V+Wt*it+le*Ct,e[11]=Rt*E+Zt*Z+Wt*ht+le*jt,Rt=a[12],Zt=a[13],Wt=a[14],le=a[15],e[12]=Rt*h+Zt*M+Wt*Y+le*_t,e[13]=Rt*p+Zt*L+Wt*rt+le*zt,e[14]=Rt*x+Zt*V+Wt*it+le*Ct,e[15]=Rt*E+Zt*Z+Wt*ht+le*jt,e}function f(e,i,a){var h=a[0],p=a[1],x=a[2],E,M,L,V,Z,Y,rt,it,ht,_t,zt,Ct;return i===e?(e[12]=i[0]*h+i[4]*p+i[8]*x+i[12],e[13]=i[1]*h+i[5]*p+i[9]*x+i[13],e[14]=i[2]*h+i[6]*p+i[10]*x+i[14],e[15]=i[3]*h+i[7]*p+i[11]*x+i[15]):(E=i[0],M=i[1],L=i[2],V=i[3],Z=i[4],Y=i[5],rt=i[6],it=i[7],ht=i[8],_t=i[9],zt=i[10],Ct=i[11],e[0]=E,e[1]=M,e[2]=L,e[3]=V,e[4]=Z,e[5]=Y,e[6]=rt,e[7]=it,e[8]=ht,e[9]=_t,e[10]=zt,e[11]=Ct,e[12]=E*h+Z*p+ht*x+i[12],e[13]=M*h+Y*p+_t*x+i[13],e[14]=L*h+rt*p+zt*x+i[14],e[15]=V*h+it*p+Ct*x+i[15]),e}function g(e,i,a){var h=a[0],p=a[1],x=a[2];return e[0]=i[0]*h,e[1]=i[1]*h,e[2]=i[2]*h,e[3]=i[3]*h,e[4]=i[4]*p,e[5]=i[5]*p,e[6]=i[6]*p,e[7]=i[7]*p,e[8]=i[8]*x,e[9]=i[9]*x,e[10]=i[10]*x,e[11]=i[11]*x,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function S(e,i,a){var h=Math.sin(a),p=Math.cos(a),x=i[4],E=i[5],M=i[6],L=i[7],V=i[8],Z=i[9],Y=i[10],rt=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=x*p+V*h,e[5]=E*p+Z*h,e[6]=M*p+Y*h,e[7]=L*p+rt*h,e[8]=V*p-x*h,e[9]=Z*p-E*h,e[10]=Y*p-M*h,e[11]=rt*p-L*h,e}function z(e,i,a){var h=Math.sin(a),p=Math.cos(a),x=i[0],E=i[1],M=i[2],L=i[3],V=i[4],Z=i[5],Y=i[6],rt=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=x*p+V*h,e[1]=E*p+Z*h,e[2]=M*p+Y*h,e[3]=L*p+rt*h,e[4]=V*p-x*h,e[5]=Z*p-E*h,e[6]=Y*p-M*h,e[7]=rt*p-L*h,e}function k(e,i,a,h,p){var x=1/Math.tan(i/2),E;return e[0]=x/a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,p!=null&&p!==1/0?(E=1/(h-p),e[10]=(p+h)*E,e[14]=2*p*h*E):(e[10]=-1,e[14]=-2*h),e}function R(e,i,a,h,p,x,E){var M=1/(i-a),L=1/(h-p),V=1/(x-E);return e[0]=-2*M,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*L,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*V,e[11]=0,e[12]=(i+a)*M,e[13]=(p+h)*L,e[14]=(E+x)*V,e[15]=1,e}var X=o;function K(){var e=new bn(3);return bn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function J(e){var i=new bn(3);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i}function ut(e,i,a){return e[0]=i[0]+a[0],e[1]=i[1]+a[1],e[2]=i[2]+a[2],e}function mt(e,i,a){return e[0]=i[0]-a[0],e[1]=i[1]-a[1],e[2]=i[2]-a[2],e}function vt(e,i,a){return e[0]=i[0]*a,e[1]=i[1]*a,e[2]=i[2]*a,e}function Tt(e,i){var a=i[0],h=i[1],p=i[2],x=a*a+h*h+p*p;return x>0&&(x=1/Math.sqrt(x)),e[0]=i[0]*x,e[1]=i[1]*x,e[2]=i[2]*x,e}function Ft(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]}function Bt(e,i,a){var h=i[0],p=i[1],x=i[2],E=a[0],M=a[1],L=a[2];return e[0]=p*L-x*M,e[1]=x*E-h*L,e[2]=h*M-p*E,e}function Ot(e,i,a){var h=i[0],p=i[1],x=i[2];return e[0]=h*a[0]+p*a[3]+x*a[6],e[1]=h*a[1]+p*a[4]+x*a[7],e[2]=h*a[2]+p*a[5]+x*a[8],e}var Dt=mt;(function(){var e=K();return function(i,a,h,p,x,E){var M,L;for(a||(a=3),h||(h=0),p?L=Math.min(p*a+h,i.length):L=i.length,M=h;M<L;M+=a)e[0]=i[M],e[1]=i[M+1],e[2]=i[M+2],x(e,e,E),i[M]=e[0],i[M+1]=e[1],i[M+2]=e[2];return i}})();function ie(){var e=new bn(4);return bn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function $t(e,i,a){return e[0]=i[0]*a,e[1]=i[1]*a,e[2]=i[2]*a,e[3]=i[3]*a,e}function ce(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function we(e,i,a){var h=i[0],p=i[1],x=i[2],E=i[3];return e[0]=a[0]*h+a[4]*p+a[8]*x+a[12]*E,e[1]=a[1]*h+a[5]*p+a[9]*x+a[13]*E,e[2]=a[2]*h+a[6]*p+a[10]*x+a[14]*E,e[3]=a[3]*h+a[7]*p+a[11]*x+a[15]*E,e}(function(){var e=ie();return function(i,a,h,p,x,E){var M,L;for(a||(a=4),h||(h=0),p?L=Math.min(p*a+h,i.length):L=i.length,M=h;M<L;M+=a)e[0]=i[M],e[1]=i[M+1],e[2]=i[M+2],e[3]=i[M+3],x(e,e,E),i[M]=e[0],i[M+1]=e[1],i[M+2]=e[2],i[M+3]=e[3];return i}})();function Fe(){var e=new bn(2);return bn!=Float32Array&&(e[0]=0,e[1]=0),e}function Ge(e){var i=e[0],a=e[1];return i*i+a*a}var Ze=Ge;(function(){var e=Fe();return function(i,a,h,p,x,E){var M,L;for(a||(a=2),h||(h=0),p?L=Math.min(p*a+h,i.length):L=i.length,M=h;M<L;M+=a)e[0]=i[M],e[1]=i[M+1],x(e,e,E),i[M]=e[0],i[M+1]=e[1];return i}})();var ei=function(e){function i(a){e.call(this,a,th)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.createBucket=function(h){return new ir(h)},i.prototype.queryRadius=function(h){var p=h;return Da("circle-radius",this,p)+Da("circle-stroke-width",this,p)+Ms(this.paint.get("circle-translate"))},i.prototype.queryIntersectsFeature=function(h,p,x,E,M,L,V,Z){for(var Y=$a(h,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),L.angle,V),rt=this.paint.get("circle-radius").evaluate(p,x),it=this.paint.get("circle-stroke-width").evaluate(p,x),ht=rt+it,_t=this.paint.get("circle-pitch-alignment")==="map",zt=_t?Y:ui(Y,Z),Ct=_t?ht*V:ht,jt=0,Rt=E;jt<Rt.length;jt+=1)for(var Zt=Rt[jt],Wt=0,le=Zt;Wt<le.length;Wt+=1){var xe=le[Wt],ve=_t?xe:Le(xe,Z),Be=Ct,Te=we([],[xe.x,xe.y,0,1],Z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Be*=Te[3]/L.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Be*=L.cameraToCenterDistance/Te[3]),Ti(zt,ve,Be))return!0}return!1},i}(Ya);function Le(e,i){var a=we([],[e.x,e.y,0,1],i);return new pe(a[0]/a[3],a[1]/a[3])}function ui(e,i){return e.map(function(a){return Le(a,i)})}var ti=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i}(ir);Ne("HeatmapBucket",ti,{omit:["layers"]});function Gi(e,i,a,h){var p=i.width,x=i.height;if(!h)h=new Uint8Array(p*x*a);else if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==p*x*a)throw new RangeError("mismatched image size");return e.width=p,e.height=x,e.data=h,e}function ye(e,i,a){var h=i.width,p=i.height;if(!(h===e.width&&p===e.height)){var x=Gi({},{width:h,height:p},a);Pe(e,x,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,h),height:Math.min(e.height,p)},a),e.width=h,e.height=p,e.data=x.data}}function Pe(e,i,a,h,p,x){if(p.width===0||p.height===0)return i;if(p.width>e.width||p.height>e.height||a.x>e.width-p.width||a.y>e.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||h.x>i.width-p.width||h.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");for(var E=e.data,M=i.data,L=0;L<p.height;L++)for(var V=((a.y+L)*e.width+a.x)*x,Z=((h.y+L)*i.width+h.x)*x,Y=0;Y<p.width*x;Y++)M[Z+Y]=E[V+Y];return i}var Ui=function(i,a){Gi(this,i,1,a)};Ui.prototype.resize=function(i){ye(this,i,1)},Ui.prototype.clone=function(){return new Ui({width:this.width,height:this.height},new Uint8Array(this.data))},Ui.copy=function(i,a,h,p,x){Pe(i,a,h,p,x,1)};var Wi=function(i,a){Gi(this,i,4,a)};Wi.prototype.resize=function(i){ye(this,i,4)},Wi.prototype.replace=function(i,a){a?this.data.set(i):i instanceof Uint8ClampedArray?this.data=new Uint8Array(i.buffer):this.data=i},Wi.prototype.clone=function(){return new Wi({width:this.width,height:this.height},new Uint8Array(this.data))},Wi.copy=function(i,a,h,p,x){Pe(i,a,h,p,x,4)},Ne("AlphaImage",Ui),Ne("RGBAImage",Wi);var Ni=new Nr({"heatmap-radius":new Ke(ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ke(ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xt(ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ka(ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xt(ue.paint_heatmap["heatmap-opacity"])}),Hr={paint:Ni};function Xr(e){var i={},a=e.resolution||256,h=e.clips?e.clips.length:1,p=e.image||new Wi({width:a,height:h}),x=function(jt,Rt,Zt){i[e.evaluationKey]=Zt;var Wt=e.expression.evaluate(i);p.data[jt+Rt+0]=Math.floor(Wt.r*255/Wt.a),p.data[jt+Rt+1]=Math.floor(Wt.g*255/Wt.a),p.data[jt+Rt+2]=Math.floor(Wt.b*255/Wt.a),p.data[jt+Rt+3]=Math.floor(Wt.a*255)};if(e.clips)for(var V=0,Z=0;V<h;++V,Z+=a*4)for(var Y=0,rt=0;Y<a;Y++,rt+=4){var it=Y/(a-1),ht=e.clips[V],_t=ht.start,zt=ht.end,Ct=_t*(1-it)+zt*it;x(Z,rt,Ct)}else for(var E=0,M=0;E<a;E++,M+=4){var L=E/(a-1);x(0,M,L)}return p}var ur=function(e){function i(a){e.call(this,a,Hr),this._updateColorRamp()}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.createBucket=function(h){return new ti(h)},i.prototype._handleSpecialPaintPropertyUpdate=function(h){h==="heatmap-color"&&this._updateColorRamp()},i.prototype._updateColorRamp=function(){var h=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Xr({expression:h,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},i.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},i.prototype.queryRadius=function(){return 0},i.prototype.queryIntersectsFeature=function(){return!1},i.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},i}(Ya),Rr=new Nr({"hillshade-illumination-direction":new Xt(ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xt(ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xt(ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xt(ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xt(ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xt(ue.paint_hillshade["hillshade-accent-color"])}),yr={paint:Rr},ul=function(e){function i(a){e.call(this,a,yr)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},i}(Ya),ds=Mr([{name:"a_pos",components:2,type:"Int16"}],4),sa=ds.members,Rn=Js,Gl=Js;function Js(e,i,a){a=a||2;var h=i&&i.length,p=h?i[0]*a:e.length,x=Eu(e,0,p,a,!0),E=[];if(!x||x.next===x.prev)return E;var M,L,V,Z,Y,rt,it;if(h&&(x=$s(e,i,x,a)),e.length>80*a){M=V=e[0],L=Z=e[1];for(var ht=a;ht<p;ht+=a)Y=e[ht],rt=e[ht+1],Y<M&&(M=Y),rt<L&&(L=rt),Y>V&&(V=Y),rt>Z&&(Z=rt);it=Math.max(V-M,Z-L),it=it!==0?1/it:0}return Qs(x,E,a,M,L,it),E}function Eu(e,i,a,h,p){var x,E;if(p===Pp(e,i,a,h)>0)for(x=i;x<a;x+=h)E=Md(x,e[x],e[x+1],E);else for(x=a-h;x>=i;x-=h)E=Md(x,e[x],e[x+1],E);return E&&vc(E,E.next)&&(Mh(E),E=E.next),E}function Bn(e,i){if(!e)return e;i||(i=e);var a=e,h;do if(h=!1,!a.steiner&&(vc(a,a.next)||nn(a.prev,a,a.next)===0)){if(Mh(a),a=i=a.prev,a===a.next)break;h=!0}else a=a.next;while(h||a!==i);return i}function Qs(e,i,a,h,p,x,E){if(e){!E&&x&&ps(e,h,p,x);for(var M=e,L,V;e.prev!==e.next;){if(L=e.prev,V=e.next,x?ff(e,h,p,x):Xf(e)){i.push(L.i/a),i.push(e.i/a),i.push(V.i/a),Mh(e),e=V.next,M=V.next;continue}if(e=V,e===M){E?E===1?(e=Hl(Bn(e),i,a),Qs(e,i,a,h,p,x,2)):E===2&&Co(e,i,a,h,p,x):Qs(Bn(e),i,a,h,p,x,1);break}}}}function Xf(e){var i=e.prev,a=e,h=e.next;if(nn(i,a,h)>=0)return!1;for(var p=e.next.next;p!==e.prev;){if(ih(i.x,i.y,a.x,a.y,h.x,h.y,p.x,p.y)&&nn(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function ff(e,i,a,h){var p=e.prev,x=e,E=e.next;if(nn(p,x,E)>=0)return!1;for(var M=p.x<x.x?p.x<E.x?p.x:E.x:x.x<E.x?x.x:E.x,L=p.y<x.y?p.y<E.y?p.y:E.y:x.y<E.y?x.y:E.y,V=p.x>x.x?p.x>E.x?p.x:E.x:x.x>E.x?x.x:E.x,Z=p.y>x.y?p.y>E.y?p.y:E.y:x.y>E.y?x.y:E.y,Y=en(M,L,i,a,h),rt=en(V,Z,i,a,h),it=e.prevZ,ht=e.nextZ;it&&it.z>=Y&&ht&&ht.z<=rt;){if(it!==e.prev&&it!==e.next&&ih(p.x,p.y,x.x,x.y,E.x,E.y,it.x,it.y)&&nn(it.prev,it,it.next)>=0||(it=it.prevZ,ht!==e.prev&&ht!==e.next&&ih(p.x,p.y,x.x,x.y,E.x,E.y,ht.x,ht.y)&&nn(ht.prev,ht,ht.next)>=0))return!1;ht=ht.nextZ}for(;it&&it.z>=Y;){if(it!==e.prev&&it!==e.next&&ih(p.x,p.y,x.x,x.y,E.x,E.y,it.x,it.y)&&nn(it.prev,it,it.next)>=0)return!1;it=it.prevZ}for(;ht&&ht.z<=rt;){if(ht!==e.prev&&ht!==e.next&&ih(p.x,p.y,x.x,x.y,E.x,E.y,ht.x,ht.y)&&nn(ht.prev,ht,ht.next)>=0)return!1;ht=ht.nextZ}return!0}function Hl(e,i,a){var h=e;do{var p=h.prev,x=h.next.next;!vc(p,x)&&$d(p,h,h.next,x)&&xc(p,x)&&xc(x,p)&&(i.push(p.i/a),i.push(h.i/a),i.push(x.i/a),Mh(h),Mh(h.next),h=e=x),h=h.next}while(h!==e);return Bn(h)}function Co(e,i,a,h,p,x){var E=e;do{for(var M=E.next.next;M!==E.prev;){if(E.i!==M.i&&Ip(E,M)){var L=Wf(E,M);E=Bn(E,E.next),L=Bn(L,L.next),Qs(E,i,a,h,p,x),Qs(L,i,a,h,p,x);return}M=M.next}E=E.next}while(E!==e)}function $s(e,i,a,h){var p=[],x,E,M,L,V;for(x=0,E=i.length;x<E;x++)M=i[x]*h,L=x<E-1?i[x+1]*h:e.length,V=Eu(e,M,L,h,!1),V===V.next&&(V.steiner=!0),p.push(rn(V));for(p.sort(eh),x=0;x<p.length;x++)Ah(p[x],a),a=Bn(a,a.next);return a}function eh(e,i){return e.x-i.x}function Ah(e,i){if(i=oa(e,i),i){var a=Wf(i,e);Bn(i,i.next),Bn(a,a.next)}}function oa(e,i){var a=i,h=e.x,p=e.y,x=-1/0,E;do{if(p<=a.y&&p>=a.next.y&&a.next.y!==a.y){var M=a.x+(p-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(M<=h&&M>x){if(x=M,M===h){if(p===a.y)return a;if(p===a.next.y)return a.next}E=a.x<a.next.x?a:a.next}}a=a.next}while(a!==i);if(!E)return null;if(h===x)return E;var L=E,V=E.x,Z=E.y,Y=1/0,rt;a=E;do h>=a.x&&a.x>=V&&h!==a.x&&ih(p<Z?h:x,p,V,Z,p<Z?x:h,p,a.x,a.y)&&(rt=Math.abs(p-a.y)/(h-a.x),xc(a,e)&&(rt<Y||rt===Y&&(a.x>E.x||a.x===E.x&&to(E,a)))&&(E=a,Y=rt)),a=a.next;while(a!==L);return E}function to(e,i){return nn(e.prev,e,i.prev)<0&&nn(i.next,e,e.next)<0}function ps(e,i,a,h){var p=e;do p.z===null&&(p.z=en(p.x,p.y,i,a,h)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==e);p.prevZ.nextZ=null,p.prevZ=null,Xl(p)}function Xl(e){var i,a,h,p,x,E,M,L,V=1;do{for(a=e,e=null,x=null,E=0;a;){for(E++,h=a,M=0,i=0;i<V&&(M++,h=h.nextZ,!!h);i++);for(L=V;M>0||L>0&&h;)M!==0&&(L===0||!h||a.z<=h.z)?(p=a,a=a.nextZ,M--):(p=h,h=h.nextZ,L--),x?x.nextZ=p:e=p,p.prevZ=x,x=p;a=h}x.nextZ=null,V*=2}while(E>1);return e}function en(e,i,a,h,p){return e=32767*(e-a)*p,i=32767*(i-h)*p,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e|i<<1}function rn(e){var i=e,a=e;do(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next;while(i!==e);return a}function ih(e,i,a,h,p,x,E,M){return(p-E)*(i-M)-(e-E)*(x-M)>=0&&(e-E)*(h-M)-(a-E)*(i-M)>=0&&(a-E)*(x-M)-(p-E)*(h-M)>=0}function Ip(e,i){return e.next.i!==i.i&&e.prev.i!==i.i&&!tp(e,i)&&(xc(e,i)&&xc(i,e)&&Ad(e,i)&&(nn(e.prev,e,i.prev)||nn(e,i.prev,i))||vc(e,i)&&nn(e.prev,e,e.next)>0&&nn(i.prev,i,i.next)>0)}function nn(e,i,a){return(i.y-e.y)*(a.x-i.x)-(i.x-e.x)*(a.y-i.y)}function vc(e,i){return e.x===i.x&&e.y===i.y}function $d(e,i,a,h){var p=Wl(nn(e,i,a)),x=Wl(nn(e,i,h)),E=Wl(nn(a,h,e)),M=Wl(nn(a,h,i));return!!(p!==x&&E!==M||p===0&&df(e,a,i)||x===0&&df(e,h,i)||E===0&&df(a,e,h)||M===0&&df(a,i,h))}function df(e,i,a){return i.x<=Math.max(e.x,a.x)&&i.x>=Math.min(e.x,a.x)&&i.y<=Math.max(e.y,a.y)&&i.y>=Math.min(e.y,a.y)}function Wl(e){return e>0?1:e<0?-1:0}function tp(e,i){var a=e;do{if(a.i!==e.i&&a.next.i!==e.i&&a.i!==i.i&&a.next.i!==i.i&&$d(a,a.next,e,i))return!0;a=a.next}while(a!==e);return!1}function xc(e,i){return nn(e.prev,e,e.next)<0?nn(e,i,e.next)>=0&&nn(e,e.prev,i)>=0:nn(e,i,e.prev)<0||nn(e,e.next,i)<0}function Ad(e,i){var a=e,h=!1,p=(e.x+i.x)/2,x=(e.y+i.y)/2;do a.y>x!=a.next.y>x&&a.next.y!==a.y&&p<(a.next.x-a.x)*(x-a.y)/(a.next.y-a.y)+a.x&&(h=!h),a=a.next;while(a!==e);return h}function Wf(e,i){var a=new Cp(e.i,e.x,e.y),h=new Cp(i.i,i.x,i.y),p=e.next,x=i.prev;return e.next=i,i.prev=e,a.next=p,p.prev=a,h.next=a,a.prev=h,x.next=h,h.prev=x,h}function Md(e,i,a,h){var p=new Cp(e,i,a);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function Mh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Cp(e,i,a){this.i=e,this.x=i,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}Js.deviation=function(e,i,a,h){var p=i&&i.length,x=p?i[0]*a:e.length,E=Math.abs(Pp(e,0,x,a));if(p)for(var M=0,L=i.length;M<L;M++){var V=i[M]*a,Z=M<L-1?i[M+1]*a:e.length;E-=Math.abs(Pp(e,V,Z,a))}var Y=0;for(M=0;M<h.length;M+=3){var rt=h[M]*a,it=h[M+1]*a,ht=h[M+2]*a;Y+=Math.abs((e[rt]-e[ht])*(e[it+1]-e[rt+1])-(e[rt]-e[it])*(e[ht+1]-e[rt+1]))}return E===0&&Y===0?0:Math.abs((Y-E)/E)};function Pp(e,i,a,h){for(var p=0,x=i,E=a-h;x<a;x+=h)p+=(e[E]-e[x])*(e[x+1]+e[E+1]),E=x;return p}Js.flatten=function(e){for(var i=e[0][0].length,a={vertices:[],holes:[],dimensions:i},h=0,p=0;p<e.length;p++){for(var x=0;x<e[p].length;x++)for(var E=0;E<i;E++)a.vertices.push(e[p][x][E]);p>0&&(h+=e[p-1].length,a.holes.push(h))}return a},Rn.default=Gl;function d_(e,i,a,h,p){ym(e,i,a,h||e.length-1,p||p_)}function ym(e,i,a,h,p){for(;h>a;){if(h-a>600){var x=h-a+1,E=i-a+1,M=Math.log(x),L=.5*Math.exp(2*M/3),V=.5*Math.sqrt(M*L*(x-L)/x)*(E-x/2<0?-1:1),Z=Math.max(a,Math.floor(i-E*L/x+V)),Y=Math.min(h,Math.floor(i+(x-E)*L/x+V));ym(e,i,Z,Y,p)}var rt=e[i],it=a,ht=h;for(zd(e,a,i),p(e[h],rt)>0&&zd(e,a,h);it<ht;){for(zd(e,it,ht),it++,ht--;p(e[it],rt)<0;)it++;for(;p(e[ht],rt)>0;)ht--}p(e[a],rt)===0?zd(e,a,ht):(ht++,zd(e,ht,h)),ht<=i&&(a=ht+1),i<=ht&&(h=ht-1)}}function zd(e,i,a){var h=e[i];e[i]=e[a],e[a]=h}function p_(e,i){return e<i?-1:e>i?1:0}function Ap(e,i){var a=e.length;if(a<=1)return[e];for(var h=[],p,x,E=0;E<a;E++){var M=Ql(e[E]);M!==0&&(e[E].area=Math.abs(M),x===void 0&&(x=M<0),x===M<0?(p&&h.push(p),p=[e[E]]):p.push(e[E]))}if(p&&h.push(p),i>1)for(var L=0;L<h.length;L++)h[L].length<=i||(d_(h[L],i,1,h[L].length-1,m_),h[L]=h[L].slice(0,i));return h}function m_(e,i){return i.area-e.area}function Kf(e,i,a){for(var h=a.patternDependencies,p=!1,x=0,E=i;x<E.length;x+=1){var M=E[x],L=M.paint.get(e+"-pattern");L.isConstant()||(p=!0);var V=L.constantOr(null);V&&(p=!0,h[V.to]=!0,h[V.from]=!0)}return p}function Mp(e,i,a,h,p){for(var x=p.patternDependencies,E=0,M=i;E<M.length;E+=1){var L=M[E],V=L.paint.get(e+"-pattern"),Z=V.value;if(Z.kind!=="constant"){var Y=Z.evaluate({zoom:h-1},a,{},p.availableImages),rt=Z.evaluate({zoom:h},a,{},p.availableImages),it=Z.evaluate({zoom:h+1},a,{},p.availableImages);Y=Y&&Y.name?Y.name:Y,rt=rt&&rt.name?rt.name:rt,it=it&&it.name?it.name:it,x[Y]=!0,x[rt]=!0,x[it]=!0,a.patterns[L.id]={min:Y,mid:rt,max:it}}}return a}var __=500,Kl=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Vl,this.indexArray=new Ln,this.indexArray2=new xu,this.programConfigurations=new Ee(i.layers,i.zoom),this.segments=new Gr,this.segments2=new Gr,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};Kl.prototype.populate=function(i,a,h){this.hasPattern=Kf("fill",this.layers,a);for(var p=this.layers[0].layout.get("fill-sort-key"),x=[],E=0,M=i;E<M.length;E+=1){var L=M[E],V=L.feature,Z=L.id,Y=L.index,rt=L.sourceLayerIndex,it=this.layers[0]._featureFilter.needGeometry,ht=or(V,it);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),ht,h)){var _t=p?p.evaluate(ht,{},h,a.availableImages):void 0,zt={id:Z,properties:V.properties,type:V.type,sourceLayerIndex:rt,index:Y,geometry:it?ht.geometry:Mi(V),patterns:{},sortKey:_t};x.push(zt)}}p&&x.sort(function(Te,De){return Te.sortKey-De.sortKey});for(var Ct=0,jt=x;Ct<jt.length;Ct+=1){var Rt=jt[Ct],Zt=Rt,Wt=Zt.geometry,le=Zt.index,xe=Zt.sourceLayerIndex;if(this.hasPattern){var ve=Mp("fill",this.layers,Rt,this.zoom,a);this.patternFeatures.push(ve)}else this.addFeature(Rt,Wt,le,h,{});var Be=i[le].feature;a.featureIndex.insert(Be,Wt,le,xe,this.index)}},Kl.prototype.update=function(i,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,h)},Kl.prototype.addFeatures=function(i,a,h){for(var p=0,x=this.patternFeatures;p<x.length;p+=1){var E=x[p];this.addFeature(E,E.geometry,E.index,a,h)}},Kl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Kl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Kl.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,sa),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0},Kl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Kl.prototype.addFeature=function(i,a,h,p,x){for(var E=0,M=Ap(a,__);E<M.length;E+=1){for(var L=M[E],V=0,Z=0,Y=L;Z<Y.length;Z+=1){var rt=Y[Z];V+=rt.length}for(var it=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray),ht=it.vertexLength,_t=[],zt=[],Ct=0,jt=L;Ct<jt.length;Ct+=1){var Rt=jt[Ct];if(Rt.length!==0){Rt!==L[0]&&zt.push(_t.length/2);var Zt=this.segments2.prepareSegment(Rt.length,this.layoutVertexArray,this.indexArray2),Wt=Zt.vertexLength;this.layoutVertexArray.emplaceBack(Rt[0].x,Rt[0].y),this.indexArray2.emplaceBack(Wt+Rt.length-1,Wt),_t.push(Rt[0].x),_t.push(Rt[0].y);for(var le=1;le<Rt.length;le++)this.layoutVertexArray.emplaceBack(Rt[le].x,Rt[le].y),this.indexArray2.emplaceBack(Wt+le-1,Wt+le),_t.push(Rt[le].x),_t.push(Rt[le].y);Zt.vertexLength+=Rt.length,Zt.primitiveLength+=Rt.length}}for(var xe=Rn(_t,zt),ve=0;ve<xe.length;ve+=3)this.indexArray.emplaceBack(ht+xe[ve],ht+xe[ve+1],ht+xe[ve+2]);it.vertexLength+=V,it.primitiveLength+=xe.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,x,p)},Ne("FillBucket",Kl,{omit:["layers","patternFeatures"]});var g_=new Nr({"fill-sort-key":new Ke(ue.layout_fill["fill-sort-key"])}),vm=new Nr({"fill-antialias":new Xt(ue.paint_fill["fill-antialias"]),"fill-opacity":new Ke(ue.paint_fill["fill-opacity"]),"fill-color":new Ke(ue.paint_fill["fill-color"]),"fill-outline-color":new Ke(ue.paint_fill["fill-outline-color"]),"fill-translate":new Xt(ue.paint_fill["fill-translate"]),"fill-translate-anchor":new Xt(ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new Cs(ue.paint_fill["fill-pattern"])}),xm={paint:vm,layout:g_},y_=function(e){function i(a){e.call(this,a,xm)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.recalculate=function(h,p){e.prototype.recalculate.call(this,h,p);var x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},i.prototype.createBucket=function(h){return new Kl(h)},i.prototype.queryRadius=function(){return Ms(this.paint.get("fill-translate"))},i.prototype.queryIntersectsFeature=function(h,p,x,E,M,L,V){var Z=$a(h,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),L.angle,V);return Lr(Z,E)},i.prototype.isTileClipped=function(){return!0},i}(Ya),v_=Mr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),zp=v_.members,Dp=bc;function bc(e,i,a,h,p){this.properties={},this.extent=a,this.type=0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=p,e.readFields(Dd,this,i)}function Dd(e,i,a){e==1?i.id=a.readVarint():e==2?hl(a,i):e==3?i.type=a.readVarint():e==4&&(i._geometry=a.pos)}function hl(e,i){for(var a=e.readVarint()+e.pos;e.pos<a;){var h=i._keys[e.readVarint()],p=i._values[e.readVarint()];i.properties[h]=p}}bc.types=["Unknown","Point","LineString","Polygon"],bc.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var i=e.readVarint()+e.pos,a=1,h=0,p=0,x=0,E=[],M;e.pos<i;){if(h<=0){var L=e.readVarint();a=L&7,h=L>>3}if(h--,a===1||a===2)p+=e.readSVarint(),x+=e.readSVarint(),a===1&&(M&&E.push(M),M=[]),M.push(new pe(p,x));else if(a===7)M&&M.push(M[0].clone());else throw new Error("unknown command "+a)}return M&&E.push(M),E},bc.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var i=e.readVarint()+e.pos,a=1,h=0,p=0,x=0,E=1/0,M=-1/0,L=1/0,V=-1/0;e.pos<i;){if(h<=0){var Z=e.readVarint();a=Z&7,h=Z>>3}if(h--,a===1||a===2)p+=e.readSVarint(),x+=e.readSVarint(),p<E&&(E=p),p>M&&(M=p),x<L&&(L=x),x>V&&(V=x);else if(a!==7)throw new Error("unknown command "+a)}return[E,L,M,V]},bc.prototype.toGeoJSON=function(e,i,a){var h=this.extent*Math.pow(2,a),p=this.extent*e,x=this.extent*i,E=this.loadGeometry(),M=bc.types[this.type],L,V;function Z(it){for(var ht=0;ht<it.length;ht++){var _t=it[ht],zt=180-(_t.y+x)*360/h;it[ht]=[(_t.x+p)*360/h-180,360/Math.PI*Math.atan(Math.exp(zt*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(L=0;L<E.length;L++)Y[L]=E[L][0];E=Y,Z(E);break;case 2:for(L=0;L<E.length;L++)Z(E[L]);break;case 3:for(E=bm(E),L=0;L<E.length;L++)for(V=0;V<E[L].length;V++)Z(E[L][V]);break}E.length===1?E=E[0]:M="Multi"+M;var rt={type:"Feature",geometry:{type:M,coordinates:E},properties:this.properties};return"id"in this&&(rt.id=this.id),rt};function bm(e){var i=e.length;if(i<=1)return[e];for(var a=[],h,p,x=0;x<i;x++){var E=kp(e[x]);E!==0&&(p===void 0&&(p=E<0),p===E<0?(h&&a.push(h),h=[e[x]]):h.push(e[x]))}return h&&a.push(h),a}function kp(e){for(var i=0,a=0,h=e.length,p=h-1,x,E;a<h;p=a++)x=e[a],E=e[p],i+=(E.x-x.x)*(x.y+E.y);return i}var wm=Fp;function Fp(e,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(x_,this,i),this.length=this._features.length}function x_(e,i,a){e===15?i.version=a.readVarint():e===1?i.name=a.readString():e===5?i.extent=a.readVarint():e===2?i._features.push(a.pos):e===3?i._keys.push(a.readString()):e===4&&i._values.push(b_(a))}function b_(e){for(var i=null,a=e.readVarint()+e.pos;e.pos<a;){var h=e.readVarint()>>3;i=h===1?e.readString():h===2?e.readFloat():h===3?e.readDouble():h===4?e.readVarint64():h===5?e.readVarint():h===6?e.readSVarint():h===7?e.readBoolean():null}return i}Fp.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var i=this._pbf.readVarint()+this._pbf.pos;return new Dp(this._pbf,i,this.extent,this._keys,this._values)};var w_=S_;function S_(e,i){this.layers=e.readFields(T_,{},i)}function T_(e,i,a){if(e===3){var h=new wm(a,a.readVarint()+a.pos);h.length&&(i[h.name]=h)}}var Bg=w_,Og=Dp,Sm=wm,pf={VectorTile:Bg,VectorTileFeature:Og,VectorTileLayer:Sm},mf=pf.VectorTileFeature.types,kd=500,Lp=Math.pow(2,13);function Fd(e,i,a,h,p,x,E,M){e.emplaceBack(i,a,Math.floor(h*Lp)*2+E,p*Lp*2,x*Lp*2,Math.round(M))}var Iu=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new To,this.indexArray=new Ln,this.programConfigurations=new Ee(i.layers,i.zoom),this.segments=new Gr,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};Iu.prototype.populate=function(i,a,h){this.features=[],this.hasPattern=Kf("fill-extrusion",this.layers,a);for(var p=0,x=i;p<x.length;p+=1){var E=x[p],M=E.feature,L=E.id,V=E.index,Z=E.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,rt=or(M,Y);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),rt,h)){var it={id:L,sourceLayerIndex:Z,index:V,geometry:Y?rt.geometry:Mi(M),properties:M.properties,type:M.type,patterns:{}};this.hasPattern?this.features.push(Mp("fill-extrusion",this.layers,it,this.zoom,a)):this.addFeature(it,it.geometry,V,h,{}),a.featureIndex.insert(M,it.geometry,V,Z,this.index,!0)}}},Iu.prototype.addFeatures=function(i,a,h){for(var p=0,x=this.features;p<x.length;p+=1){var E=x[p],M=E.geometry;this.addFeature(E,M,E.index,a,h)}},Iu.prototype.update=function(i,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,h)},Iu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Iu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Iu.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,zp),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},Iu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Iu.prototype.addFeature=function(i,a,h,p,x){for(var E=0,M=Ap(a,kd);E<M.length;E+=1){for(var L=M[E],V=0,Z=0,Y=L;Z<Y.length;Z+=1){var rt=Y[Z];V+=rt.length}for(var it=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ht=0,_t=L;ht<_t.length;ht+=1){var zt=_t[ht];if(zt.length!==0&&!I_(zt))for(var Ct=0,jt=0;jt<zt.length;jt++){var Rt=zt[jt];if(jt>=1){var Zt=zt[jt-1];if(!E_(Rt,Zt)){it.vertexLength+4>Gr.MAX_VERTEX_ARRAY_LENGTH&&(it=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Wt=Rt.sub(Zt)._perp()._unit(),le=Zt.dist(Rt);Ct+le>32768&&(Ct=0),Fd(this.layoutVertexArray,Rt.x,Rt.y,Wt.x,Wt.y,0,0,Ct),Fd(this.layoutVertexArray,Rt.x,Rt.y,Wt.x,Wt.y,0,1,Ct),Ct+=le,Fd(this.layoutVertexArray,Zt.x,Zt.y,Wt.x,Wt.y,0,0,Ct),Fd(this.layoutVertexArray,Zt.x,Zt.y,Wt.x,Wt.y,0,1,Ct);var xe=it.vertexLength;this.indexArray.emplaceBack(xe,xe+2,xe+1),this.indexArray.emplaceBack(xe+1,xe+2,xe+3),it.vertexLength+=4,it.primitiveLength+=2}}}}if(it.vertexLength+V>Gr.MAX_VERTEX_ARRAY_LENGTH&&(it=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray)),mf[i.type]==="Polygon"){for(var ve=[],Be=[],Te=it.vertexLength,De=0,oi=L;De<oi.length;De+=1){var Oe=oi[De];if(Oe.length!==0){Oe!==L[0]&&Be.push(ve.length/2);for(var Ve=0;Ve<Oe.length;Ve++){var gi=Oe[Ve];Fd(this.layoutVertexArray,gi.x,gi.y,0,0,1,1,0),ve.push(gi.x),ve.push(gi.y)}}}for(var ni=Rn(ve,Be),qi=0;qi<ni.length;qi+=3)this.indexArray.emplaceBack(Te+ni[qi],Te+ni[qi+2],Te+ni[qi+1]);it.primitiveLength+=ni.length/3,it.vertexLength+=V}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,x,p)},Ne("FillExtrusionBucket",Iu,{omit:["layers","features"]});function E_(e,i){return e.x===i.x&&(e.x<0||e.x>Re)||e.y===i.y&&(e.y<0||e.y>Re)}function I_(e){return e.every(function(i){return i.x<0})||e.every(function(i){return i.x>Re})||e.every(function(i){return i.y<0})||e.every(function(i){return i.y>Re})}var C_=new Nr({"fill-extrusion-opacity":new Xt(ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ke(ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xt(ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xt(ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Cs(ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ke(ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ke(ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xt(ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])}),P_={paint:C_},A_=function(e){function i(a){e.call(this,a,P_)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.createBucket=function(h){return new Iu(h)},i.prototype.queryRadius=function(){return Ms(this.paint.get("fill-extrusion-translate"))},i.prototype.is3D=function(){return!0},i.prototype.queryIntersectsFeature=function(h,p,x,E,M,L,V,Z){var Y=$a(h,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),L.angle,V),rt=this.paint.get("fill-extrusion-height").evaluate(p,x),it=this.paint.get("fill-extrusion-base").evaluate(p,x),ht=z_(Y,Z,L,0),_t=Rp(E,it,rt,Z),zt=_t[0],Ct=_t[1];return M_(zt,Ct,ht)},i}(Ya);function Ld(e,i){return e.x*i.x+e.y*i.y}function Tm(e,i){if(e.length===1){for(var a=0,h=i[a++],p;!p||h.equals(p);)if(p=i[a++],!p)return 1/0;for(;a<i.length;a++){var x=i[a],E=e[0],M=p.sub(h),L=x.sub(h),V=E.sub(h),Z=Ld(M,M),Y=Ld(M,L),rt=Ld(L,L),it=Ld(V,M),ht=Ld(V,L),_t=Z*rt-Y*Y,zt=(rt*it-Y*ht)/_t,Ct=(Z*ht-Y*it)/_t,jt=1-zt-Ct,Rt=h.z*jt+p.z*zt+x.z*Ct;if(isFinite(Rt))return Rt}return 1/0}else{for(var Zt=1/0,Wt=0,le=i;Wt<le.length;Wt+=1){var xe=le[Wt];Zt=Math.min(Zt,xe.z)}return Zt}}function M_(e,i,a){var h=1/0;Lr(a,i)&&(h=Tm(a,i[0]));for(var p=0;p<i.length;p++)for(var x=i[p],E=e[p],M=0;M<x.length-1;M++){var L=x[M],V=x[M+1],Z=E[M],Y=E[M+1],rt=[L,V,Y,Z,L];ri(a,rt)&&(h=Math.min(h,Tm(a,rt)))}return h===1/0?!1:h}function Rp(e,i,a,h){for(var p=[],x=[],E=h[8]*i,M=h[9]*i,L=h[10]*i,V=h[11]*i,Z=h[8]*a,Y=h[9]*a,rt=h[10]*a,it=h[11]*a,ht=0,_t=e;ht<_t.length;ht+=1){for(var zt=_t[ht],Ct=[],jt=[],Rt=0,Zt=zt;Rt<Zt.length;Rt+=1){var Wt=Zt[Rt],le=Wt.x,xe=Wt.y,ve=h[0]*le+h[4]*xe+h[12],Be=h[1]*le+h[5]*xe+h[13],Te=h[2]*le+h[6]*xe+h[14],De=h[3]*le+h[7]*xe+h[15],oi=ve+E,Oe=Be+M,Ve=Te+L,gi=De+V,ni=ve+Z,qi=Be+Y,$i=Te+rt,Zi=De+it,Bi=new pe(oi/gi,Oe/gi);Bi.z=Ve/gi,Ct.push(Bi);var Vi=new pe(ni/Zi,qi/Zi);Vi.z=$i/Zi,jt.push(Vi)}p.push(Ct),x.push(jt)}return[p,x]}function z_(e,i,a,h){for(var p=[],x=0,E=e;x<E.length;x+=1){var M=E[x],L=[M.x,M.y,h,1];we(L,L,i),p.push(new pe(L[0]/L[3],L[1]/L[3]))}return p}var Yf=Mr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),D_=Yf.members,wn=Mr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),ep=wn.members,Em=pf.VectorTileFeature.types,Rd=63,ip=Math.cos(75/2*(Math.PI/180)),k_=15,Bd=20,F_=15,Bp=1/2,Op=Math.pow(2,F_-1)/Bp,Wn=function(i){var a=this;this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(h){a.gradients[h.id]={}}),this.layoutVertexArray=new Ul,this.layoutVertexArray2=new Nl,this.indexArray=new Ln,this.programConfigurations=new Ee(i.layers,i.zoom),this.segments=new Gr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};Wn.prototype.populate=function(i,a,h){this.hasPattern=Kf("line",this.layers,a);for(var p=this.layers[0].layout.get("line-sort-key"),x=[],E=0,M=i;E<M.length;E+=1){var L=M[E],V=L.feature,Z=L.id,Y=L.index,rt=L.sourceLayerIndex,it=this.layers[0]._featureFilter.needGeometry,ht=or(V,it);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),ht,h)){var _t=p?p.evaluate(ht,{},h):void 0,zt={id:Z,properties:V.properties,type:V.type,sourceLayerIndex:rt,index:Y,geometry:it?ht.geometry:Mi(V),patterns:{},sortKey:_t};x.push(zt)}}p&&x.sort(function(Te,De){return Te.sortKey-De.sortKey});for(var Ct=0,jt=x;Ct<jt.length;Ct+=1){var Rt=jt[Ct],Zt=Rt,Wt=Zt.geometry,le=Zt.index,xe=Zt.sourceLayerIndex;if(this.hasPattern){var ve=Mp("line",this.layers,Rt,this.zoom,a);this.patternFeatures.push(ve)}else this.addFeature(Rt,Wt,le,h,{});var Be=i[le].feature;a.featureIndex.insert(Be,Wt,le,xe,this.index)}},Wn.prototype.update=function(i,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,h)},Wn.prototype.addFeatures=function(i,a,h){for(var p=0,x=this.patternFeatures;p<x.length;p+=1){var E=x[p];this.addFeature(E,E.geometry,E.index,a,h)}},Wn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Wn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Wn.prototype.upload=function(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,ep)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,D_),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},Wn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Wn.prototype.lineFeatureClips=function(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end")){var a=+i.properties.mapbox_clip_start,h=+i.properties.mapbox_clip_end;return{start:a,end:h}}},Wn.prototype.addFeature=function(i,a,h,p,x){var E=this.layers[0].layout,M=E.get("line-join").evaluate(i,{}),L=E.get("line-cap"),V=E.get("line-miter-limit"),Z=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(var Y=0,rt=a;Y<rt.length;Y+=1){var it=rt[Y];this.addLine(it,i,M,L,V,Z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,x,p)},Wn.prototype.addLine=function(i,a,h,p,x,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var M=0;M<i.length-1;M++)this.totalDistance+=i[M].dist(i[M+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var L=Em[a.type]==="Polygon",V=i.length;V>=2&&i[V-1].equals(i[V-2]);)V--;for(var Z=0;Z<V-1&&i[Z].equals(i[Z+1]);)Z++;if(!(V<(L?3:2))){h==="bevel"&&(x=1.05);var Y=this.overscaling<=16?k_*Re/(512*this.overscaling):0,rt=this.segments.prepareSegment(V*10,this.layoutVertexArray,this.indexArray),it,ht=void 0,_t=void 0,zt=void 0,Ct=void 0;this.e1=this.e2=-1,L&&(it=i[V-2],Ct=i[Z].sub(it)._unit()._perp());for(var jt=Z;jt<V;jt++)if(_t=jt===V-1?L?i[Z+1]:void 0:i[jt+1],!(_t&&i[jt].equals(_t))){Ct&&(zt=Ct),it&&(ht=it),it=i[jt],Ct=_t?_t.sub(it)._unit()._perp():zt,zt=zt||Ct;var Rt=zt.add(Ct);(Rt.x!==0||Rt.y!==0)&&Rt._unit();var Zt=zt.x*Ct.x+zt.y*Ct.y,Wt=Rt.x*Ct.x+Rt.y*Ct.y,le=Wt!==0?1/Wt:1/0,xe=2*Math.sqrt(2-2*Wt),ve=Wt<ip&&ht&&_t,Be=zt.x*Ct.y-zt.y*Ct.x>0;if(ve&&jt>Z){var Te=it.dist(ht);if(Te>2*Y){var De=it.sub(it.sub(ht)._mult(Y/Te)._round());this.updateDistance(ht,De),this.addCurrentVertex(De,zt,0,0,rt),ht=De}}var oi=ht&&_t,Oe=oi?h:L?"butt":p;if(oi&&Oe==="round"&&(le<E?Oe="miter":le<=2&&(Oe="fakeround")),Oe==="miter"&&le>x&&(Oe="bevel"),Oe==="bevel"&&(le>2&&(Oe="flipbevel"),le<x&&(Oe="miter")),ht&&this.updateDistance(ht,it),Oe==="miter")Rt._mult(le),this.addCurrentVertex(it,Rt,0,0,rt);else if(Oe==="flipbevel"){if(le>100)Rt=Ct.mult(-1);else{var Ve=le*zt.add(Ct).mag()/zt.sub(Ct).mag();Rt._perp()._mult(Ve*(Be?-1:1))}this.addCurrentVertex(it,Rt,0,0,rt),this.addCurrentVertex(it,Rt.mult(-1),0,0,rt)}else if(Oe==="bevel"||Oe==="fakeround"){var gi=-Math.sqrt(le*le-1),ni=Be?gi:0,qi=Be?0:gi;if(ht&&this.addCurrentVertex(it,zt,ni,qi,rt),Oe==="fakeround")for(var $i=Math.round(xe*180/Math.PI/Bd),Zi=1;Zi<$i;Zi++){var Bi=Zi/$i;if(Bi!==.5){var Vi=Bi-.5,hr=1.0904+Zt*(-3.2452+Zt*(3.55645-Zt*1.43519)),pr=.848013+Zt*(-1.06021+Zt*.215638);Bi=Bi+Bi*Vi*(Bi-1)*(hr*Vi*Vi+pr)}var Kr=Ct.sub(zt)._mult(Bi)._add(zt)._unit()._mult(Be?-1:1);this.addHalfVertex(it,Kr.x,Kr.y,!1,Be,0,rt)}_t&&this.addCurrentVertex(it,Ct,-ni,-qi,rt)}else if(Oe==="butt")this.addCurrentVertex(it,Rt,0,0,rt);else if(Oe==="square"){var Br=ht?1:-1;this.addCurrentVertex(it,Rt,Br,Br,rt)}else Oe==="round"&&(ht&&(this.addCurrentVertex(it,zt,0,0,rt),this.addCurrentVertex(it,zt,1,1,rt,!0)),_t&&(this.addCurrentVertex(it,Ct,-1,-1,rt,!0),this.addCurrentVertex(it,Ct,0,0,rt)));if(ve&&jt<V-1){var Yn=it.dist(_t);if(Yn>2*Y){var Tn=it.add(_t.sub(it)._mult(Y/Yn)._round());this.updateDistance(it,Tn),this.addCurrentVertex(Tn,Ct,0,0,rt),it=Tn}}}}},Wn.prototype.addCurrentVertex=function(i,a,h,p,x,E){E===void 0&&(E=!1);var M=a.x+a.y*h,L=a.y-a.x*h,V=-a.x+a.y*p,Z=-a.y-a.x*p;this.addHalfVertex(i,M,L,E,!1,h,x),this.addHalfVertex(i,V,Z,E,!0,-p,x),this.distance>Op/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(i,a,h,p,x,E))},Wn.prototype.addHalfVertex=function(i,a,h,p,x,E,M){var L=i.x,V=i.y,Z=this.lineClips?this.scaledDistance*(Op-1):this.scaledDistance,Y=Z*Bp;if(this.layoutVertexArray.emplaceBack((L<<1)+(p?1:0),(V<<1)+(x?1:0),Math.round(Rd*a)+128,Math.round(Rd*h)+128,(E===0?0:E<0?-1:1)+1|(Y&63)<<2,Y>>6),this.lineClips){var rt=this.scaledDistance-this.lineClips.start,it=this.lineClips.end-this.lineClips.start,ht=rt/it;this.layoutVertexArray2.emplaceBack(ht,this.lineClipsArray.length)}var _t=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_t),M.primitiveLength++),x?this.e2=_t:this.e1=_t},Wn.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Wn.prototype.updateDistance=function(i,a){this.distance+=i.dist(a),this.updateScaledDistance()},Ne("LineBucket",Wn,{omit:["layers","patternFeatures"]});var Vp=new Nr({"line-cap":new Xt(ue.layout_line["line-cap"]),"line-join":new Ke(ue.layout_line["line-join"]),"line-miter-limit":new Xt(ue.layout_line["line-miter-limit"]),"line-round-limit":new Xt(ue.layout_line["line-round-limit"]),"line-sort-key":new Ke(ue.layout_line["line-sort-key"])}),L_=new Nr({"line-opacity":new Ke(ue.paint_line["line-opacity"]),"line-color":new Ke(ue.paint_line["line-color"]),"line-translate":new Xt(ue.paint_line["line-translate"]),"line-translate-anchor":new Xt(ue.paint_line["line-translate-anchor"]),"line-width":new Ke(ue.paint_line["line-width"]),"line-gap-width":new Ke(ue.paint_line["line-gap-width"]),"line-offset":new Ke(ue.paint_line["line-offset"]),"line-blur":new Ke(ue.paint_line["line-blur"]),"line-dasharray":new Ca(ue.paint_line["line-dasharray"]),"line-pattern":new Cs(ue.paint_line["line-pattern"]),"line-gradient":new Ka(ue.paint_line["line-gradient"])}),rp={paint:L_,layout:Vp},Up=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.possiblyEvaluate=function(h,p){return p=new Fi(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),e.prototype.possiblyEvaluate.call(this,h,p)},i.prototype.evaluate=function(h,p,x,E){return p=Or({},p,{zoom:Math.floor(p.zoom)}),e.prototype.evaluate.call(this,h,p,x,E)},i}(Ke),Im=new Up(rp.paint.properties["line-width"].specification);Im.useIntegerZoom=!0;var Np=function(e){function i(a){e.call(this,a,rp),this.gradientVersion=0}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._handleSpecialPaintPropertyUpdate=function(h){if(h==="line-gradient"){var p=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=p._styleExpression.expression instanceof Xo,this.gradientVersion=(this.gradientVersion+1)%ca}},i.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},i.prototype.recalculate=function(h,p){e.prototype.recalculate.call(this,h,p),this.paint._values["line-floorwidth"]=Im.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,h)},i.prototype.createBucket=function(h){return new Wn(h)},i.prototype.queryRadius=function(h){var p=h,x=qp(Da("line-width",this,p),Da("line-gap-width",this,p)),E=Da("line-offset",this,p);return x/2+Math.abs(E)+Ms(this.paint.get("line-translate"))},i.prototype.queryIntersectsFeature=function(h,p,x,E,M,L,V){var Z=$a(h,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),L.angle,V),Y=V/2*qp(this.paint.get("line-width").evaluate(p,x),this.paint.get("line-gap-width").evaluate(p,x)),rt=this.paint.get("line-offset").evaluate(p,x);return rt&&(E=R_(E,rt*V)),cn(Z,E,Y)},i.prototype.isTileClipped=function(){return!0},i}(Ya);function qp(e,i){return i>0?i+2*e:e}function R_(e,i){for(var a=[],h=new pe(0,0),p=0;p<e.length;p++){for(var x=e[p],E=[],M=0;M<x.length;M++){var L=x[M-1],V=x[M],Z=x[M+1],Y=M===0?h:V.sub(L)._unit()._perp(),rt=M===x.length-1?h:Z.sub(V)._unit()._perp(),it=Y._add(rt)._unit(),ht=it.x*rt.x+it.y*rt.y;it._mult(1/ht),E.push(it._mult(i)._add(V))}a.push(E)}return a}var Cm=Mr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),B_=Mr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Mr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);var O_=Mr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Mr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);var Pm=Mr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),V_=Mr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mr([{name:"triangle",components:3,type:"Uint16"}]),Mr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Mr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mr([{type:"Float32",name:"offsetX"}]),Mr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);function U_(e,i,a){var h=i.layout.get("text-transform").evaluate(a,{});return h==="uppercase"?e=e.toLocaleUpperCase():h==="lowercase"&&(e=e.toLocaleLowerCase()),Ea.applyArabicShaping&&(e=Ea.applyArabicShaping(e)),e}function N_(e,i,a){return e.sections.forEach(function(h){h.text=U_(h.text,i,a)}),e}function Vg(e){var i={},a={},h=[],p=0;function x(Ct){h.push(e[Ct]),p++}function E(Ct,jt,Rt){var Zt=a[Ct];return delete a[Ct],a[jt]=Zt,h[Zt].geometry[0].pop(),h[Zt].geometry[0]=h[Zt].geometry[0].concat(Rt[0]),Zt}function M(Ct,jt,Rt){var Zt=i[jt];return delete i[jt],i[Ct]=Zt,h[Zt].geometry[0].shift(),h[Zt].geometry[0]=Rt[0].concat(h[Zt].geometry[0]),Zt}function L(Ct,jt,Rt){var Zt=Rt?jt[0][jt[0].length-1]:jt[0][0];return Ct+":"+Zt.x+":"+Zt.y}for(var V=0;V<e.length;V++){var Z=e[V],Y=Z.geometry,rt=Z.text?Z.text.toString():null;if(!rt){x(V);continue}var it=L(rt,Y),ht=L(rt,Y,!0);if(it in a&&ht in i&&a[it]!==i[ht]){var _t=M(it,ht,Y),zt=E(it,ht,h[_t].geometry);delete i[it],delete a[ht],a[L(rt,h[zt].geometry,!0)]=zt,h[_t].geometry=null}else it in a?E(it,ht,Y):ht in i?M(it,ht,Y):(x(V),i[it]=p-1,a[ht]=p-1)}return h.filter(function(Ct){return Ct.geometry})}var np={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function wc(e){for(var i="",a=0;a<e.length;a++){var h=e.charCodeAt(a+1)||null,p=e.charCodeAt(a-1)||null,x=(!h||!Ta(h)||np[e[a+1]])&&(!p||!Ta(p)||np[e[a-1]]);x&&np[e[a]]?i+=np[e[a]]:i+=e[a]}return i}var la=24,Am=function(e,i,a,h,p){var x,E,M=p*8-h-1,L=(1<<M)-1,V=L>>1,Z=-7,Y=a?p-1:0,rt=a?-1:1,it=e[i+Y];for(Y+=rt,x=it&(1<<-Z)-1,it>>=-Z,Z+=M;Z>0;x=x*256+e[i+Y],Y+=rt,Z-=8);for(E=x&(1<<-Z)-1,x>>=-Z,Z+=h;Z>0;E=E*256+e[i+Y],Y+=rt,Z-=8);if(x===0)x=1-V;else{if(x===L)return E?NaN:(it?-1:1)*(1/0);E=E+Math.pow(2,h),x=x-V}return(it?-1:1)*E*Math.pow(2,x-h)},Jf=function(e,i,a,h,p,x){var E,M,L,V=x*8-p-1,Z=(1<<V)-1,Y=Z>>1,rt=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,it=h?0:x-1,ht=h?1:-1,_t=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(M=isNaN(i)?1:0,E=Z):(E=Math.floor(Math.log(i)/Math.LN2),i*(L=Math.pow(2,-E))<1&&(E--,L*=2),E+Y>=1?i+=rt/L:i+=rt*Math.pow(2,1-Y),i*L>=2&&(E++,L/=2),E+Y>=Z?(M=0,E=Z):E+Y>=1?(M=(i*L-1)*Math.pow(2,p),E=E+Y):(M=i*Math.pow(2,Y-1)*Math.pow(2,p),E=0));p>=8;e[a+it]=M&255,it+=ht,M/=256,p-=8);for(E=E<<p|M,V+=p;V>0;e[a+it]=E&255,it+=ht,E/=256,V-=8);e[a+it-ht]|=_t*128},ap={read:Am,write:Jf},sp=Sr;function Sr(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Sr.Varint=0,Sr.Fixed64=1,Sr.Bytes=2,Sr.Fixed32=5;var Zp=65536*65536,Mm=1/Zp,zm=12,jp=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Sr.prototype={destroy:function(){this.buf=null},readFields:function(e,i,a){for(a=a||this.length;this.pos<a;){var h=this.readVarint(),p=h>>3,x=this.pos;this.type=h&7,e(p,i,this),this.pos===x&&this.skip(h)}return i},readMessage:function(e,i){return this.readFields(e,i,this.readVarint()+this.pos)},readFixed32:function(){var e=op(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Xp(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=op(this.buf,this.pos)+op(this.buf,this.pos+4)*Zp;return this.pos+=8,e},readSFixed64:function(){var e=op(this.buf,this.pos)+Xp(this.buf,this.pos+4)*Zp;return this.pos+=8,e},readFloat:function(){var e=ap.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=ap.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var i=this.buf,a,h;return h=i[this.pos++],a=h&127,h<128||(h=i[this.pos++],a|=(h&127)<<7,h<128)||(h=i[this.pos++],a|=(h&127)<<14,h<128)||(h=i[this.pos++],a|=(h&127)<<21,h<128)?a:(h=i[this.pos],a|=(h&15)<<28,q_(a,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=zm&&jp?Q_(this.buf,i,e):J_(this.buf,i,e)},readBytes:function(){var e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i},readPackedVarint:function(e,i){if(this.type!==Sr.Bytes)return e.push(this.readVarint(i));var a=zh(this);for(e=e||[];this.pos<a;)e.push(this.readVarint(i));return e},readPackedSVarint:function(e){if(this.type!==Sr.Bytes)return e.push(this.readSVarint());var i=zh(this);for(e=e||[];this.pos<i;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Sr.Bytes)return e.push(this.readBoolean());var i=zh(this);for(e=e||[];this.pos<i;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Sr.Bytes)return e.push(this.readFloat());var i=zh(this);for(e=e||[];this.pos<i;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Sr.Bytes)return e.push(this.readDouble());var i=zh(this);for(e=e||[];this.pos<i;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Sr.Bytes)return e.push(this.readFixed32());var i=zh(this);for(e=e||[];this.pos<i;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Sr.Bytes)return e.push(this.readSFixed32());var i=zh(this);for(e=e||[];this.pos<i;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Sr.Bytes)return e.push(this.readFixed64());var i=zh(this);for(e=e||[];this.pos<i;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Sr.Bytes)return e.push(this.readSFixed64());var i=zh(this);for(e=e||[];this.pos<i;)e.push(this.readSFixed64());return e},skip:function(e){var i=e&7;if(i===Sr.Varint)for(;this.buf[this.pos++]>127;);else if(i===Sr.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Sr.Fixed32)this.pos+=4;else if(i===Sr.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+i)},writeTag:function(e,i){this.writeVarint(e<<3|i)},realloc:function(e){for(var i=this.length||16;i<this.pos+e;)i*=2;if(i!==this.length){var a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),rh(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),rh(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),rh(this.buf,e&-1,this.pos),rh(this.buf,Math.floor(e*Mm),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),rh(this.buf,e&-1,this.pos),rh(this.buf,Math.floor(e*Mm),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){Z_(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var i=this.pos;this.pos=$_(this.buf,e,this.pos);var a=this.pos-i;a>=128&&Dm(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeFloat:function(e){this.realloc(4),ap.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),ap.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var i=e.length;this.writeVarint(i),this.realloc(i);for(var a=0;a<i;a++)this.buf[this.pos++]=e[a]},writeRawMessage:function(e,i){this.pos++;var a=this.pos;e(i,this);var h=this.pos-a;h>=128&&Dm(a,h,this),this.pos=a-1,this.writeVarint(h),this.pos+=h},writeMessage:function(e,i,a){this.writeTag(e,Sr.Bytes),this.writeRawMessage(i,a)},writePackedVarint:function(e,i){i.length&&this.writeMessage(e,H_,i)},writePackedSVarint:function(e,i){i.length&&this.writeMessage(e,Gp,i)},writePackedBoolean:function(e,i){i.length&&this.writeMessage(e,X_,i)},writePackedFloat:function(e,i){i.length&&this.writeMessage(e,Od,i)},writePackedDouble:function(e,i){i.length&&this.writeMessage(e,Hp,i)},writePackedFixed32:function(e,i){i.length&&this.writeMessage(e,W_,i)},writePackedSFixed32:function(e,i){i.length&&this.writeMessage(e,km,i)},writePackedFixed64:function(e,i){i.length&&this.writeMessage(e,K_,i)},writePackedSFixed64:function(e,i){i.length&&this.writeMessage(e,Y_,i)},writeBytesField:function(e,i){this.writeTag(e,Sr.Bytes),this.writeBytes(i)},writeFixed32Field:function(e,i){this.writeTag(e,Sr.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(e,i){this.writeTag(e,Sr.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(e,i){this.writeTag(e,Sr.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(e,i){this.writeTag(e,Sr.Fixed64),this.writeSFixed64(i)},writeVarintField:function(e,i){this.writeTag(e,Sr.Varint),this.writeVarint(i)},writeSVarintField:function(e,i){this.writeTag(e,Sr.Varint),this.writeSVarint(i)},writeStringField:function(e,i){this.writeTag(e,Sr.Bytes),this.writeString(i)},writeFloatField:function(e,i){this.writeTag(e,Sr.Fixed32),this.writeFloat(i)},writeDoubleField:function(e,i){this.writeTag(e,Sr.Fixed64),this.writeDouble(i)},writeBooleanField:function(e,i){this.writeVarintField(e,!!i)}};function q_(e,i,a){var h=a.buf,p,x;if(x=h[a.pos++],p=(x&112)>>4,x<128||(x=h[a.pos++],p|=(x&127)<<3,x<128)||(x=h[a.pos++],p|=(x&127)<<10,x<128)||(x=h[a.pos++],p|=(x&127)<<17,x<128)||(x=h[a.pos++],p|=(x&127)<<24,x<128)||(x=h[a.pos++],p|=(x&1)<<31,x<128))return Qf(e,p,i);throw new Error("Expected varint not more than 10 bytes")}function zh(e){return e.type===Sr.Bytes?e.readVarint()+e.pos:e.pos+1}function Qf(e,i,a){return a?i*4294967296+(e>>>0):(i>>>0)*4294967296+(e>>>0)}function Z_(e,i){var a,h;if(e>=0?(a=e%4294967296|0,h=e/4294967296|0):(a=~(-e%4294967296),h=~(-e/4294967296),a^4294967295?a=a+1|0:(a=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),j_(a,h,i),G_(h,i)}function j_(e,i,a){a.buf[a.pos++]=e&127|128,e>>>=7,a.buf[a.pos++]=e&127|128,e>>>=7,a.buf[a.pos++]=e&127|128,e>>>=7,a.buf[a.pos++]=e&127|128,e>>>=7,a.buf[a.pos]=e&127}function G_(e,i){var a=(e&7)<<4;i.buf[i.pos++]|=a|((e>>>=3)?128:0),e&&(i.buf[i.pos++]=e&127|((e>>>=7)?128:0),e&&(i.buf[i.pos++]=e&127|((e>>>=7)?128:0),e&&(i.buf[i.pos++]=e&127|((e>>>=7)?128:0),e&&(i.buf[i.pos++]=e&127|((e>>>=7)?128:0),e&&(i.buf[i.pos++]=e&127)))))}function Dm(e,i,a){var h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(Math.LN2*7));a.realloc(h);for(var p=a.pos-1;p>=e;p--)a.buf[p+h]=a.buf[p]}function H_(e,i){for(var a=0;a<e.length;a++)i.writeVarint(e[a])}function Gp(e,i){for(var a=0;a<e.length;a++)i.writeSVarint(e[a])}function Od(e,i){for(var a=0;a<e.length;a++)i.writeFloat(e[a])}function Hp(e,i){for(var a=0;a<e.length;a++)i.writeDouble(e[a])}function X_(e,i){for(var a=0;a<e.length;a++)i.writeBoolean(e[a])}function W_(e,i){for(var a=0;a<e.length;a++)i.writeFixed32(e[a])}function km(e,i){for(var a=0;a<e.length;a++)i.writeSFixed32(e[a])}function K_(e,i){for(var a=0;a<e.length;a++)i.writeFixed64(e[a])}function Y_(e,i){for(var a=0;a<e.length;a++)i.writeSFixed64(e[a])}function op(e,i){return(e[i]|e[i+1]<<8|e[i+2]<<16)+e[i+3]*16777216}function rh(e,i,a){e[a]=i,e[a+1]=i>>>8,e[a+2]=i>>>16,e[a+3]=i>>>24}function Xp(e,i){return(e[i]|e[i+1]<<8|e[i+2]<<16)+(e[i+3]<<24)}function J_(e,i,a){for(var h="",p=i;p<a;){var x=e[p],E=null,M=x>239?4:x>223?3:x>191?2:1;if(p+M>a)break;var L,V,Z;M===1?x<128&&(E=x):M===2?(L=e[p+1],(L&192)===128&&(E=(x&31)<<6|L&63,E<=127&&(E=null))):M===3?(L=e[p+1],V=e[p+2],(L&192)===128&&(V&192)===128&&(E=(x&15)<<12|(L&63)<<6|V&63,(E<=2047||E>=55296&&E<=57343)&&(E=null))):M===4&&(L=e[p+1],V=e[p+2],Z=e[p+3],(L&192)===128&&(V&192)===128&&(Z&192)===128&&(E=(x&15)<<18|(L&63)<<12|(V&63)<<6|Z&63,(E<=65535||E>=1114112)&&(E=null))),E===null?(E=65533,M=1):E>65535&&(E-=65536,h+=String.fromCharCode(E>>>10&1023|55296),E=56320|E&1023),h+=String.fromCharCode(E),p+=M}return h}function Q_(e,i,a){return jp.decode(e.subarray(i,a))}function $_(e,i,a){for(var h=0,p,x;h<i.length;h++){if(p=i.charCodeAt(h),p>55295&&p<57344)if(x)if(p<56320){e[a++]=239,e[a++]=191,e[a++]=189,x=p;continue}else p=x-55296<<10|p-56320|65536,x=null;else{p>56319||h+1===i.length?(e[a++]=239,e[a++]=191,e[a++]=189):x=p;continue}else x&&(e[a++]=239,e[a++]=191,e[a++]=189,x=null);p<128?e[a++]=p:(p<2048?e[a++]=p>>6|192:(p<65536?e[a++]=p>>12|224:(e[a++]=p>>18|240,e[a++]=p>>12&63|128),e[a++]=p>>6&63|128),e[a++]=p&63|128)}return a}var Wp=3;function tg(e,i,a){e===1&&a.readMessage(Ug,i)}function Ug(e,i,a){if(e===3){var h=a.readMessage(Ng,{}),p=h.id,x=h.bitmap,E=h.width,M=h.height,L=h.left,V=h.top,Z=h.advance;i.push({id:p,bitmap:new Ui({width:E+2*Wp,height:M+2*Wp},x),metrics:{width:E,height:M,left:L,top:V,advance:Z}})}}function Ng(e,i,a){e===1?i.id=a.readVarint():e===2?i.bitmap=a.readBytes():e===3?i.width=a.readVarint():e===4?i.height=a.readVarint():e===5?i.left=a.readSVarint():e===6?i.top=a.readSVarint():e===7&&(i.advance=a.readVarint())}function eg(e){return new sp(e).readFields(tg,[])}var ig=Wp;function rg(e){for(var i=0,a=0,h=0,p=e;h<p.length;h+=1){var x=p[h];i+=x.w*x.h,a=Math.max(a,x.w)}e.sort(function(zt,Ct){return Ct.h-zt.h});for(var E=Math.max(Math.ceil(Math.sqrt(i/.95)),a),M=[{x:0,y:0,w:E,h:1/0}],L=0,V=0,Z=0,Y=e;Z<Y.length;Z+=1)for(var rt=Y[Z],it=M.length-1;it>=0;it--){var ht=M[it];if(!(rt.w>ht.w||rt.h>ht.h)){if(rt.x=ht.x,rt.y=ht.y,V=Math.max(V,rt.y+rt.h),L=Math.max(L,rt.x+rt.w),rt.w===ht.w&&rt.h===ht.h){var _t=M.pop();it<M.length&&(M[it]=_t)}else rt.h===ht.h?(ht.x+=rt.w,ht.w-=rt.w):rt.w===ht.w?(ht.y+=rt.h,ht.h-=rt.h):(M.push({x:ht.x+rt.w,y:ht.y,w:ht.w-rt.w,h:rt.h}),ht.y+=rt.h,ht.h-=rt.h);break}}return{w:L,h:V,fill:i/(L*V)||0}}var Po=1,lp=function(i,a){var h=a.pixelRatio,p=a.version,x=a.stretchX,E=a.stretchY,M=a.content;this.paddedRect=i,this.pixelRatio=h,this.stretchX=x,this.stretchY=E,this.content=M,this.version=p},$f={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};$f.tl.get=function(){return[this.paddedRect.x+Po,this.paddedRect.y+Po]},$f.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-Po,this.paddedRect.y+this.paddedRect.h-Po]},$f.tlbr.get=function(){return this.tl.concat(this.br)},$f.displaySize.get=function(){return[(this.paddedRect.w-Po*2)/this.pixelRatio,(this.paddedRect.h-Po*2)/this.pixelRatio]},Object.defineProperties(lp.prototype,$f);var Vd=function(i,a){var h={},p={};this.haveRenderCallbacks=[];var x=[];this.addImages(i,h,x),this.addImages(a,p,x);var E=rg(x),M=E.w,L=E.h,V=new Wi({width:M||1,height:L||1});for(var Z in i){var Y=i[Z],rt=h[Z].paddedRect;Wi.copy(Y.data,V,{x:0,y:0},{x:rt.x+Po,y:rt.y+Po},Y.data)}for(var it in a){var ht=a[it],_t=p[it].paddedRect,zt=_t.x+Po,Ct=_t.y+Po,jt=ht.data.width,Rt=ht.data.height;Wi.copy(ht.data,V,{x:0,y:0},{x:zt,y:Ct},ht.data),Wi.copy(ht.data,V,{x:0,y:Rt-1},{x:zt,y:Ct-1},{width:jt,height:1}),Wi.copy(ht.data,V,{x:0,y:0},{x:zt,y:Ct+Rt},{width:jt,height:1}),Wi.copy(ht.data,V,{x:jt-1,y:0},{x:zt-1,y:Ct},{width:1,height:Rt}),Wi.copy(ht.data,V,{x:0,y:0},{x:zt+jt,y:Ct},{width:1,height:Rt})}this.image=V,this.iconPositions=h,this.patternPositions=p};Vd.prototype.addImages=function(i,a,h){for(var p in i){var x=i[p],E={x:0,y:0,w:x.data.width+2*Po,h:x.data.height+2*Po};h.push(E),a[p]=new lp(E,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},Vd.prototype.patchUpdatedImages=function(i,a){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(var h in i.updatedImages)this.patchUpdatedImage(this.iconPositions[h],i.getImage(h),a),this.patchUpdatedImage(this.patternPositions[h],i.getImage(h),a)},Vd.prototype.patchUpdatedImage=function(i,a,h){if(!(!i||!a)&&i.version!==a.version){i.version=a.version;var p=i.tl,x=p[0],E=p[1];h.update(a.data,void 0,{x,y:E})}},Ne("ImagePosition",lp),Ne("ImageAtlas",Vd);var Ao={horizontal:1,vertical:2,horizontalOnly:3},Ud=-17;function ng(e){for(var i=0,a=e;i<a.length;i+=1){var h=a[i];if(h.positionedGlyphs.length!==0)return!1}return!0}var Kp=57344,Yp=63743,Sc=function(){this.scale=1,this.fontStack="",this.imageName=null};Sc.forText=function(i,a){var h=new Sc;return h.scale=i||1,h.fontStack=a,h},Sc.forImage=function(i){var a=new Sc;return a.imageName=i,a};var ka=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};ka.fromFeature=function(i,a){for(var h=new ka,p=0;p<i.sections.length;p++){var x=i.sections[p];x.image?h.addImageSection(x):h.addTextSection(x,a)}return h},ka.prototype.length=function(){return this.text.length},ka.prototype.getSection=function(i){return this.sections[this.sectionIndex[i]]},ka.prototype.getSectionIndex=function(i){return this.sectionIndex[i]},ka.prototype.getCharCode=function(i){return this.text.charCodeAt(i)},ka.prototype.verticalizePunctuation=function(){this.text=wc(this.text)},ka.prototype.trim=function(){for(var i=0,a=0;a<this.text.length&&nh[this.text.charCodeAt(a)];a++)i++;for(var h=this.text.length,p=this.text.length-1;p>=0&&p>=i&&nh[this.text.charCodeAt(p)];p--)h--;this.text=this.text.substring(i,h),this.sectionIndex=this.sectionIndex.slice(i,h)},ka.prototype.substring=function(i,a){var h=new ka;return h.text=this.text.substring(i,a),h.sectionIndex=this.sectionIndex.slice(i,a),h.sections=this.sections,h},ka.prototype.toString=function(){return this.text},ka.prototype.getMaxScale=function(){var i=this;return this.sectionIndex.reduce(function(a,h){return Math.max(a,i.sections[h].scale)},0)},ka.prototype.addTextSection=function(i,a){this.text+=i.text,this.sections.push(Sc.forText(i.scale,i.fontStack||a));for(var h=this.sections.length-1,p=0;p<i.text.length;++p)this.sectionIndex.push(h)},ka.prototype.addImageSection=function(i){var a=i.image?i.image.name:"";if(a.length===0){rr("Can't add FormattedSection with an empty image.");return}var h=this.getNextImageSectionCharCode();if(!h){rr("Reached maximum number of images "+(Yp-Kp+2));return}this.text+=String.fromCharCode(h),this.sections.push(Sc.forImage(a)),this.sectionIndex.push(this.sections.length-1)},ka.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=Yp?null:++this.imageSectionID:(this.imageSectionID=Kp,this.imageSectionID)};function ag(e,i){for(var a=[],h=e.text,p=0,x=0,E=i;x<E.length;x+=1){var M=E[x];a.push(e.substring(p,M)),p=M}return p<h.length&&a.push(e.substring(p,h.length)),a}function Nd(e,i,a,h,p,x,E,M,L,V,Z,Y,rt,it,ht,_t){var zt=ka.fromFeature(e,p);Y===Ao.vertical&&zt.verticalizePunctuation();var Ct,jt=Ea.processBidirectionalText,Rt=Ea.processStyledBidirectionalText;if(jt&&zt.sections.length===1){Ct=[];for(var Zt=jt(zt.toString(),Jp(zt,V,x,i,h,it,ht)),Wt=0,le=Zt;Wt<le.length;Wt+=1){var xe=le[Wt],ve=new ka;ve.text=xe,ve.sections=zt.sections;for(var Be=0;Be<xe.length;Be++)ve.sectionIndex.push(0);Ct.push(ve)}}else if(Rt){Ct=[];for(var Te=Rt(zt.text,zt.sectionIndex,Jp(zt,V,x,i,h,it,ht)),De=0,oi=Te;De<oi.length;De+=1){var Oe=oi[De],Ve=new ka;Ve.text=Oe[0],Ve.sectionIndex=Oe[1],Ve.sections=zt.sections,Ct.push(Ve)}}else Ct=ag(zt,Jp(zt,V,x,i,h,it,ht));var gi=[],ni={positionedLines:gi,text:zt.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:Y,iconsInText:!1,verticalizable:!1};return sg(ni,i,a,h,Ct,E,M,L,Y,V,rt,_t),ng(gi)?!1:ni}var nh={};nh[9]=!0,nh[10]=!0,nh[11]=!0,nh[12]=!0,nh[13]=!0,nh[32]=!0;var zs={};zs[10]=!0,zs[32]=!0,zs[38]=!0,zs[40]=!0,zs[41]=!0,zs[43]=!0,zs[45]=!0,zs[47]=!0,zs[173]=!0,zs[183]=!0,zs[8203]=!0,zs[8208]=!0,zs[8211]=!0,zs[8231]=!0;function Fm(e,i,a,h,p,x){if(i.imageName){var L=h[i.imageName];return L?L.displaySize[0]*i.scale*la/x+p:0}else{var E=a[i.fontStack],M=E&&E[e];return M?M.metrics.advance*i.scale+p:0}}function up(e,i,a,h,p,x){for(var E=0,M=0;M<e.length();M++){var L=e.getSection(M);E+=Fm(e.getCharCode(M),L,h,p,i,x)}var V=Math.max(1,Math.ceil(E/a));return E/V}function Lm(e,i,a,h){var p=Math.pow(e-i,2);return h?e<i?p/2:p*2:p+Math.abs(a)*a}function Rm(e,i,a){var h=0;return e===10&&(h-=1e4),a&&(h+=150),(e===40||e===65288)&&(h+=50),(i===41||i===65289)&&(h+=50),h}function Bm(e,i,a,h,p,x){for(var E=null,M=Lm(i,a,p,x),L=0,V=h;L<V.length;L+=1){var Z=V[L],Y=i-Z.x,rt=Lm(Y,a,p,x)+Z.badness;rt<=M&&(E=Z,M=rt)}return{index:e,x:i,priorBreak:E,badness:M}}function Om(e){return e?Om(e.priorBreak).concat(e.index):[]}function Jp(e,i,a,h,p,x,E){if(x!=="point")return[];if(!e)return[];for(var M=[],L=up(e,i,a,h,p,E),V=e.text.indexOf("​")>=0,Z=0,Y=0;Y<e.length();Y++){var rt=e.getSection(Y),it=e.getCharCode(Y);if(nh[it]||(Z+=Fm(it,rt,h,p,i,E)),Y<e.length()-1){var ht=sf(it);(zs[it]||ht||rt.imageName)&&M.push(Bm(Y+1,Z,L,M,Rm(it,e.getCharCode(Y+1),ht&&V),!1))}}return Om(Bm(e.length(),Z,L,M,0,!0))}function hp(e){var i=.5,a=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break}switch(e){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0;break}return{horizontalAlign:i,verticalAlign:a}}function sg(e,i,a,h,p,x,E,M,L,V,Z,Y){for(var rt=0,it=Ud,ht=0,_t=0,zt=M==="right"?1:M==="left"?0:.5,Ct=0,jt=0,Rt=p;jt<Rt.length;jt+=1){var Zt=Rt[jt];Zt.trim();var Wt=Zt.getMaxScale(),le=(Wt-1)*la,xe={positionedGlyphs:[],lineOffset:0};e.positionedLines[Ct]=xe;var ve=xe.positionedGlyphs,Be=0;if(!Zt.length()){it+=x,++Ct;continue}for(var Te=0;Te<Zt.length();Te++){var De=Zt.getSection(Te),oi=Zt.getSectionIndex(Te),Oe=Zt.getCharCode(Te),Ve=0,gi=null,ni=null,qi=null,$i=la,Zi=!(L===Ao.horizontal||!Z&&!Ha(Oe)||Z&&(nh[Oe]||Sh(Oe)));if(De.imageName){var Kr=h[De.imageName];if(!Kr)continue;qi=De.imageName,e.iconsInText=e.iconsInText||!0,ni=Kr.paddedRect;var Br=Kr.displaySize;De.scale=De.scale*la/Y,gi={width:Br[0],height:Br[1],left:Po,top:-3,advance:Zi?Br[1]:Br[0]};var Yn=la-Br[1]*De.scale;Ve=le+Yn,$i=gi.advance;var Tn=Zi?Br[0]*De.scale-la*Wt:Br[1]*De.scale-la*Wt;Tn>0&&Tn>Be&&(Be=Tn)}else{var Bi=a[De.fontStack],Vi=Bi&&Bi[Oe];if(Vi&&Vi.rect)ni=Vi.rect,gi=Vi.metrics;else{var hr=i[De.fontStack],pr=hr&&hr[Oe];if(!pr)continue;gi=pr.metrics}Ve=(Wt-De.scale)*la}Zi?(e.verticalizable=!0,ve.push({glyph:Oe,imageName:qi,x:rt,y:it+Ve,vertical:Zi,scale:De.scale,fontStack:De.fontStack,sectionIndex:oi,metrics:gi,rect:ni}),rt+=$i*De.scale+V):(ve.push({glyph:Oe,imageName:qi,x:rt,y:it+Ve,vertical:Zi,scale:De.scale,fontStack:De.fontStack,sectionIndex:oi,metrics:gi,rect:ni}),rt+=gi.advance*De.scale+V)}if(ve.length!==0){var ts=rt-V;ht=Math.max(ts,ht),og(ve,0,ve.length-1,zt,Be)}rt=0;var En=x*Wt+Be;xe.lineOffset=Math.max(Be,le),it+=En,_t=Math.max(En,_t),++Ct}var Jn=it-Ud,ms=hp(E),fn=ms.horizontalAlign,dn=ms.verticalAlign;lg(e.positionedLines,zt,fn,dn,ht,_t,x,Jn,p.length),e.top+=-dn*Jn,e.bottom=e.top+Jn,e.left+=-fn*ht,e.right=e.left+ht}function og(e,i,a,h,p){if(!(!h&&!p))for(var x=e[a],E=x.metrics.advance*x.scale,M=(e[a].x+E)*h,L=i;L<=a;L++)e[L].x-=M,e[L].y+=p}function lg(e,i,a,h,p,x,E,M,L){var V=(i-a)*p,Z=0;x!==E?Z=-M*h-Ud:Z=(-h*L+.5)*E;for(var Y=0,rt=e;Y<rt.length;Y+=1)for(var it=rt[Y],ht=0,_t=it.positionedGlyphs;ht<_t.length;ht+=1){var zt=_t[ht];zt.x+=V,zt.y+=Z}}function ug(e,i,a){var h=hp(a),p=h.horizontalAlign,x=h.verticalAlign,E=i[0],M=i[1],L=E-e.displaySize[0]*p,V=L+e.displaySize[0],Z=M-e.displaySize[1]*x,Y=Z+e.displaySize[1];return{image:e,top:Z,bottom:Y,left:L,right:V}}function td(e,i,a,h,p,x){var E=e.image,M;if(E.content){var L=E.content,V=E.pixelRatio||1;M=[L[0]/V,L[1]/V,E.displaySize[0]-L[2]/V,E.displaySize[1]-L[3]/V]}var Z=i.left*x,Y=i.right*x,rt,it,ht,_t;a==="width"||a==="both"?(_t=p[0]+Z-h[3],it=p[0]+Y+h[1]):(_t=p[0]+(Z+Y-E.displaySize[0])/2,it=_t+E.displaySize[0]);var zt=i.top*x,Ct=i.bottom*x;return a==="height"||a==="both"?(rt=p[1]+zt-h[0],ht=p[1]+Ct+h[2]):(rt=p[1]+(zt+Ct-E.displaySize[1])/2,ht=rt+E.displaySize[1]),{image:E,top:rt,right:it,bottom:ht,left:_t,collisionPadding:M}}var ed=function(e){function i(a,h,p,x){e.call(this,a,h),this.angle=p,x!==void 0&&(this.segment=x)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.clone=function(){return new i(this.x,this.y,this.angle,this.segment)},i}(pe);Ne("Anchor",ed);var Tr=128;function qd(e,i){var a=i.expression;if(a.kind==="constant"){var h=a.evaluate(new Fi(e+1));return{kind:"constant",layoutSize:h}}else{if(a.kind==="source")return{kind:"source"};for(var p=a.zoomStops,x=a.interpolationType,E=0;E<p.length&&p[E]<=e;)E++;E=Math.max(0,E-1);for(var M=E;M<p.length&&p[M]<e+1;)M++;M=Math.min(p.length-1,M);var L=p[E],V=p[M];if(a.kind==="composite")return{kind:"composite",minZoom:L,maxZoom:V,interpolationType:x};var Z=a.evaluate(new Fi(L)),Y=a.evaluate(new Fi(V));return{kind:"camera",minZoom:L,maxZoom:V,minSize:Z,maxSize:Y,interpolationType:x}}}function Qp(e,i,a){var h=i.uSize,p=i.uSizeT,x=a.lowerSize,E=a.upperSize;return e.kind==="source"?x/Tr:e.kind==="composite"?$r(x/Tr,E/Tr,p):h}function Zd(e,i){var a=0,h=0;if(e.kind==="constant")h=e.layoutSize;else if(e.kind!=="source"){var p=e.interpolationType,x=e.minZoom,E=e.maxZoom,M=p?fa(kn.interpolationFactor(p,i,x,E),0,1):0;e.kind==="camera"?h=$r(e.minSize,e.maxSize,M):a=M}return{uSizeT:a,uSize:h}}var Er=Object.freeze({__proto__:null,getSizeData:qd,evaluateSizeForFeature:Qp,evaluateSizeForZoom:Zd,SIZE_PACK_FACTOR:Tr});function cp(e,i,a,h,p){if(i.segment===void 0)return!0;for(var x=i,E=i.segment+1,M=0;M>-a/2;){if(E--,E<0)return!1;M-=e[E].dist(x),x=e[E]}M+=e[E].dist(e[E+1]),E++;for(var L=[],V=0;M<a/2;){var Z=e[E-1],Y=e[E],rt=e[E+1];if(!rt)return!1;var it=Z.angleTo(Y)-Y.angleTo(rt);for(it=Math.abs((it+3*Math.PI)%(Math.PI*2)-Math.PI),L.push({distance:M,angleDelta:it}),V+=it;M-L[0].distance>h;)V-=L.shift().angleDelta;if(V>p)return!1;E++,M+=Y.dist(rt)}return!0}function $p(e){for(var i=0,a=0;a<e.length-1;a++)i+=e[a].dist(e[a+1]);return i}function Vm(e,i,a){return e?3/5*i*a:0}function tm(e,i){return Math.max(e?e.right-e.left:0,i?i.right-i.left:0)}function hg(e,i,a,h,p,x){for(var E=Vm(a,p,x),M=tm(a,h)*x,L=0,V=$p(e)/2,Z=0;Z<e.length-1;Z++){var Y=e[Z],rt=e[Z+1],it=Y.dist(rt);if(L+it>V){var ht=(V-L)/it,_t=$r(Y.x,rt.x,ht),zt=$r(Y.y,rt.y,ht),Ct=new ed(_t,zt,rt.angleTo(Y),Z);return Ct._round(),!E||cp(e,Ct,M,E,i)?Ct:void 0}L+=it}}function Dh(e,i,a,h,p,x,E,M,L){var V=Vm(h,x,E),Z=tm(h,p),Y=Z*E,rt=e[0].x===0||e[0].x===L||e[0].y===0||e[0].y===L;i-Y<i/4&&(i=Y+i/4);var it=x*2,ht=rt?i/2*M%i:(Z/2+it)*E*M%i;return _f(e,ht,i,V,a,Y,rt,!1,L)}function _f(e,i,a,h,p,x,E,M,L){for(var V=x/2,Z=$p(e),Y=0,rt=i-a,it=[],ht=0;ht<e.length-1;ht++){for(var _t=e[ht],zt=e[ht+1],Ct=_t.dist(zt),jt=zt.angleTo(_t);rt+a<Y+Ct;){rt+=a;var Rt=(rt-Y)/Ct,Zt=$r(_t.x,zt.x,Rt),Wt=$r(_t.y,zt.y,Rt);if(Zt>=0&&Zt<L&&Wt>=0&&Wt<L&&rt-V>=0&&rt+V<=Z){var le=new ed(Zt,Wt,jt,ht);le._round(),(!h||cp(e,le,x,h,p))&&it.push(le)}}Y+=Ct}return!M&&!it.length&&!E&&(it=_f(e,Y/2,a,h,p,x,E,!0,L)),it}function Um(e,i,a,h,p){for(var x=[],E=0;E<e.length;E++)for(var M=e[E],L=void 0,V=0;V<M.length-1;V++){var Z=M[V],Y=M[V+1];Z.x<i&&Y.x<i||(Z.x<i?Z=new pe(i,Z.y+(Y.y-Z.y)*((i-Z.x)/(Y.x-Z.x)))._round():Y.x<i&&(Y=new pe(i,Z.y+(Y.y-Z.y)*((i-Z.x)/(Y.x-Z.x)))._round()),!(Z.y<a&&Y.y<a)&&(Z.y<a?Z=new pe(Z.x+(Y.x-Z.x)*((a-Z.y)/(Y.y-Z.y)),a)._round():Y.y<a&&(Y=new pe(Z.x+(Y.x-Z.x)*((a-Z.y)/(Y.y-Z.y)),a)._round()),!(Z.x>=h&&Y.x>=h)&&(Z.x>=h?Z=new pe(h,Z.y+(Y.y-Z.y)*((h-Z.x)/(Y.x-Z.x)))._round():Y.x>=h&&(Y=new pe(h,Z.y+(Y.y-Z.y)*((h-Z.x)/(Y.x-Z.x)))._round()),!(Z.y>=p&&Y.y>=p)&&(Z.y>=p?Z=new pe(Z.x+(Y.x-Z.x)*((p-Z.y)/(Y.y-Z.y)),p)._round():Y.y>=p&&(Y=new pe(Z.x+(Y.x-Z.x)*((p-Z.y)/(Y.y-Z.y)),p)._round()),(!L||!Z.equals(L[L.length-1]))&&(L=[Z],x.push(L)),L.push(Y)))))}return x}var jd=Po;function Nm(e,i,a,h){var p=[],x=e.image,E=x.pixelRatio,M=x.paddedRect.w-2*jd,L=x.paddedRect.h-2*jd,V=e.right-e.left,Z=e.bottom-e.top,Y=x.stretchX||[[0,M]],rt=x.stretchY||[[0,L]],it=function(Bi,Vi){return Bi+Vi[1]-Vi[0]},ht=Y.reduce(it,0),_t=rt.reduce(it,0),zt=M-ht,Ct=L-_t,jt=0,Rt=ht,Zt=0,Wt=_t,le=0,xe=zt,ve=0,Be=Ct;if(x.content&&h){var Te=x.content;jt=Gd(Y,0,Te[0]),Zt=Gd(rt,0,Te[1]),Rt=Gd(Y,Te[0],Te[2]),Wt=Gd(rt,Te[1],Te[3]),le=Te[0]-jt,ve=Te[1]-Zt,xe=Te[2]-Te[0]-Rt,Be=Te[3]-Te[1]-Wt}var De=function(Bi,Vi,hr,pr){var Kr=fp(Bi.stretch-jt,Rt,V,e.left),Br=dp(Bi.fixed-le,xe,Bi.stretch,ht),Yn=fp(Vi.stretch-Zt,Wt,Z,e.top),Tn=dp(Vi.fixed-ve,Be,Vi.stretch,_t),ts=fp(hr.stretch-jt,Rt,V,e.left),En=dp(hr.fixed-le,xe,hr.stretch,ht),Jn=fp(pr.stretch-Zt,Wt,Z,e.top),ms=dp(pr.fixed-ve,Be,pr.stretch,_t),fn=new pe(Kr,Yn),dn=new pe(ts,Yn),es=new pe(ts,Jn),ro=new pe(Kr,Jn),Oh=new pe(Br/E,Tn/E),ah=new pe(En/E,ms/E),Ic=i*Math.PI/180;if(Ic){var Cc=Math.sin(Ic),xf=Math.cos(Ic),fl=[xf,-Cc,Cc,xf];fn._matMult(fl),dn._matMult(fl),ro._matMult(fl),es._matMult(fl)}var Tp=Bi.stretch+Bi.fixed,pm=hr.stretch+hr.fixed,Yd=Vi.stretch+Vi.fixed,Jd=pr.stretch+pr.fixed,_s={x:x.paddedRect.x+jd+Tp,y:x.paddedRect.y+jd+Yd,w:pm-Tp,h:Jd-Yd},Pc=xe/E/V,ud=Be/E/Z;return{tl:fn,tr:dn,bl:ro,br:es,tex:_s,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oh,pixelOffsetBR:ah,minFontScaleX:Pc,minFontScaleY:ud,isSDF:a}};if(!h||!x.stretchX&&!x.stretchY)p.push(De({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:L+1}));else for(var oi=qm(Y,zt,ht),Oe=qm(rt,Ct,_t),Ve=0;Ve<oi.length-1;Ve++)for(var gi=oi[Ve],ni=oi[Ve+1],qi=0;qi<Oe.length-1;qi++){var $i=Oe[qi],Zi=Oe[qi+1];p.push(De(gi,$i,ni,Zi))}return p}function Gd(e,i,a){for(var h=0,p=0,x=e;p<x.length;p+=1){var E=x[p];h+=Math.max(i,Math.min(a,E[1]))-Math.max(i,Math.min(a,E[0]))}return h}function qm(e,i,a){for(var h=[{fixed:-1,stretch:0}],p=0,x=e;p<x.length;p+=1){var E=x[p],M=E[0],L=E[1],V=h[h.length-1];h.push({fixed:M-V.stretch,stretch:V.stretch}),h.push({fixed:M-V.stretch,stretch:V.stretch+(L-M)})}return h.push({fixed:i+jd,stretch:a}),h}function fp(e,i,a,h){return e/i*a+h}function dp(e,i,a,h){return e-i*a/h}function cg(e,i,a,h,p,x,E,M){for(var L=h.layout.get("text-rotate").evaluate(x,{})*Math.PI/180,V=[],Z=0,Y=i.positionedLines;Z<Y.length;Z+=1)for(var rt=Y[Z],it=0,ht=rt.positionedGlyphs;it<ht.length;it+=1){var _t=ht[it];if(_t.rect){var zt=_t.rect||{},Ct=1,jt=ig+Ct,Rt=!0,Zt=1,Wt=0,le=(p||M)&&_t.vertical,xe=_t.metrics.advance*_t.scale/2;if(M&&i.verticalizable){var ve=(_t.scale-1)*la,Be=(la-_t.metrics.width*_t.scale)/2;Wt=rt.lineOffset/2-(_t.imageName?-Be:ve)}if(_t.imageName){var Te=E[_t.imageName];Rt=Te.sdf,Zt=Te.pixelRatio,jt=Po/Zt}var De=p?[_t.x+xe,_t.y]:[0,0],oi=p?[0,0]:[_t.x+xe+a[0],_t.y+a[1]-Wt],Oe=[0,0];le&&(Oe=oi,oi=[0,0]);var Ve=(_t.metrics.left-jt)*_t.scale-xe+oi[0],gi=(-_t.metrics.top-jt)*_t.scale+oi[1],ni=Ve+zt.w*_t.scale/Zt,qi=gi+zt.h*_t.scale/Zt,$i=new pe(Ve,gi),Zi=new pe(ni,gi),Bi=new pe(Ve,qi),Vi=new pe(ni,qi);if(le){var hr=new pe(-xe,xe-Ud),pr=-Math.PI/2,Kr=la/2-xe,Br=_t.imageName?Kr:0,Yn=new pe(5-Ud-Kr,-Br),Tn=new(Function.prototype.bind.apply(pe,[null].concat(Oe)));$i._rotateAround(pr,hr)._add(Yn)._add(Tn),Zi._rotateAround(pr,hr)._add(Yn)._add(Tn),Bi._rotateAround(pr,hr)._add(Yn)._add(Tn),Vi._rotateAround(pr,hr)._add(Yn)._add(Tn)}if(L){var ts=Math.sin(L),En=Math.cos(L),Jn=[En,-ts,ts,En];$i._matMult(Jn),Zi._matMult(Jn),Bi._matMult(Jn),Vi._matMult(Jn)}var ms=new pe(0,0),fn=new pe(0,0),dn=0,es=0;V.push({tl:$i,tr:Zi,bl:Bi,br:Vi,tex:zt,writingMode:i.writingMode,glyphOffset:De,sectionIndex:_t.sectionIndex,isSDF:Rt,pixelOffsetTL:ms,pixelOffsetBR:fn,minFontScaleX:dn,minFontScaleY:es})}}return V}var pp=function(i,a,h,p,x,E,M,L,V,Z){if(this.boxStartIndex=i.length,V){var Y=E.top,rt=E.bottom,it=E.collisionPadding;it&&(Y-=it[1],rt+=it[3]);var ht=rt-Y;ht>0&&(ht=Math.max(10,ht),this.circleDiameter=ht)}else{var _t=E.top*M-L,zt=E.bottom*M+L,Ct=E.left*M-L,jt=E.right*M+L,Rt=E.collisionPadding;if(Rt&&(Ct-=Rt[0]*M,_t-=Rt[1]*M,jt+=Rt[2]*M,zt+=Rt[3]*M),Z){var Zt=new pe(Ct,_t),Wt=new pe(jt,_t),le=new pe(Ct,zt),xe=new pe(jt,zt),ve=Z*Math.PI/180;Zt._rotate(ve),Wt._rotate(ve),le._rotate(ve),xe._rotate(ve),Ct=Math.min(Zt.x,Wt.x,le.x,xe.x),jt=Math.max(Zt.x,Wt.x,le.x,xe.x),_t=Math.min(Zt.y,Wt.y,le.y,xe.y),zt=Math.max(Zt.y,Wt.y,le.y,xe.y)}i.emplaceBack(a.x,a.y,Ct,_t,jt,zt,h,p,x)}this.boxEndIndex=i.length},id=function(i,a){if(i===void 0&&(i=[]),a===void 0&&(a=fg),this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(var h=(this.length>>1)-1;h>=0;h--)this._down(h)};id.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},id.prototype.pop=function(){if(this.length!==0){var i=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),i}},id.prototype.peek=function(){return this.data[0]},id.prototype._up=function(i){for(var a=this,h=a.data,p=a.compare,x=h[i];i>0;){var E=i-1>>1,M=h[E];if(p(x,M)>=0)break;h[i]=M,i=E}h[i]=x},id.prototype._down=function(i){for(var a=this,h=a.data,p=a.compare,x=this.length>>1,E=h[i];i<x;){var M=(i<<1)+1,L=h[M],V=M+1;if(V<this.length&&p(h[V],L)<0&&(M=V,L=h[V]),p(L,E)>=0)break;h[i]=L,i=M}h[i]=E};function fg(e,i){return e<i?-1:e>i?1:0}function dg(e,i,a){a===void 0&&(a=!1);for(var h=1/0,p=1/0,x=-1/0,E=-1/0,M=e[0],L=0;L<M.length;L++){var V=M[L];(!L||V.x<h)&&(h=V.x),(!L||V.y<p)&&(p=V.y),(!L||V.x>x)&&(x=V.x),(!L||V.y>E)&&(E=V.y)}var Z=x-h,Y=E-p,rt=Math.min(Z,Y),it=rt/2,ht=new id([],pg);if(rt===0)return new pe(h,p);for(var _t=h;_t<x;_t+=rt)for(var zt=p;zt<E;zt+=rt)ht.push(new kh(_t+it,zt+it,it,e));for(var Ct=Zm(e),jt=ht.length;ht.length;){var Rt=ht.pop();(Rt.d>Ct.d||!Ct.d)&&(Ct=Rt,a&&console.log("found best %d after %d probes",Math.round(1e4*Rt.d)/1e4,jt)),!(Rt.max-Ct.d<=i)&&(it=Rt.h/2,ht.push(new kh(Rt.p.x-it,Rt.p.y-it,it,e)),ht.push(new kh(Rt.p.x+it,Rt.p.y-it,it,e)),ht.push(new kh(Rt.p.x-it,Rt.p.y+it,it,e)),ht.push(new kh(Rt.p.x+it,Rt.p.y+it,it,e)),jt+=4)}return a&&(console.log("num probes: "+jt),console.log("best distance: "+Ct.d)),Ct.p}function pg(e,i){return i.max-e.max}function kh(e,i,a,h){this.p=new pe(e,i),this.h=a,this.d=rd(this.p,h),this.max=this.d+this.h*Math.SQRT2}function rd(e,i){for(var a=!1,h=1/0,p=0;p<i.length;p++)for(var x=i[p],E=0,M=x.length,L=M-1;E<M;L=E++){var V=x[E],Z=x[L];V.y>e.y!=Z.y>e.y&&e.x<(Z.x-V.x)*(e.y-V.y)/(Z.y-V.y)+V.x&&(a=!a),h=Math.min(h,bu(e,V,Z))}return(a?1:-1)*Math.sqrt(h)}function Zm(e){for(var i=0,a=0,h=0,p=e[0],x=0,E=p.length,M=E-1;x<E;M=x++){var L=p[x],V=p[M],Z=L.x*V.y-V.x*L.y;a+=(L.x+V.x)*Z,h+=(L.y+V.y)*Z,i+=Z*3}return new kh(a/i,h/i,0,e)}var nd=7,em=Number.POSITIVE_INFINITY;function jm(e,i){function a(p,x){var E=0,M=0;x<0&&(x=0);var L=x/Math.sqrt(2);switch(p){case"top-right":case"top-left":M=L-nd;break;case"bottom-right":case"bottom-left":M=-L+nd;break;case"bottom":M=-x+nd;break;case"top":M=x-nd;break}switch(p){case"top-right":case"bottom-right":E=-L;break;case"top-left":case"bottom-left":E=L;break;case"left":E=x;break;case"right":E=-x;break}return[E,M]}function h(p,x,E){var M=0,L=0;switch(x=Math.abs(x),E=Math.abs(E),p){case"top-right":case"top-left":case"top":L=E-nd;break;case"bottom-right":case"bottom-left":case"bottom":L=-E+nd;break}switch(p){case"top-right":case"bottom-right":case"right":M=-x;break;case"top-left":case"bottom-left":case"left":M=x;break}return[M,L]}return i[1]!==em?h(e,i[0],i[1]):a(e,i[0])}function im(e,i,a,h,p,x,E){e.createArrays();var M=512*e.overscaling;e.tilePixelRatio=Re/M,e.compareText={},e.iconsNeedLinear=!1;var L=e.layers[0].layout,V=e.layers[0]._unevaluatedLayout._values,Z={};if(e.textSizeData.kind==="composite"){var Y=e.textSizeData,rt=Y.minZoom,it=Y.maxZoom;Z.compositeTextSizes=[V["text-size"].possiblyEvaluate(new Fi(rt),E),V["text-size"].possiblyEvaluate(new Fi(it),E)]}if(e.iconSizeData.kind==="composite"){var ht=e.iconSizeData,_t=ht.minZoom,zt=ht.maxZoom;Z.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new Fi(_t),E),V["icon-size"].possiblyEvaluate(new Fi(zt),E)]}Z.layoutTextSize=V["text-size"].possiblyEvaluate(new Fi(e.zoom+1),E),Z.layoutIconSize=V["icon-size"].possiblyEvaluate(new Fi(e.zoom+1),E),Z.textMaxSize=V["text-size"].possiblyEvaluate(new Fi(18));for(var Ct=L.get("text-line-height")*la,jt=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Rt=L.get("text-keep-upright"),Zt=L.get("text-size"),Wt=function(){var ve=xe[le],Be=L.get("text-font").evaluate(ve,{},E).join(","),Te=Zt.evaluate(ve,{},E),De=Z.layoutTextSize.evaluate(ve,{},E),oi=Z.layoutIconSize.evaluate(ve,{},E),Oe={horizontal:{},vertical:void 0},Ve=ve.text,gi=[0,0];if(Ve){var ni=Ve.toString(),qi=L.get("text-letter-spacing").evaluate(ve,{},E)*la,$i=af(ni)?qi:0,Zi=L.get("text-anchor").evaluate(ve,{},E),Bi=L.get("text-variable-anchor");if(!Bi){var Vi=L.get("text-radial-offset").evaluate(ve,{},E);Vi?gi=jm(Zi,[Vi*la,em]):gi=L.get("text-offset").evaluate(ve,{},E).map(function(Oh){return Oh*la})}var hr=jt?"center":L.get("text-justify").evaluate(ve,{},E),pr=L.get("symbol-placement"),Kr=pr==="point"?L.get("text-max-width").evaluate(ve,{},E)*la:0,Br=function(){e.allowVerticalPlacement&&hc(ni)&&(Oe.vertical=Nd(Ve,i,a,p,Be,Kr,Ct,Zi,"left",$i,gi,Ao.vertical,!0,pr,De,Te))};if(!jt&&Bi){for(var Yn=hr==="auto"?Bi.map(function(Oh){return Hd(Oh)}):[hr],Tn=!1,ts=0;ts<Yn.length;ts++){var En=Yn[ts];if(!Oe.horizontal[En])if(Tn)Oe.horizontal[En]=Oe.horizontal[0];else{var Jn=Nd(Ve,i,a,p,Be,Kr,Ct,"center",En,$i,gi,Ao.horizontal,!1,pr,De,Te);Jn&&(Oe.horizontal[En]=Jn,Tn=Jn.positionedLines.length===1)}}Br()}else{hr==="auto"&&(hr=Hd(Zi));var ms=Nd(Ve,i,a,p,Be,Kr,Ct,Zi,hr,$i,gi,Ao.horizontal,!1,pr,De,Te);ms&&(Oe.horizontal[hr]=ms),Br(),hc(ni)&&jt&&Rt&&(Oe.vertical=Nd(Ve,i,a,p,Be,Kr,Ct,Zi,hr,$i,gi,Ao.vertical,!1,pr,De,Te))}}var fn=void 0,dn=!1;if(ve.icon&&ve.icon.name){var es=h[ve.icon.name];es&&(fn=ug(p[ve.icon.name],L.get("icon-offset").evaluate(ve,{},E),L.get("icon-anchor").evaluate(ve,{},E)),dn=es.sdf,e.sdfIcons===void 0?e.sdfIcons=es.sdf:e.sdfIcons!==es.sdf&&rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(es.pixelRatio!==e.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var ro=Hm(Oe.horizontal)||Oe.vertical;e.iconsInText=ro?ro.iconsInText:!1,(ro||fn)&&mg(e,ve,Oe,fn,h,Z,De,oi,gi,dn,E)},le=0,xe=e.features;le<xe.length;le+=1)Wt();x&&e.generateCollisionDebugBuffers()}function Hd(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mg(e,i,a,h,p,x,E,M,L,V,Z){var Y=x.textMaxSize.evaluate(i,{});Y===void 0&&(Y=E);var rt=e.layers[0].layout,it=rt.get("icon-offset").evaluate(i,{},Z),ht=Hm(a.horizontal),_t=24,zt=E/_t,Ct=e.tilePixelRatio*zt,jt=e.tilePixelRatio*Y/_t,Rt=e.tilePixelRatio*M,Zt=e.tilePixelRatio*rt.get("symbol-spacing"),Wt=rt.get("text-padding")*e.tilePixelRatio,le=rt.get("icon-padding")*e.tilePixelRatio,xe=rt.get("text-max-angle")/180*Math.PI,ve=rt.get("text-rotation-alignment")==="map"&&rt.get("symbol-placement")!=="point",Be=rt.get("icon-rotation-alignment")==="map"&&rt.get("symbol-placement")!=="point",Te=rt.get("symbol-placement"),De=Zt/2,oi=rt.get("icon-text-fit"),Oe;h&&oi!=="none"&&(e.allowVerticalPlacement&&a.vertical&&(Oe=td(h,a.vertical,oi,rt.get("icon-text-fit-padding"),it,zt)),ht&&(h=td(h,ht,oi,rt.get("icon-text-fit-padding"),it,zt)));var Ve=function(xf,fl){fl.x<0||fl.x>=Re||fl.y<0||fl.y>=Re||Xm(e,fl,xf,a,h,p,Oe,e.layers[0],e.collisionBoxArray,i.index,i.sourceLayerIndex,e.index,Ct,Wt,ve,L,Rt,le,Be,it,i,x,V,Z,E)};if(Te==="line")for(var gi=0,ni=Um(i.geometry,0,0,Re,Re);gi<ni.length;gi+=1)for(var qi=ni[gi],$i=Dh(qi,Zt,xe,a.vertical||ht,h,_t,jt,e.overscaling,Re),Zi=0,Bi=$i;Zi<Bi.length;Zi+=1){var Vi=Bi[Zi],hr=ht;(!hr||!eo(e,hr.text,De,Vi))&&Ve(qi,Vi)}else if(Te==="line-center")for(var pr=0,Kr=i.geometry;pr<Kr.length;pr+=1){var Br=Kr[pr];if(Br.length>1){var Yn=hg(Br,xe,a.vertical||ht,h,_t,jt);Yn&&Ve(Br,Yn)}}else if(i.type==="Polygon")for(var Tn=0,ts=Ap(i.geometry,0);Tn<ts.length;Tn+=1){var En=ts[Tn],Jn=dg(En,16);Ve(En[0],new ed(Jn.x,Jn.y,0))}else if(i.type==="LineString")for(var ms=0,fn=i.geometry;ms<fn.length;ms+=1){var dn=fn[ms];Ve(dn,new ed(dn[0].x,dn[0].y,0))}else if(i.type==="Point")for(var es=0,ro=i.geometry;es<ro.length;es+=1)for(var Oh=ro[es],ah=0,Ic=Oh;ah<Ic.length;ah+=1){var Cc=Ic[ah];Ve([Cc],new ed(Cc.x,Cc.y,0))}}var Xd=255,Tc=Xd*Tr;function Gm(e,i,a,h,p,x,E,M,L,V,Z,Y,rt,it,ht){var _t=cg(i,a,M,p,x,E,h,e.allowVerticalPlacement),zt=e.textSizeData,Ct=null;zt.kind==="source"?(Ct=[Tr*p.layout.get("text-size").evaluate(E,{})],Ct[0]>Tc&&rr(e.layerIds[0]+': Value for "text-size" is >= '+Xd+'. Reduce your "text-size".')):zt.kind==="composite"&&(Ct=[Tr*it.compositeTextSizes[0].evaluate(E,{},ht),Tr*it.compositeTextSizes[1].evaluate(E,{},ht)],(Ct[0]>Tc||Ct[1]>Tc)&&rr(e.layerIds[0]+': Value for "text-size" is >= '+Xd+'. Reduce your "text-size".')),e.addSymbols(e.text,_t,Ct,M,x,E,V,i,L.lineStartIndex,L.lineLength,rt,ht);for(var jt=0,Rt=Z;jt<Rt.length;jt+=1){var Zt=Rt[jt];Y[Zt]=e.text.placedSymbolArray.length-1}return _t.length*4}function Hm(e){for(var i in e)return e[i];return null}function Xm(e,i,a,h,p,x,E,M,L,V,Z,Y,rt,it,ht,_t,zt,Ct,jt,Rt,Zt,Wt,le,xe,ve){var Be,Te=e.addToLineVertexArray(i,a),De,oi,Oe,Ve,gi=0,ni=0,qi=0,$i=0,Zi=-1,Bi=-1,Vi={},hr=_(""),pr=0,Kr=0;if(M._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Be=M.layout.get("text-offset").evaluate(Zt,{},xe).map(function(hd){return hd*la}),pr=Be[0],Kr=Be[1]):(pr=M.layout.get("text-radial-offset").evaluate(Zt,{},xe)*la,Kr=em),e.allowVerticalPlacement&&h.vertical){var Br=M.layout.get("text-rotate").evaluate(Zt,{},xe),Yn=Br+90,Tn=h.vertical;Oe=new pp(L,i,V,Z,Y,Tn,rt,it,ht,Yn),E&&(Ve=new pp(L,i,V,Z,Y,E,zt,Ct,ht,Yn))}if(p){var ts=M.layout.get("icon-rotate").evaluate(Zt,{}),En=M.layout.get("icon-text-fit")!=="none",Jn=Nm(p,ts,le,En),ms=E?Nm(E,ts,le,En):void 0;oi=new pp(L,i,V,Z,Y,p,zt,Ct,!1,ts),gi=Jn.length*4;var fn=e.iconSizeData,dn=null;fn.kind==="source"?(dn=[Tr*M.layout.get("icon-size").evaluate(Zt,{})],dn[0]>Tc&&rr(e.layerIds[0]+': Value for "icon-size" is >= '+Xd+'. Reduce your "icon-size".')):fn.kind==="composite"&&(dn=[Tr*Wt.compositeIconSizes[0].evaluate(Zt,{},xe),Tr*Wt.compositeIconSizes[1].evaluate(Zt,{},xe)],(dn[0]>Tc||dn[1]>Tc)&&rr(e.layerIds[0]+': Value for "icon-size" is >= '+Xd+'. Reduce your "icon-size".')),e.addSymbols(e.icon,Jn,dn,Rt,jt,Zt,!1,i,Te.lineStartIndex,Te.lineLength,-1,xe),Zi=e.icon.placedSymbolArray.length-1,ms&&(ni=ms.length*4,e.addSymbols(e.icon,ms,dn,Rt,jt,Zt,Ao.vertical,i,Te.lineStartIndex,Te.lineLength,-1,xe),Bi=e.icon.placedSymbolArray.length-1)}for(var es in h.horizontal){var ro=h.horizontal[es];if(!De){hr=_(ro.text);var Oh=M.layout.get("text-rotate").evaluate(Zt,{},xe);De=new pp(L,i,V,Z,Y,ro,rt,it,ht,Oh)}var ah=ro.positionedLines.length===1;if(qi+=Gm(e,i,ro,x,M,ht,Zt,_t,Te,h.vertical?Ao.horizontal:Ao.horizontalOnly,ah?Object.keys(h.horizontal):[es],Vi,Zi,Wt,xe),ah)break}h.vertical&&($i+=Gm(e,i,h.vertical,x,M,ht,Zt,_t,Te,Ao.vertical,["vertical"],Vi,Bi,Wt,xe));var Ic=De?De.boxStartIndex:e.collisionBoxArray.length,Cc=De?De.boxEndIndex:e.collisionBoxArray.length,xf=Oe?Oe.boxStartIndex:e.collisionBoxArray.length,fl=Oe?Oe.boxEndIndex:e.collisionBoxArray.length,Tp=oi?oi.boxStartIndex:e.collisionBoxArray.length,pm=oi?oi.boxEndIndex:e.collisionBoxArray.length,Yd=Ve?Ve.boxStartIndex:e.collisionBoxArray.length,Jd=Ve?Ve.boxEndIndex:e.collisionBoxArray.length,_s=-1,Pc=function(hd,cd){return hd&&hd.circleDiameter?Math.max(hd.circleDiameter,cd):cd};_s=Pc(De,_s),_s=Pc(Oe,_s),_s=Pc(oi,_s),_s=Pc(Ve,_s);var ud=_s>-1?1:0;ud&&(_s*=ve/la),e.glyphOffsetArray.length>=Ji.MAX_GLYPHS&&rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&e.addToSortKeyRanges(e.symbolInstances.length,Zt.sortKey),e.symbolInstances.emplaceBack(i.x,i.y,Vi.right>=0?Vi.right:-1,Vi.center>=0?Vi.center:-1,Vi.left>=0?Vi.left:-1,Vi.vertical||-1,Zi,Bi,hr,Ic,Cc,xf,fl,Tp,pm,Yd,Jd,V,qi,$i,gi,ni,ud,0,rt,pr,Kr,_s)}function eo(e,i,a,h){var p=e.compareText;if(!(i in p))p[i]=[];else for(var x=p[i],E=x.length-1;E>=0;E--)if(h.dist(x[E])<a)return!0;return p[i].push(h),!1}var rm=pf.VectorTileFeature.types,Wm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ec(e,i,a,h,p,x,E,M,L,V,Z,Y,rt){var it=M?Math.min(Tc,Math.round(M[0])):0,ht=M?Math.min(Tc,Math.round(M[1])):0;e.emplaceBack(i,a,Math.round(h*32),Math.round(p*32),x,E,(it<<1)+(L?1:0),ht,V*16,Z*16,Y*256,rt*256)}function nm(e,i,a){e.emplaceBack(i.x,i.y,a),e.emplaceBack(i.x,i.y,a),e.emplaceBack(i.x,i.y,a),e.emplaceBack(i.x,i.y,a)}function Km(e){for(var i=0,a=e.sections;i<a.length;i+=1){var h=a[i];if(Gf(h.text))return!0}return!1}var gf=function(i){this.layoutVertexArray=new ql,this.indexArray=new Ln,this.programConfigurations=i,this.segments=new Gr,this.dynamicLayoutVertexArray=new Ih,this.opacityVertexArray=new pc,this.placedSymbolArray=new $u};gf.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},gf.prototype.upload=function(i,a,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Cm.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,B_.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Wm,!0),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(i))},gf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Ne("SymbolBuffers",gf);var Fh=function(i,a,h){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new h,this.segments=new Gr,this.collisionVertexArray=new aa};Fh.prototype.upload=function(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,O_.members,!0)},Fh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Ne("CollisionBuffers",Fh);var Ji=function(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(L){return L.id}),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=w([]),this.placementViewportMatrix=w([]);var a=this.layers[0],h=a._unevaluatedLayout._values;this.textSizeData=qd(this.zoom,h["text-size"]),this.iconSizeData=qd(this.zoom,h["icon-size"]);var p=this.layers[0].layout,x=p.get("symbol-sort-key"),E=p.get("symbol-z-order");this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&x.constantOr(1)!==void 0;var M=E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey;this.sortFeaturesByY=M&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(function(L){return Ao[L]})),this.stateDependentLayerIds=this.layers.filter(function(L){return L.isStateDependent()}).map(function(L){return L.id}),this.sourceID=i.sourceID};Ji.prototype.createArrays=function(){this.text=new gf(new Ee(this.layers,this.zoom,function(i){return/^text/.test(i)})),this.icon=new gf(new Ee(this.layers,this.zoom,function(i){return/^icon/.test(i)})),this.glyphOffsetArray=new Pa,this.lineVertexArray=new Ja,this.symbolInstances=new _c},Ji.prototype.calculateGlyphDependencies=function(i,a,h,p,x){for(var E=0;E<i.length;E++)if(a[i.charCodeAt(E)]=!0,(h||p)&&x){var M=np[i.charAt(E)];M&&(a[M.charCodeAt(0)]=!0)}},Ji.prototype.populate=function(i,a,h){var p=this.layers[0],x=p.layout,E=x.get("text-font"),M=x.get("text-field"),L=x.get("icon-image"),V=(M.value.kind!=="constant"||M.value.value instanceof Mn&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),Z=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,Y=x.get("symbol-sort-key");if(this.features=[],!(!V&&!Z)){for(var rt=a.iconDependencies,it=a.glyphDependencies,ht=a.availableImages,_t=new Fi(this.zoom),zt=0,Ct=i;zt<Ct.length;zt+=1){var jt=Ct[zt],Rt=jt.feature,Zt=jt.id,Wt=jt.index,le=jt.sourceLayerIndex,xe=p._featureFilter.needGeometry,ve=or(Rt,xe);if(p._featureFilter.filter(_t,ve,h)){xe||(ve.geometry=Mi(Rt));var Be=void 0;if(V){var Te=p.getValueAndResolveTokens("text-field",ve,h,ht),De=Mn.factory(Te);Km(De)&&(this.hasRTLText=!0),(!this.hasRTLText||So()==="unavailable"||this.hasRTLText&&Ea.isParsed())&&(Be=N_(De,p,ve))}var oi=void 0;if(Z){var Oe=p.getValueAndResolveTokens("icon-image",ve,h,ht);Oe instanceof Pr?oi=Oe:oi=Pr.fromString(Oe)}if(!(!Be&&!oi)){var Ve=this.sortFeaturesByKey?Y.evaluate(ve,{},h):void 0,gi={id:Zt,text:Be,icon:oi,index:Wt,sourceLayerIndex:le,geometry:ve.geometry,properties:Rt.properties,type:rm[Rt.type],sortKey:Ve};if(this.features.push(gi),oi&&(rt[oi.name]=!0),Be){var ni=E.evaluate(ve,{},h).join(","),qi=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ao.vertical)>=0;for(var $i=0,Zi=Be.sections;$i<Zi.length;$i+=1){var Bi=Zi[$i];if(Bi.image)rt[Bi.image.name]=!0;else{var Vi=hc(Be.toString()),hr=Bi.fontStack||ni,pr=it[hr]=it[hr]||{};this.calculateGlyphDependencies(Bi.text,pr,qi,this.allowVerticalPlacement,Vi)}}}}}}x.get("symbol-placement")==="line"&&(this.features=Vg(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Kr,Br){return Kr.sortKey-Br.sortKey})}},Ji.prototype.update=function(i,a,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,a,this.layers,h),this.icon.programConfigurations.updatePaintArrays(i,a,this.layers,h))},Ji.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ji.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ji.prototype.upload=function(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ji.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ji.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ji.prototype.addToLineVertexArray=function(i,a){var h=this.lineVertexArray.length;if(i.segment!==void 0){for(var p=i.dist(a[i.segment+1]),x=i.dist(a[i.segment]),E={},M=i.segment+1;M<a.length;M++)E[M]={x:a[M].x,y:a[M].y,tileUnitDistanceFromAnchor:p},M<a.length-1&&(p+=a[M+1].dist(a[M]));for(var L=i.segment||0;L>=0;L--)E[L]={x:a[L].x,y:a[L].y,tileUnitDistanceFromAnchor:x},L>0&&(x+=a[L-1].dist(a[L]));for(var V=0;V<a.length;V++){var Z=E[V];this.lineVertexArray.emplaceBack(Z.x,Z.y,Z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}},Ji.prototype.addSymbols=function(i,a,h,p,x,E,M,L,V,Z,Y,rt){for(var it=i.indexArray,ht=i.layoutVertexArray,_t=i.segments.prepareSegment(4*a.length,ht,it,this.canOverlap?E.sortKey:void 0),zt=this.glyphOffsetArray.length,Ct=_t.vertexLength,jt=this.allowVerticalPlacement&&M===Ao.vertical?Math.PI/2:0,Rt=E.text&&E.text.sections,Zt=0;Zt<a.length;Zt++){var Wt=a[Zt],le=Wt.tl,xe=Wt.tr,ve=Wt.bl,Be=Wt.br,Te=Wt.tex,De=Wt.pixelOffsetTL,oi=Wt.pixelOffsetBR,Oe=Wt.minFontScaleX,Ve=Wt.minFontScaleY,gi=Wt.glyphOffset,ni=Wt.isSDF,qi=Wt.sectionIndex,$i=_t.vertexLength,Zi=gi[1];Ec(ht,L.x,L.y,le.x,Zi+le.y,Te.x,Te.y,h,ni,De.x,De.y,Oe,Ve),Ec(ht,L.x,L.y,xe.x,Zi+xe.y,Te.x+Te.w,Te.y,h,ni,oi.x,De.y,Oe,Ve),Ec(ht,L.x,L.y,ve.x,Zi+ve.y,Te.x,Te.y+Te.h,h,ni,De.x,oi.y,Oe,Ve),Ec(ht,L.x,L.y,Be.x,Zi+Be.y,Te.x+Te.w,Te.y+Te.h,h,ni,oi.x,oi.y,Oe,Ve),nm(i.dynamicLayoutVertexArray,L,jt),it.emplaceBack($i,$i+1,$i+2),it.emplaceBack($i+1,$i+2,$i+3),_t.vertexLength+=4,_t.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gi[0]),(Zt===a.length-1||qi!==a[Zt+1].sectionIndex)&&i.programConfigurations.populatePaintArrays(ht.length,E,E.index,{},rt,Rt&&Rt[qi])}i.placedSymbolArray.emplaceBack(L.x,L.y,zt,this.glyphOffsetArray.length-zt,Ct,V,Z,L.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],M,0,!1,0,Y)},Ji.prototype._addCollisionDebugVertex=function(i,a,h,p,x,E){return a.emplaceBack(0,0),i.emplaceBack(h.x,h.y,p,x,Math.round(E.x),Math.round(E.y))},Ji.prototype.addCollisionDebugVertices=function(i,a,h,p,x,E,M){var L=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),V=L.vertexLength,Z=x.layoutVertexArray,Y=x.collisionVertexArray,rt=M.anchorX,it=M.anchorY;this._addCollisionDebugVertex(Z,Y,E,rt,it,new pe(i,a)),this._addCollisionDebugVertex(Z,Y,E,rt,it,new pe(h,a)),this._addCollisionDebugVertex(Z,Y,E,rt,it,new pe(h,p)),this._addCollisionDebugVertex(Z,Y,E,rt,it,new pe(i,p)),L.vertexLength+=4;var ht=x.indexArray;ht.emplaceBack(V,V+1),ht.emplaceBack(V+1,V+2),ht.emplaceBack(V+2,V+3),ht.emplaceBack(V+3,V),L.primitiveLength+=4},Ji.prototype.addDebugCollisionBoxes=function(i,a,h,p){for(var x=i;x<a;x++){var E=this.collisionBoxArray.get(x),M=E.x1,L=E.y1,V=E.x2,Z=E.y2;this.addCollisionDebugVertices(M,L,V,Z,p?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,h)}},Ji.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fh(Ch,Pm.members,xu),this.iconCollisionBox=new Fh(Ch,Pm.members,xu);for(var i=0;i<this.symbolInstances.length;i++){var a=this.symbolInstances.get(i);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},Ji.prototype._deserializeCollisionBoxesForSymbol=function(i,a,h,p,x,E,M,L,V){for(var Z={},Y=a;Y<h;Y++){var rt=i.get(Y);Z.textBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},Z.textFeatureIndex=rt.featureIndex;break}for(var it=p;it<x;it++){var ht=i.get(it);Z.verticalTextBox={x1:ht.x1,y1:ht.y1,x2:ht.x2,y2:ht.y2,anchorPointX:ht.anchorPointX,anchorPointY:ht.anchorPointY},Z.verticalTextFeatureIndex=ht.featureIndex;break}for(var _t=E;_t<M;_t++){var zt=i.get(_t);Z.iconBox={x1:zt.x1,y1:zt.y1,x2:zt.x2,y2:zt.y2,anchorPointX:zt.anchorPointX,anchorPointY:zt.anchorPointY},Z.iconFeatureIndex=zt.featureIndex;break}for(var Ct=L;Ct<V;Ct++){var jt=i.get(Ct);Z.verticalIconBox={x1:jt.x1,y1:jt.y1,x2:jt.x2,y2:jt.y2,anchorPointX:jt.anchorPointX,anchorPointY:jt.anchorPointY},Z.verticalIconFeatureIndex=jt.featureIndex;break}return Z},Ji.prototype.deserializeCollisionBoxes=function(i){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var h=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}},Ji.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ji.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ji.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ji.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ji.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ji.prototype.addIndicesForPlacedSymbol=function(i,a){for(var h=i.placedSymbolArray.get(a),p=h.vertexStartIndex+h.numGlyphs*4,x=h.vertexStartIndex;x<p;x+=4)i.indexArray.emplaceBack(x,x+1,x+2),i.indexArray.emplaceBack(x+1,x+2,x+3)},Ji.prototype.getSortedSymbolIndexes=function(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(i),h=Math.cos(i),p=[],x=[],E=[],M=0;M<this.symbolInstances.length;++M){E.push(M);var L=this.symbolInstances.get(M);p.push(Math.round(a*L.anchorX+h*L.anchorY)|0),x.push(L.featureIndex)}return E.sort(function(V,Z){return p[V]-p[Z]||x[Z]-x[V]}),E},Ji.prototype.addToSortKeyRanges=function(i,a){var h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===a?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})},Ji.prototype.sortFeatures=function(i){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var h=0,p=this.symbolInstanceIndexes;h<p.length;h+=1){var x=p[h],E=this.symbolInstances.get(x);this.featureSortOrder.push(E.featureIndex),[E.rightJustifiedTextSymbolIndex,E.centerJustifiedTextSymbolIndex,E.leftJustifiedTextSymbolIndex].forEach(function(M,L,V){M>=0&&V.indexOf(M)===L&&a.addIndicesForPlacedSymbol(a.text,M)}),E.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,E.verticalPlacedTextSymbolIndex),E.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,E.placedIconSymbolIndex),E.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,E.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Ne("SymbolBucket",Ji,{omit:["layers","collisionBoxArray","features","compareText"]}),Ji.MAX_GLYPHS=65535,Ji.addDynamicAttributes=nm;function _g(e,i){return i.replace(/{([^{}]+)}/g,function(a,h){return h in e?String(e[h]):""})}var mp=new Nr({"symbol-placement":new Xt(ue.layout_symbol["symbol-placement"]),"symbol-spacing":new Xt(ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xt(ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ke(ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xt(ue.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xt(ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Xt(ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xt(ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xt(ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ke(ue.layout_symbol["icon-size"]),"icon-text-fit":new Xt(ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xt(ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ke(ue.layout_symbol["icon-image"]),"icon-rotate":new Ke(ue.layout_symbol["icon-rotate"]),"icon-padding":new Xt(ue.layout_symbol["icon-padding"]),"icon-keep-upright":new Xt(ue.layout_symbol["icon-keep-upright"]),"icon-offset":new Ke(ue.layout_symbol["icon-offset"]),"icon-anchor":new Ke(ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xt(ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xt(ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xt(ue.layout_symbol["text-rotation-alignment"]),"text-field":new Ke(ue.layout_symbol["text-field"]),"text-font":new Ke(ue.layout_symbol["text-font"]),"text-size":new Ke(ue.layout_symbol["text-size"]),"text-max-width":new Ke(ue.layout_symbol["text-max-width"]),"text-line-height":new Xt(ue.layout_symbol["text-line-height"]),"text-letter-spacing":new Ke(ue.layout_symbol["text-letter-spacing"]),"text-justify":new Ke(ue.layout_symbol["text-justify"]),"text-radial-offset":new Ke(ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xt(ue.layout_symbol["text-variable-anchor"]),"text-anchor":new Ke(ue.layout_symbol["text-anchor"]),"text-max-angle":new Xt(ue.layout_symbol["text-max-angle"]),"text-writing-mode":new Xt(ue.layout_symbol["text-writing-mode"]),"text-rotate":new Ke(ue.layout_symbol["text-rotate"]),"text-padding":new Xt(ue.layout_symbol["text-padding"]),"text-keep-upright":new Xt(ue.layout_symbol["text-keep-upright"]),"text-transform":new Ke(ue.layout_symbol["text-transform"]),"text-offset":new Ke(ue.layout_symbol["text-offset"]),"text-allow-overlap":new Xt(ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Xt(ue.layout_symbol["text-ignore-placement"]),"text-optional":new Xt(ue.layout_symbol["text-optional"])}),_p=new Nr({"icon-opacity":new Ke(ue.paint_symbol["icon-opacity"]),"icon-color":new Ke(ue.paint_symbol["icon-color"]),"icon-halo-color":new Ke(ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ke(ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ke(ue.paint_symbol["icon-halo-blur"]),"icon-translate":new Xt(ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xt(ue.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ke(ue.paint_symbol["text-opacity"]),"text-color":new Ke(ue.paint_symbol["text-color"],{runtimeType:bs,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Ke(ue.paint_symbol["text-halo-color"]),"text-halo-width":new Ke(ue.paint_symbol["text-halo-width"]),"text-halo-blur":new Ke(ue.paint_symbol["text-halo-blur"]),"text-translate":new Xt(ue.paint_symbol["text-translate"]),"text-translate-anchor":new Xt(ue.paint_symbol["text-translate-anchor"])}),am={paint:_p,layout:mp},ad=function(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Du,this.defaultValue=i};ad.prototype.evaluate=function(i){if(i.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default},ad.prototype.eachChild=function(i){if(!this.defaultValue.isConstant()){var a=this.defaultValue.value;i(a._styleExpression.expression)}},ad.prototype.outputDefined=function(){return!1},ad.prototype.serialize=function(){return null},Ne("FormatSectionOverride",ad,{omit:["defaultValue"]});var Ym=function(e){function i(a){e.call(this,a,am)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.recalculate=function(h,p){if(e.prototype.recalculate.call(this,h,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout.get("symbol-placement")!=="point"?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout.get("symbol-placement")!=="point"?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var x=this.layout.get("text-writing-mode");if(x){for(var E=[],M=0,L=x;M<L.length;M+=1){var V=L[M];E.indexOf(V)<0&&E.push(V)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},i.prototype.getValueAndResolveTokens=function(h,p,x,E){var M=this.layout.get(h).evaluate(p,{},x,E),L=this._unevaluatedLayout._values[h];return!L.isDataDriven()&&!el(L.value)&&M?_g(p.properties,M):M},i.prototype.createBucket=function(h){return new Ji(h)},i.prototype.queryRadius=function(){return 0},i.prototype.queryIntersectsFeature=function(){return!1},i.prototype._setPaintOverrides=function(){for(var h=0,p=am.paint.overridableProperties;h<p.length;h+=1){var x=p[h];if(i.hasPaintOverride(this.layout,x)){var E=this.paint.get(x),M=new ad(E),L=new Hs(M,E.property.specification),V=null;E.value.kind==="constant"||E.value.kind==="source"?V=new xo("source",L):V=new il("composite",L,E.value.zoomStops,E.value._interpolationType),this.paint._values[x]=new tn(E.property,V,E.parameters)}}},i.prototype._handleOverridablePaintPropertyUpdate=function(h,p,x){return!this.layout||p.isDataDriven()||x.isDataDriven()?!1:i.hasPaintOverride(this.layout,h)},i.hasPaintOverride=function(h,p){var x=h.get("text-field"),E=am.paint.properties[p],M=!1,L=function(Y){for(var rt=0,it=Y;rt<it.length;rt+=1){var ht=it[rt];if(E.overrides&&E.overrides.hasOverride(ht)){M=!0;return}}};if(x.value.kind==="constant"&&x.value.value instanceof Mn)L(x.value.value.sections);else if(x.value.kind==="source"){var V=function(Y){if(!M)if(Y instanceof ya&&Dr(Y.value)===El){var rt=Y.value;L(rt.sections)}else Y instanceof yn?L(Y.sections):Y.eachChild(V)},Z=x.value;Z._styleExpression&&V(Z._styleExpression.expression)}return M},i}(Ya),gg=new Nr({"background-color":new Xt(ue.paint_background["background-color"]),"background-pattern":new Ca(ue.paint_background["background-pattern"]),"background-opacity":new Xt(ue.paint_background["background-opacity"])}),Jm={paint:gg},yg=function(e){function i(a){e.call(this,a,Jm)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i}(Ya),Qm=new Nr({"raster-opacity":new Xt(ue.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xt(ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xt(ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xt(ue.paint_raster["raster-brightness-max"]),"raster-saturation":new Xt(ue.paint_raster["raster-saturation"]),"raster-contrast":new Xt(ue.paint_raster["raster-contrast"]),"raster-resampling":new Xt(ue.paint_raster["raster-resampling"]),"raster-fade-duration":new Xt(ue.paint_raster["raster-fade-duration"])}),$m={paint:Qm},sm=function(e){function i(a){e.call(this,a,$m)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i}(Ya);function om(e){var i=[],a=e.id;return a===void 0&&i.push({message:"layers."+a+': missing required property "id"'}),e.render===void 0&&i.push({message:"layers."+a+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&i.push({message:"layers."+a+': property "renderingMode" must be either "2d" or "3d"'}),i}var vg=function(e){function i(a){e.call(this,a,{}),this.implementation=a}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},i.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},i.prototype.recalculate=function(){},i.prototype.updateTransitions=function(){},i.prototype.hasTransition=function(){},i.prototype.serialize=function(){},i.prototype.onAdd=function(h){this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},i.prototype.onRemove=function(h){this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},i}(Ya),xg={circle:ei,heatmap:ur,hillshade:ul,fill:y_,"fill-extrusion":A_,line:Np,symbol:Ym,background:yg,raster:sm};function bg(e){return e.type==="custom"?new vg(e):new xg[e.type](e)}var t_=me.HTMLImageElement,lm=me.HTMLCanvasElement,um=me.HTMLVideoElement,sd=me.ImageData,cl=me.ImageBitmap,Mo=function(i,a,h,p){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(a,p)};Mo.prototype.update=function(i,a,h){var p=i.width,x=i.height,E=(!this.size||this.size[0]!==p||this.size[1]!==x)&&!h,M=this,L=M.context,V=L.gl;if(this.useMipmap=!!(a&&a.useMipmap),V.bindTexture(V.TEXTURE_2D,this.texture),L.pixelStoreUnpackFlipY.set(!1),L.pixelStoreUnpack.set(1),L.pixelStoreUnpackPremultiplyAlpha.set(this.format===V.RGBA&&(!a||a.premultiply!==!1)),E)this.size=[p,x],i instanceof t_||i instanceof lm||i instanceof um||i instanceof sd||cl&&i instanceof cl?V.texImage2D(V.TEXTURE_2D,0,this.format,this.format,V.UNSIGNED_BYTE,i):V.texImage2D(V.TEXTURE_2D,0,this.format,p,x,0,this.format,V.UNSIGNED_BYTE,i.data);else{var Z=h||{x:0,y:0},Y=Z.x,rt=Z.y;i instanceof t_||i instanceof lm||i instanceof um||i instanceof sd||cl&&i instanceof cl?V.texSubImage2D(V.TEXTURE_2D,0,Y,rt,V.RGBA,V.UNSIGNED_BYTE,i):V.texSubImage2D(V.TEXTURE_2D,0,Y,rt,p,x,V.RGBA,V.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&V.generateMipmap(V.TEXTURE_2D)},Mo.prototype.bind=function(i,a,h){var p=this,x=p.context,E=x.gl;E.bindTexture(E.TEXTURE_2D,this.texture),h===E.LINEAR_MIPMAP_NEAREST&&!this.isSizePowerOfTwo()&&(h=E.LINEAR),i!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,i),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,h||i),this.filter=i),a!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,a),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,a),this.wrap=a)},Mo.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1===0},Mo.prototype.destroy=function(){var i=this.context,a=i.gl;a.deleteTexture(this.texture),this.texture=null};var gp=function(i){var a=this;this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};gp.prototype.trigger=function(){var i=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){i._triggered=!1,i._callback()},0))},gp.prototype.remove=function(){delete this._channel,this._callback=function(){}};var od=function(i,a,h){this.target=i,this.parent=a,this.mapId=h,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Jl(["receive","process"],this),this.invoker=new gp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=sn()?i:me};od.prototype.send=function(i,a,h,p,x){var E=this;x===void 0&&(x=!1);var M=Math.round(Math.random()*1e18).toString(36).substring(0,10);h&&(this.callbacks[M]=h);var L=Ba(this.globalScope)?void 0:[];return this.target.postMessage({id:M,type:i,hasCallback:!!h,targetMapId:p,mustQueue:x,sourceMapId:this.mapId,data:Zr(a,L)},L),{cancel:function(){h&&delete E.callbacks[M],E.target.postMessage({id:M,type:"<cancel>",targetMapId:p,sourceMapId:E.mapId})}}},od.prototype.receive=function(i){var a=i.data,h=a.id;if(h&&!(a.targetMapId&&this.mapId!==a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[h];var p=this.cancelCallbacks[h];delete this.cancelCallbacks[h],p&&p()}else sn()||a.mustQueue?(this.tasks[h]=a,this.taskQueue.push(h),this.invoker.trigger()):this.processTask(h,a)},od.prototype.process=function(){if(this.taskQueue.length){var i=this.taskQueue.shift(),a=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(i,a)}},od.prototype.processTask=function(i,a){var h=this;if(a.type==="<response>"){var p=this.callbacks[i];delete this.callbacks[i],p&&(a.error?p(Fn(a.error)):p(null,Fn(a.data)))}else{var x=!1,E=Ba(this.globalScope)?void 0:[],M=a.hasCallback?function(rt,it){x=!0,delete h.cancelCallbacks[i],h.target.postMessage({id:i,type:"<response>",sourceMapId:h.mapId,error:rt?Zr(rt):null,data:Zr(it,E)},E)}:function(rt){x=!0},L=null,V=Fn(a.data);if(this.parent[a.type])L=this.parent[a.type](a.sourceMapId,V,M);else if(this.parent.getWorkerSource){var Z=a.type.split("."),Y=this.parent.getWorkerSource(a.sourceMapId,Z[0],V.source);L=Y[Z[1]](V,M)}else M(new Error("Could not find function "+a.type));!x&&L&&L.cancel&&(this.cancelCallbacks[i]=L.cancel)}},od.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};function wg(e,i,a){i=Math.pow(2,a)-i-1;var h=yp(e*256,i*256,a),p=yp((e+1)*256,(i+1)*256,a);return h[0]+","+h[1]+","+p[0]+","+p[1]}function yp(e,i,a){var h=2*Math.PI*6378137/256/Math.pow(2,a),p=e*h-2*Math.PI*6378137/2,x=i*h-2*Math.PI*6378137/2;return[p,x]}var Sn=function(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))};Sn.prototype.setNorthEast=function(i){return this._ne=i instanceof xr?new xr(i.lng,i.lat):xr.convert(i),this},Sn.prototype.setSouthWest=function(i){return this._sw=i instanceof xr?new xr(i.lng,i.lat):xr.convert(i),this},Sn.prototype.extend=function(i){var a=this._sw,h=this._ne,p,x;if(i instanceof xr)p=i,x=i;else if(i instanceof Sn){if(p=i._sw,x=i._ne,!p||!x)return this}else{if(Array.isArray(i))if(i.length===4||i.every(Array.isArray)){var E=i;return this.extend(Sn.convert(E))}else{var M=i;return this.extend(xr.convert(M))}return this}return!a&&!h?(this._sw=new xr(p.lng,p.lat),this._ne=new xr(x.lng,x.lat)):(a.lng=Math.min(p.lng,a.lng),a.lat=Math.min(p.lat,a.lat),h.lng=Math.max(x.lng,h.lng),h.lat=Math.max(x.lat,h.lat)),this},Sn.prototype.getCenter=function(){return new xr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Sn.prototype.getSouthWest=function(){return this._sw},Sn.prototype.getNorthEast=function(){return this._ne},Sn.prototype.getNorthWest=function(){return new xr(this.getWest(),this.getNorth())},Sn.prototype.getSouthEast=function(){return new xr(this.getEast(),this.getSouth())},Sn.prototype.getWest=function(){return this._sw.lng},Sn.prototype.getSouth=function(){return this._sw.lat},Sn.prototype.getEast=function(){return this._ne.lng},Sn.prototype.getNorth=function(){return this._ne.lat},Sn.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Sn.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Sn.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Sn.prototype.contains=function(i){var a=xr.convert(i),h=a.lng,p=a.lat,x=this._sw.lat<=p&&p<=this._ne.lat,E=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(E=this._sw.lng>=h&&h>=this._ne.lng),x&&E},Sn.convert=function(i){return!i||i instanceof Sn?i:new Sn(i)};var e_=63710088e-1,xr=function(i,a){if(isNaN(i)||isNaN(a))throw new Error("Invalid LngLat object: ("+i+", "+a+")");if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};xr.prototype.wrap=function(){return new xr(zo(this.lng,-180,180),this.lat)},xr.prototype.toArray=function(){return[this.lng,this.lat]},xr.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},xr.prototype.distanceTo=function(i){var a=Math.PI/180,h=this.lat*a,p=i.lat*a,x=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((i.lng-this.lng)*a),E=e_*Math.acos(Math.min(x,1));return E},xr.prototype.toBounds=function(i){i===void 0&&(i=0);var a=40075017,h=360*i/a,p=h/Math.cos(Math.PI/180*this.lat);return new Sn(new xr(this.lng-p,this.lat-h),new xr(this.lng+p,this.lat+h))},xr.convert=function(i){if(i instanceof xr)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new xr(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new xr(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var vp=2*Math.PI*e_;function i_(e){return vp*Math.cos(e*Math.PI/180)}function xp(e){return(180+e)/360}function bp(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function yf(e,i){return e/i_(i)}function Sg(e){return e*360-180}function wp(e){var i=180-e*360;return 360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90}function Tg(e,i){return e*i_(wp(i))}function r_(e){return 1/Math.cos(e*Math.PI/180)}var vf=function(i,a,h){h===void 0&&(h=0),this.x=+i,this.y=+a,this.z=+h};vf.fromLngLat=function(i,a){a===void 0&&(a=0);var h=xr.convert(i);return new vf(xp(h.lng),bp(h.lat),yf(a,h.lat))},vf.prototype.toLngLat=function(){return new xr(Sg(this.x),wp(this.y))},vf.prototype.toAltitude=function(){return Tg(this.z,this.y)},vf.prototype.meterInMercatorCoordinateUnits=function(){return 1/vp*r_(wp(this.y))};var Lh=function(i,a,h){this.z=i,this.x=a,this.y=h,this.key=Wd(0,i,i,a,h)};Lh.prototype.equals=function(i){return this.z===i.z&&this.x===i.x&&this.y===i.y},Lh.prototype.url=function(i,a){var h=wg(this.x,this.y,this.z),p=n_(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)},Lh.prototype.getTilePoint=function(i){var a=Math.pow(2,this.z);return new pe((i.x*a-this.x)*Re,(i.y*a-this.y)*Re)},Lh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var hm=function(i,a){this.wrap=i,this.canonical=a,this.key=Wd(i,a.z,a.z,a.x,a.y)},Wr=function(i,a,h,p,x){this.overscaledZ=i,this.wrap=a,this.canonical=new Lh(h,+p,+x),this.key=Wd(a,i,h,p,x)};Wr.prototype.equals=function(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)},Wr.prototype.scaledTo=function(i){var a=this.canonical.z-i;return i>this.canonical.z?new Wr(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wr(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)},Wr.prototype.calculateScaledKey=function(i,a){var h=this.canonical.z-i;return i>this.canonical.z?Wd(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y):Wd(this.wrap*+a,i,i,this.canonical.x>>h,this.canonical.y>>h)},Wr.prototype.isChildOf=function(i){if(i.wrap!==this.wrap)return!1;var a=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a},Wr.prototype.children=function(i){if(this.overscaledZ>=i)return[new Wr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,h=this.canonical.x*2,p=this.canonical.y*2;return[new Wr(a,this.wrap,a,h,p),new Wr(a,this.wrap,a,h+1,p),new Wr(a,this.wrap,a,h,p+1),new Wr(a,this.wrap,a,h+1,p+1)]},Wr.prototype.isLessThan=function(i){return this.wrap<i.wrap?!0:this.wrap>i.wrap?!1:this.overscaledZ<i.overscaledZ?!0:this.overscaledZ>i.overscaledZ?!1:this.canonical.x<i.canonical.x?!0:this.canonical.x>i.canonical.x?!1:this.canonical.y<i.canonical.y},Wr.prototype.wrapped=function(){return new Wr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Wr.prototype.unwrapTo=function(i){return new Wr(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)},Wr.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Wr.prototype.toUnwrapped=function(){return new hm(this.wrap,this.canonical)},Wr.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Wr.prototype.getTilePoint=function(i){return this.canonical.getTilePoint(new vf(i.x-this.wrap,i.y))};function Wd(e,i,a,h,p){e*=2,e<0&&(e=e*-1-1);var x=1<<a;return(x*x*e+x*p+h).toString(36)+a.toString(36)+i.toString(36)}function n_(e,i,a){for(var h="",p,x=e;x>0;x--)p=1<<x-1,h+=(i&p?1:0)+(a&p?2:0);return h}Ne("CanonicalTileID",Lh),Ne("OverscaledTileID",Wr,{omit:["posMatrix"]});var Rh=function(i,a,h){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return rr('"'+h+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var p=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=h||"mapbox";for(var x=0;x<p;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(p,x)]=this.data[this._idx(p-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,p)]=this.data[this._idx(x,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Rh.prototype.get=function(i,a){var h=new Uint8Array(this.data.buffer),p=this._idx(i,a)*4,x=this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox;return x(h[p],h[p+1],h[p+2])},Rh.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Rh.prototype._idx=function(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)},Rh.prototype._unpackMapbox=function(i,a,h){return(i*256*256+a*256+h)/10-1e4},Rh.prototype._unpackTerrarium=function(i,a,h){return i*256+a+h/256-32768},Rh.prototype.getPixels=function(){return new Wi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Rh.prototype.backfillBorder=function(i,a,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");var p=a*this.dim,x=a*this.dim+this.dim,E=h*this.dim,M=h*this.dim+this.dim;switch(a){case-1:p=x-1;break;case 1:x=p+1;break}switch(h){case-1:E=M-1;break;case 1:M=E+1;break}for(var L=-a*this.dim,V=-h*this.dim,Z=E;Z<M;Z++)for(var Y=p;Y<x;Y++)this.data[this._idx(Y,Z)]=i.data[this._idx(Y+L,Z+V)]},Ne("DEMData",Rh);function Eg(e,i){var a={};if(!i)return a;for(var h=function(){var E=x[p],M=E.layerIds.map(function(Y){return i.getLayer(Y)}).filter(Boolean);if(M.length!==0){E.layers=M,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(function(Y){return M.filter(function(rt){return rt.id===Y})[0]}));for(var L=0,V=M;L<V.length;L+=1){var Z=V[L];a[Z.id]=E}}},p=0,x=e;p<x.length;p+=1)h();return a}var Sp=function(i){this._stringToNumber={},this._numberToString=[];for(var a=0;a<i.length;a++){var h=i[a];this._stringToNumber[h]=a,this._numberToString[a]=h}};Sp.prototype.encode=function(i){return this._stringToNumber[i]},Sp.prototype.decode=function(i){return this._numberToString[i]};var Kd=function(i,a,h,p,x){this.type="Feature",this._vectorTileFeature=i,i._z=a,i._x=h,i._y=p,this.properties=i.properties,this.id=x},cm={geometry:{configurable:!0}};cm.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},cm.geometry.set=function(e){this._geometry=e},Kd.prototype.toJSON=function(){var i={geometry:this.geometry};for(var a in this)a==="_geometry"||a==="_vectorTileFeature"||(i[a]=this[a]);return i},Object.defineProperties(Kd.prototype,cm);var ld=function(){this.state={},this.stateChanges={},this.deletedStates={}};ld.prototype.updateState=function(i,a,h){var p=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},Or(this.stateChanges[i][p],h),this.deletedStates[i]===null){this.deletedStates[i]={};for(var x in this.state[i])x!==p&&(this.deletedStates[i][x]=null)}else{var E=this.deletedStates[i]&&this.deletedStates[i][p]===null;if(E){this.deletedStates[i][p]={};for(var M in this.state[i][p])h[M]||(this.deletedStates[i][p][M]=null)}else for(var L in h){var V=this.deletedStates[i]&&this.deletedStates[i][p]&&this.deletedStates[i][p][L]===null;V&&delete this.deletedStates[i][p][L]}}},ld.prototype.removeFeatureState=function(i,a,h){var p=this.deletedStates[i]===null;if(!p){var x=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},h&&a!==void 0)this.deletedStates[i][x]!==null&&(this.deletedStates[i][x]=this.deletedStates[i][x]||{},this.deletedStates[i][x][h]=null);else if(a!==void 0){var E=this.stateChanges[i]&&this.stateChanges[i][x];if(E){this.deletedStates[i][x]={};for(h in this.stateChanges[i][x])this.deletedStates[i][x][h]=null}else this.deletedStates[i][x]=null}else this.deletedStates[i]=null}},ld.prototype.getState=function(i,a){var h=String(a),p=this.state[i]||{},x=this.stateChanges[i]||{},E=Or({},p[h],x[h]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){var M=this.deletedStates[i][a];if(M===null)return{};for(var L in M)delete E[L]}return E},ld.prototype.initializeTileState=function(i,a){i.setFeatureState(this.state,a)},ld.prototype.coalesceChanges=function(i,a){var h={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var x={};for(var E in this.stateChanges[p])this.state[p][E]||(this.state[p][E]={}),Or(this.state[p][E],this.stateChanges[p][E]),x[E]=this.state[p][E];h[p]=x}for(var M in this.deletedStates){this.state[M]=this.state[M]||{};var L={};if(this.deletedStates[M]===null)for(var V in this.state[M])L[V]={},this.state[M][V]={};else for(var Z in this.deletedStates[M]){var Y=this.deletedStates[M][Z]===null;if(Y)this.state[M][Z]={};else for(var rt=0,it=Object.keys(this.deletedStates[M][Z]);rt<it.length;rt+=1){var ht=it[rt];delete this.state[M][Z][ht]}L[Z]=this.state[M][Z]}h[M]=h[M]||{},Or(h[M],L)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(var _t in i){var zt=i[_t];zt.setFeatureState(h,a)}};var Bh=function(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new vu(Re,16,0),this.grid3D=new vu(Re,16,0),this.featureIndexArray=new hf,this.promoteId=a};Bh.prototype.insert=function(i,a,h,p,x,E){var M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,x);for(var L=E?this.grid3D:this.grid,V=0;V<a.length;V++){for(var Z=a[V],Y=[1/0,1/0,-1/0,-1/0],rt=0;rt<Z.length;rt++){var it=Z[rt];Y[0]=Math.min(Y[0],it.x),Y[1]=Math.min(Y[1],it.y),Y[2]=Math.max(Y[2],it.x),Y[3]=Math.max(Y[3],it.y)}Y[0]<Re&&Y[1]<Re&&Y[2]>=0&&Y[3]>=0&&L.insert(M,Y[0],Y[1],Y[2],Y[3])}},Bh.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new pf.VectorTile(new sp(this.rawTileData)).layers,this.sourceLayerCoder=new Sp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Bh.prototype.query=function(i,a,h,p){var x=this;this.loadVTLayers();for(var E=i.params||{},M=Re/i.tileSize/i.scale,L=Zu(E.filter),V=i.queryGeometry,Z=i.queryPadding*M,Y=s_(V),rt=this.grid.query(Y.minX-Z,Y.minY-Z,Y.maxX+Z,Y.maxY+Z),it=s_(i.cameraQueryGeometry),ht=this.grid3D.query(it.minX-Z,it.minY-Z,it.maxX+Z,it.maxY+Z,function(le,xe,ve,Be){return Ys(i.cameraQueryGeometry,le-Z,xe-Z,ve+Z,Be+Z)}),_t=0,zt=ht;_t<zt.length;_t+=1){var Ct=zt[_t];rt.push(Ct)}rt.sort(Ig);for(var jt={},Rt,Zt=function(le){var xe=rt[le];if(xe!==Rt){Rt=xe;var ve=x.featureIndexArray.get(xe),Be=null;x.loadMatchingFeature(jt,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,L,E.layers,E.availableImages,a,h,p,function(Te,De,oi){return Be||(Be=Mi(Te)),De.queryIntersectsFeature(V,Te,oi,Be,x.z,i.transform,M,i.pixelPosMatrix)})}},Wt=0;Wt<rt.length;Wt++)Zt(Wt);return jt},Bh.prototype.loadMatchingFeature=function(i,a,h,p,x,E,M,L,V,Z,Y){var rt=this.bucketLayerIDs[a];if(!(E&&!so(E,rt))){var it=this.sourceLayerCoder.decode(h),ht=this.vtLayers[it],_t=ht.feature(p);if(x.needGeometry){var zt=or(_t,!0);if(!x.filter(new Fi(this.tileID.overscaledZ),zt,this.tileID.canonical))return}else if(!x.filter(new Fi(this.tileID.overscaledZ),_t))return;for(var Ct=this.getId(_t,it),jt=0;jt<rt.length;jt++){var Rt=rt[jt];if(!(E&&E.indexOf(Rt)<0)){var Zt=L[Rt];if(Zt){var Wt={};Ct!==void 0&&Z&&(Wt=Z.getState(Zt.sourceLayer||"_geojsonTileLayer",Ct));var le=Or({},V[Rt]);le.paint=a_(le.paint,Zt.paint,_t,Wt,M),le.layout=a_(le.layout,Zt.layout,_t,Wt,M);var xe=!Y||Y(_t,Zt,Wt);if(xe){var ve=new Kd(_t,this.z,this.x,this.y,Ct);ve.layer=le;var Be=i[Rt];Be===void 0&&(Be=i[Rt]=[]),Be.push({featureIndex:p,feature:ve,intersectionZ:xe})}}}}}},Bh.prototype.lookupSymbolFeatures=function(i,a,h,p,x,E,M,L){var V={};this.loadVTLayers();for(var Z=Zu(x),Y=0,rt=i;Y<rt.length;Y+=1){var it=rt[Y];this.loadMatchingFeature(V,h,p,it,Z,E,M,L,a)}return V},Bh.prototype.hasLayer=function(i){for(var a=0,h=this.bucketLayerIDs;a<h.length;a+=1)for(var p=h[a],x=0,E=p;x<E.length;x+=1){var M=E[x];if(i===M)return!0}return!1},Bh.prototype.getId=function(i,a){var h=i.id;if(this.promoteId){var p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[a];h=i.properties[p],typeof h=="boolean"&&(h=Number(h))}return h},Ne("FeatureIndex",Bh,{omit:["rawTileData","sourceLayerCoder"]});function a_(e,i,a,h,p){return La(e,function(x,E){var M=i instanceof Ar?i.get(E):null;return M&&M.evaluate?M.evaluate(a,h,p):M})}function s_(e){for(var i=1/0,a=1/0,h=-1/0,p=-1/0,x=0,E=e;x<E.length;x+=1){var M=E[x];i=Math.min(i,M.x),a=Math.min(a,M.y),h=Math.max(h,M.x),p=Math.max(p,M.y)}return{minX:i,minY:a,maxX:h,maxY:p}}function Ig(e,i){return i-e}var Cg=3e4,Kn=function(i,a){this.tileID=i,this.uid=Ls(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Kn.prototype.registerFadeDuration=function(i){var a=i+this.timeAdded;a<Bs.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},Kn.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Kn.prototype.loadVectorData=function(i,a,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",!i){this.collisionBoxArray=new Xe;return}i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=Eg(i.buckets,a.style),this.hasSymbolBuckets=!1;for(var p in this.buckets){var x=this.buckets[p];if(x instanceof Ji)if(this.hasSymbolBuckets=!0,h)x.justReloaded=!0;else break}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var M=this.buckets[E];if(M instanceof Ji&&M.hasRTLText){this.hasRTLText=!0,hs();break}}this.queryPadding=0;for(var L in this.buckets){var V=this.buckets[L];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(L).queryRadius(V))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)},Kn.prototype.unloadVectorData=function(){for(var i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Kn.prototype.getBucket=function(i){return this.buckets[i.id]},Kn.prototype.upload=function(i){for(var a in this.buckets){var h=this.buckets[a];h.uploadPending()&&h.upload(i)}var p=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Mo(i,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Mo(i,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},Kn.prototype.prepare=function(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)},Kn.prototype.queryRenderedFeatures=function(i,a,h,p,x,E,M,L,V,Z){return!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData?{}:this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:Z,transform:L,params:M,queryPadding:this.queryPadding*V},i,a,h)},Kn.prototype.querySourceFeatures=function(i,a){var h=this.latestFeatureIndex;if(!(!h||!h.rawTileData)){var p=h.loadVTLayers(),x=a?a.sourceLayer:"",E=p._geojsonTileLayer||p[x];if(E)for(var M=Zu(a&&a.filter),L=this.tileID.canonical,V=L.z,Z=L.x,Y=L.y,rt={z:V,x:Z,y:Y},it=0;it<E.length;it++){var ht=E.feature(it);if(M.needGeometry){var _t=or(ht,!0);if(!M.filter(new Fi(this.tileID.overscaledZ),_t,this.tileID.canonical))continue}else if(!M.filter(new Fi(this.tileID.overscaledZ),ht))continue;var zt=h.getId(ht,x),Ct=new Kd(ht,V,Z,Y,zt);Ct.tile=rt,i.push(Ct)}}},Kn.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Kn.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Kn.prototype.setExpiryData=function(i){var a=this.expirationTime;if(i.cacheControl){var h=Lo(i.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+h["max-age"]*1e3)}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){var p=Date.now(),x=!1;if(this.expirationTime>p)x=!1;else if(!a)x=!0;else if(this.expirationTime<a)x=!0;else{var E=this.expirationTime-a;E?this.expirationTime=p+Math.max(E,Cg):x=!0}x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Kn.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Kn.prototype.setFeatureState=function(i,a){if(!(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)){var h=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(a.style.hasLayer(p)){var x=this.buckets[p],E=x.layers[0].sourceLayer||"_geojsonTileLayer",M=h[E],L=i[E];if(!(!M||!L||Object.keys(L).length===0)){x.update(L,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});var V=a&&a.style&&a.style.getLayer(p);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(x)))}}}},Kn.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Kn.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Bs.now()},Kn.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Kn.prototype.setHoldDuration=function(i){this.symbolFadeHoldUntil=Bs.now()+i},Kn.prototype.setDependencies=function(i,a){for(var h={},p=0,x=a;p<x.length;p+=1){var E=x[p];h[E]=!0}this.dependencies[i]=h},Kn.prototype.hasDependency=function(i,a){for(var h=0,p=i;h<p.length;h+=1){var x=p[h],E=this.dependencies[x];if(E)for(var M=0,L=a;M<L.length;M+=1){var V=L[M];if(E[V])return!0}}return!1};var fm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],io=me.performance,dm=function(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},io.mark(this._marks.start)};dm.prototype.finish=function(){io.mark(this._marks.end);var i=io.getEntriesByName(this._marks.measure);return i.length===0&&(io.measure(this._marks.measure,this._marks.start,this._marks.end),i=io.getEntriesByName(this._marks.measure),io.clearMarks(this._marks.start),io.clearMarks(this._marks.end),io.clearMeasures(this._marks.measure)),i},v.Actor=od,v.AlphaImage=Ui,v.CanonicalTileID=Lh,v.CollisionBoxArray=Xe,v.Color=Ki,v.DEMData=Rh,v.DataConstantProperty=Xt,v.DictionaryCoder=Sp,v.EXTENT=Re,v.ErrorEvent=ii,v.EvaluationParameters=Fi,v.Event=Ht,v.Evented=tr,v.FeatureIndex=Bh,v.FillBucket=Kl,v.FillExtrusionBucket=Iu,v.ImageAtlas=Vd,v.ImagePosition=lp,v.LineBucket=Wn,v.LngLat=xr,v.LngLatBounds=Sn,v.MercatorCoordinate=vf,v.ONE_EM=la,v.OverscaledTileID=Wr,v.Point=pe,v.Point$1=pe,v.Properties=Nr,v.Protobuf=sp,v.RGBAImage=Wi,v.RequestManager=ln,v.RequestPerformance=dm,v.ResourceType=Nt,v.SegmentVector=Gr,v.SourceFeatureState=ld,v.StructArrayLayout1ui2=jl,v.StructArrayLayout2f1f2i16=sl,v.StructArrayLayout2i4=Vl,v.StructArrayLayout3ui6=Ln,v.StructArrayLayout4i8=uf,v.SymbolBucket=Ji,v.Texture=Mo,v.Tile=Kn,v.Transitionable=Gn,v.Uniform1f=wt,v.Uniform1i=pt,v.Uniform2f=bt,v.Uniform3f=xt,v.Uniform4f=Et,v.UniformColor=kt,v.UniformMatrix4f=Kt,v.UnwrappedTileID=hm,v.ValidationError=Ue,v.WritingMode=Ao,v.ZoomHistory=Sa,v.add=ut,v.addDynamicAttributes=nm,v.asyncAll=ml,v.bezier=ns,v.bindAll=Jl,v.browser=Bs,v.cacheEntryPossiblyAdded=dt,v.clamp=fa,v.clearTileCache=Q,v.clipLine=Um,v.clone=Tu,v.clone$1=qr,v.clone$2=J,v.collisionCircleLayout=V_,v.config=zi,v.create=Su,v.create$1=lr,v.create$2=cf,v.createCommonjsModule=C,v.createExpression=xa,v.createLayout=Mr,v.createStyleLayer=bg,v.cross=Bt,v.deepEqual=Qt,v.dot=Ft,v.dot$1=ce,v.ease=Fa,v.emitValidationErrors=wh,v.endsWith=Do,v.enforceCacheSizeLimit=tt,v.evaluateSizeForFeature=Qp,v.evaluateSizeForZoom=Zd,v.evaluateVariableOffset=jm,v.evented=Wu,v.extend=Or,v.featureFilter=Zu,v.filterObject=Ra,v.fromRotation=wu,v.getAnchorAlignment=hp,v.getAnchorJustification=Hd,v.getArrayBuffer=St,v.getImage=Ie,v.getJSON=ft,v.getRTLTextPluginStatus=So,v.getReferrer=N,v.getVideo=We,v.identity=w,v.invert=t,v.isChar=ke,v.isMapboxURL=un,v.keysDifference=Fs,v.makeRequest=nt,v.mapObject=La,v.mercatorXfromLng=xp,v.mercatorYfromLat=bp,v.mercatorZfromAltitude=yf,v.mul=X,v.multiply=o,v.mvt=pf,v.nextPowerOfTwo=gs,v.normalize=Tt,v.number=$r,v.offscreenCanvasSupported=Pt,v.ortho=R,v.parseGlyphPBF=eg,v.pbf=sp,v.performSymbolLayout=im,v.perspective=k,v.pick=_l,v.plugin=Ea,v.polygonIntersectsPolygon=ri,v.postMapLoadEvent=ho,v.postTurnstileEvent=bl,v.potpack=rg,v.refProperties=fm,v.register=Ne,v.registerForPluginStateChange=Th,v.renderColorRamp=Xr,v.rotate=yc,v.rotateX=S,v.rotateZ=z,v.scale=g,v.scale$1=$t,v.scale$2=vt,v.setCacheLimits=lt,v.setRTLTextPlugin=Is,v.sphericalToCartesian=Fo,v.sqrLen=Ze,v.styleSpec=ue,v.sub=Dt,v.symbolSize=Er,v.transformMat3=Ot,v.transformMat4=we,v.translate=f,v.triggerPluginCompletionEvent=ra,v.uniqueId=Ls,v.validateCustomStyleLayer=om,v.validateLight=ar,v.validateStyle=Xi,v.values=an,v.vectorTile=pf,v.version=fe,v.warnOnce=rr,v.webpSupported=uo,v.window=me,v.wrap=zo}),Ep(["./shared"],function(v){function C(N){var O=typeof N;if(O==="number"||O==="boolean"||O==="string"||N===void 0||N===null)return JSON.stringify(N);if(Array.isArray(N)){for(var H="[",W=0,nt=N;W<nt.length;W+=1){var ft=nt[W];H+=C(ft)+","}return H+"]"}for(var St=Object.keys(N).sort(),It="{",Lt=0;Lt<St.length;Lt++)It+=JSON.stringify(St[Lt])+":"+C(N[St[Lt]])+",";return It+"}"}function fe(N){for(var O="",H=0,W=v.refProperties;H<W.length;H+=1){var nt=W[H];O+="/"+C(N[nt])}return O}function Yr(N,O){for(var H={},W=0;W<N.length;W++){var nt=O&&O[N[W].id]||fe(N[W]);O&&(O[N[W].id]=nt);var ft=H[nt];ft||(ft=H[nt]=[]),ft.push(N[W])}var St=[];for(var It in H)St.push(H[It]);return St}var Jr=function(O){this.keyCache={},O&&this.replace(O)};Jr.prototype.replace=function(O){this._layerConfigs={},this._layers={},this.update(O,[])},Jr.prototype.update=function(O,H){for(var W=this,nt=0,ft=O;nt<ft.length;nt+=1){var St=ft[nt];this._layerConfigs[St.id]=St;var It=this._layers[St.id]=v.createStyleLayer(St);It._featureFilter=v.featureFilter(It.filter),this.keyCache[St.id]&&delete this.keyCache[St.id]}for(var Lt=0,Vt=H;Lt<Vt.length;Lt+=1){var qt=Vt[Lt];delete this.keyCache[qt],delete this._layerConfigs[qt],delete this._layers[qt]}this.familiesBySource={};for(var ee=Yr(v.values(this._layerConfigs),this.keyCache),Jt=0,se=ee;Jt<se.length;Jt+=1){var Ae=se[Jt],Ie=Ae.map(function(tr){return W._layers[tr.id]}),We=Ie[0];if(We.visibility!=="none"){var di=We.source||"",mi=this.familiesBySource[di];mi||(mi=this.familiesBySource[di]={});var Ht=We.sourceLayer||"_geojsonTileLayer",ii=mi[Ht];ii||(ii=mi[Ht]=[]),ii.push(Ie)}}};var pe=1,ha=function(O){var H={},W=[];for(var nt in O){var ft=O[nt],St=H[nt]={};for(var It in ft){var Lt=ft[+It];if(!(!Lt||Lt.bitmap.width===0||Lt.bitmap.height===0)){var Vt={x:0,y:0,w:Lt.bitmap.width+2*pe,h:Lt.bitmap.height+2*pe};W.push(Vt),St[It]={rect:Vt,metrics:Lt.metrics}}}}var qt=v.potpack(W),ee=qt.w,Jt=qt.h,se=new v.AlphaImage({width:ee||1,height:Jt||1});for(var Ae in O){var Ie=O[Ae];for(var We in Ie){var di=Ie[+We];if(!(!di||di.bitmap.width===0||di.bitmap.height===0)){var mi=H[Ae][We].rect;v.AlphaImage.copy(di.bitmap,se,{x:0,y:0},{x:mi.x+pe,y:mi.y+pe},di.bitmap)}}}this.image=se,this.positions=H};v.register("GlyphAtlas",ha);var me=function(O){this.tileID=new v.OverscaledTileID(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId};me.prototype.parse=function(O,H,W,nt,ft){var St=this;this.status="parsing",this.data=O,this.collisionBoxArray=new v.CollisionBoxArray;var It=new v.DictionaryCoder(Object.keys(O.layers).sort()),Lt=new v.FeatureIndex(this.tileID,this.promoteId);Lt.bucketLayerIDs=[];var Vt={},qt={featureIndex:Lt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W},ee=H.familiesBySource[this.source];for(var Jt in ee){var se=O.layers[Jt];if(se){se.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+Jt+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Ae=It.encode(Jt),Ie=[],We=0;We<se.length;We++){var di=se.feature(We),mi=Lt.getId(di,Jt);Ie.push({feature:di,id:mi,index:We,sourceLayerIndex:Ae})}for(var Ht=0,ii=ee[Jt];Ht<ii.length;Ht+=1){var tr=ii[Ht],Qr=tr[0];if(!(Qr.minzoom&&this.zoom<Math.floor(Qr.minzoom))&&!(Qr.maxzoom&&this.zoom>=Qr.maxzoom)&&Qr.visibility!=="none"){Qt(tr,this.zoom,W);var Ei=Vt[Qr.id]=Qr.createBucket({index:Lt.bucketLayerIDs.length,layers:tr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ae,sourceID:this.source});Ei.populate(Ie,qt,this.tileID.canonical),Lt.bucketLayerIDs.push(tr.map(function(pi){return pi.id}))}}}}var er,xs,qn,_a,as=v.mapObject(qt.glyphDependencies,function(pi){return Object.keys(pi).map(Number)});Object.keys(as).length?nt.send("getGlyphs",{uid:this.uid,stacks:as},function(pi,qa){er||(er=pi,xs=qa,Vs.call(St))}):xs={};var No=Object.keys(qt.iconDependencies);No.length?nt.send("getImages",{icons:No,source:this.source,tileID:this.tileID,type:"icons"},function(pi,qa){er||(er=pi,qn=qa,Vs.call(St))}):qn={};var mr=Object.keys(qt.patternDependencies);mr.length?nt.send("getImages",{icons:mr,source:this.source,tileID:this.tileID,type:"patterns"},function(pi,qa){er||(er=pi,_a=qa,Vs.call(St))}):_a={},Vs.call(this);function Vs(){if(er)return ft(er);if(xs&&qn&&_a){var pi=new ha(xs),qa=new v.ImageAtlas(qn,_a);for(var Tl in Vt){var _e=Vt[Tl];_e instanceof v.SymbolBucket?(Qt(_e.layers,this.zoom,W),v.performSymbolLayout(_e,xs,pi.positions,qn,qa.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):_e.hasPattern&&(_e instanceof v.LineBucket||_e instanceof v.FillBucket||_e instanceof v.FillExtrusionBucket)&&(Qt(_e.layers,this.zoom,W),_e.addFeatures(qt,this.tileID.canonical,qa.patternPositions))}this.status="done",ft(null,{buckets:v.values(Vt).filter(function(fo){return!fo.isEmpty()}),featureIndex:Lt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pi.image,imageAtlas:qa,glyphMap:this.returnDependencies?xs:null,iconMap:this.returnDependencies?qn:null,glyphPositions:this.returnDependencies?pi.positions:null})}}};function Qt(N,O,H){for(var W=new v.EvaluationParameters(O),nt=0,ft=N;nt<ft.length;nt+=1){var St=ft[nt];St.recalculate(W,H)}}function ca(N,O){var H=v.getArrayBuffer(N.request,function(W,nt,ft,St){W?O(W):nt&&O(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(nt)),rawData:nt,cacheControl:ft,expires:St})});return function(){H.cancel(),O()}}var In=function(O,H,W,nt){this.actor=O,this.layerIndex=H,this.availableImages=W,this.loadVectorData=nt||ca,this.loading={},this.loaded={}};In.prototype.loadTile=function(O,H){var W=this,nt=O.uid;this.loading||(this.loading={});var ft=O&&O.request&&O.request.collectResourceTiming?new v.RequestPerformance(O.request):!1,St=this.loading[nt]=new me(O);St.abort=this.loadVectorData(O,function(It,Lt){if(delete W.loading[nt],It||!Lt)return St.status="done",W.loaded[nt]=St,H(It);var Vt=Lt.rawData,qt={};Lt.expires&&(qt.expires=Lt.expires),Lt.cacheControl&&(qt.cacheControl=Lt.cacheControl);var ee={};if(ft){var Jt=ft.finish();Jt&&(ee.resourceTiming=JSON.parse(JSON.stringify(Jt)))}St.vectorTile=Lt.vectorTile,St.parse(Lt.vectorTile,W.layerIndex,W.availableImages,W.actor,function(se,Ae){if(se||!Ae)return H(se);H(null,v.extend({rawTileData:Vt.slice(0)},Ae,qt,ee))}),W.loaded=W.loaded||{},W.loaded[nt]=St})},In.prototype.reloadTile=function(O,H){var W=this,nt=this.loaded,ft=O.uid,St=this;if(nt&&nt[ft]){var It=nt[ft];It.showCollisionBoxes=O.showCollisionBoxes;var Lt=function(Vt,qt){var ee=It.reloadCallback;ee&&(delete It.reloadCallback,It.parse(It.vectorTile,St.layerIndex,W.availableImages,St.actor,ee)),H(Vt,qt)};It.status==="parsing"?It.reloadCallback=Lt:It.status==="done"&&(It.vectorTile?It.parse(It.vectorTile,this.layerIndex,this.availableImages,this.actor,Lt):Lt())}},In.prototype.abortTile=function(O,H){var W=this.loading,nt=O.uid;W&&W[nt]&&W[nt].abort&&(W[nt].abort(),delete W[nt]),H()},In.prototype.removeTile=function(O,H){var W=this.loaded,nt=O.uid;W&&W[nt]&&delete W[nt],H()};var ns=v.window.ImageBitmap,Fa=function(){this.loaded={}};Fa.prototype.loadTile=function(O,H){var W=O.uid,nt=O.encoding,ft=O.rawImageData,St=ns&&ft instanceof ns?this.getImageData(ft):ft,It=new v.DEMData(W,St,nt);this.loaded=this.loaded||{},this.loaded[W]=It,H(null,It)},Fa.prototype.getImageData=function(O){(!this.offscreenCanvas||!this.offscreenCanvasContext)&&(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);var H=this.offscreenCanvasContext.getImageData(-1,-1,O.width+2,O.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:H.width,height:H.height},H.data)},Fa.prototype.removeTile=function(O){var H=this.loaded,W=O.uid;H&&H[W]&&delete H[W]};var fa=zo;function zo(N,O){var H=N&&N.type,W;if(H==="FeatureCollection")for(W=0;W<N.features.length;W++)zo(N.features[W],O);else if(H==="GeometryCollection")for(W=0;W<N.geometries.length;W++)zo(N.geometries[W],O);else if(H==="Feature")zo(N.geometry,O);else if(H==="Polygon")ml(N.coordinates,O);else if(H==="MultiPolygon")for(W=0;W<N.coordinates.length;W++)ml(N.coordinates[W],O);return N}function ml(N,O){if(N.length!==0){an(N[0],O);for(var H=1;H<N.length;H++)an(N[H],!O)}}function an(N,O){for(var H=0,W=0,nt=N.length,ft=nt-1;W<nt;ft=W++)H+=(N[W][0]-N[ft][0])*(N[ft][1]+N[W][1]);H>=0!=!!O&&N.reverse()}var Fs=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,Or=function(O){this._feature=O,this.extent=v.EXTENT,this.type=O.type,this.properties=O.tags,"id"in O&&!isNaN(O.id)&&(this.id=parseInt(O.id,10))};Or.prototype.loadGeometry=function(){if(this._feature.type===1){for(var O=[],H=0,W=this._feature.geometry;H<W.length;H+=1){var nt=W[H];O.push([new v.Point$1(nt[0],nt[1])])}return O}else{for(var ft=[],St=0,It=this._feature.geometry;St<It.length;St+=1){for(var Lt=It[St],Vt=[],qt=0,ee=Lt;qt<ee.length;qt+=1){var Jt=ee[qt];Vt.push(new v.Point$1(Jt[0],Jt[1]))}ft.push(Vt)}return ft}},Or.prototype.toGeoJSON=function(O,H,W){return Fs.call(this,O,H,W)};var _l=function(O){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=O.length,this._features=O};_l.prototype.feature=function(O){return new Or(this._features[O])};var da=v.vectorTile.VectorTileFeature,Ls=pa;function pa(N,O){this.options=O||{},this.features=N,this.length=N.length}pa.prototype.feature=function(N){return new gs(this.features[N],this.options.extent)};function gs(N,O){this.id=typeof N.id=="number"?N.id:void 0,this.type=N.type,this.rawGeometry=N.type===1?[N.geometry]:N.geometry,this.properties=N.tags,this.extent=O||4096}gs.prototype.loadGeometry=function(){var N=this.rawGeometry;this.geometry=[];for(var O=0;O<N.length;O++){for(var H=N[O],W=[],nt=0;nt<H.length;nt++)W.push(new v.Point$1(H[nt][0],H[nt][1]));this.geometry.push(W)}return this.geometry},gs.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var N=this.geometry,O=1/0,H=-1/0,W=1/0,nt=-1/0,ft=0;ft<N.length;ft++)for(var St=N[ft],It=0;It<St.length;It++){var Lt=St[It];O=Math.min(O,Lt.x),H=Math.max(H,Lt.x),W=Math.min(W,Lt.y),nt=Math.max(nt,Lt.y)}return[O,W,H,nt]},gs.prototype.toGeoJSON=da.prototype.toGeoJSON;var Rs=Ra,Jl=Ra,Do=qr,La=Ls;function Ra(N){var O=new v.pbf;return so(N,O),O.finish()}function qr(N,O){O=O||{};var H={};for(var W in N)H[W]=new Ls(N[W].features,O),H[W].name=W,H[W].version=O.version,H[W].extent=O.extent;return Ra({layers:H})}function so(N,O){for(var H in N.layers)O.writeMessage(3,ko,N.layers[H])}function ko(N,O){O.writeVarintField(15,N.version||1),O.writeStringField(1,N.name||""),O.writeVarintField(5,N.extent||4096);var H,W={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<N.length;H++)W.feature=N.feature(H),O.writeMessage(2,rr,W);var nt=W.keys;for(H=0;H<nt.length;H++)O.writeStringField(3,nt[H]);var ft=W.values;for(H=0;H<ft.length;H++)O.writeMessage(4,Lo,ft[H])}function rr(N,O){var H=N.feature;H.id!==void 0&&O.writeVarintField(1,H.id),O.writeMessage(2,mn,N),O.writeVarintField(3,H.type),O.writeMessage(4,sn,H)}function mn(N,O){var H=N.feature,W=N.keys,nt=N.values,ft=N.keycache,St=N.valuecache;for(var It in H.properties){var Lt=ft[It];typeof Lt>"u"&&(W.push(It),Lt=W.length-1,ft[It]=Lt),O.writeVarint(Lt);var Vt=H.properties[It],qt=typeof Vt;qt!=="string"&&qt!=="boolean"&&qt!=="number"&&(Vt=JSON.stringify(Vt));var ee=qt+":"+Vt,Jt=St[ee];typeof Jt>"u"&&(nt.push(Vt),Jt=nt.length-1,St[ee]=Jt),O.writeVarint(Jt)}}function Ql(N,O){return(O<<3)+(N&7)}function Fo(N){return N<<1^N>>31}function sn(N,O){for(var H=N.loadGeometry(),W=N.type,nt=0,ft=0,St=H.length,It=0;It<St;It++){var Lt=H[It],Vt=1;W===1&&(Vt=Lt.length),O.writeVarint(Ql(1,Vt));for(var qt=W===3?Lt.length-1:Lt.length,ee=0;ee<qt;ee++){ee===1&&W!==1&&O.writeVarint(Ql(2,qt-1));var Jt=Lt[ee].x-nt,se=Lt[ee].y-ft;O.writeVarint(Fo(Jt)),O.writeVarint(Fo(se)),nt+=Jt,ft+=se}W===3&&O.writeVarint(Ql(7,1))}}function Lo(N,O){var H=typeof N;H==="string"?O.writeStringField(1,N):H==="boolean"?O.writeBooleanField(7,N):H==="number"&&(N%1!==0?O.writeDoubleField(3,N):N<0?O.writeSVarintField(6,N):O.writeVarintField(5,N))}Rs.fromVectorTileJs=Jl,Rs.fromGeojsonVt=Do,Rs.GeoJSONWrapper=La;function On(N,O,H,W,nt,ft){if(!(nt-W<=H)){var St=W+nt>>1;Ba(N,O,St,W,nt,ft%2),On(N,O,H,W,St-1,ft+1),On(N,O,H,St+1,nt,ft+1)}}function Ba(N,O,H,W,nt,ft){for(;nt>W;){if(nt-W>600){var St=nt-W+1,It=H-W+1,Lt=Math.log(St),Vt=.5*Math.exp(2*Lt/3),qt=.5*Math.sqrt(Lt*Vt*(St-Vt)/St)*(It-St/2<0?-1:1),ee=Math.max(W,Math.floor(H-It*Vt/St+qt)),Jt=Math.min(nt,Math.floor(H+(St-It)*Vt/St+qt));Ba(N,O,H,ee,Jt,ft)}var se=O[2*H+ft],Ae=W,Ie=nt;for(Qi(N,O,W,H),O[2*nt+ft]>se&&Qi(N,O,W,nt);Ae<Ie;){for(Qi(N,O,Ae,Ie),Ae++,Ie--;O[2*Ae+ft]<se;)Ae++;for(;O[2*Ie+ft]>se;)Ie--}O[2*W+ft]===se?Qi(N,O,W,Ie):(Ie++,Qi(N,O,Ie,nt)),Ie<=H&&(W=Ie+1),H<=Ie&&(nt=Ie-1)}}function Qi(N,O,H,W){Oa(N,H,W),Oa(O,2*H,2*W),Oa(O,2*H+1,2*W+1)}function Oa(N,O,H){var W=N[O];N[O]=N[H],N[H]=W}function oo(N,O,H,W,nt,ft,St){for(var It=[0,N.length-1,0],Lt=[],Vt,qt;It.length;){var ee=It.pop(),Jt=It.pop(),se=It.pop();if(Jt-se<=St){for(var Ae=se;Ae<=Jt;Ae++)Vt=O[2*Ae],qt=O[2*Ae+1],Vt>=H&&Vt<=nt&&qt>=W&&qt<=ft&&Lt.push(N[Ae]);continue}var Ie=Math.floor((se+Jt)/2);Vt=O[2*Ie],qt=O[2*Ie+1],Vt>=H&&Vt<=nt&&qt>=W&&qt<=ft&&Lt.push(N[Ie]);var We=(ee+1)%2;(ee===0?H<=Vt:W<=qt)&&(It.push(se),It.push(Ie-1),It.push(We)),(ee===0?nt>=Vt:ft>=qt)&&(It.push(Ie+1),It.push(Jt),It.push(We))}return Lt}function oh(N,O,H,W,nt,ft){for(var St=[0,N.length-1,0],It=[],Lt=nt*nt;St.length;){var Vt=St.pop(),qt=St.pop(),ee=St.pop();if(qt-ee<=ft){for(var Jt=ee;Jt<=qt;Jt++)$l(O[2*Jt],O[2*Jt+1],H,W)<=Lt&&It.push(N[Jt]);continue}var se=Math.floor((ee+qt)/2),Ae=O[2*se],Ie=O[2*se+1];$l(Ae,Ie,H,W)<=Lt&&It.push(N[se]);var We=(Vt+1)%2;(Vt===0?H-nt<=Ae:W-nt<=Ie)&&(St.push(ee),St.push(se-1),St.push(We)),(Vt===0?H+nt>=Ae:W+nt>=Ie)&&(St.push(se+1),St.push(qt),St.push(We))}return It}function $l(N,O,H,W){var nt=N-H,ft=O-W;return nt*nt+ft*ft}var lo=function(N){return N[0]},ma=function(N){return N[1]},Cn=function(O,H,W,nt,ft){H===void 0&&(H=lo),W===void 0&&(W=ma),nt===void 0&&(nt=64),ft===void 0&&(ft=Float64Array),this.nodeSize=nt,this.points=O;for(var St=O.length<65536?Uint16Array:Uint32Array,It=this.ids=new St(O.length),Lt=this.coords=new ft(O.length*2),Vt=0;Vt<O.length;Vt++)It[Vt]=Vt,Lt[2*Vt]=H(O[Vt]),Lt[2*Vt+1]=W(O[Vt]);On(It,Lt,nt,0,It.length-1,0)};Cn.prototype.range=function(O,H,W,nt){return oo(this.ids,this.coords,O,H,W,nt,this.nodeSize)},Cn.prototype.within=function(O,H,W){return oh(this.ids,this.coords,O,H,W,this.nodeSize)};var Bs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(N){return N}},zi=function(O){this.options=ys(Object.create(Bs),O),this.trees=new Array(this.options.maxZoom+1)};zi.prototype.load=function(O){var H=this.options,W=H.log,nt=H.minZoom,ft=H.maxZoom,St=H.nodeSize;W&&console.time("total time");var It="prepare "+O.length+" points";W&&console.time(It),this.points=O;for(var Lt=[],Vt=0;Vt<O.length;Vt++)O[Vt].geometry&&Lt.push(on(O[Vt],Vt));this.trees[ft+1]=new Cn(Lt,ln,un,St,Float32Array),W&&console.timeEnd(It);for(var qt=ft;qt>=nt;qt--){var ee=+Date.now();Lt=this._cluster(Lt,qt),this.trees[qt]=new Cn(Lt,ln,un,St,Float32Array),W&&console.log("z%d: %d clusters in %dms",qt,Lt.length,+Date.now()-ee)}return W&&console.timeEnd("total time"),this},zi.prototype.getClusters=function(O,H){var W=((O[0]+180)%360+360)%360-180,nt=Math.max(-90,Math.min(90,O[1])),ft=O[2]===180?180:((O[2]+180)%360+360)%360-180,St=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)W=-180,ft=180;else if(W>ft){var It=this.getClusters([W,nt,180,St],H),Lt=this.getClusters([-180,nt,ft,St],H);return It.concat(Lt)}for(var Vt=this.trees[this._limitZoom(H)],qt=Vt.range(Va(W),bi(St),Va(ft),bi(nt)),ee=[],Jt=0,se=qt;Jt<se.length;Jt+=1){var Ae=se[Jt],Ie=Vt.points[Ae];ee.push(Ie.numPoints?_n(Ie):this.points[Ie.index])}return ee},zi.prototype.getChildren=function(O){var H=this._getOriginId(O),W=this._getOriginZoom(O),nt="No cluster with the specified id.",ft=this.trees[W];if(!ft)throw new Error(nt);var St=ft.points[H];if(!St)throw new Error(nt);for(var It=this.options.radius/(this.options.extent*Math.pow(2,W-1)),Lt=ft.within(St.x,St.y,It),Vt=[],qt=0,ee=Lt;qt<ee.length;qt+=1){var Jt=ee[qt],se=ft.points[Jt];se.parentId===O&&Vt.push(se.numPoints?_n(se):this.points[se.index])}if(Vt.length===0)throw new Error(nt);return Vt},zi.prototype.getLeaves=function(O,H,W){H=H||10,W=W||0;var nt=[];return this._appendLeaves(nt,O,H,W,0),nt},zi.prototype.getTile=function(O,H,W){var nt=this.trees[this._limitZoom(O)],ft=Math.pow(2,O),St=this.options,It=St.extent,Lt=St.radius,Vt=Lt/It,qt=(W-Vt)/ft,ee=(W+1+Vt)/ft,Jt={features:[]};return this._addTileFeatures(nt.range((H-Vt)/ft,qt,(H+1+Vt)/ft,ee),nt.points,H,W,ft,Jt),H===0&&this._addTileFeatures(nt.range(1-Vt/ft,qt,1,ee),nt.points,ft,W,ft,Jt),H===ft-1&&this._addTileFeatures(nt.range(0,qt,Vt/ft,ee),nt.points,-1,W,ft,Jt),Jt.features.length?Jt:null},zi.prototype.getClusterExpansionZoom=function(O){for(var H=this._getOriginZoom(O)-1;H<=this.options.maxZoom;){var W=this.getChildren(O);if(H++,W.length!==1)break;O=W[0].properties.cluster_id}return H},zi.prototype._appendLeaves=function(O,H,W,nt,ft){for(var St=this.getChildren(H),It=0,Lt=St;It<Lt.length;It+=1){var Vt=Lt[It],qt=Vt.properties;if(qt&&qt.cluster?ft+qt.point_count<=nt?ft+=qt.point_count:ft=this._appendLeaves(O,qt.cluster_id,W,nt,ft):ft<nt?ft++:O.push(Vt),O.length===W)break}return ft},zi.prototype._addTileFeatures=function(O,H,W,nt,ft,St){for(var It=0,Lt=O;It<Lt.length;It+=1){var Vt=Lt[It],qt=H[Vt],ee=qt.numPoints,Jt={type:1,geometry:[[Math.round(this.options.extent*(qt.x*ft-W)),Math.round(this.options.extent*(qt.y*ft-nt))]],tags:ee?Qn(qt):this.points[qt.index].properties},se=void 0;ee?se=qt.id:this.options.generateId?se=qt.index:this.points[qt.index].id&&(se=this.points[qt.index].id),se!==void 0&&(Jt.id=se),St.features.push(Jt)}},zi.prototype._limitZoom=function(O){return Math.max(this.options.minZoom,Math.min(+O,this.options.maxZoom+1))},zi.prototype._cluster=function(O,H){for(var W=[],nt=this.options,ft=nt.radius,St=nt.extent,It=nt.reduce,Lt=nt.minPoints,Vt=ft/(St*Math.pow(2,H)),qt=0;qt<O.length;qt++){var ee=O[qt];if(!(ee.zoom<=H)){ee.zoom=H;for(var Jt=this.trees[H+1],se=Jt.within(ee.x,ee.y,Vt),Ae=ee.numPoints||1,Ie=Ae,We=0,di=se;We<di.length;We+=1){var mi=di[We],Ht=Jt.points[mi];Ht.zoom>H&&(Ie+=Ht.numPoints||1)}if(Ie>=Lt){for(var ii=ee.x*Ae,tr=ee.y*Ae,Qr=It&&Ae>1?this._map(ee,!0):null,Ei=(qt<<5)+(H+1)+this.points.length,er=0,xs=se;er<xs.length;er+=1){var qn=xs[er],_a=Jt.points[qn];if(!(_a.zoom<=H)){_a.zoom=H;var as=_a.numPoints||1;ii+=_a.x*as,tr+=_a.y*as,_a.parentId=Ei,It&&(Qr||(Qr=this._map(ee,!0)),It(Qr,this._map(_a)))}}ee.parentId=Ei,W.push(uo(ii/Ie,tr/Ie,Ei,Ie,Qr))}else if(W.push(ee),Ie>1)for(var No=0,mr=se;No<mr.length;No+=1){var Vs=mr[No],pi=Jt.points[Vs];pi.zoom<=H||(pi.zoom=H,W.push(pi))}}}return W},zi.prototype._getOriginId=function(O){return O-this.points.length>>5},zi.prototype._getOriginZoom=function(O){return(O-this.points.length)%32},zi.prototype._map=function(O,H){if(O.numPoints)return H?ys({},O.properties):O.properties;var W=this.points[O.index].properties,nt=this.options.map(W);return H&&nt===W?ys({},nt):nt};function uo(N,O,H,W,nt){return{x:N,y:O,zoom:1/0,id:H,parentId:-1,numPoints:W,properties:nt}}function on(N,O){var H=N.geometry.coordinates,W=H[0],nt=H[1];return{x:Va(W),y:bi(nt),zoom:1/0,index:O,parentId:-1}}function _n(N){return{type:"Feature",id:N.id,properties:Qn(N),geometry:{type:"Point",coordinates:[Ro(N.x),Os(N.y)]}}}function Qn(N){var O=N.numPoints,H=O>=1e4?Math.round(O/1e3)+"k":O>=1e3?Math.round(O/100)/10+"k":O;return ys(ys({},N.properties),{cluster:!0,cluster_id:N.id,point_count:O,point_count_abbreviated:H})}function Va(N){return N/360+.5}function bi(N){var O=Math.sin(N*Math.PI/180),H=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return H<0?0:H>1?1:H}function Ro(N){return(N-.5)*360}function Os(N){var O=(180-N*360)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function ys(N,O){for(var H in O)N[H]=O[H];return N}function ln(N){return N.x}function un(N){return N.y}function Vn(N,O,H,W){for(var nt=W,ft=H-O>>1,St=H-O,It,Lt=N[O],Vt=N[O+1],qt=N[H],ee=N[H+1],Jt=O+3;Jt<H;Jt+=3){var se=$n(N[Jt],N[Jt+1],Lt,Vt,qt,ee);if(se>nt)It=Jt,nt=se;else if(se===nt){var Ae=Math.abs(Jt-ft);Ae<St&&(It=Jt,St=Ae)}}nt>W&&(It-O>3&&Vn(N,O,It,W),N[It+2]=nt,H-It>3&&Vn(N,It,H,W))}function $n(N,O,H,W,nt,ft){var St=nt-H,It=ft-W;if(St!==0||It!==0){var Lt=((N-H)*St+(O-W)*It)/(St*St+It*It);Lt>1?(H=nt,W=ft):Lt>0&&(H+=St*Lt,W+=It*Lt)}return St=N-H,It=O-W,St*St+It*It}function Ua(N,O,H,W){var nt={id:typeof N>"u"?null:N,type:O,geometry:H,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return Au(nt),nt}function Au(N){var O=N.geometry,H=N.type;if(H==="Point"||H==="MultiPoint"||H==="LineString")Bo(N,O);else if(H==="Polygon"||H==="MultiLineString")for(var W=0;W<O.length;W++)Bo(N,O[W]);else if(H==="MultiPolygon")for(W=0;W<O.length;W++)for(var nt=0;nt<O[W].length;nt++)Bo(N,O[W][nt])}function Bo(N,O){for(var H=0;H<O.length;H+=3)N.minX=Math.min(N.minX,O[H]),N.minY=Math.min(N.minY,O[H+1]),N.maxX=Math.max(N.maxX,O[H]),N.maxY=Math.max(N.maxY,O[H+1])}function Pn(N,O){var H=[];if(N.type==="FeatureCollection")for(var W=0;W<N.features.length;W++)ta(H,N.features[W],O,W);else N.type==="Feature"?ta(H,N,O):ta(H,{geometry:N},O);return H}function ta(N,O,H,W){if(O.geometry){var nt=O.geometry.coordinates,ft=O.geometry.type,St=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),It=[],Lt=O.id;if(H.promoteId?Lt=O.properties[H.promoteId]:H.generateId&&(Lt=W||0),ft==="Point")gl(nt,It);else if(ft==="MultiPoint")for(var Vt=0;Vt<nt.length;Vt++)gl(nt[Vt],It);else if(ft==="LineString")yl(nt,It,St,!1);else if(ft==="MultiLineString")if(H.lineMetrics){for(Vt=0;Vt<nt.length;Vt++)It=[],yl(nt[Vt],It,St,!1),N.push(Ua(Lt,"LineString",It,O.properties));return}else ea(nt,It,St,!1);else if(ft==="Polygon")ea(nt,It,St,!0);else if(ft==="MultiPolygon")for(Vt=0;Vt<nt.length;Vt++){var qt=[];ea(nt[Vt],qt,St,!0),It.push(qt)}else if(ft==="GeometryCollection"){for(Vt=0;Vt<O.geometry.geometries.length;Vt++)ta(N,{id:Lt,geometry:O.geometry.geometries[Vt],properties:O.properties},H,W);return}else throw new Error("Input data is not a valid GeoJSON object.");N.push(Ua(Lt,ft,It,O.properties))}}function gl(N,O){O.push(vl(N[0])),O.push(xl(N[1])),O.push(0)}function yl(N,O,H,W){for(var nt,ft,St=0,It=0;It<N.length;It++){var Lt=vl(N[It][0]),Vt=xl(N[It][1]);O.push(Lt),O.push(Vt),O.push(0),It>0&&(W?St+=(nt*Vt-Lt*ft)/2:St+=Math.sqrt(Math.pow(Lt-nt,2)+Math.pow(Vt-ft,2))),nt=Lt,ft=Vt}var qt=O.length-3;O[2]=1,Vn(O,0,qt,H),O[qt+2]=1,O.size=Math.abs(St),O.start=0,O.end=O.size}function ea(N,O,H,W){for(var nt=0;nt<N.length;nt++){var ft=[];yl(N[nt],ft,H,W),O.push(ft)}}function vl(N){return N/360+.5}function xl(N){var O=Math.sin(N*Math.PI/180),H=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return H<0?0:H>1?1:H}function Un(N,O,H,W,nt,ft,St,It){if(H/=O,W/=O,ft>=H&&St<W)return N;if(St<H||ft>=W)return null;for(var Lt=[],Vt=0;Vt<N.length;Vt++){var qt=N[Vt],ee=qt.geometry,Jt=qt.type,se=nt===0?qt.minX:qt.minY,Ae=nt===0?qt.maxX:qt.maxY;if(se>=H&&Ae<W){Lt.push(qt);continue}else if(Ae<H||se>=W)continue;var Ie=[];if(Jt==="Point"||Jt==="MultiPoint")bl(ee,Ie,H,W,nt);else if(Jt==="LineString")Oo(ee,Ie,H,W,nt,!1,It.lineMetrics);else if(Jt==="MultiLineString")Vr(ee,Ie,H,W,nt,!1);else if(Jt==="Polygon")Vr(ee,Ie,H,W,nt,!0);else if(Jt==="MultiPolygon")for(var We=0;We<ee.length;We++){var di=[];Vr(ee[We],di,H,W,nt,!0),di.length&&Ie.push(di)}if(Ie.length){if(It.lineMetrics&&Jt==="LineString"){for(We=0;We<Ie.length;We++)Lt.push(Ua(qt.id,Jt,Ie[We],qt.tags));continue}(Jt==="LineString"||Jt==="MultiLineString")&&(Ie.length===1?(Jt="LineString",Ie=Ie[0]):Jt="MultiLineString"),(Jt==="Point"||Jt==="MultiPoint")&&(Jt=Ie.length===3?"Point":"MultiPoint"),Lt.push(Ua(qt.id,Jt,Ie,qt.tags))}}return Lt.length?Lt:null}function bl(N,O,H,W,nt){for(var ft=0;ft<N.length;ft+=3){var St=N[ft+nt];St>=H&&St<=W&&(O.push(N[ft]),O.push(N[ft+1]),O.push(N[ft+2]))}}function Oo(N,O,H,W,nt,ft,St){for(var It=ho(N),Lt=nt===0?tu:Uo,Vt=N.start,qt,ee,Jt=0;Jt<N.length-3;Jt+=3){var se=N[Jt],Ae=N[Jt+1],Ie=N[Jt+2],We=N[Jt+3],di=N[Jt+4],mi=nt===0?se:Ae,Ht=nt===0?We:di,ii=!1;St&&(qt=Math.sqrt(Math.pow(se-We,2)+Math.pow(Ae-di,2))),mi<H?Ht>H&&(ee=Lt(It,se,Ae,We,di,H),St&&(It.start=Vt+qt*ee)):mi>W?Ht<W&&(ee=Lt(It,se,Ae,We,di,W),St&&(It.start=Vt+qt*ee)):Vo(It,se,Ae,Ie),Ht<H&&mi>=H&&(ee=Lt(It,se,Ae,We,di,H),ii=!0),Ht>W&&mi<=W&&(ee=Lt(It,se,Ae,We,di,W),ii=!0),!ft&&ii&&(St&&(It.end=Vt+qt*ee),O.push(It),It=ho(N)),St&&(Vt+=qt)}var tr=N.length-3;se=N[tr],Ae=N[tr+1],Ie=N[tr+2],mi=nt===0?se:Ae,mi>=H&&mi<=W&&Vo(It,se,Ae,Ie),tr=It.length-3,ft&&tr>=3&&(It[tr]!==It[0]||It[tr+1]!==It[1])&&Vo(It,It[0],It[1],It[2]),It.length&&O.push(It)}function ho(N){var O=[];return O.size=N.size,O.start=N.start,O.end=N.end,O}function Vr(N,O,H,W,nt,ft){for(var St=0;St<N.length;St++)Oo(N[St],O,H,W,nt,ft,!1)}function Vo(N,O,H,W){N.push(O),N.push(H),N.push(W)}function tu(N,O,H,W,nt,ft){var St=(ft-O)/(W-O);return N.push(ft),N.push(H+(nt-H)*St),N.push(1),St}function Uo(N,O,H,W,nt,ft){var St=(ft-H)/(nt-H);return N.push(O+(W-O)*St),N.push(ft),N.push(1),St}function Na(N,O){var H=O.buffer/O.extent,W=N,nt=Un(N,1,-1-H,H,0,-1,2,O),ft=Un(N,1,1-H,2+H,0,-1,2,O);return(nt||ft)&&(W=Un(N,1,-H,1+H,0,-1,2,O)||[],nt&&(W=co(nt,1).concat(W)),ft&&(W=W.concat(co(ft,-1)))),W}function co(N,O){for(var H=[],W=0;W<N.length;W++){var nt=N[W],ft=nt.type,St;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")St=Nn(nt.geometry,O);else if(ft==="MultiLineString"||ft==="Polygon"){St=[];for(var It=0;It<nt.geometry.length;It++)St.push(Nn(nt.geometry[It],O))}else if(ft==="MultiPolygon")for(St=[],It=0;It<nt.geometry.length;It++){for(var Lt=[],Vt=0;Vt<nt.geometry[It].length;Vt++)Lt.push(Nn(nt.geometry[It][Vt],O));St.push(Lt)}H.push(Ua(nt.id,ft,St,nt.tags))}return H}function Nn(N,O){var H=[];H.size=N.size,N.start!==void 0&&(H.start=N.start,H.end=N.end);for(var W=0;W<N.length;W+=3)H.push(N[W]+O,N[W+1],N[W+2]);return H}function vs(N,O){if(N.transformed)return N;var H=1<<N.z,W=N.x,nt=N.y,ft,St,It;for(ft=0;ft<N.features.length;ft++){var Lt=N.features[ft],Vt=Lt.geometry,qt=Lt.type;if(Lt.geometry=[],qt===1)for(St=0;St<Vt.length;St+=2)Lt.geometry.push(eu(Vt[St],Vt[St+1],O,H,W,nt));else for(St=0;St<Vt.length;St++){var ee=[];for(It=0;It<Vt[St].length;It+=2)ee.push(eu(Vt[St][It],Vt[St][It+1],O,H,W,nt));Lt.geometry.push(ee)}}return N.transformed=!0,N}function eu(N,O,H,W,nt,ft){return[Math.round(H*(N*W-nt)),Math.round(H*(O*W-ft))]}function iu(N,O,H,W,nt){for(var ft=O===nt.maxZoom?0:nt.tolerance/((1<<O)*nt.extent),St={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:H,y:W,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},It=0;It<N.length;It++){St.numFeatures++,ru(St,N[It],ft,nt);var Lt=N[It].minX,Vt=N[It].minY,qt=N[It].maxX,ee=N[It].maxY;Lt<St.minX&&(St.minX=Lt),Vt<St.minY&&(St.minY=Vt),qt>St.maxX&&(St.maxX=qt),ee>St.maxY&&(St.maxY=ee)}return St}function ru(N,O,H,W){var nt=O.geometry,ft=O.type,St=[];if(ft==="Point"||ft==="MultiPoint")for(var It=0;It<nt.length;It+=3)St.push(nt[It]),St.push(nt[It+1]),N.numPoints++,N.numSimplified++;else if(ft==="LineString")wl(St,nt,N,H,!1,!1);else if(ft==="MultiLineString"||ft==="Polygon")for(It=0;It<nt.length;It++)wl(St,nt[It],N,H,ft==="Polygon",It===0);else if(ft==="MultiPolygon")for(var Lt=0;Lt<nt.length;Lt++){var Vt=nt[Lt];for(It=0;It<Vt.length;It++)wl(St,Vt[It],N,H,!0,It===0)}if(St.length){var qt=O.tags||null;if(ft==="LineString"&&W.lineMetrics){qt={};for(var ee in O.tags)qt[ee]=O.tags[ee];qt.mapbox_clip_start=nt.start/nt.size,qt.mapbox_clip_end=nt.end/nt.size}var Jt={geometry:St,type:ft==="Polygon"||ft==="MultiPolygon"?3:ft==="LineString"||ft==="MultiLineString"?2:1,tags:qt};O.id!==null&&(Jt.id=O.id),N.features.push(Jt)}}function wl(N,O,H,W,nt,ft){var St=W*W;if(W>0&&O.size<(nt?St:W)){H.numPoints+=O.length/3;return}for(var It=[],Lt=0;Lt<O.length;Lt+=3)(W===0||O[Lt+2]>St)&&(H.numSimplified++,It.push(O[Lt]),It.push(O[Lt+1])),H.numPoints++;nt&&Sl(It,ft),N.push(It)}function Sl(N,O){for(var H=0,W=0,nt=N.length,ft=nt-2;W<nt;ft=W,W+=2)H+=(N[W]-N[ft])*(N[W+1]+N[ft+1]);if(H>0===O)for(W=0,nt=N.length;W<nt/2;W+=2){var St=N[W],It=N[W+1];N[W]=N[nt-2-W],N[W+1]=N[nt-1-W],N[nt-2-W]=St,N[nt-1-W]=It}}function dt(N,O){return new tt(N,O)}function tt(N,O){O=this.options=lt(Object.create(this.options),O);var H=O.debug;if(H&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var W=Pn(N,O);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),W=Na(W,O),W.length&&this.splitTile(W,0,0,0),H&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}tt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},tt.prototype.splitTile=function(N,O,H,W,nt,ft,St){for(var It=[N,O,H,W],Lt=this.options,Vt=Lt.debug;It.length;){W=It.pop(),H=It.pop(),O=It.pop(),N=It.pop();var qt=1<<O,ee=Q(O,H,W),Jt=this.tiles[ee];if(!Jt&&(Vt>1&&console.time("creation"),Jt=this.tiles[ee]=iu(N,O,H,W,Lt),this.tileCoords.push({z:O,x:H,y:W}),Vt)){Vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,H,W,Jt.numFeatures,Jt.numPoints,Jt.numSimplified),console.timeEnd("creation"));var se="z"+O;this.stats[se]=(this.stats[se]||0)+1,this.total++}if(Jt.source=N,nt){if(O===Lt.maxZoom||O===nt)continue;var Ae=1<<nt-O;if(H!==Math.floor(ft/Ae)||W!==Math.floor(St/Ae))continue}else if(O===Lt.indexMaxZoom||Jt.numPoints<=Lt.indexMaxPoints)continue;if(Jt.source=null,N.length!==0){Vt>1&&console.time("clipping");var Ie=.5*Lt.buffer/Lt.extent,We=.5-Ie,di=.5+Ie,mi=1+Ie,Ht,ii,tr,Qr,Ei,er;Ht=ii=tr=Qr=null,Ei=Un(N,qt,H-Ie,H+di,0,Jt.minX,Jt.maxX,Lt),er=Un(N,qt,H+We,H+mi,0,Jt.minX,Jt.maxX,Lt),N=null,Ei&&(Ht=Un(Ei,qt,W-Ie,W+di,1,Jt.minY,Jt.maxY,Lt),ii=Un(Ei,qt,W+We,W+mi,1,Jt.minY,Jt.maxY,Lt),Ei=null),er&&(tr=Un(er,qt,W-Ie,W+di,1,Jt.minY,Jt.maxY,Lt),Qr=Un(er,qt,W+We,W+mi,1,Jt.minY,Jt.maxY,Lt),er=null),Vt>1&&console.timeEnd("clipping"),It.push(Ht||[],O+1,H*2,W*2),It.push(ii||[],O+1,H*2,W*2+1),It.push(tr||[],O+1,H*2+1,W*2),It.push(Qr||[],O+1,H*2+1,W*2+1)}}},tt.prototype.getTile=function(N,O,H){var W=this.options,nt=W.extent,ft=W.debug;if(N<0||N>24)return null;var St=1<<N;O=(O%St+St)%St;var It=Q(N,O,H);if(this.tiles[It])return vs(this.tiles[It],nt);ft>1&&console.log("drilling down to z%d-%d-%d",N,O,H);for(var Lt=N,Vt=O,qt=H,ee;!ee&&Lt>0;)Lt--,Vt=Math.floor(Vt/2),qt=Math.floor(qt/2),ee=this.tiles[Q(Lt,Vt,qt)];return!ee||!ee.source?null:(ft>1&&console.log("found parent tile z%d-%d-%d",Lt,Vt,qt),ft>1&&console.time("drilling down"),this.splitTile(ee.source,Lt,Vt,qt,N,O,H),ft>1&&console.timeEnd("drilling down"),this.tiles[It]?vs(this.tiles[It],nt):null)};function Q(N,O,H){return((1<<N)*H+O)*32+N}function lt(N,O){for(var H in O)N[H]=O[H];return N}function gt(N,O){var H=N.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);var W=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!W)return O(null,null);var nt=new _l(W.features),ft=Rs(nt);(ft.byteOffset!==0||ft.byteLength!==ft.buffer.byteLength)&&(ft=new Uint8Array(ft)),O(null,{vectorTile:nt,rawData:ft.buffer})}var Pt=function(N){function O(H,W,nt,ft){N.call(this,H,W,nt,gt),ft&&(this.loadGeoJSON=ft)}return N&&(O.__proto__=N),O.prototype=Object.create(N&&N.prototype),O.prototype.constructor=O,O.prototype.loadData=function(W,nt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=nt,this._pendingLoadDataParams=W,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},O.prototype._loadData=function(){var W=this;if(!(!this._pendingCallback||!this._pendingLoadDataParams)){var nt=this._pendingCallback,ft=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var St=ft&&ft.request&&ft.request.collectResourceTiming?new v.RequestPerformance(ft.request):!1;this.loadGeoJSON(ft,function(It,Lt){if(It||!Lt)return nt(It);if(typeof Lt!="object")return nt(new Error("Input data given to '"+ft.source+"' is not a valid GeoJSON object."));fa(Lt,!0);try{if(ft.filter){var Vt=v.createExpression(ft.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Vt.result==="error")throw new Error(Vt.value.map(function(se){return se.key+": "+se.message}).join(", "));var qt=Lt.features.filter(function(se){return Vt.value.evaluate({zoom:0},se)});Lt={type:"FeatureCollection",features:qt}}W._geoJSONIndex=ft.cluster?new zi(Nt(ft)).load(Lt.features):dt(Lt,ft.geojsonVtOptions)}catch(se){return nt(se)}W.loaded={};var ee={};if(St){var Jt=St.finish();Jt&&(ee.resourceTiming={},ee.resourceTiming[ft.source]=JSON.parse(JSON.stringify(Jt)))}nt(null,ee)})}},O.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},O.prototype.reloadTile=function(W,nt){var ft=this.loaded,St=W.uid;return ft&&ft[St]?N.prototype.reloadTile.call(this,W,nt):this.loadTile(W,nt)},O.prototype.loadGeoJSON=function(W,nt){if(W.request)v.getJSON(W.request,nt);else if(typeof W.data=="string")try{return nt(null,JSON.parse(W.data))}catch{return nt(new Error("Input data given to '"+W.source+"' is not a valid GeoJSON object."))}else return nt(new Error("Input data given to '"+W.source+"' is not a valid GeoJSON object."))},O.prototype.removeSource=function(W,nt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),nt()},O.prototype.getClusterExpansionZoom=function(W,nt){try{nt(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(ft){nt(ft)}},O.prototype.getClusterChildren=function(W,nt){try{nt(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(ft){nt(ft)}},O.prototype.getClusterLeaves=function(W,nt){try{nt(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(ft){nt(ft)}},O}(In);function Nt(N){var O=N.superclusterOptions,H=N.clusterProperties;if(!H||!O)return O;for(var W={},nt={},ft={accumulated:null,zoom:0},St={properties:null},It=Object.keys(H),Lt=0,Vt=It;Lt<Vt.length;Lt+=1){var qt=Vt[Lt],ee=H[qt],Jt=ee[0],se=ee[1],Ae=v.createExpression(se),Ie=v.createExpression(typeof Jt=="string"?[Jt,["accumulated"],["get",qt]]:Jt);W[qt]=Ae.value,nt[qt]=Ie.value}return O.map=function(We){St.properties=We;for(var di={},mi=0,Ht=It;mi<Ht.length;mi+=1){var ii=Ht[mi];di[ii]=W[ii].evaluate(ft,St)}return di},O.reduce=function(We,di){St.properties=di;for(var mi=0,Ht=It;mi<Ht.length;mi+=1){var ii=Ht[mi];ft.accumulated=We[ii],We[ii]=nt[ii].evaluate(ft,St)}},O}var Mt=function(O){var H=this;this.self=O,this.actor=new v.Actor(O,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:In,geojson:Pt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(W,nt){if(H.workerSourceTypes[W])throw new Error('Worker source with name "'+W+'" already registered.');H.workerSourceTypes[W]=nt},this.self.registerRTLTextPlugin=function(W){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=W.applyArabicShaping,v.plugin.processBidirectionalText=W.processBidirectionalText,v.plugin.processStyledBidirectionalText=W.processStyledBidirectionalText}};return Mt.prototype.setReferrer=function(O,H){this.referrer=H},Mt.prototype.setImages=function(O,H,W){this.availableImages[O]=H;for(var nt in this.workerSources[O]){var ft=this.workerSources[O][nt];for(var St in ft)ft[St].availableImages=H}W()},Mt.prototype.setLayers=function(O,H,W){this.getLayerIndex(O).replace(H),W()},Mt.prototype.updateLayers=function(O,H,W){this.getLayerIndex(O).update(H.layers,H.removedIds),W()},Mt.prototype.loadTile=function(O,H,W){this.getWorkerSource(O,H.type,H.source).loadTile(H,W)},Mt.prototype.loadDEMTile=function(O,H,W){this.getDEMWorkerSource(O,H.source).loadTile(H,W)},Mt.prototype.reloadTile=function(O,H,W){this.getWorkerSource(O,H.type,H.source).reloadTile(H,W)},Mt.prototype.abortTile=function(O,H,W){this.getWorkerSource(O,H.type,H.source).abortTile(H,W)},Mt.prototype.removeTile=function(O,H,W){this.getWorkerSource(O,H.type,H.source).removeTile(H,W)},Mt.prototype.removeDEMTile=function(O,H){this.getDEMWorkerSource(O,H.source).removeTile(H)},Mt.prototype.removeSource=function(O,H,W){if(!(!this.workerSources[O]||!this.workerSources[O][H.type]||!this.workerSources[O][H.type][H.source])){var nt=this.workerSources[O][H.type][H.source];delete this.workerSources[O][H.type][H.source],nt.removeSource!==void 0?nt.removeSource(H,W):W()}},Mt.prototype.loadWorkerSource=function(O,H,W){try{this.self.importScripts(H.url),W()}catch(nt){W(nt.toString())}},Mt.prototype.syncRTLPluginState=function(O,H,W){try{v.plugin.setState(H);var nt=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&nt!=null){this.self.importScripts(nt);var ft=v.plugin.isParsed(),St=ft?void 0:new Error("RTL Text Plugin failed to import scripts from "+nt);W(St,ft)}}catch(It){W(It.toString())}},Mt.prototype.getAvailableImages=function(O){var H=this.availableImages[O];return H||(H=[]),H},Mt.prototype.getLayerIndex=function(O){var H=this.layerIndexes[O];return H||(H=this.layerIndexes[O]=new Jr),H},Mt.prototype.getWorkerSource=function(O,H,W){var nt=this;if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][H]||(this.workerSources[O][H]={}),!this.workerSources[O][H][W]){var ft={send:function(St,It,Lt){nt.actor.send(St,It,Lt,O)}};this.workerSources[O][H][W]=new this.workerSourceTypes[H](ft,this.getLayerIndex(O),this.getAvailableImages(O))}return this.workerSources[O][H][W]},Mt.prototype.getDEMWorkerSource=function(O,H){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][H]||(this.demWorkerSources[O][H]=new Fa),this.demWorkerSources[O][H]},Mt.prototype.enforceCacheSizeLimit=function(O,H){v.enforceCacheSizeLimit(H)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Mt(self)),Mt}),Ep(["./shared"],function(v){var C=v.createCommonjsModule(function(d){d.exports?d.exports=l:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=l,window.mapboxgl.notSupportedReason=m);function l(xt){return!m(xt)}function m(xt){if(!u())return"not a browser";if(!_())return"insufficent Array support";if(!I())return"insufficient Function support";if(!P())return"insufficient Object support";if(!D())return"insufficient JSON support";if(!q())return"insufficient worker support";if(!G())return"insufficient Uint8ClampedArray support";if(!et())return"insufficient ArrayBuffer support";if(!ot())return"insufficient Canvas/getImageData support";if(!pt(xt&&xt.failIfMajorPerformanceCaveat))return"insufficient WebGL support"}function u(){return typeof window<"u"&&typeof document<"u"}function _(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function I(){return Function.prototype&&Function.prototype.bind}function P(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function D(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function q(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var xt=new Blob([""],{type:"text/javascript"}),Et=URL.createObjectURL(xt),kt,Gt;try{Gt=new Worker(Et),kt=!0}catch{kt=!1}return Gt&&Gt.terminate(),URL.revokeObjectURL(Et),kt}function G(){return"Uint8ClampedArray"in window}function et(){return ArrayBuffer.isView}function ot(){var xt=document.createElement("canvas");xt.width=xt.height=1;var Et=xt.getContext("2d");if(!Et)return!1;var kt=Et.getImageData(0,0,1,1);return kt&&kt.width===xt.width}var at={};function pt(xt){return at[xt]===void 0&&(at[xt]=bt(xt)),at[xt]}l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};function wt(xt){var Et=document.createElement("canvas"),kt=Object.create(l.webGLContextAttributes);return kt.failIfMajorPerformanceCaveat=xt,Et.probablySupportsContext?Et.probablySupportsContext("webgl",kt)||Et.probablySupportsContext("experimental-webgl",kt):Et.supportsContext?Et.supportsContext("webgl",kt)||Et.supportsContext("experimental-webgl",kt):Et.getContext("webgl",kt)||Et.getContext("experimental-webgl",kt)}function bt(xt){var Et=wt(xt);if(!Et)return!1;var kt=Et.createShader(Et.VERTEX_SHADER);return!kt||Et.isContextLost()?!1:(Et.shaderSource(kt,"void main() {}"),Et.compileShader(kt),Et.getShaderParameter(kt,Et.COMPILE_STATUS)===!0)}}),fe={};fe.create=function(d,l,m){var u=v.window.document.createElement(d);return l!==void 0&&(u.className=l),m&&m.appendChild(u),u},fe.createNS=function(d,l){var m=v.window.document.createElementNS(d,l);return m};var Yr=v.window.document&&v.window.document.documentElement.style;function Jr(d){if(!Yr)return d[0];for(var l=0;l<d.length;l++)if(d[l]in Yr)return d[l];return d[0]}var pe=Jr(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ha;fe.disableDrag=function(){Yr&&pe&&(ha=Yr[pe],Yr[pe]="none")},fe.enableDrag=function(){Yr&&pe&&(Yr[pe]=ha)};var me=Jr(["transform","WebkitTransform"]);fe.setTransform=function(d,l){d.style[me]=l};var Qt=!1;try{var ca=Object.defineProperty({},"passive",{get:function(){Qt=!0}});v.window.addEventListener("test",ca,ca),v.window.removeEventListener("test",ca,ca)}catch{Qt=!1}fe.addEventListener=function(d,l,m,u){u===void 0&&(u={}),"passive"in u&&Qt?d.addEventListener(l,m,u):d.addEventListener(l,m,u.capture)},fe.removeEventListener=function(d,l,m,u){u===void 0&&(u={}),"passive"in u&&Qt?d.removeEventListener(l,m,u):d.removeEventListener(l,m,u.capture)};var In=function(d){d.preventDefault(),d.stopPropagation(),v.window.removeEventListener("click",In,!0)};fe.suppressClick=function(){v.window.addEventListener("click",In,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",In,!0)},0)},fe.mousePos=function(d,l){var m=d.getBoundingClientRect();return new v.Point(l.clientX-m.left-d.clientLeft,l.clientY-m.top-d.clientTop)},fe.touchPos=function(d,l){for(var m=d.getBoundingClientRect(),u=[],_=0;_<l.length;_++)u.push(new v.Point(l[_].clientX-m.left-d.clientLeft,l[_].clientY-m.top-d.clientTop));return u},fe.mouseButton=function(d){return typeof v.window.InstallTrigger<"u"&&d.button===2&&d.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button},fe.remove=function(d){d.parentNode&&d.parentNode.removeChild(d)};function ns(d,l,m){var u,_,I,P=v.browser.devicePixelRatio>1?"@2x":"",D=v.getJSON(l.transformRequest(l.normalizeSpriteURL(d,P,".json"),v.ResourceType.SpriteJSON),function(et,ot){D=null,I||(I=et,u=ot,G())}),q=v.getImage(l.transformRequest(l.normalizeSpriteURL(d,P,".png"),v.ResourceType.SpriteImage),function(et,ot){q=null,I||(I=et,_=ot,G())});function G(){if(I)m(I);else if(u&&_){var et=v.browser.getImageData(_),ot={};for(var at in u){var pt=u[at],wt=pt.width,bt=pt.height,xt=pt.x,Et=pt.y,kt=pt.sdf,Gt=pt.pixelRatio,Kt=pt.stretchX,ae=pt.stretchY,oe=pt.content,ne=new v.RGBAImage({width:wt,height:bt});v.RGBAImage.copy(et,ne,{x:xt,y:Et},{x:0,y:0},{width:wt,height:bt}),ot[at]={data:ne,pixelRatio:Gt,sdf:kt,stretchX:Kt,stretchY:ae,content:oe}}m(null,ot)}}return{cancel:function(){D&&(D.cancel(),D=null),q&&(q.cancel(),q=null)}}}function Fa(d){var l=d.userImage;if(l&&l.render){var m=l.render();if(m)return d.data.replace(new Uint8Array(l.data.buffer)),!0}return!1}var fa=1,zo=function(d){function l(){d.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.isLoaded=function(){return this.loaded},l.prototype.setLoaded=function(u){if(this.loaded!==u&&(this.loaded=u,u)){for(var _=0,I=this.requestors;_<I.length;_+=1){var P=I[_],D=P.ids,q=P.callback;this._notify(D,q)}this.requestors=[]}},l.prototype.getImage=function(u){return this.images[u]},l.prototype.addImage=function(u,_){this._validate(u,_)&&(this.images[u]=_)},l.prototype._validate=function(u,_){var I=!0;return this._validateStretch(_.stretchX,_.data&&_.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+u+'" has invalid "stretchX" value'))),I=!1),this._validateStretch(_.stretchY,_.data&&_.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+u+'" has invalid "stretchY" value'))),I=!1),this._validateContent(_.content,_)||(this.fire(new v.ErrorEvent(new Error('Image "'+u+'" has invalid "content" value'))),I=!1),I},l.prototype._validateStretch=function(u,_){if(!u)return!0;for(var I=0,P=0,D=u;P<D.length;P+=1){var q=D[P];if(q[0]<I||q[1]<q[0]||_<q[1])return!1;I=q[1]}return!0},l.prototype._validateContent=function(u,_){return u?!(u.length!==4||u[0]<0||_.data.width<u[0]||u[1]<0||_.data.height<u[1]||u[2]<0||_.data.width<u[2]||u[3]<0||_.data.height<u[3]||u[2]<u[0]||u[3]<u[1]):!0},l.prototype.updateImage=function(u,_){var I=this.images[u];_.version=I.version+1,this.images[u]=_,this.updatedImages[u]=!0},l.prototype.removeImage=function(u){var _=this.images[u];delete this.images[u],delete this.patterns[u],_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()},l.prototype.listImages=function(){return Object.keys(this.images)},l.prototype.getImages=function(u,_){var I=!0;if(!this.isLoaded())for(var P=0,D=u;P<D.length;P+=1){var q=D[P];this.images[q]||(I=!1)}this.isLoaded()||I?this._notify(u,_):this.requestors.push({ids:u,callback:_})},l.prototype._notify=function(u,_){for(var I={},P=0,D=u;P<D.length;P+=1){var q=D[P];this.images[q]||this.fire(new v.Event("styleimagemissing",{id:q}));var G=this.images[q];G?I[q]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:!!(G.userImage&&G.userImage.render)}:v.warnOnce('Image "'+q+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}_(null,I)},l.prototype.getPixelSize=function(){var u=this.atlasImage,_=u.width,I=u.height;return{width:_,height:I}},l.prototype.getPattern=function(u){var _=this.patterns[u],I=this.getImage(u);if(!I)return null;if(_&&_.position.version===I.version)return _.position;if(_)_.position.version=I.version;else{var P=I.data.width+fa*2,D=I.data.height+fa*2,q={w:P,h:D,x:0,y:0},G=new v.ImagePosition(q,I);this.patterns[u]={bin:q,position:G}}return this._updatePatternAtlas(),this.patterns[u].position},l.prototype.bind=function(u){var _=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(u,this.atlasImage,_.RGBA),this.atlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE)},l.prototype._updatePatternAtlas=function(){var u=[];for(var _ in this.patterns)u.push(this.patterns[_].bin);var I=v.potpack(u),P=I.w,D=I.h,q=this.atlasImage;q.resize({width:P||1,height:D||1});for(var G in this.patterns){var et=this.patterns[G],ot=et.bin,at=ot.x+fa,pt=ot.y+fa,wt=this.images[G].data,bt=wt.width,xt=wt.height;v.RGBAImage.copy(wt,q,{x:0,y:0},{x:at,y:pt},{width:bt,height:xt}),v.RGBAImage.copy(wt,q,{x:0,y:xt-1},{x:at,y:pt-1},{width:bt,height:1}),v.RGBAImage.copy(wt,q,{x:0,y:0},{x:at,y:pt+xt},{width:bt,height:1}),v.RGBAImage.copy(wt,q,{x:bt-1,y:0},{x:at-1,y:pt},{width:1,height:xt}),v.RGBAImage.copy(wt,q,{x:0,y:0},{x:at+bt,y:pt},{width:1,height:xt})}this.dirty=!0},l.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},l.prototype.dispatchRenderCallbacks=function(u){for(var _=0,I=u;_<I.length;_+=1){var P=I[_];if(!this.callbackDispatchedThisFrame[P]){this.callbackDispatchedThisFrame[P]=!0;var D=this.images[P],q=Fa(D);q&&this.updateImage(P,D)}}},l}(v.Evented);function ml(d,l,m,u,_){var I=l*256,P=I+255,D=u.transformRequest(u.normalizeGlyphsURL(m).replace("{fontstack}",d).replace("{range}",I+"-"+P),v.ResourceType.Glyphs);v.getArrayBuffer(D,function(q,G){if(q)_(q);else if(G){for(var et={},ot=0,at=v.parseGlyphPBF(G);ot<at.length;ot+=1){var pt=at[ot];et[pt.id]=pt}_(null,et)}})}var an=_l,Fs=_l,Or=1e20;function _l(d,l,m,u,_,I){this.fontSize=d||24,this.buffer=l===void 0?3:l,this.cutoff=u||.25,this.fontFamily=_||"sans-serif",this.fontWeight=I||"normal",this.radius=m||8;var P=this.size=this.fontSize+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}_l.prototype.draw=function(d){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(d,this.buffer,this.middle);for(var l=this.ctx.getImageData(0,0,this.size,this.size),m=new Uint8ClampedArray(this.size*this.size),u=0;u<this.size*this.size;u++){var _=l.data[u*4+3]/255;this.gridOuter[u]=_===1?0:_===0?Or:Math.pow(Math.max(0,.5-_),2),this.gridInner[u]=_===1?Or:_===0?0:Math.pow(Math.max(0,_-.5),2)}for(da(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),da(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),u=0;u<this.size*this.size;u++){var I=this.gridOuter[u]-this.gridInner[u];m[u]=Math.max(0,Math.min(255,Math.round(255-255*(I/this.radius+this.cutoff))))}return m};function da(d,l,m,u,_,I,P){for(var D=0;D<l;D++){for(var q=0;q<m;q++)u[q]=d[q*l+D];for(Ls(u,_,I,P,m),q=0;q<m;q++)d[q*l+D]=_[q]}for(q=0;q<m;q++){for(D=0;D<l;D++)u[D]=d[q*l+D];for(Ls(u,_,I,P,l),D=0;D<l;D++)d[q*l+D]=Math.sqrt(_[D])}}function Ls(d,l,m,u,_){m[0]=0,u[0]=-1e20,u[1]=1e20;for(var I=1,P=0;I<_;I++){for(var D=(d[I]+I*I-(d[m[P]]+m[P]*m[P]))/(2*I-2*m[P]);D<=u[P];)P--,D=(d[I]+I*I-(d[m[P]]+m[P]*m[P]))/(2*I-2*m[P]);P++,m[P]=I,u[P]=D,u[P+1]=1e20}for(I=0,P=0;I<_;I++){for(;u[P+1]<I;)P++;l[I]=(I-m[P])*(I-m[P])+d[m[P]]}}an.default=Fs;var pa=function(l,m){this.requestManager=l,this.localIdeographFontFamily=m,this.entries={}};pa.prototype.setURL=function(l){this.url=l},pa.prototype.getGlyphs=function(l,m){var u=this,_=[];for(var I in l)for(var P=0,D=l[I];P<D.length;P+=1){var q=D[P];_.push({stack:I,id:q})}v.asyncAll(_,function(G,et){var ot=G.stack,at=G.id,pt=u.entries[ot];pt||(pt=u.entries[ot]={glyphs:{},requests:{},ranges:{}});var wt=pt.glyphs[at];if(wt!==void 0){et(null,{stack:ot,id:at,glyph:wt});return}if(wt=u._tinySDF(pt,ot,at),wt){pt.glyphs[at]=wt,et(null,{stack:ot,id:at,glyph:wt});return}var bt=Math.floor(at/256);if(bt*256>65535){et(new Error("glyphs > 65535 not supported"));return}if(pt.ranges[bt]){et(null,{stack:ot,id:at,glyph:wt});return}var xt=pt.requests[bt];xt||(xt=pt.requests[bt]=[],pa.loadGlyphRange(ot,bt,u.url,u.requestManager,function(Et,kt){if(kt){for(var Gt in kt)u._doesCharSupportLocalGlyph(+Gt)||(pt.glyphs[+Gt]=kt[+Gt]);pt.ranges[bt]=!0}for(var Kt=0,ae=xt;Kt<ae.length;Kt+=1){var oe=ae[Kt];oe(Et,kt)}delete pt.requests[bt]})),xt.push(function(Et,kt){Et?et(Et):kt&&et(null,{stack:ot,id:at,glyph:kt[at]||null})})},function(G,et){if(G)m(G);else if(et){for(var ot={},at=0,pt=et;at<pt.length;at+=1){var wt=pt[at],bt=wt.stack,xt=wt.id,Et=wt.glyph;(ot[bt]||(ot[bt]={}))[xt]=Et&&{id:Et.id,bitmap:Et.bitmap.clone(),metrics:Et.metrics}}m(null,ot)}})},pa.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},pa.prototype._tinySDF=function(l,m,u){var _=this.localIdeographFontFamily;if(_&&this._doesCharSupportLocalGlyph(u)){var I=l.tinySDF;if(!I){var P="400";/bold/i.test(m)?P="900":/medium/i.test(m)?P="500":/light/i.test(m)&&(P="200"),I=l.tinySDF=new pa.TinySDF(24,3,8,.25,_,P)}return{id:u,bitmap:new v.AlphaImage({width:30,height:30},I.draw(String.fromCharCode(u))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},pa.loadGlyphRange=ml,pa.TinySDF=an;var gs=function(){this.specification=v.styleSpec.light.position};gs.prototype.possiblyEvaluate=function(l,m){return v.sphericalToCartesian(l.expression.evaluate(m))},gs.prototype.interpolate=function(l,m,u){return{x:v.number(l.x,m.x,u),y:v.number(l.y,m.y,u),z:v.number(l.z,m.z,u)}};var Rs=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new gs,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),Jl="-transition",Do=function(d){function l(m){d.call(this),this._transitionable=new v.Transitionable(Rs),this.setLight(m),this._transitioning=this._transitionable.untransitioned()}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getLight=function(){return this._transitionable.serialize()},l.prototype.setLight=function(u,_){if(_===void 0&&(_={}),!this._validate(v.validateLight,u,_))for(var I in u){var P=u[I];v.endsWith(I,Jl)?this._transitionable.setTransition(I.slice(0,-Jl.length),P):this._transitionable.setValue(I,P)}},l.prototype.updateTransitions=function(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)},l.prototype.hasTransition=function(){return this._transitioning.hasTransition()},l.prototype.recalculate=function(u){this.properties=this._transitioning.possiblyEvaluate(u)},l.prototype._validate=function(u,_,I){return I&&I.validate===!1?!1:v.emitValidationErrors(this,u.call(v.validateStyle,v.extend({value:_,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},l}(v.Evented),La=function(l,m){this.width=l,this.height=m,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};La.prototype.getDash=function(l,m){var u=l.join(",")+String(m);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(l,m)),this.dashEntry[u]},La.prototype.getDashRanges=function(l,m,u){var _=l.length%2===1,I=[],P=_?-l[l.length-1]*u:0,D=l[0]*u,q=!0;I.push({left:P,right:D,isDash:q,zeroLength:l[0]===0});for(var G=l[0],et=1;et<l.length;et++){q=!q;var ot=l[et];P=G*u,G+=ot,D=G*u,I.push({left:P,right:D,isDash:q,zeroLength:ot===0})}return I},La.prototype.addRoundDash=function(l,m,u){for(var _=m/2,I=-u;I<=u;I++)for(var P=this.nextRow+u+I,D=this.width*P,q=0,G=l[q],et=0;et<this.width;et++){et/G.right>1&&(G=l[++q]);var ot=Math.abs(et-G.left),at=Math.abs(et-G.right),pt=Math.min(ot,at),wt=void 0,bt=I/u*(_+1);if(G.isDash){var xt=_-Math.abs(bt);wt=Math.sqrt(pt*pt+xt*xt)}else wt=_-Math.sqrt(pt*pt+bt*bt);this.data[D+et]=Math.max(0,Math.min(255,wt+128))}},La.prototype.addRegularDash=function(l){for(var m=l.length-1;m>=0;--m){var u=l[m],_=l[m+1];u.zeroLength?l.splice(m,1):_&&_.isDash===u.isDash&&(_.left=u.left,l.splice(m,1))}var I=l[0],P=l[l.length-1];I.isDash===P.isDash&&(I.left=P.left-this.width,P.right=I.right+this.width);for(var D=this.width*this.nextRow,q=0,G=l[q],et=0;et<this.width;et++){et/G.right>1&&(G=l[++q]);var ot=Math.abs(et-G.left),at=Math.abs(et-G.right),pt=Math.min(ot,at),wt=G.isDash?pt:-pt;this.data[D+et]=Math.max(0,Math.min(255,wt+128))}},La.prototype.addDash=function(l,m){var u=m?7:0,_=2*u+1;if(this.nextRow+_>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var I=0,P=0;P<l.length;P++)I+=l[P];if(I!==0){var D=this.width/I,q=this.getDashRanges(l,this.width,D);m?this.addRoundDash(q,D,u):this.addRegularDash(q)}var G={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:I};return this.nextRow+=_,this.dirty=!0,G},La.prototype.bind=function(l){var m=l.gl;this.texture?(m.bindTexture(m.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,m.texSubImage2D(m.TEXTURE_2D,0,0,0,this.width,this.height,m.ALPHA,m.UNSIGNED_BYTE,this.data))):(this.texture=m.createTexture(),m.bindTexture(m.TEXTURE_2D,this.texture),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texImage2D(m.TEXTURE_2D,0,m.ALPHA,this.width,this.height,0,m.ALPHA,m.UNSIGNED_BYTE,this.data))};var Ra=function d(l,m){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var u=this.workerPool.acquire(this.id),_=0;_<u.length;_++){var I=u[_],P=new d.Actor(I,m,this.id);P.name="Worker "+_,this.actors.push(P)}};Ra.prototype.broadcast=function(l,m,u){u=u||function(){},v.asyncAll(this.actors,function(_,I){_.send(l,m,I)},u)},Ra.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ra.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Ra.Actor=v.Actor;function qr(d,l,m){var u=function(_,I){if(_)return m(_);if(I){var P=v.pick(v.extend(I,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(P.vectorLayers=I.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(D){return D.id})),P.tiles=l.canonicalizeTileset(P,d.url),m(null,P)}};return d.url?v.getJSON(l.transformRequest(l.normalizeSourceURL(d.url),v.ResourceType.Source),u):v.browser.frame(function(){return u(null,d)})}var so=function(l,m,u){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=m||0,this.maxzoom=u||24};so.prototype.validateBounds=function(l){return!Array.isArray(l)||l.length!==4?[-180,-90,180,90]:[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]},so.prototype.contains=function(l){var m=Math.pow(2,l.z),u={minX:Math.floor(v.mercatorXfromLng(this.bounds.getWest())*m),minY:Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*m),maxX:Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*m),maxY:Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*m)},_=l.x>=u.minX&&l.x<u.maxX&&l.y>=u.minY&&l.y<u.maxY;return _};var ko=function(d){function l(m,u,_,I){if(d.call(this),this.id=m,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(u,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.load=function(){var u=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=qr(this._options,this.map._requestManager,function(_,I){u._tileJSONRequest=null,u._loaded=!0,_?u.fire(new v.ErrorEvent(_)):I&&(v.extend(u,I),I.bounds&&(u.tileBounds=new so(I.bounds,u.minzoom,u.maxzoom)),v.postTurnstileEvent(I.tiles,u.map._requestManager._customAccessToken),v.postMapLoadEvent(I.tiles,u.map._getMapId(),u.map._requestManager._skuToken,u.map._requestManager._customAccessToken),u.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),u.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},l.prototype.loaded=function(){return this._loaded},l.prototype.hasTile=function(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)},l.prototype.onAdd=function(u){this.map=u,this.load()},l.prototype.setSourceProperty=function(u){this._tileJSONRequest&&this._tileJSONRequest.cancel(),u();var _=this.map.style.sourceCaches[this.id];_.clearTiles(),this.load()},l.prototype.setTiles=function(u){var _=this;return this.setSourceProperty(function(){_._options.tiles=u}),this},l.prototype.setUrl=function(u){var _=this;return this.setSourceProperty(function(){_.url=u,_._options.url=u}),this},l.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},l.prototype.serialize=function(){return v.extend({},this._options)},l.prototype.loadTile=function(u,_){var I=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),P={request:this.map._requestManager.transformRequest(I,v.ResourceType.Tile),uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};P.request.collectResourceTiming=this._collectResourceTiming,!u.actor||u.state==="expired"?(u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",P,D.bind(this))):u.state==="loading"?u.reloadCallback=_:u.request=u.actor.send("reloadTile",P,D.bind(this));function D(q,G){if(delete u.request,u.aborted)return _(null);if(q&&q.status!==404)return _(q);G&&G.resourceTiming&&(u.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&u.setExpiryData(G),u.loadVectorData(G,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),_(null),u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)}},l.prototype.abortTile=function(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id},void 0)},l.prototype.unloadTile=function(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id},void 0)},l.prototype.hasTransition=function(){return!1},l}(v.Evented),rr=function(d){function l(m,u,_,I){d.call(this),this.id=m,this.dispatcher=_,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},u),v.extend(this,v.pick(u,["url","scheme","tileSize"]))}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.load=function(){var u=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=qr(this._options,this.map._requestManager,function(_,I){u._tileJSONRequest=null,u._loaded=!0,_?u.fire(new v.ErrorEvent(_)):I&&(v.extend(u,I),I.bounds&&(u.tileBounds=new so(I.bounds,u.minzoom,u.maxzoom)),v.postTurnstileEvent(I.tiles),v.postMapLoadEvent(I.tiles,u.map._getMapId(),u.map._requestManager._skuToken),u.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),u.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},l.prototype.loaded=function(){return this._loaded},l.prototype.onAdd=function(u){this.map=u,this.load()},l.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},l.prototype.serialize=function(){return v.extend({},this._options)},l.prototype.hasTile=function(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)},l.prototype.loadTile=function(u,_){var I=this,P=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);u.request=v.getImage(this.map._requestManager.transformRequest(P,v.ResourceType.Tile),function(D,q){if(delete u.request,u.aborted)u.state="unloaded",_(null);else if(D)u.state="errored",_(D);else if(q){I.map._refreshExpiredTiles&&u.setExpiryData(q),delete q.cacheControl,delete q.expires;var G=I.map.painter.context,et=G.gl;u.texture=I.map.painter.getTileTexture(q.width),u.texture?u.texture.update(q,{useMipmap:!0}):(u.texture=new v.Texture(G,q,et.RGBA,{useMipmap:!0}),u.texture.bind(et.LINEAR,et.CLAMP_TO_EDGE,et.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&et.texParameterf(et.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),u.state="loaded",v.cacheEntryPossiblyAdded(I.dispatcher),_(null)}})},l.prototype.abortTile=function(u,_){u.request&&(u.request.cancel(),delete u.request),_()},l.prototype.unloadTile=function(u,_){u.texture&&this.map.painter.saveTileTexture(u.texture),_()},l.prototype.hasTransition=function(){return!1},l}(v.Evented),mn=function(d){function l(m,u,_,I){d.call(this,m,u,_,I),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},l.prototype.loadTile=function(u,_){var I=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);u.request=v.getImage(this.map._requestManager.transformRequest(I,v.ResourceType.Tile),P.bind(this)),u.neighboringTiles=this._getNeighboringTiles(u.tileID);function P(q,G){if(delete u.request,u.aborted)u.state="unloaded",_(null);else if(q)u.state="errored",_(q);else if(G){this.map._refreshExpiredTiles&&u.setExpiryData(G),delete G.cacheControl,delete G.expires;var et=v.window.ImageBitmap&&G instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported(),ot=et?G:v.browser.getImageData(G,1),at={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:ot,encoding:this.encoding};(!u.actor||u.state==="expired")&&(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",at,D.bind(this)))}}function D(q,G){q&&(u.state="errored",_(q)),G&&(u.dem=G,u.needsHillshadePrepare=!0,u.state="loaded",_(null))}},l.prototype._getNeighboringTiles=function(u){var _=u.canonical,I=Math.pow(2,_.z),P=(_.x-1+I)%I,D=_.x===0?u.wrap-1:u.wrap,q=(_.x+1+I)%I,G=_.x+1===I?u.wrap+1:u.wrap,et={};return et[new v.OverscaledTileID(u.overscaledZ,D,_.z,P,_.y).key]={backfilled:!1},et[new v.OverscaledTileID(u.overscaledZ,G,_.z,q,_.y).key]={backfilled:!1},_.y>0&&(et[new v.OverscaledTileID(u.overscaledZ,D,_.z,P,_.y-1).key]={backfilled:!1},et[new v.OverscaledTileID(u.overscaledZ,u.wrap,_.z,_.x,_.y-1).key]={backfilled:!1},et[new v.OverscaledTileID(u.overscaledZ,G,_.z,q,_.y-1).key]={backfilled:!1}),_.y+1<I&&(et[new v.OverscaledTileID(u.overscaledZ,D,_.z,P,_.y+1).key]={backfilled:!1},et[new v.OverscaledTileID(u.overscaledZ,u.wrap,_.z,_.x,_.y+1).key]={backfilled:!1},et[new v.OverscaledTileID(u.overscaledZ,G,_.z,q,_.y+1).key]={backfilled:!1}),et},l.prototype.unloadTile=function(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded",u.actor&&u.actor.send("removeDEMTile",{uid:u.uid,source:this.id})},l}(rr),Ql=function(d){function l(m,u,_,I){d.call(this),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=_.getActor(),this.setEventedParent(I),this._data=u.data,this._options=v.extend({},u),this._collectResourceTiming=u.collectResourceTiming,this._resourceTiming=[],u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;var P=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*P,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*P,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?Math.min(u.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:v.EXTENT,radius:(u.clusterRadius||50)*P,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.load=function(){var u=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(_){if(_){u.fire(new v.ErrorEvent(_));return}var I={dataType:"source",sourceDataType:"metadata"};u._collectResourceTiming&&u._resourceTiming&&u._resourceTiming.length>0&&(I.resourceTiming=u._resourceTiming,u._resourceTiming=[]),u.fire(new v.Event("data",I))})},l.prototype.onAdd=function(u){this.map=u,this.load()},l.prototype.setData=function(u){var _=this;return this._data=u,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(I){if(I){_.fire(new v.ErrorEvent(I));return}var P={dataType:"source",sourceDataType:"content"};_._collectResourceTiming&&_._resourceTiming&&_._resourceTiming.length>0&&(P.resourceTiming=_._resourceTiming,_._resourceTiming=[]),_.fire(new v.Event("data",P))}),this},l.prototype.getClusterExpansionZoom=function(u,_){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},_),this},l.prototype.getClusterChildren=function(u,_){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},_),this},l.prototype.getClusterLeaves=function(u,_,I,P){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:_,offset:I},P),this},l.prototype._updateWorkerData=function(u){var _=this;this._loaded=!1;var I=v.extend({},this.workerOptions),P=this._data;typeof P=="string"?(I.request=this.map._requestManager.transformRequest(v.browser.resolveURL(P),v.ResourceType.Source),I.request.collectResourceTiming=this._collectResourceTiming):I.data=JSON.stringify(P),this.actor.send(this.type+".loadData",I,function(D,q){_._removed||q&&q.abandoned||(_._loaded=!0,q&&q.resourceTiming&&q.resourceTiming[_.id]&&(_._resourceTiming=q.resourceTiming[_.id].slice(0)),_.actor.send(_.type+".coalesce",{source:I.source},null),u(D))})},l.prototype.loaded=function(){return this._loaded},l.prototype.loadTile=function(u,_){var I=this,P=u.actor?"reloadTile":"loadTile";u.actor=this.actor;var D={type:this.type,uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request=this.actor.send(P,D,function(q,G){return delete u.request,u.unloadVectorData(),u.aborted?_(null):q?_(q):(u.loadVectorData(G,I.map.painter,P==="reloadTile"),_(null))})},l.prototype.abortTile=function(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0},l.prototype.unloadTile=function(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})},l.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},l.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},l.prototype.hasTransition=function(){return!1},l}(v.Evented),Fo=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),sn=function(d){function l(m,u,_,I){d.call(this),this.id=m,this.dispatcher=_,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=u}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.load=function(u,_){var I=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(P,D){I._loaded=!0,P?I.fire(new v.ErrorEvent(P)):D&&(I.image=D,u&&(I.coordinates=u),_&&_(),I._finishLoading())})},l.prototype.loaded=function(){return this._loaded},l.prototype.updateImage=function(u){var _=this;return!this.image||!u.url?this:(this.options.url=u.url,this.load(u.coordinates,function(){_.texture=null}),this)},l.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},l.prototype.onAdd=function(u){this.map=u,this.load()},l.prototype.setCoordinates=function(u){var _=this;this.coordinates=u;var I=u.map(v.MercatorCoordinate.fromLngLat);this.tileID=Lo(I),this.minzoom=this.maxzoom=this.tileID.z;var P=I.map(function(D){return _.tileID.getTilePoint(D)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(P[0].x,P[0].y,0,0),this._boundsArray.emplaceBack(P[1].x,P[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(P[3].x,P[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(P[2].x,P[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},l.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||!this.image)){var u=this.map.painter.context,_=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,Fo.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(u,this.image,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));for(var I in this.tiles){var P=this.tiles[I];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},l.prototype.loadTile=function(u,_){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={},_(null)):(u.state="errored",_(null))},l.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},l.prototype.hasTransition=function(){return!1},l}(v.Evented);function Lo(d){for(var l=1/0,m=1/0,u=-1/0,_=-1/0,I=0,P=d;I<P.length;I+=1){var D=P[I];l=Math.min(l,D.x),m=Math.min(m,D.y),u=Math.max(u,D.x),_=Math.max(_,D.y)}var q=u-l,G=_-m,et=Math.max(q,G),ot=Math.max(0,Math.floor(-Math.log(et)/Math.LN2)),at=Math.pow(2,ot);return new v.CanonicalTileID(ot,Math.floor((l+u)/2*at),Math.floor((m+_)/2*at))}var On=function(d){function l(m,u,_,I){d.call(this,m,u,_,I),this.roundZoom=!0,this.type="video",this.options=u}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.load=function(){var u=this;this._loaded=!1;var _=this.options;this.urls=[];for(var I=0,P=_.urls;I<P.length;I+=1){var D=P[I];this.urls.push(this.map._requestManager.transformRequest(D,v.ResourceType.Source).url)}v.getVideo(this.urls,function(q,G){u._loaded=!0,q?u.fire(new v.ErrorEvent(q)):G&&(u.video=G,u.video.loop=!0,u.video.addEventListener("playing",function(){u.map.triggerRepaint()}),u.map&&u.video.play(),u._finishLoading())})},l.prototype.pause=function(){this.video&&this.video.pause()},l.prototype.play=function(){this.video&&this.video.play()},l.prototype.seek=function(u){if(this.video){var _=this.video.seekable;u<_.start(0)||u>_.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+_.start(0)+" and "+_.end(0)+"-second mark."))):this.video.currentTime=u}},l.prototype.getVideo=function(){return this.video},l.prototype.onAdd=function(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},l.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var u=this.map.painter.context,_=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,Fo.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.texSubImage2D(_.TEXTURE_2D,0,0,0,_.RGBA,_.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(u,this.video,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));for(var I in this.tiles){var P=this.tiles[I];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},l.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},l.prototype.hasTransition=function(){return this.video&&!this.video.paused},l}(sn),Ba=function(d){function l(m,u,_,I){d.call(this,m,u,_,I),u.coordinates?(!Array.isArray(u.coordinates)||u.coordinates.length!==4||u.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(D){return typeof D!="number"})}))&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+m,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+m,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+m,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas!="string"&&!(u.canvas instanceof v.window.HTMLCanvasElement)&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+m,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+m,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate!==void 0?u.animate:!0}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.load=function(){if(this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()){this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero.")));return}this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading()},l.prototype.getCanvas=function(){return this.canvas},l.prototype.onAdd=function(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()},l.prototype.onRemove=function(){this.pause()},l.prototype.prepare=function(){var u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var _=this.map.painter.context,I=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,Fo.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(_,this.canvas,I.RGBA,{premultiply:!0});for(var P in this.tiles){var D=this.tiles[P];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}}},l.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},l.prototype.hasTransition=function(){return this._playing},l.prototype._hasInvalidDimensions=function(){for(var u=0,_=[this.canvas.width,this.canvas.height];u<_.length;u+=1){var I=_[u];if(isNaN(I)||I<=0)return!0}return!1},l}(sn),Qi={vector:ko,raster:rr,"raster-dem":mn,geojson:Ql,video:On,image:sn,canvas:Ba},Oa=function(d,l,m,u){var _=new Qi[l.type](d,l,m,u);if(_.id!==d)throw new Error("Expected Source id to be "+d+" instead of "+_.id);return v.bindAll(["load","abort","unload","serialize","prepare"],_),_},oo=function(d){return Qi[d]},oh=function(d,l){Qi[d]=l};function $l(d,l){var m=v.identity([]);return v.translate(m,m,[1,1,0]),v.scale(m,m,[d.width*.5,d.height*.5,1]),v.multiply(m,m,d.calculatePosMatrix(l.toUnwrapped()))}function lo(d,l,m){if(d)for(var u=0,_=d;u<_.length;u+=1){var I=_[u],P=l[I];if(P&&P.source===m&&P.type==="fill-extrusion")return!0}else for(var D in l){var q=l[D];if(q.source===m&&q.type==="fill-extrusion")return!0}return!1}function ma(d,l,m,u,_,I){var P=lo(_&&_.layers,l,d.id),D=I.maxPitchScaleFactor(),q=d.tilesIn(u,D,P);q.sort(zi);for(var G=[],et=0,ot=q;et<ot.length;et+=1){var at=ot[et];G.push({wrappedTileID:at.tileID.wrapped().key,queryResults:at.tile.queryRenderedFeatures(l,m,d._state,at.queryGeometry,at.cameraQueryGeometry,at.scale,_,I,D,$l(d.transform,at.tileID))})}var pt=uo(G);for(var wt in pt)pt[wt].forEach(function(bt){var xt=bt.feature,Et=d.getFeatureState(xt.layer["source-layer"],xt.id);xt.source=xt.layer.source,xt.layer["source-layer"]&&(xt.sourceLayer=xt.layer["source-layer"]),xt.state=Et});return pt}function Cn(d,l,m,u,_,I,P){for(var D={},q=I.queryRenderedSymbols(u),G=[],et=0,ot=Object.keys(q).map(Number);et<ot.length;et+=1){var at=ot[et];G.push(P[at])}G.sort(zi);for(var pt=function(){var kt=bt[wt],Gt=kt.featureIndex.lookupSymbolFeatures(q[kt.bucketInstanceId],l,kt.bucketIndex,kt.sourceLayerIndex,_.filter,_.layers,_.availableImages,d);for(var Kt in Gt){var ae=D[Kt]=D[Kt]||[],oe=Gt[Kt];oe.sort(function(Se,Ce){var Ee=kt.featureSortOrder;if(Ee){var Je=Ee.indexOf(Se.featureIndex),Ai=Ee.indexOf(Ce.featureIndex);return Ai-Je}else return Ce.featureIndex-Se.featureIndex});for(var ne=0,he=oe;ne<he.length;ne+=1){var ge=he[ne];ae.push(ge)}}},wt=0,bt=G;wt<bt.length;wt+=1)pt();var xt=function(kt){D[kt].forEach(function(Gt){var Kt=Gt.feature,ae=d[kt],oe=m[ae.source],ne=oe.getFeatureState(Kt.layer["source-layer"],Kt.id);Kt.source=Kt.layer.source,Kt.layer["source-layer"]&&(Kt.sourceLayer=Kt.layer["source-layer"]),Kt.state=ne})};for(var Et in D)xt(Et);return D}function Bs(d,l){for(var m=d.getRenderableIds().map(function(q){return d.getTileByID(q)}),u=[],_={},I=0;I<m.length;I++){var P=m[I],D=P.tileID.canonical.key;_[D]||(_[D]=!0,P.querySourceFeatures(u,l))}return u}function zi(d,l){var m=d.tileID,u=l.tileID;return m.overscaledZ-u.overscaledZ||m.canonical.y-u.canonical.y||m.wrap-u.wrap||m.canonical.x-u.canonical.x}function uo(d){for(var l={},m={},u=0,_=d;u<_.length;u+=1){var I=_[u],P=I.queryResults,D=I.wrappedTileID,q=m[D]=m[D]||{};for(var G in P)for(var et=P[G],ot=q[G]=q[G]||{},at=l[G]=l[G]||[],pt=0,wt=et;pt<wt.length;pt+=1){var bt=wt[pt];ot[bt.featureIndex]||(ot[bt.featureIndex]=!0,at.push(bt))}}return l}var on=function(l,m){this.max=l,this.onRemove=m,this.reset()};on.prototype.reset=function(){for(var l in this.data)for(var m=0,u=this.data[l];m<u.length;m+=1){var _=u[m];_.timeout&&clearTimeout(_.timeout),this.onRemove(_.value)}return this.data={},this.order=[],this},on.prototype.add=function(l,m,u){var _=this,I=l.wrapped().key;this.data[I]===void 0&&(this.data[I]=[]);var P={value:m,timeout:void 0};if(u!==void 0&&(P.timeout=setTimeout(function(){_.remove(l,P)},u)),this.data[I].push(P),this.order.push(I),this.order.length>this.max){var D=this._getAndRemoveByKey(this.order[0]);D&&this.onRemove(D)}return this},on.prototype.has=function(l){return l.wrapped().key in this.data},on.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},on.prototype._getAndRemoveByKey=function(l){var m=this.data[l].shift();return m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),m.value},on.prototype.getByKey=function(l){var m=this.data[l];return m?m[0].value:null},on.prototype.get=function(l){if(!this.has(l))return null;var m=this.data[l.wrapped().key][0];return m.value},on.prototype.remove=function(l,m){if(!this.has(l))return this;var u=l.wrapped().key,_=m===void 0?0:this.data[u].indexOf(m),I=this.data[u][_];return this.data[u].splice(_,1),I.timeout&&clearTimeout(I.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(I.value),this.order.splice(this.order.indexOf(u),1),this},on.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this},on.prototype.filter=function(l){var m=[];for(var u in this.data)for(var _=0,I=this.data[u];_<I.length;_+=1){var P=I[_];l(P.value)||m.push(P)}for(var D=0,q=m;D<q.length;D+=1){var G=q[D];this.remove(G.value.tileID,G)}};var _n=function(l,m,u){this.context=l;var _=l.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete m.arrayBuffer};_n.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},_n.prototype.updateData=function(l){var m=this.context.gl;this.context.unbindVAO(),this.bind(),m.bufferSubData(m.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},_n.prototype.destroy=function(){var l=this.context.gl;this.buffer&&(l.deleteBuffer(this.buffer),delete this.buffer)};var Qn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Va=function(l,m,u,_){this.length=m.length,this.attributes=u,this.itemSize=m.bytesPerElement,this.dynamicDraw=_,this.context=l;var I=l.gl;this.buffer=I.createBuffer(),l.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||delete m.arrayBuffer};Va.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Va.prototype.updateData=function(l){var m=this.context.gl;this.bind(),m.bufferSubData(m.ARRAY_BUFFER,0,l.arrayBuffer)},Va.prototype.enableAttributes=function(l,m){for(var u=0;u<this.attributes.length;u++){var _=this.attributes[u],I=m.attributes[_.name];I!==void 0&&l.enableVertexAttribArray(I)}},Va.prototype.setVertexAttribPointers=function(l,m,u){for(var _=0;_<this.attributes.length;_++){var I=this.attributes[_],P=m.attributes[I.name];P!==void 0&&l.vertexAttribPointer(P,I.components,l[Qn[I.type]],!1,this.itemSize,I.offset+this.itemSize*(u||0))}},Va.prototype.destroy=function(){var l=this.context.gl;this.buffer&&(l.deleteBuffer(this.buffer),delete this.buffer)};var bi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};bi.prototype.get=function(){return this.current},bi.prototype.set=function(l){},bi.prototype.getDefault=function(){return this.default},bi.prototype.setDefault=function(){this.set(this.default)};var Ro=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return v.Color.transparent},l.prototype.set=function(u){var _=this.current;u.r===_.r&&u.g===_.g&&u.b===_.b&&u.a===_.a&&!this.dirty||(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)},l}(bi),Os=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return 1},l.prototype.set=function(u){u===this.current&&!this.dirty||(this.gl.clearDepth(u),this.current=u,this.dirty=!1)},l}(bi),ys=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return 0},l.prototype.set=function(u){u===this.current&&!this.dirty||(this.gl.clearStencil(u),this.current=u,this.dirty=!1)},l}(bi),ln=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return[!0,!0,!0,!0]},l.prototype.set=function(u){var _=this.current;u[0]===_[0]&&u[1]===_[1]&&u[2]===_[2]&&u[3]===_[3]&&!this.dirty||(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)},l}(bi),un=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return!0},l.prototype.set=function(u){u===this.current&&!this.dirty||(this.gl.depthMask(u),this.current=u,this.dirty=!1)},l}(bi),Vn=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return 255},l.prototype.set=function(u){u===this.current&&!this.dirty||(this.gl.stencilMask(u),this.current=u,this.dirty=!1)},l}(bi),$n=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},l.prototype.set=function(u){var _=this.current;u.func===_.func&&u.ref===_.ref&&u.mask===_.mask&&!this.dirty||(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)},l}(bi),Ua=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){var u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]},l.prototype.set=function(u){var _=this.current;u[0]===_[0]&&u[1]===_[1]&&u[2]===_[2]&&!this.dirty||(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)},l}(bi),Au=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;u?_.enable(_.STENCIL_TEST):_.disable(_.STENCIL_TEST),this.current=u,this.dirty=!1}},l}(bi),Bo=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return[0,1]},l.prototype.set=function(u){var _=this.current;u[0]===_[0]&&u[1]===_[1]&&!this.dirty||(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)},l}(bi),Pn=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;u?_.enable(_.DEPTH_TEST):_.disable(_.DEPTH_TEST),this.current=u,this.dirty=!1}},l}(bi),ta=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return this.gl.LESS},l.prototype.set=function(u){u===this.current&&!this.dirty||(this.gl.depthFunc(u),this.current=u,this.dirty=!1)},l}(bi),gl=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;u?_.enable(_.BLEND):_.disable(_.BLEND),this.current=u,this.dirty=!1}},l}(bi),yl=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){var u=this.gl;return[u.ONE,u.ZERO]},l.prototype.set=function(u){var _=this.current;u[0]===_[0]&&u[1]===_[1]&&!this.dirty||(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)},l}(bi),ea=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return v.Color.transparent},l.prototype.set=function(u){var _=this.current;u.r===_.r&&u.g===_.g&&u.b===_.b&&u.a===_.a&&!this.dirty||(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)},l}(bi),vl=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return this.gl.FUNC_ADD},l.prototype.set=function(u){u===this.current&&!this.dirty||(this.gl.blendEquation(u),this.current=u,this.dirty=!1)},l}(bi),xl=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;u?_.enable(_.CULL_FACE):_.disable(_.CULL_FACE),this.current=u,this.dirty=!1}},l}(bi),Un=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return this.gl.BACK},l.prototype.set=function(u){u===this.current&&!this.dirty||(this.gl.cullFace(u),this.current=u,this.dirty=!1)},l}(bi),bl=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return this.gl.CCW},l.prototype.set=function(u){u===this.current&&!this.dirty||(this.gl.frontFace(u),this.current=u,this.dirty=!1)},l}(bi),Oo=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(u){u===this.current&&!this.dirty||(this.gl.useProgram(u),this.current=u,this.dirty=!1)},l}(bi),ho=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return this.gl.TEXTURE0},l.prototype.set=function(u){u===this.current&&!this.dirty||(this.gl.activeTexture(u),this.current=u,this.dirty=!1)},l}(bi),Vr=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){var u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]},l.prototype.set=function(u){var _=this.current;u[0]===_[0]&&u[1]===_[1]&&u[2]===_[2]&&u[3]===_[3]&&!this.dirty||(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)},l}(bi),Vo=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;_.bindFramebuffer(_.FRAMEBUFFER,u),this.current=u,this.dirty=!1}},l}(bi),tu=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;_.bindRenderbuffer(_.RENDERBUFFER,u),this.current=u,this.dirty=!1}},l}(bi),Uo=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;_.bindTexture(_.TEXTURE_2D,u),this.current=u,this.dirty=!1}},l}(bi),Na=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;_.bindBuffer(_.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}},l}(bi),co=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(u){var _=this.gl;_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1},l}(bi),Nn=function(d){function l(m){d.call(this,m),this.vao=m.extVertexArrayObject}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return null},l.prototype.set=function(u){!this.vao||u===this.current&&!this.dirty||(this.vao.bindVertexArrayOES(u),this.current=u,this.dirty=!1)},l}(bi),vs=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return 4},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;_.pixelStorei(_.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}},l}(bi),eu=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}},l}(bi),iu=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return!1},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){var _=this.gl;_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}},l}(bi),ru=function(d){function l(m,u){d.call(this,m),this.context=m,this.parent=u}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getDefault=function(){return null},l}(bi),wl=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.setDirty=function(){this.dirty=!0},l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){this.context.bindFramebuffer.set(this.parent);var _=this.gl;_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}},l}(ru),Sl=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.set=function(u){if(!(u===this.current&&!this.dirty)){this.context.bindFramebuffer.set(this.parent);var _=this.gl;_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,u),this.current=u,this.dirty=!1}},l}(ru),dt=function(l,m,u,_){this.context=l,this.width=m,this.height=u;var I=l.gl,P=this.framebuffer=I.createFramebuffer();this.colorAttachment=new wl(l,P),_&&(this.depthAttachment=new Sl(l,P))};dt.prototype.destroy=function(){var l=this.context.gl,m=this.colorAttachment.get();if(m&&l.deleteTexture(m),this.depthAttachment){var u=this.depthAttachment.get();u&&l.deleteRenderbuffer(u)}l.deleteFramebuffer(this.framebuffer)};var tt=519,Q=function(l,m,u){this.func=l,this.mask=m,this.range=u};Q.ReadOnly=!1,Q.ReadWrite=!0,Q.disabled=new Q(tt,Q.ReadOnly,[0,1]);var lt=519,gt=7680,Pt=function(l,m,u,_,I,P){this.test=l,this.ref=m,this.mask=u,this.fail=_,this.depthFail=I,this.pass=P};Pt.disabled=new Pt({func:lt,mask:0},0,0,gt,gt,gt);var Nt=0,Mt=1,N=771,O=function(l,m,u){this.blendFunction=l,this.blendColor=m,this.mask=u};O.Replace=[Mt,Nt],O.disabled=new O(O.Replace,v.Color.transparent,[!1,!1,!1,!1]),O.unblended=new O(O.Replace,v.Color.transparent,[!0,!0,!0,!0]),O.alphaBlended=new O([Mt,N],v.Color.transparent,[!0,!0,!0,!0]);var H=1029,W=2305,nt=function(l,m,u){this.enable=l,this.mode=m,this.frontFace=u};nt.disabled=new nt(!1,H,W),nt.backCCW=new nt(!0,H,W);var ft=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ro(this),this.clearDepth=new Os(this),this.clearStencil=new ys(this),this.colorMask=new ln(this),this.depthMask=new un(this),this.stencilMask=new Vn(this),this.stencilFunc=new $n(this),this.stencilOp=new Ua(this),this.stencilTest=new Au(this),this.depthRange=new Bo(this),this.depthTest=new Pn(this),this.depthFunc=new ta(this),this.blend=new gl(this),this.blendFunc=new yl(this),this.blendColor=new ea(this),this.blendEquation=new vl(this),this.cullFace=new xl(this),this.cullFaceSide=new Un(this),this.frontFace=new bl(this),this.program=new Oo(this),this.activeTexture=new ho(this),this.viewport=new Vr(this),this.bindFramebuffer=new Vo(this),this.bindRenderbuffer=new tu(this),this.bindTexture=new Uo(this),this.bindVertexBuffer=new Na(this),this.bindElementBuffer=new co(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Nn(this),this.pixelStoreUnpack=new vs(this),this.pixelStoreUnpackPremultiplyAlpha=new eu(this),this.pixelStoreUnpackFlipY=new iu(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ft.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ft.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ft.prototype.createIndexBuffer=function(l,m){return new _n(this,l,m)},ft.prototype.createVertexBuffer=function(l,m,u){return new Va(this,l,m,u)},ft.prototype.createRenderbuffer=function(l,m,u){var _=this.gl,I=_.createRenderbuffer();return this.bindRenderbuffer.set(I),_.renderbufferStorage(_.RENDERBUFFER,l,m,u),this.bindRenderbuffer.set(null),I},ft.prototype.createFramebuffer=function(l,m,u){return new dt(this,l,m,u)},ft.prototype.clear=function(l){var m=l.color,u=l.depth,_=this.gl,I=0;m&&(I|=_.COLOR_BUFFER_BIT,this.clearColor.set(m),this.colorMask.set([!0,!0,!0,!0])),typeof u<"u"&&(I|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_.clear(I)},ft.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ft.prototype.setDepthMode=function(l){l.func===this.gl.ALWAYS&&!l.mask?this.depthTest.set(!1):(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range))},ft.prototype.setStencilMode=function(l){l.test.func===this.gl.ALWAYS&&!l.mask?this.stencilTest.set(!1):(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask}))},ft.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,O.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ft.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var St=function(d){function l(m,u,_){var I=this;d.call(this),this.id=m,this.dispatcher=_,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(I._sourceLoaded=!0),I._sourceLoaded&&!I._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(I.reload(),I.transform&&I.update(I.transform))}),this.on("error",function(){I._sourceErrored=!0}),this._source=Oa(m,u,_,this),this._tiles={},this._cache=new on(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.onAdd=function(u){this.map=u,this._maxTileCacheSize=u?u._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(u)},l.prototype.onRemove=function(u){this._source&&this._source.onRemove&&this._source.onRemove(u)},l.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var u in this._tiles){var _=this._tiles[u];if(_.state!=="loaded"&&_.state!=="errored")return!1}return!0},l.prototype.getSource=function(){return this._source},l.prototype.pause=function(){this._paused=!0},l.prototype.resume=function(){if(this._paused){var u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform)}},l.prototype._loadTile=function(u,_){return this._source.loadTile(u,_)},l.prototype._unloadTile=function(u){if(this._source.unloadTile)return this._source.unloadTile(u,function(){})},l.prototype._abortTile=function(u){if(this._source.abortTile)return this._source.abortTile(u,function(){})},l.prototype.serialize=function(){return this._source.serialize()},l.prototype.prepare=function(u){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(var _ in this._tiles){var I=this._tiles[_];I.upload(u),I.prepare(this.map.style.imageManager)}},l.prototype.getIds=function(){return v.values(this._tiles).map(function(u){return u.tileID}).sort(It).map(function(u){return u.key})},l.prototype.getRenderableIds=function(u){var _=this,I=[];for(var P in this._tiles)this._isIdRenderable(P,u)&&I.push(this._tiles[P]);return u?I.sort(function(D,q){var G=D.tileID,et=q.tileID,ot=new v.Point(G.canonical.x,G.canonical.y)._rotate(_.transform.angle),at=new v.Point(et.canonical.x,et.canonical.y)._rotate(_.transform.angle);return G.overscaledZ-et.overscaledZ||at.y-ot.y||at.x-ot.x}).map(function(D){return D.tileID.key}):I.map(function(D){return D.tileID}).sort(It).map(function(D){return D.key})},l.prototype.hasRenderableParent=function(u){var _=this.findLoadedParent(u,0);return _?this._isIdRenderable(_.tileID.key):!1},l.prototype._isIdRenderable=function(u,_){return this._tiles[u]&&this._tiles[u].hasData()&&!this._coveredTiles[u]&&(_||!this._tiles[u].holdingForFade())},l.prototype.reload=function(){if(this._paused){this._shouldReloadOnResume=!0;return}this._cache.reset();for(var u in this._tiles)this._tiles[u].state!=="errored"&&this._reloadTile(u,"reloading")},l.prototype._reloadTile=function(u,_){var I=this._tiles[u];I&&(I.state!=="loading"&&(I.state=_),this._loadTile(I,this._tileLoaded.bind(this,I,u,_)))},l.prototype._tileLoaded=function(u,_,I,P){if(P){u.state="errored",P.status!==404?this._source.fire(new v.ErrorEvent(P,{tile:u})):this.update(this.transform);return}u.timeAdded=v.browser.now(),I==="expired"&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(_,u),this.getSource().type==="raster-dem"&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:u,coord:u.tileID}))},l.prototype._backfillDEM=function(u){for(var _=this.getRenderableIds(),I=0;I<_.length;I++){var P=_[I];if(u.neighboringTiles&&u.neighboringTiles[P]){var D=this.getTileByID(P);q(u,D),q(D,u)}}function q(G,et){G.needsHillshadePrepare=!0;var ot=et.tileID.canonical.x-G.tileID.canonical.x,at=et.tileID.canonical.y-G.tileID.canonical.y,pt=Math.pow(2,G.tileID.canonical.z),wt=et.tileID.key;ot===0&&at===0||Math.abs(at)>1||(Math.abs(ot)>1&&(Math.abs(ot+pt)===1?ot+=pt:Math.abs(ot-pt)===1&&(ot-=pt)),!(!et.dem||!G.dem)&&(G.dem.backfillBorder(et.dem,ot,at),G.neighboringTiles&&G.neighboringTiles[wt]&&(G.neighboringTiles[wt].backfilled=!0)))}},l.prototype.getTile=function(u){return this.getTileByID(u.key)},l.prototype.getTileByID=function(u){return this._tiles[u]},l.prototype._retainLoadedChildren=function(u,_,I,P){for(var D in this._tiles){var q=this._tiles[D];if(!(P[D]||!q.hasData()||q.tileID.overscaledZ<=_||q.tileID.overscaledZ>I)){for(var G=q.tileID;q&&q.tileID.overscaledZ>_+1;){var et=q.tileID.scaledTo(q.tileID.overscaledZ-1);q=this._tiles[et.key],q&&q.hasData()&&(G=et)}for(var ot=G;ot.overscaledZ>_;)if(ot=ot.scaledTo(ot.overscaledZ-1),u[ot.key]){P[G.key]=G;break}}}},l.prototype.findLoadedParent=function(u,_){if(u.key in this._loadedParentTiles){var I=this._loadedParentTiles[u.key];return I&&I.tileID.overscaledZ>=_?I:null}for(var P=u.overscaledZ-1;P>=_;P--){var D=u.scaledTo(P),q=this._getLoadedTile(D);if(q)return q}},l.prototype._getLoadedTile=function(u){var _=this._tiles[u.key];if(_&&_.hasData())return _;var I=this._cache.getByKey(u.wrapped().key);return I},l.prototype.updateCacheSize=function(u){var _=Math.ceil(u.width/this._source.tileSize)+1,I=Math.ceil(u.height/this._source.tileSize)+1,P=_*I,D=5,q=Math.floor(P*D),G=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,q):q;this._cache.setMaxSize(G)},l.prototype.handleWrapJump=function(u){var _=this._prevLng===void 0?u:this._prevLng,I=u-_,P=I/360,D=Math.round(P);if(this._prevLng=u,D){var q={};for(var G in this._tiles){var et=this._tiles[G];et.tileID=et.tileID.unwrapTo(et.tileID.wrap+D),q[et.tileID.key]=et}this._tiles=q;for(var ot in this._timers)clearTimeout(this._timers[ot]),delete this._timers[ot];for(var at in this._tiles){var pt=this._tiles[at];this._setTileReloadTimer(at,pt)}}},l.prototype.update=function(u){var _=this;if(this.transform=u,!(!this._sourceLoaded||this._paused)){this.updateCacheSize(u),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={};var I;this.used?this._source.tileID?I=u.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Se){return new v.OverscaledTileID(Se.canonical.z,Se.wrap,Se.canonical.z,Se.canonical.x,Se.canonical.y)}):(I=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(I=I.filter(function(Se){return _._source.hasTile(Se)}))):I=[];var P=u.coveringZoomLevel(this._source),D=Math.max(P-l.maxOverzooming,this._source.minzoom),q=Math.max(P+l.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(I,P);if(Lt(this._source.type)){for(var et={},ot={},at=Object.keys(G),pt=0,wt=at;pt<wt.length;pt+=1){var bt=wt[pt],xt=G[bt],Et=this._tiles[bt];if(!(!Et||Et.fadeEndTime&&Et.fadeEndTime<=v.browser.now())){var kt=this.findLoadedParent(xt,D);kt&&(this._addTile(kt.tileID),et[kt.tileID.key]=kt.tileID),ot[bt]=xt}}this._retainLoadedChildren(ot,P,q,G);for(var Gt in et)G[Gt]||(this._coveredTiles[Gt]=!0,G[Gt]=et[Gt])}for(var Kt in G)this._tiles[Kt].clearFadeHold();for(var ae=v.keysDifference(this._tiles,G),oe=0,ne=ae;oe<ne.length;oe+=1){var he=ne[oe],ge=this._tiles[he];ge.hasSymbolBuckets&&!ge.holdingForFade()?ge.setHoldDuration(this.map._fadeDuration):(!ge.hasSymbolBuckets||ge.symbolFadeFinished())&&this._removeTile(he)}this._updateLoadedParentTileCache()}},l.prototype.releaseSymbolFadeTiles=function(){for(var u in this._tiles)this._tiles[u].holdingForFade()&&this._removeTile(u)},l.prototype._updateRetainedTiles=function(u,_){for(var I={},P={},D=Math.max(_-l.maxOverzooming,this._source.minzoom),q=Math.max(_+l.maxUnderzooming,this._source.minzoom),G={},et=0,ot=u;et<ot.length;et+=1){var at=ot[et],pt=this._addTile(at);I[at.key]=at,!pt.hasData()&&_<this._source.maxzoom&&(G[at.key]=at)}this._retainLoadedChildren(G,_,q,I);for(var wt=0,bt=u;wt<bt.length;wt+=1){var xt=bt[wt],Et=this._tiles[xt.key];if(!Et.hasData()){if(_+1>this._source.maxzoom){var kt=xt.children(this._source.maxzoom)[0],Gt=this.getTile(kt);if(Gt&&Gt.hasData()){I[kt.key]=kt;continue}}else{var Kt=xt.children(this._source.maxzoom);if(I[Kt[0].key]&&I[Kt[1].key]&&I[Kt[2].key]&&I[Kt[3].key])continue}for(var ae=Et.wasRequested(),oe=xt.overscaledZ-1;oe>=D;--oe){var ne=xt.scaledTo(oe);if(P[ne.key]||(P[ne.key]=!0,Et=this.getTile(ne),!Et&&ae&&(Et=this._addTile(ne)),Et&&(I[ne.key]=ne,ae=Et.wasRequested(),Et.hasData())))break}}}return I},l.prototype._updateLoadedParentTileCache=function(){this._loadedParentTiles={};for(var u in this._tiles){for(var _=[],I=void 0,P=this._tiles[u].tileID;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){I=this._loadedParentTiles[P.key];break}_.push(P.key);var D=P.scaledTo(P.overscaledZ-1);if(I=this._getLoadedTile(D),I)break;P=D}for(var q=0,G=_;q<G.length;q+=1){var et=G[q];this._loadedParentTiles[et]=I}}},l.prototype._addTile=function(u){var _=this._tiles[u.key];if(_)return _;_=this._cache.getAndRemove(u),_&&(this._setTileReloadTimer(u.key,_),_.tileID=u,this._state.initializeTileState(_,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,_)));var I=!!_;return I||(_=new v.Tile(u,this._source.tileSize*u.overscaleFactor()),this._loadTile(_,this._tileLoaded.bind(this,_,u.key,_.state))),_?(_.uses++,this._tiles[u.key]=_,I||this._source.fire(new v.Event("dataloading",{tile:_,coord:_.tileID,dataType:"source"})),_):null},l.prototype._setTileReloadTimer=function(u,_){var I=this;u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);var P=_.getExpiryTimeout();P&&(this._timers[u]=setTimeout(function(){I._reloadTile(u,"expired"),delete I._timers[u]},P))},l.prototype._removeTile=function(u){var _=this._tiles[u];_&&(_.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),!(_.uses>0)&&(_.hasData()&&_.state!=="reloading"?this._cache.add(_.tileID,_,_.getExpiryTimeout()):(_.aborted=!0,this._abortTile(_),this._unloadTile(_))))},l.prototype.clearTiles=function(){this._shouldReloadOnResume=!1,this._paused=!1;for(var u in this._tiles)this._removeTile(u);this._cache.reset()},l.prototype.tilesIn=function(u,_,I){var P=this,D=[],q=this.transform;if(!q)return D;for(var G=I?q.getCameraQueryGeometry(u):u,et=u.map(function(oe){return q.pointCoordinate(oe)}),ot=G.map(function(oe){return q.pointCoordinate(oe)}),at=this.getIds(),pt=1/0,wt=1/0,bt=-1/0,xt=-1/0,Et=0,kt=ot;Et<kt.length;Et+=1){var Gt=kt[Et];pt=Math.min(pt,Gt.x),wt=Math.min(wt,Gt.y),bt=Math.max(bt,Gt.x),xt=Math.max(xt,Gt.y)}for(var Kt=function(oe){var ne=P._tiles[at[oe]];if(!ne.holdingForFade()){var he=ne.tileID,ge=Math.pow(2,q.zoom-ne.tileID.overscaledZ),Se=_*ne.queryPadding*v.EXTENT/ne.tileSize/ge,Ce=[he.getTilePoint(new v.MercatorCoordinate(pt,wt)),he.getTilePoint(new v.MercatorCoordinate(bt,xt))];if(Ce[0].x-Se<v.EXTENT&&Ce[0].y-Se<v.EXTENT&&Ce[1].x+Se>=0&&Ce[1].y+Se>=0){var Ee=et.map(function(Ai){return he.getTilePoint(Ai)}),Je=ot.map(function(Ai){return he.getTilePoint(Ai)});D.push({tile:ne,tileID:he,queryGeometry:Ee,cameraQueryGeometry:Je,scale:ge})}}},ae=0;ae<at.length;ae++)Kt(ae);return D},l.prototype.getVisibleCoordinates=function(u){for(var _=this,I=this.getRenderableIds(u).map(function(G){return _._tiles[G].tileID}),P=0,D=I;P<D.length;P+=1){var q=D[P];q.posMatrix=this.transform.calculatePosMatrix(q.toUnwrapped())}return I},l.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Lt(this._source.type))for(var u in this._tiles){var _=this._tiles[u];if(_.fadeEndTime!==void 0&&_.fadeEndTime>=v.browser.now())return!0}return!1},l.prototype.setFeatureState=function(u,_,I){u=u||"_geojsonTileLayer",this._state.updateState(u,_,I)},l.prototype.removeFeatureState=function(u,_,I){u=u||"_geojsonTileLayer",this._state.removeFeatureState(u,_,I)},l.prototype.getFeatureState=function(u,_){return u=u||"_geojsonTileLayer",this._state.getState(u,_)},l.prototype.setDependencies=function(u,_,I){var P=this._tiles[u];P&&P.setDependencies(_,I)},l.prototype.reloadTilesForDependencies=function(u,_){for(var I in this._tiles){var P=this._tiles[I];P.hasDependency(u,_)&&this._reloadTile(I,"reloading")}this._cache.filter(function(D){return!D.hasDependency(u,_)})},l}(v.Evented);St.maxOverzooming=10,St.maxUnderzooming=3;function It(d,l){var m=Math.abs(d.wrap*2)-+(d.wrap<0),u=Math.abs(l.wrap*2)-+(l.wrap<0);return d.overscaledZ-l.overscaledZ||u-m||l.canonical.y-d.canonical.y||l.canonical.x-d.canonical.x}function Lt(d){return d==="raster"||d==="image"||d==="video"}function Vt(){return new v.window.Worker(Gr.workerUrl)}var qt="mapboxgl_preloaded_worker_pool",ee=function(){this.active={}};ee.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<ee.workerCount;)this.workers.push(new Vt);return this.active[l]=!0,this.workers.slice()},ee.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(m){m.terminate()}),this.workers=null)},ee.prototype.isPreloaded=function(){return!!this.active[qt]},ee.prototype.numActive=function(){return Object.keys(this.active).length};var Jt=Math.floor(v.browser.hardwareConcurrency/2);ee.workerCount=Math.max(Math.min(Jt,6),1);var se;function Ae(){return se||(se=new ee),se}function Ie(){var d=Ae();d.acquire(qt)}function We(){var d=se;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(qt),se=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))}function di(d,l){var m={};for(var u in d)u!=="ref"&&(m[u]=d[u]);return v.refProperties.forEach(function(_){_ in l&&(m[_]=l[_])}),m}function mi(d){d=d.slice();for(var l=Object.create(null),m=0;m<d.length;m++)l[d[m].id]=d[m];for(var u=0;u<d.length;u++)"ref"in d[u]&&(d[u]=di(d[u],l[d[u].ref]));return d}function Ht(){var d={},l=v.styleSpec.$version;for(var m in v.styleSpec.$root){var u=v.styleSpec.$root[m];if(u.required){var _=null;m==="version"?_=l:u.type==="array"?_=[]:_={},_!=null&&(d[m]=_)}}return d}var ii={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function tr(d,l,m){m.push({command:ii.addSource,args:[d,l[d]]})}function Qr(d,l,m){l.push({command:ii.removeSource,args:[d]}),m[d]=!0}function Ei(d,l,m,u){Qr(d,m,u),tr(d,l,m)}function er(d,l,m){var u;for(u in d[m])if(d[m].hasOwnProperty(u)&&u!=="data"&&!v.deepEqual(d[m][u],l[m][u]))return!1;for(u in l[m])if(l[m].hasOwnProperty(u)&&u!=="data"&&!v.deepEqual(d[m][u],l[m][u]))return!1;return!0}function xs(d,l,m,u){d=d||{},l=l||{};var _;for(_ in d)d.hasOwnProperty(_)&&(l.hasOwnProperty(_)||Qr(_,m,u));for(_ in l)l.hasOwnProperty(_)&&(d.hasOwnProperty(_)?v.deepEqual(d[_],l[_])||(d[_].type==="geojson"&&l[_].type==="geojson"&&er(d,l,_)?m.push({command:ii.setGeoJSONSourceData,args:[_,l[_].data]}):Ei(_,l,m,u)):tr(_,l,m))}function qn(d,l,m,u,_,I){d=d||{},l=l||{};var P;for(P in d)d.hasOwnProperty(P)&&(v.deepEqual(d[P],l[P])||m.push({command:I,args:[u,P,l[P],_]}));for(P in l)!l.hasOwnProperty(P)||d.hasOwnProperty(P)||v.deepEqual(d[P],l[P])||m.push({command:I,args:[u,P,l[P],_]})}function _a(d){return d.id}function as(d,l){return d[l.id]=l,d}function No(d,l,m){d=d||[],l=l||[];var u=d.map(_a),_=l.map(_a),I=d.reduce(as,{}),P=l.reduce(as,{}),D=u.slice(),q=Object.create(null),G,et,ot,at,pt,wt,bt;for(G=0,et=0;G<u.length;G++)ot=u[G],P.hasOwnProperty(ot)?et++:(m.push({command:ii.removeLayer,args:[ot]}),D.splice(D.indexOf(ot,et),1));for(G=0,et=0;G<_.length;G++)ot=_[_.length-1-G],D[D.length-1-G]!==ot&&(I.hasOwnProperty(ot)?(m.push({command:ii.removeLayer,args:[ot]}),D.splice(D.lastIndexOf(ot,D.length-et),1)):et++,wt=D[D.length-G],m.push({command:ii.addLayer,args:[P[ot],wt]}),D.splice(D.length-G,0,ot),q[ot]=!0);for(G=0;G<_.length;G++)if(ot=_[G],at=I[ot],pt=P[ot],!(q[ot]||v.deepEqual(at,pt))){if(!v.deepEqual(at.source,pt.source)||!v.deepEqual(at["source-layer"],pt["source-layer"])||!v.deepEqual(at.type,pt.type)){m.push({command:ii.removeLayer,args:[ot]}),wt=D[D.lastIndexOf(ot)+1],m.push({command:ii.addLayer,args:[pt,wt]});continue}qn(at.layout,pt.layout,m,ot,null,ii.setLayoutProperty),qn(at.paint,pt.paint,m,ot,null,ii.setPaintProperty),v.deepEqual(at.filter,pt.filter)||m.push({command:ii.setFilter,args:[ot,pt.filter]}),(!v.deepEqual(at.minzoom,pt.minzoom)||!v.deepEqual(at.maxzoom,pt.maxzoom))&&m.push({command:ii.setLayerZoomRange,args:[ot,pt.minzoom,pt.maxzoom]});for(bt in at)at.hasOwnProperty(bt)&&(bt==="layout"||bt==="paint"||bt==="filter"||bt==="metadata"||bt==="minzoom"||bt==="maxzoom"||(bt.indexOf("paint.")===0?qn(at[bt],pt[bt],m,ot,bt.slice(6),ii.setPaintProperty):v.deepEqual(at[bt],pt[bt])||m.push({command:ii.setLayerProperty,args:[ot,bt,pt[bt]]})));for(bt in pt)!pt.hasOwnProperty(bt)||at.hasOwnProperty(bt)||bt==="layout"||bt==="paint"||bt==="filter"||bt==="metadata"||bt==="minzoom"||bt==="maxzoom"||(bt.indexOf("paint.")===0?qn(at[bt],pt[bt],m,ot,bt.slice(6),ii.setPaintProperty):v.deepEqual(at[bt],pt[bt])||m.push({command:ii.setLayerProperty,args:[ot,bt,pt[bt]]}))}}function mr(d,l){if(!d)return[{command:ii.setStyle,args:[l]}];var m=[];try{if(!v.deepEqual(d.version,l.version))return[{command:ii.setStyle,args:[l]}];v.deepEqual(d.center,l.center)||m.push({command:ii.setCenter,args:[l.center]}),v.deepEqual(d.zoom,l.zoom)||m.push({command:ii.setZoom,args:[l.zoom]}),v.deepEqual(d.bearing,l.bearing)||m.push({command:ii.setBearing,args:[l.bearing]}),v.deepEqual(d.pitch,l.pitch)||m.push({command:ii.setPitch,args:[l.pitch]}),v.deepEqual(d.sprite,l.sprite)||m.push({command:ii.setSprite,args:[l.sprite]}),v.deepEqual(d.glyphs,l.glyphs)||m.push({command:ii.setGlyphs,args:[l.glyphs]}),v.deepEqual(d.transition,l.transition)||m.push({command:ii.setTransition,args:[l.transition]}),v.deepEqual(d.light,l.light)||m.push({command:ii.setLight,args:[l.light]});var u={},_=[];xs(d.sources,l.sources,_,u);var I=[];d.layers&&d.layers.forEach(function(P){u[P.source]?m.push({command:ii.removeLayer,args:[P.id]}):I.push(P)}),m=m.concat(_),No(I,l.layers,m)}catch(P){console.warn("Unable to compute style diff:",P),m=[{command:ii.setStyle,args:[l]}]}return m}var Vs=function(l,m){this.reset(l,m)};Vs.prototype.reset=function(l,m){this.points=l||[],this._distances=[0];for(var u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(m||0,this.length*.5),this.paddedLength=this.length-this.padding*2},Vs.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var m=1,u=this._distances[m],_=l*this.paddedLength+this.padding;u<_&&m<this._distances.length;)u=this._distances[++m];var I=m-1,P=this._distances[I],D=u-P,q=D>0?(_-P)/D:0;return this.points[I].mult(1-q).add(this.points[m].mult(q))};var pi=function(l,m,u){var _=this.boxCells=[],I=this.circleCells=[];this.xCellCount=Math.ceil(l/u),this.yCellCount=Math.ceil(m/u);for(var P=0;P<this.xCellCount*this.yCellCount;P++)_.push([]),I.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=m,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/m,this.boxUid=0,this.circleUid=0};pi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},pi.prototype.insert=function(l,m,u,_,I){this._forEachCell(m,u,_,I,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(m),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(I)},pi.prototype.insertCircle=function(l,m,u,_){this._forEachCell(m-_,u-_,m+_,u+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(m),this.circles.push(u),this.circles.push(_)},pi.prototype._insertBoxCell=function(l,m,u,_,I,P){this.boxCells[I].push(P)},pi.prototype._insertCircleCell=function(l,m,u,_,I,P){this.circleCells[I].push(P)},pi.prototype._query=function(l,m,u,_,I,P){if(u<0||l>this.width||_<0||m>this.height)return I?!1:[];var D=[];if(l<=0&&m<=0&&this.width<=u&&this.height<=_){if(I)return!0;for(var q=0;q<this.boxKeys.length;q++)D.push({key:this.boxKeys[q],x1:this.bboxes[q*4],y1:this.bboxes[q*4+1],x2:this.bboxes[q*4+2],y2:this.bboxes[q*4+3]});for(var G=0;G<this.circleKeys.length;G++){var et=this.circles[G*3],ot=this.circles[G*3+1],at=this.circles[G*3+2];D.push({key:this.circleKeys[G],x1:et-at,y1:ot-at,x2:et+at,y2:ot+at})}return P?D.filter(P):D}else{var pt={hitTest:I,seenUids:{box:{},circle:{}}};return this._forEachCell(l,m,u,_,this._queryCell,D,pt,P),I?D.length>0:D}},pi.prototype._queryCircle=function(l,m,u,_,I){var P=l-u,D=l+u,q=m-u,G=m+u;if(D<0||P>this.width||G<0||q>this.height)return _?!1:[];var et=[],ot={hitTest:_,circle:{x:l,y:m,radius:u},seenUids:{box:{},circle:{}}};return this._forEachCell(P,q,D,G,this._queryCellCircle,et,ot,I),_?et.length>0:et},pi.prototype.query=function(l,m,u,_,I){return this._query(l,m,u,_,!1,I)},pi.prototype.hitTest=function(l,m,u,_,I){return this._query(l,m,u,_,!0,I)},pi.prototype.hitTestCircle=function(l,m,u,_){return this._queryCircle(l,m,u,!0,_)},pi.prototype._queryCell=function(l,m,u,_,I,P,D,q){var G=D.seenUids,et=this.boxCells[I];if(et!==null)for(var ot=this.bboxes,at=0,pt=et;at<pt.length;at+=1){var wt=pt[at];if(!G.box[wt]){G.box[wt]=!0;var bt=wt*4;if(l<=ot[bt+2]&&m<=ot[bt+3]&&u>=ot[bt+0]&&_>=ot[bt+1]&&(!q||q(this.boxKeys[wt]))){if(D.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[wt],x1:ot[bt],y1:ot[bt+1],x2:ot[bt+2],y2:ot[bt+3]})}}}var xt=this.circleCells[I];if(xt!==null)for(var Et=this.circles,kt=0,Gt=xt;kt<Gt.length;kt+=1){var Kt=Gt[kt];if(!G.circle[Kt]){G.circle[Kt]=!0;var ae=Kt*3;if(this._circleAndRectCollide(Et[ae],Et[ae+1],Et[ae+2],l,m,u,_)&&(!q||q(this.circleKeys[Kt]))){if(D.hitTest)return P.push(!0),!0;var oe=Et[ae],ne=Et[ae+1],he=Et[ae+2];P.push({key:this.circleKeys[Kt],x1:oe-he,y1:ne-he,x2:oe+he,y2:ne+he})}}}},pi.prototype._queryCellCircle=function(l,m,u,_,I,P,D,q){var G=D.circle,et=D.seenUids,ot=this.boxCells[I];if(ot!==null)for(var at=this.bboxes,pt=0,wt=ot;pt<wt.length;pt+=1){var bt=wt[pt];if(!et.box[bt]){et.box[bt]=!0;var xt=bt*4;if(this._circleAndRectCollide(G.x,G.y,G.radius,at[xt+0],at[xt+1],at[xt+2],at[xt+3])&&(!q||q(this.boxKeys[bt])))return P.push(!0),!0}}var Et=this.circleCells[I];if(Et!==null)for(var kt=this.circles,Gt=0,Kt=Et;Gt<Kt.length;Gt+=1){var ae=Kt[Gt];if(!et.circle[ae]){et.circle[ae]=!0;var oe=ae*3;if(this._circlesCollide(kt[oe],kt[oe+1],kt[oe+2],G.x,G.y,G.radius)&&(!q||q(this.circleKeys[ae])))return P.push(!0),!0}}},pi.prototype._forEachCell=function(l,m,u,_,I,P,D,q){for(var G=this._convertToXCellCoord(l),et=this._convertToYCellCoord(m),ot=this._convertToXCellCoord(u),at=this._convertToYCellCoord(_),pt=G;pt<=ot;pt++)for(var wt=et;wt<=at;wt++){var bt=this.xCellCount*wt+pt;if(I.call(this,l,m,u,_,bt,P,D,q))return}},pi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},pi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},pi.prototype._circlesCollide=function(l,m,u,_,I,P){var D=_-l,q=I-m,G=u+P;return G*G>D*D+q*q},pi.prototype._circleAndRectCollide=function(l,m,u,_,I,P,D){var q=(P-_)/2,G=Math.abs(l-(_+q));if(G>q+u)return!1;var et=(D-I)/2,ot=Math.abs(m-(I+et));if(ot>et+u)return!1;if(G<=q||ot<=et)return!0;var at=G-q,pt=ot-et;return at*at+pt*pt<=u*u};function qa(d,l,m,u,_){var I=v.create();return l?(v.scale(I,I,[1/_,1/_,1]),m||v.rotateZ(I,I,u.angle)):v.multiply(I,u.labelPlaneMatrix,d),I}function Tl(d,l,m,u,_){if(l){var I=v.clone(d);return v.scale(I,I,[_,_,1]),m||v.rotateZ(I,I,-u.angle),I}else return u.glCoordMatrix}function _e(d,l){var m=[d.x,d.y,0,1];wf(m,m,l);var u=m[3];return{point:new v.Point(m[0]/u,m[1]/u),signedDistanceFromCamera:u}}function fo(d,l){return .5+.5*(d/l)}function po(d,l){var m=d[0]/d[3],u=d[1]/d[3],_=m>=-l[0]&&m<=l[0]&&u>=-l[1]&&u<=l[1];return _}function Ac(d,l,m,u,_,I,P,D){var q=u?d.textSizeData:d.iconSizeData,G=v.evaluateSizeForZoom(q,m.transform.zoom),et=[256/m.width*2+1,256/m.height*2+1],ot=u?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;ot.clear();for(var at=d.lineVertexArray,pt=u?d.text.placedSymbolArray:d.icon.placedSymbolArray,wt=m.transform.width/m.transform.height,bt=!1,xt=0;xt<pt.length;xt++){var Et=pt.get(xt);if(Et.hidden||Et.writingMode===v.WritingMode.vertical&&!bt){vi(Et.numGlyphs,ot);continue}bt=!1;var kt=[Et.anchorX,Et.anchorY,0,1];if(v.transformMat4(kt,kt,l),!po(kt,et)){vi(Et.numGlyphs,ot);continue}var Gt=kt[3],Kt=fo(m.transform.cameraToCenterDistance,Gt),ae=v.evaluateSizeForFeature(q,G,Et),oe=P?ae/Kt:ae*Kt,ne=new v.Point(Et.anchorX,Et.anchorY),he=_e(ne,_).point,ge={},Se=Di(Et,oe,!1,D,l,_,I,d.glyphOffsetArray,at,ot,he,ne,ge,wt);bt=Se.useVertical,(Se.notEnoughRoom||bt||Se.needsFlipping&&Di(Et,oe,!0,D,l,_,I,d.glyphOffsetArray,at,ot,he,ne,ge,wt).notEnoughRoom)&&vi(Et.numGlyphs,ot)}u?d.text.dynamicLayoutVertexBuffer.updateData(ot):d.icon.dynamicLayoutVertexBuffer.updateData(ot)}function nu(d,l,m,u,_,I,P,D,q,G,et){var ot=D.glyphStartIndex+D.numGlyphs,at=D.lineStartIndex,pt=D.lineStartIndex+D.lineLength,wt=l.getoffsetX(D.glyphStartIndex),bt=l.getoffsetX(ot-1),xt=Za(d*wt,m,u,_,I,P,D.segment,at,pt,q,G,et);if(!xt)return null;var Et=Za(d*bt,m,u,_,I,P,D.segment,at,pt,q,G,et);return Et?{first:xt,last:Et}:null}function Me(d,l,m,u){if(d===v.WritingMode.horizontal){var _=Math.abs(m.y-l.y),I=Math.abs(m.x-l.x)*u;if(_>I)return{useVertical:!0}}return(d===v.WritingMode.vertical?l.y<m.y:l.x>m.x)?{needsFlipping:!0}:null}function Di(d,l,m,u,_,I,P,D,q,G,et,ot,at,pt){var wt=l/24,bt=d.lineOffsetX*wt,xt=d.lineOffsetY*wt,Et;if(d.numGlyphs>1){var kt=d.glyphStartIndex+d.numGlyphs,Gt=d.lineStartIndex,Kt=d.lineStartIndex+d.lineLength,ae=nu(wt,D,bt,xt,m,et,ot,d,q,I,at);if(!ae)return{notEnoughRoom:!0};var oe=_e(ae.first.point,P).point,ne=_e(ae.last.point,P).point;if(u&&!m){var he=Me(d.writingMode,oe,ne,pt);if(he)return he}Et=[ae.first];for(var ge=d.glyphStartIndex+1;ge<kt-1;ge++)Et.push(Za(wt*D.getoffsetX(ge),bt,xt,m,et,ot,d.segment,Gt,Kt,q,I,at));Et.push(ae.last)}else{if(u&&!m){var Se=_e(ot,_).point,Ce=d.lineStartIndex+d.segment+1,Ee=new v.Point(q.getx(Ce),q.gety(Ce)),Je=_e(Ee,_),Ai=Je.signedDistanceFromCamera>0?Je.point:Ci(ot,Ee,Se,1,_),_i=Me(d.writingMode,Se,Ai,pt);if(_i)return _i}var Re=Za(wt*D.getoffsetX(d.glyphStartIndex),bt,xt,m,et,ot,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,q,I,at);if(!Re)return{notEnoughRoom:!0};Et=[Re]}for(var fi=0,si=Et;fi<si.length;fi+=1){var Li=si[fi];v.addDynamicAttributes(G,Li.point,Li.angle)}return{}}function Ci(d,l,m,u,_){var I=_e(d.add(d.sub(l)._unit()),_).point,P=m.sub(I);return m.add(P._mult(u/P.mag()))}function Za(d,l,m,u,_,I,P,D,q,G,et,ot){var at=u?d-l:d+l,pt=at>0?1:-1,wt=0;u&&(pt*=-1,wt=Math.PI),pt<0&&(wt+=Math.PI);for(var bt=pt>0?D+P:D+P+1,xt=_,Et=_,kt=0,Gt=0,Kt=Math.abs(at),ae=[];kt+Gt<=Kt;){if(bt+=pt,bt<D||bt>=q)return null;if(Et=xt,ae.push(xt),xt=ot[bt],xt===void 0){var oe=new v.Point(G.getx(bt),G.gety(bt)),ne=_e(oe,et);if(ne.signedDistanceFromCamera>0)xt=ot[bt]=ne.point;else{var he=bt-pt,ge=kt===0?I:new v.Point(G.getx(he),G.gety(he));xt=Ci(ge,oe,Et,Kt-kt+1,et)}}kt+=Gt,Gt=Et.dist(xt)}var Se=(Kt-kt)/Gt,Ce=xt.sub(Et),Ee=Ce.mult(Se)._add(Et);Ee._add(Ce._unit()._perp()._mult(m*pt));var Je=wt+Math.atan2(xt.y-Et.y,xt.x-Et.x);return ae.push(Ee),{point:Ee,angle:Je,path:ae}}var Mu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function vi(d,l){for(var m=0;m<d;m++){var u=l.length;l.resize(u+4),l.float32.set(Mu,u*3)}}function wf(d,l,m){var u=l[0],_=l[1];return d[0]=m[0]*u+m[4]*_+m[12],d[1]=m[1]*u+m[5]*_+m[13],d[3]=m[3]*u+m[7]*_+m[15],d}var gn=100,ja=function(l,m,u){m===void 0&&(m=new pi(l.width+2*gn,l.height+2*gn,25)),u===void 0&&(u=new pi(l.width+2*gn,l.height+2*gn,25)),this.transform=l,this.grid=m,this.ignoredGrid=u,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+gn,this.screenBottomBoundary=l.height+gn,this.gridRightBoundary=l.width+2*gn,this.gridBottomBoundary=l.height+2*gn};ja.prototype.placeCollisionBox=function(l,m,u,_,I){var P=this.projectAndGetPerspectiveRatio(_,l.anchorPointX,l.anchorPointY),D=u*P.perspectiveRatio,q=l.x1*D+P.point.x,G=l.y1*D+P.point.y,et=l.x2*D+P.point.x,ot=l.y2*D+P.point.y;return!this.isInsideGrid(q,G,et,ot)||!m&&this.grid.hitTest(q,G,et,ot,I)?{box:[],offscreen:!1}:{box:[q,G,et,ot],offscreen:this.isOffscreen(q,G,et,ot)}},ja.prototype.placeCollisionCircles=function(l,m,u,_,I,P,D,q,G,et,ot,at,pt){var wt=[],bt=new v.Point(m.anchorX,m.anchorY),xt=_e(bt,P),Et=fo(this.transform.cameraToCenterDistance,xt.signedDistanceFromCamera),kt=et?I/Et:I*Et,Gt=kt/v.ONE_EM,Kt=_e(bt,D).point,ae={},oe=m.lineOffsetX*Gt,ne=m.lineOffsetY*Gt,he=nu(Gt,_,oe,ne,!1,Kt,bt,m,u,D,ae),ge=!1,Se=!1,Ce=!0;if(he){for(var Ee=at*.5*Et+pt,Je=new v.Point(-100,-100),Ai=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),_i=new Vs,Re=he.first,fi=he.last,si=[],Li=Re.path.length-1;Li>=1;Li--)si.push(Re.path[Li]);for(var Mi=1;Mi<fi.path.length;Mi++)si.push(fi.path[Mi]);var or=Ee*2.5;if(q){var wi=si.map(function(fs){return _e(fs,q)});wi.some(function(fs){return fs.signedDistanceFromCamera<=0})?si=[]:si=wi.map(function(fs){return fs.point})}var ir=[];if(si.length>0){for(var ri=si[0].clone(),Ti=si[0].clone(),Lr=1;Lr<si.length;Lr++)ri.x=Math.min(ri.x,si[Lr].x),ri.y=Math.min(ri.y,si[Lr].y),Ti.x=Math.max(Ti.x,si[Lr].x),Ti.y=Math.max(Ti.y,si[Lr].y);ri.x>=Je.x&&Ti.x<=Ai.x&&ri.y>=Je.y&&Ti.y<=Ai.y?ir=[si]:Ti.x<Je.x||ri.x>Ai.x||Ti.y<Je.y||ri.y>Ai.y?ir=[]:ir=v.clipLine([si],Je.x,Je.y,Ai.x,Ai.y)}for(var cn=0,As=ir;cn<As.length;cn+=1){var cs=As[cn];_i.reset(cs,Ee*.25);var Aa=0;_i.length<=.5*Ee?Aa=1:Aa=Math.ceil(_i.paddedLength/or)+1;for(var Ma=0;Ma<Aa;Ma++){var bu=Ma/Math.max(Aa-1,1),Io=_i.lerp(bu),za=Io.x+gn,Ys=Io.y+gn;wt.push(za,Ys,Ee,0);var Qa=za-Ee,Da=Ys-Ee,Ms=za+Ee,$a=Ys+Ee;if(Ce=Ce&&this.isOffscreen(Qa,Da,Ms,$a),Se=Se||this.isInsideGrid(Qa,Da,Ms,$a),!l&&this.grid.hitTestCircle(za,Ys,Ee,ot)&&(ge=!0,!G))return{circles:[],offscreen:!1,collisionDetected:ge}}}}return{circles:!G&&ge||!Se?[]:wt,offscreen:Ce,collisionDetected:ge}},ja.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var m=[],u=1/0,_=1/0,I=-1/0,P=-1/0,D=0,q=l;D<q.length;D+=1){var G=q[D],et=new v.Point(G.x+gn,G.y+gn);u=Math.min(u,et.x),_=Math.min(_,et.y),I=Math.max(I,et.x),P=Math.max(P,et.y),m.push(et)}for(var ot=this.grid.query(u,_,I,P).concat(this.ignoredGrid.query(u,_,I,P)),at={},pt={},wt=0,bt=ot;wt<bt.length;wt+=1){var xt=bt[wt],Et=xt.key;if(at[Et.bucketInstanceId]===void 0&&(at[Et.bucketInstanceId]={}),!at[Et.bucketInstanceId][Et.featureIndex]){var kt=[new v.Point(xt.x1,xt.y1),new v.Point(xt.x2,xt.y1),new v.Point(xt.x2,xt.y2),new v.Point(xt.x1,xt.y2)];v.polygonIntersectsPolygon(m,kt)&&(at[Et.bucketInstanceId][Et.featureIndex]=!0,pt[Et.bucketInstanceId]===void 0&&(pt[Et.bucketInstanceId]=[]),pt[Et.bucketInstanceId].push(Et.featureIndex))}}return pt},ja.prototype.insertCollisionBox=function(l,m,u,_,I){var P=m?this.ignoredGrid:this.grid,D={bucketInstanceId:u,featureIndex:_,collisionGroupID:I};P.insert(D,l[0],l[1],l[2],l[3])},ja.prototype.insertCollisionCircles=function(l,m,u,_,I){for(var P=m?this.ignoredGrid:this.grid,D={bucketInstanceId:u,featureIndex:_,collisionGroupID:I},q=0;q<l.length;q+=4)P.insertCircle(D,l[q],l[q+1],l[q+2])},ja.prototype.projectAndGetPerspectiveRatio=function(l,m,u){var _=[m,u,0,1];wf(_,_,l);var I=new v.Point((_[0]/_[3]+1)/2*this.transform.width+gn,(-_[1]/_[3]+1)/2*this.transform.height+gn);return{point:I,perspectiveRatio:.5+.5*(this.transform.cameraToCenterDistance/_[3])}},ja.prototype.isOffscreen=function(l,m,u,_){return u<gn||l>=this.screenRightBoundary||_<gn||m>this.screenBottomBoundary},ja.prototype.isInsideGrid=function(l,m,u,_){return u>=0&&l<this.gridRightBoundary&&_>=0&&m<this.gridBottomBoundary},ja.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};function Zn(d,l,m){return l*(v.EXTENT/(d.tileSize*Math.pow(2,m-d.tileID.overscaledZ)))}var Us=function(l,m,u,_){l?this.opacity=Math.max(0,Math.min(1,l.opacity+(l.placed?m:-m))):this.opacity=_&&u?1:0,this.placed=u};Us.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ns=function(l,m,u,_,I){this.text=new Us(l?l.text:null,m,u,I),this.icon=new Us(l?l.icon:null,m,_,I)};Ns.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ga=function(l,m,u){this.text=l,this.icon=m,this.skipFade=u},zr=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},pd=function(l,m,u,_,I){this.bucketInstanceId=l,this.featureIndex=m,this.sourceLayerIndex=u,this.bucketIndex=_,this.tileID=I},mo=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};mo.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var m=++this.maxGroupID;this.collisionGroups[l]={ID:m,predicate:function(u){return u.collisionGroupID===m}}}return this.collisionGroups[l]};function Uh(d,l,m,u,_){var I=v.getAnchorAlignment(d),P=I.horizontalAlign,D=I.verticalAlign,q=-(P-.5)*l,G=-(D-.5)*m,et=v.evaluateVariableOffset(d,u);return new v.Point(q+et[0]*_,G+et[1]*_)}function qo(d,l,m,u,_,I){var P=d.x1,D=d.x2,q=d.y1,G=d.y2,et=d.anchorPointX,ot=d.anchorPointY,at=new v.Point(l,m);return u&&at._rotate(_?I:-I),{x1:P+at.x,y1:q+at.y,x2:D+at.x,y2:G+at.y,anchorPointX:et,anchorPointY:ot}}var An=function(l,m,u,_){this.transform=l.clone(),this.collisionIndex=new ja(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new mo(u),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}};An.prototype.getBucketParts=function(l,m,u,_){var I=u.getBucket(m),P=u.latestFeatureIndex;if(!(!I||!P||m.id!==I.layerIds[0])){var D=u.collisionBoxArray,q=I.layers[0].layout,G=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),et=u.tileSize/v.EXTENT,ot=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),at=q.get("text-pitch-alignment")==="map",pt=q.get("text-rotation-alignment")==="map",wt=Zn(u,1,this.transform.zoom),bt=qa(ot,at,pt,this.transform,wt),xt=null;if(at){var Et=Tl(ot,at,pt,this.transform,wt);xt=v.multiply([],this.transform.labelPlaneMatrix,Et)}this.retainedQueryData[I.bucketInstanceId]=new pd(I.bucketInstanceId,P,I.sourceLayerIndex,I.index,u.tileID);var kt={bucket:I,layout:q,posMatrix:ot,textLabelPlaneMatrix:bt,labelToScreenMatrix:xt,scale:G,textPixelRatio:et,holdingForFade:u.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(I.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(I.sourceID)};if(_)for(var Gt=0,Kt=I.sortKeyRanges;Gt<Kt.length;Gt+=1){var ae=Kt[Gt],oe=ae.sortKey,ne=ae.symbolInstanceStart,he=ae.symbolInstanceEnd;l.push({sortKey:oe,symbolInstanceStart:ne,symbolInstanceEnd:he,parameters:kt})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:kt})}},An.prototype.attemptAnchorPlacement=function(l,m,u,_,I,P,D,q,G,et,ot,at,pt,wt,bt){var xt=[at.textOffset0,at.textOffset1],Et=Uh(l,u,_,xt,I),kt=this.collisionIndex.placeCollisionBox(qo(m,Et.x,Et.y,P,D,this.transform.angle),ot,q,G,et.predicate);if(bt){var Gt=this.collisionIndex.placeCollisionBox(qo(bt,Et.x,Et.y,P,D,this.transform.angle),ot,q,G,et.predicate);if(Gt.box.length===0)return}if(kt.box.length>0){var Kt;return this.prevPlacement&&this.prevPlacement.variableOffsets[at.crossTileID]&&this.prevPlacement.placements[at.crossTileID]&&this.prevPlacement.placements[at.crossTileID].text&&(Kt=this.prevPlacement.variableOffsets[at.crossTileID].anchor),this.variableOffsets[at.crossTileID]={textOffset:xt,width:u,height:_,anchor:l,textBoxScale:I,prevAnchor:Kt},this.markUsedJustification(pt,l,at,wt),pt.allowVerticalPlacement&&(this.markUsedOrientation(pt,wt,at),this.placedOrientations[at.crossTileID]=wt),{shift:Et,placedGlyphBoxes:kt}}},An.prototype.placeLayerBucketPart=function(l,m,u){var _=this,I=l.parameters,P=I.bucket,D=I.layout,q=I.posMatrix,G=I.textLabelPlaneMatrix,et=I.labelToScreenMatrix,ot=I.textPixelRatio,at=I.holdingForFade,pt=I.collisionBoxArray,wt=I.partiallyEvaluatedTextSize,bt=I.collisionGroup,xt=D.get("text-optional"),Et=D.get("icon-optional"),kt=D.get("text-allow-overlap"),Gt=D.get("icon-allow-overlap"),Kt=D.get("text-rotation-alignment")==="map",ae=D.get("text-pitch-alignment")==="map",oe=D.get("icon-text-fit")!=="none",ne=D.get("symbol-z-order")==="viewport-y",he=kt&&(Gt||!P.hasIconData()||Et),ge=Gt&&(kt||!P.hasTextData()||xt);!P.collisionArrays&&pt&&P.deserializeCollisionBoxes(pt);var Se=function(Re,fi){if(!m[Re.crossTileID]){if(at){_.placements[Re.crossTileID]=new Ga(!1,!1,!1);return}var si=!1,Li=!1,Mi=!0,or=null,wi={box:null,offscreen:null},ir={box:null},ri=null,Ti=null,Lr=null,cn=0,As=0,cs=0;fi.textFeatureIndex?cn=fi.textFeatureIndex:Re.useRuntimeCollisionCircles&&(cn=Re.featureIndex),fi.verticalTextFeatureIndex&&(As=fi.verticalTextFeatureIndex);var Aa=fi.textBox;if(Aa){var Ma=function(f){var g=v.WritingMode.horizontal;if(P.allowVerticalPlacement&&!f&&_.prevPlacement){var S=_.prevPlacement.placedOrientations[Re.crossTileID];S&&(_.placedOrientations[Re.crossTileID]=S,g=S,_.markUsedOrientation(P,g,Re))}return g},bu=function(f,g){if(P.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&fi.verticalTextBox)for(var S=0,z=P.writingModes;S<z.length;S+=1){var k=z[S];if(k===v.WritingMode.vertical?(wi=g(),ir=wi):wi=f(),wi&&wi.box&&wi.box.length)break}else wi=f()};if(D.get("text-variable-anchor")){var Qa=D.get("text-variable-anchor");if(_.prevPlacement&&_.prevPlacement.variableOffsets[Re.crossTileID]){var Da=_.prevPlacement.variableOffsets[Re.crossTileID];Qa.indexOf(Da.anchor)>0&&(Qa=Qa.filter(function(f){return f!==Da.anchor}),Qa.unshift(Da.anchor))}var Ms=function(f,g,S){for(var z=f.x2-f.x1,k=f.y2-f.y1,R=Re.textBoxScale,X=oe&&!Gt?g:null,K={box:[],offscreen:!1},J=kt?Qa.length*2:Qa.length,ut=0;ut<J;++ut){var mt=Qa[ut%Qa.length],vt=ut>=Qa.length,Tt=_.attemptAnchorPlacement(mt,f,z,k,R,Kt,ae,ot,q,bt,vt,Re,P,S,X);if(Tt&&(K=Tt.placedGlyphBoxes,K&&K.box&&K.box.length)){si=!0,or=Tt.shift;break}}return K},$a=function(){return Ms(Aa,fi.iconBox,v.WritingMode.horizontal)},fs=function(){var f=fi.verticalTextBox,g=wi&&wi.box&&wi.box.length;return P.allowVerticalPlacement&&!g&&Re.numVerticalGlyphVertices>0&&f?Ms(f,fi.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}};bu($a,fs),wi&&(si=wi.box,Mi=wi.offscreen);var gc=Ma(wi&&wi.box);if(!si&&_.prevPlacement){var th=_.prevPlacement.variableOffsets[Re.crossTileID];th&&(_.variableOffsets[Re.crossTileID]=th,_.markUsedJustification(P,th.anchor,Re,gc))}}else{var Io=function(f,g){var S=_.collisionIndex.placeCollisionBox(f,kt,ot,q,bt.predicate);return S&&S.box&&S.box.length&&(_.markUsedOrientation(P,g,Re),_.placedOrientations[Re.crossTileID]=g),S},za=function(){return Io(Aa,v.WritingMode.horizontal)},Ys=function(){var f=fi.verticalTextBox;return P.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&f?Io(f,v.WritingMode.vertical):{box:null,offscreen:null}};bu(za,Ys),Ma(wi&&wi.box&&wi.box.length)}}if(ri=wi,si=ri&&ri.box&&ri.box.length>0,Mi=ri&&ri.offscreen,Re.useRuntimeCollisionCircles){var bn=P.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex),cf=v.evaluateSizeForFeature(P.textSizeData,wt,bn),yc=D.get("text-padding"),lr=Re.collisionCircleDiameter;Ti=_.collisionIndex.placeCollisionCircles(kt,bn,P.lineVertexArray,P.glyphOffsetArray,cf,q,G,et,u,ae,bt.predicate,lr,yc),si=kt||Ti.circles.length>0&&!Ti.collisionDetected,Mi=Mi&&Ti.offscreen}if(fi.iconFeatureIndex&&(cs=fi.iconFeatureIndex),fi.iconBox){var wu=function(f){var g=oe&&or?qo(f,or.x,or.y,Kt,ae,_.transform.angle):f;return _.collisionIndex.placeCollisionBox(g,Gt,ot,q,bt.predicate)};ir&&ir.box&&ir.box.length&&fi.verticalIconBox?(Lr=wu(fi.verticalIconBox),Li=Lr.box.length>0):(Lr=wu(fi.iconBox),Li=Lr.box.length>0),Mi=Mi&&Lr.offscreen}var Su=xt||Re.numHorizontalGlyphVertices===0&&Re.numVerticalGlyphVertices===0,Tu=Et||Re.numIconVertices===0;if(!Su&&!Tu?Li=si=Li&&si:Tu?Su||(Li=Li&&si):si=Li&&si,si&&ri&&ri.box&&(ir&&ir.box&&As?_.collisionIndex.insertCollisionBox(ri.box,D.get("text-ignore-placement"),P.bucketInstanceId,As,bt.ID):_.collisionIndex.insertCollisionBox(ri.box,D.get("text-ignore-placement"),P.bucketInstanceId,cn,bt.ID)),Li&&Lr&&_.collisionIndex.insertCollisionBox(Lr.box,D.get("icon-ignore-placement"),P.bucketInstanceId,cs,bt.ID),Ti&&(si&&_.collisionIndex.insertCollisionCircles(Ti.circles,D.get("text-ignore-placement"),P.bucketInstanceId,cn,bt.ID),u)){var w=P.bucketInstanceId,t=_.collisionCircleArrays[w];t===void 0&&(t=_.collisionCircleArrays[w]=new zr);for(var o=0;o<Ti.circles.length;o+=4)t.circles.push(Ti.circles[o+0]),t.circles.push(Ti.circles[o+1]),t.circles.push(Ti.circles[o+2]),t.circles.push(Ti.collisionDetected?1:0)}_.placements[Re.crossTileID]=new Ga(si||he,Li||ge,Mi||P.justReloaded),m[Re.crossTileID]=!0}};if(ne)for(var Ce=P.getSortedSymbolIndexes(this.transform.angle),Ee=Ce.length-1;Ee>=0;--Ee){var Je=Ce[Ee];Se(P.symbolInstances.get(Je),P.collisionArrays[Je])}else for(var Ai=l.symbolInstanceStart;Ai<l.symbolInstanceEnd;Ai++)Se(P.symbolInstances.get(Ai),P.collisionArrays[Ai]);if(u&&P.bucketInstanceId in this.collisionCircleArrays){var _i=this.collisionCircleArrays[P.bucketInstanceId];v.invert(_i.invProjMatrix,q),_i.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1},An.prototype.markUsedJustification=function(l,m,u,_){var I={left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex},P;_===v.WritingMode.vertical?P=u.verticalPlacedTextSymbolIndex:P=I[v.getAnchorJustification(m)];for(var D=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex],q=0,G=D;q<G.length;q+=1){var et=G[q];et>=0&&(P>=0&&et!==P?l.text.placedSymbolArray.get(et).crossTileID=0:l.text.placedSymbolArray.get(et).crossTileID=u.crossTileID)}},An.prototype.markUsedOrientation=function(l,m,u){for(var _=m===v.WritingMode.horizontal||m===v.WritingMode.horizontalOnly?m:0,I=m===v.WritingMode.vertical?m:0,P=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex],D=0,q=P;D<q.length;D+=1){var G=q[D];l.text.placedSymbolArray.get(G).placedOrientation=_}u.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=I)},An.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var m=this.prevPlacement,u=!1;this.prevZoomAdjustment=m?m.zoomAdjustment(this.transform.zoom):0;var _=m?m.symbolFadeChange(l):1,I=m?m.opacities:{},P=m?m.variableOffsets:{},D=m?m.placedOrientations:{};for(var q in this.placements){var G=this.placements[q],et=I[q];et?(this.opacities[q]=new Ns(et,_,G.text,G.icon),u=u||G.text!==et.text.placed||G.icon!==et.icon.placed):(this.opacities[q]=new Ns(null,_,G.text,G.icon,G.skipFade),u=u||G.text||G.icon)}for(var ot in I){var at=I[ot];if(!this.opacities[ot]){var pt=new Ns(at,_,!1,!1);pt.isHidden()||(this.opacities[ot]=pt,u=u||at.text.placed||at.icon.placed)}}for(var wt in P)!this.variableOffsets[wt]&&this.opacities[wt]&&!this.opacities[wt].isHidden()&&(this.variableOffsets[wt]=P[wt]);for(var bt in D)!this.placedOrientations[bt]&&this.opacities[bt]&&!this.opacities[bt].isHidden()&&(this.placedOrientations[bt]=D[bt]);u?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=m?m.lastPlacementChangeTime:l)},An.prototype.updateLayerOpacities=function(l,m){for(var u={},_=0,I=m;_<I.length;_+=1){var P=I[_],D=P.getBucket(l);D&&P.latestFeatureIndex&&l.id===D.layerIds[0]&&this.updateBucketOpacities(D,u,P.collisionBoxArray)}},An.prototype.updateBucketOpacities=function(l,m,u){var _=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var I=l.layers[0].layout,P=new Ns(null,0,!1,!1,!0),D=I.get("text-allow-overlap"),q=I.get("icon-allow-overlap"),G=I.get("text-variable-anchor"),et=I.get("text-rotation-alignment")==="map",ot=I.get("text-pitch-alignment")==="map",at=I.get("icon-text-fit")!=="none",pt=new Ns(null,0,D&&(q||!l.hasIconData()||I.get("icon-optional")),q&&(D||!l.hasTextData()||I.get("text-optional")),!0);!l.collisionArrays&&u&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(u);for(var wt=function(kt,Gt,Kt){for(var ae=0;ae<Gt/4;ae++)kt.opacityVertexArray.emplaceBack(Kt)},bt=function(kt){var Gt=l.symbolInstances.get(kt),Kt=Gt.numHorizontalGlyphVertices,ae=Gt.numVerticalGlyphVertices,oe=Gt.crossTileID,ne=m[oe],he=_.opacities[oe];ne?he=P:he||(he=pt,_.opacities[oe]=he),m[oe]=!0;var ge=Kt>0||ae>0,Se=Gt.numIconVertices>0,Ce=_.placedOrientations[Gt.crossTileID],Ee=Ce===v.WritingMode.vertical,Je=Ce===v.WritingMode.horizontal||Ce===v.WritingMode.horizontalOnly;if(ge){var Ai=Du(he.text),_i=Ee?ze:Ai;wt(l.text,Kt,_i);var Re=Je?ze:Ai;wt(l.text,ae,Re);var fi=he.text.isHidden();[Gt.rightJustifiedTextSymbolIndex,Gt.centerJustifiedTextSymbolIndex,Gt.leftJustifiedTextSymbolIndex].forEach(function(cs){cs>=0&&(l.text.placedSymbolArray.get(cs).hidden=fi||Ee?1:0)}),Gt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Gt.verticalPlacedTextSymbolIndex).hidden=fi||Je?1:0);var si=_.variableOffsets[Gt.crossTileID];si&&_.markUsedJustification(l,si.anchor,Gt,Ce);var Li=_.placedOrientations[Gt.crossTileID];Li&&(_.markUsedJustification(l,"left",Gt,Li),_.markUsedOrientation(l,Li,Gt))}if(Se){var Mi=Du(he.icon),or=!(at&&Gt.verticalPlacedIconSymbolIndex&&Ee);if(Gt.placedIconSymbolIndex>=0){var wi=or?Mi:ze;wt(l.icon,Gt.numIconVertices,wi),l.icon.placedSymbolArray.get(Gt.placedIconSymbolIndex).hidden=he.icon.isHidden()}if(Gt.verticalPlacedIconSymbolIndex>=0){var ir=or?ze:Mi;wt(l.icon,Gt.numVerticalIconVertices,ir),l.icon.placedSymbolArray.get(Gt.verticalPlacedIconSymbolIndex).hidden=he.icon.isHidden()}}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var ri=l.collisionArrays[kt];if(ri){var Ti=new v.Point(0,0);if(ri.textBox||ri.verticalTextBox){var Lr=!0;if(G){var cn=_.variableOffsets[oe];cn?(Ti=Uh(cn.anchor,cn.width,cn.height,cn.textOffset,cn.textBoxScale),et&&Ti._rotate(ot?_.transform.angle:-_.transform.angle)):Lr=!1}ri.textBox&&ue(l.textCollisionBox.collisionVertexArray,he.text.placed,!Lr||Ee,Ti.x,Ti.y),ri.verticalTextBox&&ue(l.textCollisionBox.collisionVertexArray,he.text.placed,!Lr||Je,Ti.x,Ti.y)}var As=!!(!Je&&ri.verticalIconBox);ri.iconBox&&ue(l.iconCollisionBox.collisionVertexArray,he.icon.placed,As,at?Ti.x:0,at?Ti.y:0),ri.verticalIconBox&&ue(l.iconCollisionBox.collisionVertexArray,he.icon.placed,!As,at?Ti.x:0,at?Ti.y:0)}}},xt=0;xt<l.symbolInstances.length;xt++)bt(xt);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Et=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Et.invProjMatrix,l.placementViewportMatrix=Et.viewportMatrix,l.collisionCircleArray=Et.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},An.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},An.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},An.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},An.prototype.stillRecent=function(l,m){var u=this.zoomAtLastRecencyCheck===m?1-this.zoomAdjustment(m):1;return this.zoomAtLastRecencyCheck=m,this.commitTime+this.fadeDuration*u>l},An.prototype.setStale=function(){this.stale=!0};function ue(d,l,m,u,_){d.emplaceBack(l?1:0,m?1:0,u||0,_||0),d.emplaceBack(l?1:0,m?1:0,u||0,_||0),d.emplaceBack(l?1:0,m?1:0,u||0,_||0),d.emplaceBack(l?1:0,m?1:0,u||0,_||0)}var Ue=Math.pow(2,25),zu=Math.pow(2,24),au=Math.pow(2,17),vr=Math.pow(2,16),qs=Math.pow(2,9),_o=Math.pow(2,8),lh=Math.pow(2,1);function Du(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;var l=d.placed?1:0,m=Math.floor(d.opacity*127);return m*Ue+l*zu+m*au+l*vr+m*qs+l*_o+m*lh+l}var ze=0,ki=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ki.prototype.continuePlacement=function(l,m,u,_,I){for(var P=this._bucketParts;this._currentTileIndex<l.length;){var D=l[this._currentTileIndex];if(m.getBucketParts(P,_,D,this._sortAcrossTiles),this._currentTileIndex++,I())return!0}for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(function(G,et){return G.sortKey-et.sortKey}));this._currentPartIndex<P.length;){var q=P[this._currentPartIndex];if(m.placeLayerBucketPart(q,this._seenCrossTileIDs,u),this._currentPartIndex++,I())return!0}return!1};var xi=function(l,m,u,_,I,P,D){this.placement=new An(l,I,P,D),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=_,this._done=!1};xi.prototype.isDone=function(){return this._done},xi.prototype.continuePlacement=function(l,m,u){for(var _=this,I=v.browser.now(),P=function(){var ot=v.browser.now()-I;return _._forceFullPlacement?!1:ot>2};this._currentPlacementIndex>=0;){var D=l[this._currentPlacementIndex],q=m[D],G=this.placement.collisionIndex.transform.zoom;if(q.type==="symbol"&&(!q.minzoom||q.minzoom<=G)&&(!q.maxzoom||q.maxzoom>G)){this._inProgressLayer||(this._inProgressLayer=new ki(q));var et=this._inProgressLayer.continuePlacement(u[q.source],this.placement,this._showCollisionBoxes,q,P);if(et)return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},xi.prototype.commit=function(l){return this.placement.commit(l),this.placement};var bs=512/v.EXTENT/2,Zo=function(l,m,u){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(var _=0;_<m.length;_++){var I=m.get(_),P=I.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:I.crossTileID,coord:this.getScaledCoordinates(I,l)})}};Zo.prototype.getScaledCoordinates=function(l,m){var u=m.canonical.z-this.tileID.canonical.z,_=bs/Math.pow(2,u);return{x:Math.floor((m.canonical.x*v.EXTENT+l.anchorX)*_),y:Math.floor((m.canonical.y*v.EXTENT+l.anchorY)*_)}},Zo.prototype.findMatches=function(l,m,u){for(var _=this.tileID.canonical.z<m.canonical.z?1:Math.pow(2,this.tileID.canonical.z-m.canonical.z),I=0;I<l.length;I++){var P=l.get(I);if(!P.crossTileID){var D=this.indexedSymbolInstances[P.key];if(D)for(var q=this.getScaledCoordinates(P,m),G=0,et=D;G<et.length;G+=1){var ot=et[G];if(Math.abs(ot.coord.x-q.x)<=_&&Math.abs(ot.coord.y-q.y)<=_&&!u[ot.crossTileID]){u[ot.crossTileID]=!0,P.crossTileID=ot.crossTileID;break}}}}};var Si=function(){this.maxCrossTileID=0};Si.prototype.generate=function(){return++this.maxCrossTileID};var su=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};su.prototype.handleWrapJump=function(l){var m=Math.round((l-this.lng)/360);if(m!==0)for(var u in this.indexes){var _=this.indexes[u],I={};for(var P in _){var D=_[P];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+m),I[D.tileID.key]=D}this.indexes[u]=I}this.lng=l},su.prototype.addBucket=function(l,m,u){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===m.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var _=0;_<m.symbolInstances.length;_++){var I=m.symbolInstances.get(_);I.crossTileID=0}this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var P=this.usedCrossTileIDs[l.overscaledZ];for(var D in this.indexes){var q=this.indexes[D];if(Number(D)>l.overscaledZ)for(var G in q){var et=q[G];et.tileID.isChildOf(l)&&et.findMatches(m.symbolInstances,l,P)}else{var ot=l.scaledTo(Number(D)),at=q[ot.key];at&&at.findMatches(m.symbolInstances,l,P)}}for(var pt=0;pt<m.symbolInstances.length;pt++){var wt=m.symbolInstances.get(pt);wt.crossTileID||(wt.crossTileID=u.generate(),P[wt.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Zo(l,m.symbolInstances,m.bucketInstanceId),!0},su.prototype.removeBucketCrossTileIDs=function(l,m){for(var u in m.indexedSymbolInstances)for(var _=0,I=m.indexedSymbolInstances[u];_<I.length;_+=1){var P=I[_];delete this.usedCrossTileIDs[l][P.crossTileID]}},su.prototype.removeStaleBuckets=function(l){var m=!1;for(var u in this.indexes){var _=this.indexes[u];for(var I in _)l[_[I].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,_[I]),delete _[I],m=!0)}return m};var ou=function(){this.layerIndexes={},this.crossTileIDs=new Si,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ou.prototype.addLayer=function(l,m,u){var _=this.layerIndexes[l.id];_===void 0&&(_=this.layerIndexes[l.id]=new su);var I=!1,P={};_.handleWrapJump(u);for(var D=0,q=m;D<q.length;D+=1){var G=q[D],et=G.getBucket(l);!et||l.id!==et.layerIds[0]||(et.bucketInstanceId||(et.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(G.tileID,et,this.crossTileIDs)&&(I=!0),P[et.bucketInstanceId]=!0)}return _.removeStaleBuckets(P)&&(I=!0),I},ou.prototype.pruneUnusedLayers=function(l){var m={};l.forEach(function(_){m[_]=!0});for(var u in this.layerIndexes)m[u]||delete this.layerIndexes[u]};var El=function(d,l){return v.emitValidationErrors(d,l&&l.filter(function(m){return m.identifier!=="source.canvas"}))},uh=v.pick(ii,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ws=v.pick(ii,["setCenter","setZoom","setBearing","setPitch"]),br=Ht(),lu=function(d){function l(m,u){var _=this;u===void 0&&(u={}),d.call(this),this.map=m,this.dispatcher=new Ra(Ae(),this),this.imageManager=new zo,this.imageManager.setEventedParent(this),this.glyphManager=new pa(m._requestManager,u.localIdeographFontFamily),this.lineAtlas=new La(256,512),this.crossTileSymbolIndex=new ou,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var I=this;this._rtlTextPluginCallback=l.registerForPluginStateChange(function(P){var D={pluginStatus:P.pluginStatus,pluginURL:P.pluginURL};I.dispatcher.broadcast("syncRTLPluginState",D,function(q,G){if(v.triggerPluginCompletionEvent(q),G){var et=G.every(function(at){return at});if(et)for(var ot in I.sourceCaches)I.sourceCaches[ot].reload()}})}),this.on("data",function(P){if(!(P.dataType!=="source"||P.sourceDataType!=="metadata")){var D=_.sourceCaches[P.sourceId];if(D){var q=D.getSource();if(!(!q||!q.vectorLayerIds))for(var G in _._layers){var et=_._layers[G];et.source===q.id&&_._validateLayer(et)}}}})}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.loadURL=function(u,_){var I=this;_===void 0&&(_={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var P=typeof _.validate=="boolean"?_.validate:!v.isMapboxURL(u);u=this.map._requestManager.normalizeStyleURL(u,_.accessToken);var D=this.map._requestManager.transformRequest(u,v.ResourceType.Style);this._request=v.getJSON(D,function(q,G){I._request=null,q?I.fire(new v.ErrorEvent(q)):G&&I._load(G,P)})},l.prototype.loadJSON=function(u,_){var I=this;_===void 0&&(_={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){I._request=null,I._load(u,_.validate!==!1)})},l.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(br,!1)},l.prototype._load=function(u,_){if(!(_&&El(this,v.validateStyle(u)))){this._loaded=!0,this.stylesheet=u;for(var I in u.sources)this.addSource(I,u.sources[I],{validate:!1});u.sprite?this._loadSprite(u.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(u.glyphs);var P=mi(this.stylesheet.layers);this._order=P.map(function(et){return et.id}),this._layers={},this._serializedLayers={};for(var D=0,q=P;D<q.length;D+=1){var G=q[D];G=v.createStyleLayer(G),G.setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Do(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},l.prototype._loadSprite=function(u){var _=this;this._spriteRequest=ns(u,this.map._requestManager,function(I,P){if(_._spriteRequest=null,I)_.fire(new v.ErrorEvent(I));else if(P)for(var D in P)_.imageManager.addImage(D,P[D]);_.imageManager.setLoaded(!0),_._availableImages=_.imageManager.listImages(),_.dispatcher.broadcast("setImages",_._availableImages),_.fire(new v.Event("data",{dataType:"style"}))})},l.prototype._validateLayer=function(u){var _=this.sourceCaches[u.source];if(_){var I=u.sourceLayer;if(I){var P=_.getSource();(P.type==="geojson"||P.vectorLayerIds&&P.vectorLayerIds.indexOf(I)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+I+'" does not exist on source "'+P.id+'" as specified by style layer "'+u.id+'"')))}}},l.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var u in this.sourceCaches)if(!this.sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()},l.prototype._serializeLayers=function(u){for(var _=[],I=0,P=u;I<P.length;I+=1){var D=P[I],q=this._layers[D];q.type!=="custom"&&_.push(q.serialize())}return _},l.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(var _ in this._layers)if(this._layers[_].hasTransition())return!0;return!1},l.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},l.prototype.update=function(u){if(this._loaded){var _=this._changed;if(this._changed){var I=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);(I.length||P.length)&&this._updateWorkerLayers(I,P);for(var D in this._updatedSources){var q=this._updatedSources[D];q==="reload"?this._reloadSource(D):q==="clear"&&this._clearSource(D)}this._updateTilesForChangedImages();for(var G in this._updatedPaintProps)this._layers[G].updateTransitions(u);this.light.updateTransitions(u),this._resetUpdates()}var et={};for(var ot in this.sourceCaches){var at=this.sourceCaches[ot];et[ot]=at.used,at.used=!1}for(var pt=0,wt=this._order;pt<wt.length;pt+=1){var bt=wt[pt],xt=this._layers[bt];xt.recalculate(u,this._availableImages),!xt.isHidden(u.zoom)&&xt.source&&(this.sourceCaches[xt.source].used=!0)}for(var Et in et){var kt=this.sourceCaches[Et];et[Et]!==kt.used&&kt.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Et}))}this.light.recalculate(u),this.z=u.zoom,_&&this.fire(new v.Event("data",{dataType:"style"}))}},l.prototype._updateTilesForChangedImages=function(){var u=Object.keys(this._changedImages);if(u.length){for(var _ in this.sourceCaches)this.sourceCaches[_].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}},l.prototype._updateWorkerLayers=function(u,_){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(u),removedIds:_})},l.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},l.prototype.setState=function(u){var _=this;if(this._checkLoaded(),El(this,v.validateStyle(u)))return!1;u=v.clone$1(u),u.layers=mi(u.layers);var I=mr(this.serialize(),u).filter(function(D){return!(D.command in ws)});if(I.length===0)return!1;var P=I.filter(function(D){return!(D.command in uh)});if(P.length>0)throw new Error("Unimplemented: "+P.map(function(D){return D.command}).join(", ")+".");return I.forEach(function(D){D.command!=="setTransition"&&_[D.command].apply(_,D.args)}),this.stylesheet=u,!0},l.prototype.addImage=function(u,_){if(this.getImage(u))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(u,_),this._afterImageUpdated(u)},l.prototype.updateImage=function(u,_){this.imageManager.updateImage(u,_)},l.prototype.getImage=function(u){return this.imageManager.getImage(u)},l.prototype.removeImage=function(u){if(!this.getImage(u))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(u),this._afterImageUpdated(u)},l.prototype._afterImageUpdated=function(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},l.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},l.prototype.addSource=function(u,_,I){var P=this;if(I===void 0&&(I={}),this._checkLoaded(),this.sourceCaches[u]!==void 0)throw new Error("There is already a source with this ID");if(!_.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(_).join(", ")+".");var D=["vector","raster","geojson","video","image"],q=D.indexOf(_.type)>=0;if(!(q&&this._validate(v.validateStyle.source,"sources."+u,_,null,I))){this.map&&this.map._collectResourceTiming&&(_.collectResourceTiming=!0);var G=this.sourceCaches[u]=new St(u,_,this.dispatcher);G.style=this,G.setEventedParent(this,function(){return{isSourceLoaded:P.loaded(),source:G.serialize(),sourceId:u}}),G.onAdd(this.map),this._changed=!0}},l.prototype.removeSource=function(u){if(this._checkLoaded(),this.sourceCaches[u]===void 0)throw new Error("There is no source with this ID");for(var _ in this._layers)if(this._layers[_].source===u)return this.fire(new v.ErrorEvent(new Error('Source "'+u+'" cannot be removed while layer "'+_+'" is using it.')));var I=this.sourceCaches[u];delete this.sourceCaches[u],delete this._updatedSources[u],I.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:u})),I.setEventedParent(null),I.clearTiles(),I.onRemove&&I.onRemove(this.map),this._changed=!0},l.prototype.setGeoJSONSourceData=function(u,_){this._checkLoaded();var I=this.sourceCaches[u].getSource();I.setData(_),this._changed=!0},l.prototype.getSource=function(u){return this.sourceCaches[u]&&this.sourceCaches[u].getSource()},l.prototype.addLayer=function(u,_,I){I===void 0&&(I={}),this._checkLoaded();var P=u.id;if(this.getLayer(P)){this.fire(new v.ErrorEvent(new Error('Layer with id "'+P+'" already exists on this map')));return}var D;if(u.type==="custom"){if(El(this,v.validateCustomStyleLayer(u)))return;D=v.createStyleLayer(u)}else{if(typeof u.source=="object"&&(this.addSource(P,u.source),u=v.clone$1(u),u=v.extend(u,{source:P})),this._validate(v.validateStyle.layer,"layers."+P,u,{arrayIndex:-1},I))return;D=v.createStyleLayer(u),this._validateLayer(D),D.setEventedParent(this,{layer:{id:P}}),this._serializedLayers[D.id]=D.serialize()}var q=_?this._order.indexOf(_):this._order.length;if(_&&q===-1){this.fire(new v.ErrorEvent(new Error('Layer with id "'+_+'" does not exist on this map.')));return}if(this._order.splice(q,0,P),this._layerOrderChanged=!0,this._layers[P]=D,this._removedLayers[P]&&D.source&&D.type!=="custom"){var G=this._removedLayers[P];delete this._removedLayers[P],G.type!==D.type?this._updatedSources[D.source]="clear":(this._updatedSources[D.source]="reload",this.sourceCaches[D.source].pause())}this._updateLayer(D),D.onAdd&&D.onAdd(this.map)},l.prototype.moveLayer=function(u,_){this._checkLoaded(),this._changed=!0;var I=this._layers[u];if(!I){this.fire(new v.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be moved.")));return}if(u!==_){var P=this._order.indexOf(u);this._order.splice(P,1);var D=_?this._order.indexOf(_):this._order.length;if(_&&D===-1){this.fire(new v.ErrorEvent(new Error('Layer with id "'+_+'" does not exist on this map.')));return}this._order.splice(D,0,u),this._layerOrderChanged=!0}},l.prototype.removeLayer=function(u){this._checkLoaded();var _=this._layers[u];if(!_){this.fire(new v.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be removed.")));return}_.setEventedParent(null);var I=this._order.indexOf(u);this._order.splice(I,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=_,delete this._layers[u],delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],_.onRemove&&_.onRemove(this.map)},l.prototype.getLayer=function(u){return this._layers[u]},l.prototype.hasLayer=function(u){return u in this._layers},l.prototype.setLayerZoomRange=function(u,_,I){this._checkLoaded();var P=this.getLayer(u);if(!P){this.fire(new v.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot have zoom extent.")));return}P.minzoom===_&&P.maxzoom===I||(_!=null&&(P.minzoom=_),I!=null&&(P.maxzoom=I),this._updateLayer(P))},l.prototype.setFilter=function(u,_,I){I===void 0&&(I={}),this._checkLoaded();var P=this.getLayer(u);if(!P){this.fire(new v.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be filtered.")));return}if(!v.deepEqual(P.filter,_)){if(_==null){P.filter=void 0,this._updateLayer(P);return}this._validate(v.validateStyle.filter,"layers."+P.id+".filter",_,null,I)||(P.filter=v.clone$1(_),this._updateLayer(P))}},l.prototype.getFilter=function(u){return v.clone$1(this.getLayer(u).filter)},l.prototype.setLayoutProperty=function(u,_,I,P){P===void 0&&(P={}),this._checkLoaded();var D=this.getLayer(u);if(!D){this.fire(new v.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be styled.")));return}v.deepEqual(D.getLayoutProperty(_),I)||(D.setLayoutProperty(_,I,P),this._updateLayer(D))},l.prototype.getLayoutProperty=function(u,_){var I=this.getLayer(u);if(!I){this.fire(new v.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style.")));return}return I.getLayoutProperty(_)},l.prototype.setPaintProperty=function(u,_,I,P){P===void 0&&(P={}),this._checkLoaded();var D=this.getLayer(u);if(!D){this.fire(new v.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be styled.")));return}if(!v.deepEqual(D.getPaintProperty(_),I)){var q=D.setPaintProperty(_,I,P);q&&this._updateLayer(D),this._changed=!0,this._updatedPaintProps[u]=!0}},l.prototype.getPaintProperty=function(u,_){return this.getLayer(u).getPaintProperty(_)},l.prototype.setFeatureState=function(u,_){this._checkLoaded();var I=u.source,P=u.sourceLayer,D=this.sourceCaches[I];if(D===void 0){this.fire(new v.ErrorEvent(new Error("The source '"+I+"' does not exist in the map's style.")));return}var q=D.getSource().type;if(q==="geojson"&&P){this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));return}if(q==="vector"&&!P){this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));return}u.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),D.setFeatureState(P,u.id,_)},l.prototype.removeFeatureState=function(u,_){this._checkLoaded();var I=u.source,P=this.sourceCaches[I];if(P===void 0){this.fire(new v.ErrorEvent(new Error("The source '"+I+"' does not exist in the map's style.")));return}var D=P.getSource().type,q=D==="vector"?u.sourceLayer:void 0;if(D==="vector"&&!q){this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));return}if(_&&typeof u.id!="string"&&typeof u.id!="number"){this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));return}P.removeFeatureState(q,u.id,_)},l.prototype.getFeatureState=function(u){this._checkLoaded();var _=u.source,I=u.sourceLayer,P=this.sourceCaches[_];if(P===void 0){this.fire(new v.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")));return}var D=P.getSource().type;if(D==="vector"&&!I){this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));return}return u.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),P.getFeatureState(I,u.id)},l.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},l.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(u){return u.serialize()}),layers:this._serializeLayers(this._order)},function(u){return u!==void 0})},l.prototype._updateLayer=function(u){this._updatedLayers[u.id]=!0,u.source&&!this._updatedSources[u.source]&&this.sourceCaches[u.source].getSource().type!=="raster"&&(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause()),this._changed=!0},l.prototype._flattenAndSortRenderedFeatures=function(u){for(var _=this,I=function(Je){return _._layers[Je].type==="fill-extrusion"},P={},D=[],q=this._order.length-1;q>=0;q--){var G=this._order[q];if(I(G)){P[G]=q;for(var et=0,ot=u;et<ot.length;et+=1){var at=ot[et],pt=at[G];if(pt)for(var wt=0,bt=pt;wt<bt.length;wt+=1){var xt=bt[wt];D.push(xt)}}}}D.sort(function(Je,Ai){return Ai.intersectionZ-Je.intersectionZ});for(var Et=[],kt=this._order.length-1;kt>=0;kt--){var Gt=this._order[kt];if(I(Gt))for(var Kt=D.length-1;Kt>=0;Kt--){var ae=D[Kt].feature;if(P[ae.layer.id]<kt)break;Et.push(ae),D.pop()}else for(var oe=0,ne=u;oe<ne.length;oe+=1){var he=ne[oe],ge=he[Gt];if(ge)for(var Se=0,Ce=ge;Se<Ce.length;Se+=1){var Ee=Ce[Se];Et.push(Ee.feature)}}}return Et},l.prototype.queryRenderedFeatures=function(u,_,I){_&&_.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",_.filter,null,_);var P={};if(_&&_.layers){if(!Array.isArray(_.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var D=0,q=_.layers;D<q.length;D+=1){var G=q[D],et=this._layers[G];if(!et)return this.fire(new v.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];P[et.source]=!0}}var ot=[];_.availableImages=this._availableImages;for(var at in this.sourceCaches)_.layers&&!P[at]||ot.push(ma(this.sourceCaches[at],this._layers,this._serializedLayers,u,_,I));return this.placement&&ot.push(Cn(this._layers,this._serializedLayers,this.sourceCaches,u,_,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ot)},l.prototype.querySourceFeatures=function(u,_){_&&_.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",_.filter,null,_);var I=this.sourceCaches[u];return I?Bs(I,_):[]},l.prototype.addSourceType=function(u,_,I){if(l.getSourceType(u))return I(new Error('A source type called "'+u+'" already exists.'));if(l.setSourceType(u,_),!_.workerSourceURL)return I(null,null);this.dispatcher.broadcast("loadWorkerSource",{name:u,url:_.workerSourceURL},I)},l.prototype.getLight=function(){return this.light.getLight()},l.prototype.setLight=function(u,_){_===void 0&&(_={}),this._checkLoaded();var I=this.light.getLight(),P=!1;for(var D in u)if(!v.deepEqual(u[D],I[D])){P=!0;break}if(P){var q={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(u,_),this.light.updateTransitions(q)}},l.prototype._validate=function(u,_,I,P,D){return D===void 0&&(D={}),D&&D.validate===!1?!1:El(this,u.call(v.validateStyle,v.extend({key:_,style:this.serialize(),value:I,styleSpec:v.styleSpec},P)))},l.prototype._remove=function(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(var u in this._layers){var _=this._layers[u];_.setEventedParent(null)}for(var I in this.sourceCaches)this.sourceCaches[I].clearTiles(),this.sourceCaches[I].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},l.prototype._clearSource=function(u){this.sourceCaches[u].clearTiles()},l.prototype._reloadSource=function(u){this.sourceCaches[u].resume(),this.sourceCaches[u].reload()},l.prototype._updateSources=function(u){for(var _ in this.sourceCaches)this.sourceCaches[_].update(u)},l.prototype._generateCollisionBoxes=function(){for(var u in this.sourceCaches)this._reloadSource(u)},l.prototype._updatePlacement=function(u,_,I,P,D){D===void 0&&(D=!1);for(var q=!1,G=!1,et={},ot=0,at=this._order;ot<at.length;ot+=1){var pt=at[ot],wt=this._layers[pt];if(wt.type==="symbol"){if(!et[wt.source]){var bt=this.sourceCaches[wt.source];et[wt.source]=bt.getRenderableIds(!0).map(function(oe){return bt.getTileByID(oe)}).sort(function(oe,ne){return ne.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(ne.tileID)?-1:1)})}var xt=this.crossTileSymbolIndex.addLayer(wt,et[wt.source],u.center.lng);q=q||xt}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),D=D||this._layerOrderChanged||I===0,(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),u.zoom))&&(this.pauseablePlacement=new xi(u,this._order,D,_,I,P,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,et),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),G=!0),q&&this.pauseablePlacement.placement.setStale()),G||q)for(var Et=0,kt=this._order;Et<kt.length;Et+=1){var Gt=kt[Et],Kt=this._layers[Gt];Kt.type==="symbol"&&this.placement.updateLayerOpacities(Kt,et[Kt.source])}var ae=!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now());return ae},l.prototype._releaseSymbolFadeTiles=function(){for(var u in this.sourceCaches)this.sourceCaches[u].releaseSymbolFadeTiles()},l.prototype.getImages=function(u,_,I){this.imageManager.getImages(_.icons,I),this._updateTilesForChangedImages();var P=this.sourceCaches[_.source];P&&P.setDependencies(_.tileID.key,_.type,_.icons)},l.prototype.getGlyphs=function(u,_,I){this.glyphManager.getGlyphs(_.stacks,I)},l.prototype.getResource=function(u,_,I){return v.makeRequest(_,I)},l}(v.Evented);lu.getSourceType=oo,lu.setSourceType=oh,lu.registerForPluginStateChange=v.registerForPluginStateChange;var Ss=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),Nh=`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,hh=`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`,cr=`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,qh="attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}",Ki=`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,jn="uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}",ga=`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Mn=`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`,Pr="void main() {gl_FragColor=vec4(1.0);}",ss="attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}",ch=`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Dr=`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`,kr=`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,ya="uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}",Fr="varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}",Ur="attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}",zn="varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",yn="attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}",jo="uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",Il="attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}",Ts=`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Sf=`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`,Zs=`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,hn=`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`,Zh=`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,go=`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`,yo=`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ku=`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`,Mc=`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,zc=`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`,uu=`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,jh=`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`,fh=`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,md="uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}",Dc=`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Tf="uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}",_d=`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ef=`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`,hu=`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,gd=`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`,dh=`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,yd=`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`,kc=`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Dn=`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`,Pi=`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Fc="uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}",Fu=`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Lc=`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`,vd=`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,xd=`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`,js=`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Gh=`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`,cu=wr(Nh,hh),Lu=wr(cr,qh),Go=wr(Ki,jn),Ho=wr(ga,Mn),Rc=wr(Pr,ss),Hh=wr(ch,Dr),Xo=wr(kr,ya),$r=wr(Fr,Ur),Ru=wr(zn,yn),bd=wr(jo,Il),Xh=wr(Ts,Sf),If=wr(Zs,hn),Cf=wr(Zh,go),Bc=wr(yo,ku),Oc=wr(Mc,zc),Wo=wr(uu,jh),Wh=wr(fh,md),Kh=wr(Dc,Tf),Vc=wr(_d,Ef),Uc=wr(hu,gd),Es=wr(dh,yd),Nc=wr(kc,Dn),ph=wr(Pi,Fc),qc=wr(Fu,Lc),Zc=wr(vd,xd),Pf=wr(js,Gh);function wr(d,l){var m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=l.match(/attribute ([\w]+) ([\w]+)/g),_=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=I?I.concat(_):_,D={};return d=d.replace(m,function(q,G,et,ot,at){return D[at]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_`+at+`
varying `+et+" "+ot+" "+at+`;
#else
uniform `+et+" "+ot+" u_"+at+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+at+`
    `+et+" "+ot+" "+at+" = u_"+at+`;
#endif
`}),l=l.replace(m,function(q,G,et,ot,at){var pt=ot==="float"?"vec2":"vec4",wt=at.match(/color/)?"color":pt;return D[at]?G==="define"?`
#ifndef HAS_UNIFORM_u_`+at+`
uniform lowp float u_`+at+`_t;
attribute `+et+" "+pt+" a_"+at+`;
varying `+et+" "+ot+" "+at+`;
#else
uniform `+et+" "+ot+" u_"+at+`;
#endif
`:wt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+at+`
    `+at+" = a_"+at+`;
#else
    `+et+" "+ot+" "+at+" = u_"+at+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+at+`
    `+at+" = unpack_mix_"+wt+"(a_"+at+", u_"+at+`_t);
#else
    `+et+" "+ot+" "+at+" = u_"+at+`;
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_`+at+`
uniform lowp float u_`+at+`_t;
attribute `+et+" "+pt+" a_"+at+`;
#else
uniform `+et+" "+ot+" u_"+at+`;
#endif
`:wt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+at+`
    `+et+" "+ot+" "+at+" = a_"+at+`;
#else
    `+et+" "+ot+" "+at+" = u_"+at+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+at+`
    `+et+" "+ot+" "+at+" = unpack_mix_"+wt+"(a_"+at+", u_"+at+`_t);
#else
    `+et+" "+ot+" "+at+" = u_"+at+`;
#endif
`}),{fragmentSource:d,vertexSource:l,staticAttributes:u,staticUniforms:P}}var mh=Object.freeze({__proto__:null,prelude:cu,background:Lu,backgroundPattern:Go,circle:Ho,clippingMask:Rc,heatmap:Hh,heatmapTexture:Xo,collisionBox:$r,collisionCircle:Ru,debug:bd,fill:Xh,fillOutline:If,fillOutlinePattern:Cf,fillPattern:Bc,fillExtrusion:Oc,fillExtrusionPattern:Wo,hillshadePrepare:Wh,hillshade:Kh,line:Vc,lineGradient:Uc,linePattern:Es,lineSDF:Nc,raster:ph,symbolIcon:qc,symbolSDF:Zc,symbolTextAndIcon:Pf}),Cl=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};Cl.prototype.bind=function(l,m,u,_,I,P,D,q){this.context=l;for(var G=this.boundPaintVertexBuffers.length!==_.length,et=0;!G&&et<_.length;et++)this.boundPaintVertexBuffers[et]!==_[et]&&(G=!0);var ot=!this.vao||this.boundProgram!==m||this.boundLayoutVertexBuffer!==u||G||this.boundIndexBuffer!==I||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==q;!l.extVertexArrayObject||ot?this.freshBind(m,u,_,I,P,D,q):(l.bindVertexArrayOES.set(this.vao),D&&D.bind(),I&&I.dynamicDraw&&I.bind(),q&&q.bind())},Cl.prototype.freshBind=function(l,m,u,_,I,P,D){var q,G=l.numAttributes,et=this.context,ot=et.gl;if(et.extVertexArrayObject)this.vao&&this.destroy(),this.vao=et.extVertexArrayObject.createVertexArrayOES(),et.bindVertexArrayOES.set(this.vao),q=0,this.boundProgram=l,this.boundLayoutVertexBuffer=m,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=_,this.boundVertexOffset=I,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=D;else{q=et.currentNumAttributes||0;for(var at=G;at<q;at++)ot.disableVertexAttribArray(at)}m.enableAttributes(ot,l);for(var pt=0,wt=u;pt<wt.length;pt+=1){var bt=wt[pt];bt.enableAttributes(ot,l)}P&&P.enableAttributes(ot,l),D&&D.enableAttributes(ot,l),m.bind(),m.setVertexAttribPointers(ot,l,I);for(var xt=0,Et=u;xt<Et.length;xt+=1){var kt=Et[xt];kt.bind(),kt.setVertexAttribPointers(ot,l,I)}P&&(P.bind(),P.setVertexAttribPointers(ot,l,I)),_&&_.bind(),D&&(D.bind(),D.setVertexAttribPointers(ot,l,I)),et.currentNumAttributes=G},Cl.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};function jc(d){for(var l=[],m=0;m<d.length;m++)if(d[m]!==null){var u=d[m].split(" ");l.push(u.pop())}return l}var Gc=function(l,m,u,_,I,P){var D=l.gl;this.program=D.createProgram();for(var q=jc(u.staticAttributes),G=_?_.getBinderAttributes():[],et=q.concat(G),ot=u.staticUniforms?jc(u.staticUniforms):[],at=_?_.getBinderUniforms():[],pt=ot.concat(at),wt=[],bt=0,xt=pt;bt<xt.length;bt+=1){var Et=xt[bt];wt.indexOf(Et)<0&&wt.push(Et)}var kt=_?_.defines():[];P&&kt.push("#define OVERDRAW_INSPECTOR;");var Gt=kt.concat(cu.fragmentSource,u.fragmentSource).join(`
`),Kt=kt.concat(cu.vertexSource,u.vertexSource).join(`
`),ae=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost()){this.failedToCreate=!0;return}D.shaderSource(ae,Gt),D.compileShader(ae),D.attachShader(this.program,ae);var oe=D.createShader(D.VERTEX_SHADER);if(D.isContextLost()){this.failedToCreate=!0;return}D.shaderSource(oe,Kt),D.compileShader(oe),D.attachShader(this.program,oe),this.attributes={};var ne={};this.numAttributes=et.length;for(var he=0;he<this.numAttributes;he++)et[he]&&(D.bindAttribLocation(this.program,he,et[he]),this.attributes[et[he]]=he);D.linkProgram(this.program),D.deleteShader(oe),D.deleteShader(ae);for(var ge=0;ge<wt.length;ge++){var Se=wt[ge];if(Se&&!ne[Se]){var Ce=D.getUniformLocation(this.program,Se);Ce&&(ne[Se]=Ce)}}this.fixedUniforms=I(l,ne),this.binderUniforms=_?_.getUniforms(l,ne):[]};Gc.prototype.draw=function(l,m,u,_,I,P,D,q,G,et,ot,at,pt,wt,bt,xt){var Et,kt=l.gl;if(!this.failedToCreate){l.program.set(this.program),l.setDepthMode(u),l.setStencilMode(_),l.setColorMode(I),l.setCullFace(P);for(var Gt in this.fixedUniforms)this.fixedUniforms[Gt].set(D[Gt]);wt&&wt.setUniforms(l,this.binderUniforms,at,{zoom:pt});for(var Kt=(Et={},Et[kt.LINES]=2,Et[kt.TRIANGLES]=3,Et[kt.LINE_STRIP]=1,Et)[m],ae=0,oe=ot.get();ae<oe.length;ae+=1){var ne=oe[ae],he=ne.vaos||(ne.vaos={}),ge=he[q]||(he[q]=new Cl);ge.bind(l,this,G,wt?wt.getPaintVertexBuffers():[],et,ne.vertexOffset,bt,xt),kt.drawElements(m,ne.primitiveLength*Kt,kt.UNSIGNED_SHORT,ne.primitiveOffset*Kt*2)}}};function Ko(d,l,m){var u=1/Zn(m,1,l.transform.tileZoom),_=Math.pow(2,m.tileID.overscaledZ),I=m.tileSize*Math.pow(2,l.transform.tileZoom)/_,P=I*(m.tileID.canonical.x+m.tileID.wrap*_),D=I*m.tileID.canonical.y;return{u_image:0,u_texsize:m.imageAtlasTexture.size,u_scale:[u,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[P>>16,D>>16],u_pixel_coord_lower:[P&65535,D&65535]}}function _h(d,l,m,u){var _=m.imageManager.getPattern(d.from.toString()),I=m.imageManager.getPattern(d.to.toString()),P=m.imageManager.getPixelSize(),D=P.width,q=P.height,G=Math.pow(2,u.tileID.overscaledZ),et=u.tileSize*Math.pow(2,m.transform.tileZoom)/G,ot=et*(u.tileID.canonical.x+u.tileID.wrap*G),at=et*u.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:_.tl,u_pattern_br_a:_.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[D,q],u_mix:l.t,u_pattern_size_a:_.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:l.fromScale,u_scale_b:l.toScale,u_tile_units_to_pixels:1/Zn(u,1,m.transform.tileZoom),u_pixel_coord_upper:[ot>>16,at>>16],u_pixel_coord_lower:[ot&65535,at&65535]}}var fu=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_lightpos:new v.Uniform3f(d,l.u_lightpos),u_lightintensity:new v.Uniform1f(d,l.u_lightintensity),u_lightcolor:new v.Uniform3f(d,l.u_lightcolor),u_vertical_gradient:new v.Uniform1f(d,l.u_vertical_gradient),u_opacity:new v.Uniform1f(d,l.u_opacity)}},kn=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_lightpos:new v.Uniform3f(d,l.u_lightpos),u_lightintensity:new v.Uniform1f(d,l.u_lightintensity),u_lightcolor:new v.Uniform3f(d,l.u_lightcolor),u_vertical_gradient:new v.Uniform1f(d,l.u_vertical_gradient),u_height_factor:new v.Uniform1f(d,l.u_height_factor),u_image:new v.Uniform1i(d,l.u_image),u_texsize:new v.Uniform2f(d,l.u_texsize),u_pixel_coord_upper:new v.Uniform2f(d,l.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,l.u_pixel_coord_lower),u_scale:new v.Uniform3f(d,l.u_scale),u_fade:new v.Uniform1f(d,l.u_fade),u_opacity:new v.Uniform1f(d,l.u_opacity)}},gh=function(d,l,m,u){var _=l.style.light,I=_.properties.get("position"),P=[I.x,I.y,I.z],D=v.create$1();_.properties.get("anchor")==="viewport"&&v.fromRotation(D,-l.transform.angle),v.transformMat3(P,P,D);var q=_.properties.get("color");return{u_matrix:d,u_lightpos:P,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+m,u_opacity:u}},Yo=function(d,l,m,u,_,I,P){return v.extend(gh(d,l,m,u),Ko(I,l,P),{u_height_factor:-Math.pow(2,_.overscaledZ)/P.tileSize/8})},Pl=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix)}},Al=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_image:new v.Uniform1i(d,l.u_image),u_texsize:new v.Uniform2f(d,l.u_texsize),u_pixel_coord_upper:new v.Uniform2f(d,l.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,l.u_pixel_coord_lower),u_scale:new v.Uniform3f(d,l.u_scale),u_fade:new v.Uniform1f(d,l.u_fade)}},Jo=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_world:new v.Uniform2f(d,l.u_world)}},Gs=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_world:new v.Uniform2f(d,l.u_world),u_image:new v.Uniform1i(d,l.u_image),u_texsize:new v.Uniform2f(d,l.u_texsize),u_pixel_coord_upper:new v.Uniform2f(d,l.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,l.u_pixel_coord_lower),u_scale:new v.Uniform3f(d,l.u_scale),u_fade:new v.Uniform1f(d,l.u_fade)}},Qo=function(d){return{u_matrix:d}},Ml=function(d,l,m,u){return v.extend(Qo(d),Ko(m,l,u))},$o=function(d,l){return{u_matrix:d,u_world:l}},Yh=function(d,l,m,u,_){return v.extend(Ml(d,l,m,u),{u_world:_})},Af=function(d,l){return{u_camera_to_center_distance:new v.Uniform1f(d,l.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(d,l.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(d,l.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(d,l.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(d,l.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(d,l.u_matrix)}},wd=function(d,l,m,u){var _=d.transform,I,P;if(u.paint.get("circle-pitch-alignment")==="map"){var D=Zn(m,1,_.zoom);I=!0,P=[D,D]}else I=!1,P=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(l.posMatrix,m,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+I,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:P}},du=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_camera_to_center_distance:new v.Uniform1f(d,l.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(d,l.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(d,l.u_extrude_scale),u_overscale_factor:new v.Uniform1f(d,l.u_overscale_factor)}},Mf=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_inv_matrix:new v.UniformMatrix4f(d,l.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(d,l.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(d,l.u_viewport_size)}},Sd=function(d,l,m){var u=Zn(m,1,l.zoom),_=Math.pow(2,l.zoom-m.tileID.overscaledZ),I=m.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[l.pixelsToGLUnits[0]/(u*_),l.pixelsToGLUnits[1]/(u*_)],u_overscale_factor:I}},zf=function(d,l,m){return{u_matrix:d,u_inv_matrix:l,u_camera_to_center_distance:m.cameraToCenterDistance,u_viewport_size:[m.width,m.height]}},Bu=function(d,l){return{u_color:new v.UniformColor(d,l.u_color),u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_overlay:new v.Uniform1i(d,l.u_overlay),u_overlay_scale:new v.Uniform1f(d,l.u_overlay_scale)}},Df=function(d,l,m){return m===void 0&&(m=1),{u_matrix:d,u_color:l,u_overlay:0,u_overlay_scale:m}},Jh=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix)}},Hc=function(d){return{u_matrix:d}},kf=function(d,l){return{u_extrude_scale:new v.Uniform1f(d,l.u_extrude_scale),u_intensity:new v.Uniform1f(d,l.u_intensity),u_matrix:new v.UniformMatrix4f(d,l.u_matrix)}},Td=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_world:new v.Uniform2f(d,l.u_world),u_image:new v.Uniform1i(d,l.u_image),u_color_ramp:new v.Uniform1i(d,l.u_color_ramp),u_opacity:new v.Uniform1f(d,l.u_opacity)}},pu=function(d,l,m,u){return{u_matrix:d,u_extrude_scale:Zn(l,1,m),u_intensity:u}},Ff=function(d,l,m,u){var _=v.create();v.ortho(_,0,d.width,d.height,0,0,1);var I=d.context.gl;return{u_matrix:_,u_world:[I.drawingBufferWidth,I.drawingBufferHeight],u_image:m,u_color_ramp:u,u_opacity:l.paint.get("heatmap-opacity")}},Lf=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_image:new v.Uniform1i(d,l.u_image),u_latrange:new v.Uniform2f(d,l.u_latrange),u_light:new v.Uniform2f(d,l.u_light),u_shadow:new v.UniformColor(d,l.u_shadow),u_highlight:new v.UniformColor(d,l.u_highlight),u_accent:new v.UniformColor(d,l.u_accent)}},Xc=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_image:new v.Uniform1i(d,l.u_image),u_dimension:new v.Uniform2f(d,l.u_dimension),u_zoom:new v.Uniform1f(d,l.u_zoom),u_unpack:new v.Uniform4f(d,l.u_unpack)}},Wc=function(d,l,m){var u=m.paint.get("hillshade-shadow-color"),_=m.paint.get("hillshade-highlight-color"),I=m.paint.get("hillshade-accent-color"),P=m.paint.get("hillshade-illumination-direction")*(Math.PI/180);m.paint.get("hillshade-illumination-anchor")==="viewport"&&(P-=d.transform.angle);var D=!d.options.moving;return{u_matrix:d.transform.calculatePosMatrix(l.tileID.toUnwrapped(),D),u_image:0,u_latrange:Rf(d,l.tileID),u_light:[m.paint.get("hillshade-exaggeration"),P],u_shadow:u,u_highlight:_,u_accent:I}},Kc=function(d,l){var m=l.stride,u=v.create();return v.ortho(u,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(u,u,[0,-v.EXTENT,0]),{u_matrix:u,u_image:1,u_dimension:[m,m],u_zoom:d.overscaledZ,u_unpack:l.getUnpackVector()}};function Rf(d,l){var m=Math.pow(2,l.canonical.z),u=l.canonical.y;return[new v.MercatorCoordinate(0,u/m).toLngLat().lat,new v.MercatorCoordinate(0,(u+1)/m).toLngLat().lat]}var vo=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_ratio:new v.Uniform1f(d,l.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,l.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(d,l.u_units_to_pixels)}},va=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_ratio:new v.Uniform1f(d,l.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,l.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(d,l.u_units_to_pixels),u_image:new v.Uniform1i(d,l.u_image),u_image_height:new v.Uniform1f(d,l.u_image_height)}},zl=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_texsize:new v.Uniform2f(d,l.u_texsize),u_ratio:new v.Uniform1f(d,l.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,l.u_device_pixel_ratio),u_image:new v.Uniform1i(d,l.u_image),u_units_to_pixels:new v.Uniform2f(d,l.u_units_to_pixels),u_scale:new v.Uniform3f(d,l.u_scale),u_fade:new v.Uniform1f(d,l.u_fade)}},Ou=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_ratio:new v.Uniform1f(d,l.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,l.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(d,l.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(d,l.u_patternscale_a),u_patternscale_b:new v.Uniform2f(d,l.u_patternscale_b),u_sdfgamma:new v.Uniform1f(d,l.u_sdfgamma),u_image:new v.Uniform1i(d,l.u_image),u_tex_y_a:new v.Uniform1f(d,l.u_tex_y_a),u_tex_y_b:new v.Uniform1f(d,l.u_tex_y_b),u_mix:new v.Uniform1f(d,l.u_mix)}},tl=function(d,l,m){var u=d.transform;return{u_matrix:mu(d,l,m),u_ratio:1/Zn(l,1,u.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Yi=function(d,l,m,u){return v.extend(tl(d,l,m),{u_image:0,u_image_height:u})},Yc=function(d,l,m,u){var _=d.transform,I=Vu(l,_);return{u_matrix:mu(d,l,m),u_texsize:l.imageAtlasTexture.size,u_ratio:1/Zn(l,1,_.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[I,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},os=function(d,l,m,u,_){var I=d.transform,P=d.lineAtlas,D=Vu(l,I),q=m.layout.get("line-cap")==="round",G=P.getDash(u.from,q),et=P.getDash(u.to,q),ot=G.width*_.fromScale,at=et.width*_.toScale;return v.extend(tl(d,l,m),{u_patternscale_a:[D/ot,-G.height/2],u_patternscale_b:[D/at,-et.height/2],u_sdfgamma:P.width/(Math.min(ot,at)*256*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:et.y,u_mix:_.t})};function Vu(d,l){return 1/Zn(d,1,l.tileZoom)}function mu(d,l,m){return d.translatePosMatrix(l.tileID.posMatrix,l,m.paint.get("line-translate"),m.paint.get("line-translate-anchor"))}var Uu=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_tl_parent:new v.Uniform2f(d,l.u_tl_parent),u_scale_parent:new v.Uniform1f(d,l.u_scale_parent),u_buffer_scale:new v.Uniform1f(d,l.u_buffer_scale),u_fade_t:new v.Uniform1f(d,l.u_fade_t),u_opacity:new v.Uniform1f(d,l.u_opacity),u_image0:new v.Uniform1i(d,l.u_image0),u_image1:new v.Uniform1i(d,l.u_image1),u_brightness_low:new v.Uniform1f(d,l.u_brightness_low),u_brightness_high:new v.Uniform1f(d,l.u_brightness_high),u_saturation_factor:new v.Uniform1f(d,l.u_saturation_factor),u_contrast_factor:new v.Uniform1f(d,l.u_contrast_factor),u_spin_weights:new v.Uniform3f(d,l.u_spin_weights)}},Bf=function(d,l,m,u,_){return{u_matrix:d,u_tl_parent:l,u_scale_parent:m,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:Qh(_.paint.get("raster-saturation")),u_contrast_factor:fr(_.paint.get("raster-contrast")),u_spin_weights:Jc(_.paint.get("raster-hue-rotate"))}};function Jc(d){d*=Math.PI/180;var l=Math.sin(d),m=Math.cos(d);return[(2*m+1)/3,(-Math.sqrt(3)*l-m+1)/3,(Math.sqrt(3)*l-m+1)/3]}function fr(d){return d>0?1/(1-d):1+d}function Qh(d){return d>0?1-1/(1.001-d):-d}var Of=function(d,l){return{u_is_size_zoom_constant:new v.Uniform1i(d,l.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(d,l.u_is_size_feature_constant),u_size_t:new v.Uniform1f(d,l.u_size_t),u_size:new v.Uniform1f(d,l.u_size),u_camera_to_center_distance:new v.Uniform1f(d,l.u_camera_to_center_distance),u_pitch:new v.Uniform1f(d,l.u_pitch),u_rotate_symbol:new v.Uniform1i(d,l.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(d,l.u_aspect_ratio),u_fade_change:new v.Uniform1f(d,l.u_fade_change),u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(d,l.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(d,l.u_coord_matrix),u_is_text:new v.Uniform1i(d,l.u_is_text),u_pitch_with_map:new v.Uniform1i(d,l.u_pitch_with_map),u_texsize:new v.Uniform2f(d,l.u_texsize),u_texture:new v.Uniform1i(d,l.u_texture)}},yh=function(d,l){return{u_is_size_zoom_constant:new v.Uniform1i(d,l.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(d,l.u_is_size_feature_constant),u_size_t:new v.Uniform1f(d,l.u_size_t),u_size:new v.Uniform1f(d,l.u_size),u_camera_to_center_distance:new v.Uniform1f(d,l.u_camera_to_center_distance),u_pitch:new v.Uniform1f(d,l.u_pitch),u_rotate_symbol:new v.Uniform1i(d,l.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(d,l.u_aspect_ratio),u_fade_change:new v.Uniform1f(d,l.u_fade_change),u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(d,l.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(d,l.u_coord_matrix),u_is_text:new v.Uniform1i(d,l.u_is_text),u_pitch_with_map:new v.Uniform1i(d,l.u_pitch_with_map),u_texsize:new v.Uniform2f(d,l.u_texsize),u_texture:new v.Uniform1i(d,l.u_texture),u_gamma_scale:new v.Uniform1f(d,l.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(d,l.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(d,l.u_is_halo)}},Dl=function(d,l){return{u_is_size_zoom_constant:new v.Uniform1i(d,l.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(d,l.u_is_size_feature_constant),u_size_t:new v.Uniform1f(d,l.u_size_t),u_size:new v.Uniform1f(d,l.u_size),u_camera_to_center_distance:new v.Uniform1f(d,l.u_camera_to_center_distance),u_pitch:new v.Uniform1f(d,l.u_pitch),u_rotate_symbol:new v.Uniform1i(d,l.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(d,l.u_aspect_ratio),u_fade_change:new v.Uniform1f(d,l.u_fade_change),u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(d,l.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(d,l.u_coord_matrix),u_is_text:new v.Uniform1i(d,l.u_is_text),u_pitch_with_map:new v.Uniform1i(d,l.u_pitch_with_map),u_texsize:new v.Uniform2f(d,l.u_texsize),u_texsize_icon:new v.Uniform2f(d,l.u_texsize_icon),u_texture:new v.Uniform1i(d,l.u_texture),u_texture_icon:new v.Uniform1i(d,l.u_texture_icon),u_gamma_scale:new v.Uniform1f(d,l.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(d,l.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(d,l.u_is_halo)}},vh=function(d,l,m,u,_,I,P,D,q,G){var et=_.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:et.cameraToCenterDistance,u_pitch:et.pitch/360*2*Math.PI,u_rotate_symbol:+m,u_aspect_ratio:et.width/et.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:P,u_coord_matrix:D,u_is_text:+q,u_pitch_with_map:+u,u_texsize:G,u_texture:0}},Vf=function(d,l,m,u,_,I,P,D,q,G,et){var ot=_.transform;return v.extend(vh(d,l,m,u,_,I,P,D,q,G),{u_gamma_scale:u?Math.cos(ot._pitch)*ot.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:1})},Uf=function(d,l,m,u,_,I,P,D,q,G){return v.extend(Vf(d,l,m,u,_,I,P,D,!0,q),{u_texsize_icon:G,u_texture_icon:1})},Ed=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_opacity:new v.Uniform1f(d,l.u_opacity),u_color:new v.UniformColor(d,l.u_color)}},Qc=function(d,l){return{u_matrix:new v.UniformMatrix4f(d,l.u_matrix),u_opacity:new v.Uniform1f(d,l.u_opacity),u_image:new v.Uniform1i(d,l.u_image),u_pattern_tl_a:new v.Uniform2f(d,l.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(d,l.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(d,l.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(d,l.u_pattern_br_b),u_texsize:new v.Uniform2f(d,l.u_texsize),u_mix:new v.Uniform1f(d,l.u_mix),u_pattern_size_a:new v.Uniform2f(d,l.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(d,l.u_pattern_size_b),u_scale_a:new v.Uniform1f(d,l.u_scale_a),u_scale_b:new v.Uniform1f(d,l.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(d,l.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,l.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(d,l.u_tile_units_to_pixels)}},Hs=function(d,l,m){return{u_matrix:d,u_opacity:l,u_color:m}},el=function(d,l,m,u,_,I){return v.extend(_h(u,I,m,_),{u_matrix:d,u_opacity:l})},xa={fillExtrusion:fu,fillExtrusionPattern:kn,fill:Pl,fillPattern:Al,fillOutline:Jo,fillOutlinePattern:Gs,circle:Af,collisionBox:du,collisionCircle:Mf,debug:Bu,clippingMask:Jh,heatmap:kf,heatmapTexture:Td,hillshade:Lf,hillshadePrepare:Xc,line:vo,lineGradient:va,linePattern:zl,lineSDF:Ou,raster:Uu,symbolIcon:Of,symbolSDF:yh,symbolTextAndIcon:Dl,background:Ed,backgroundPattern:Qc},xo;function il(d,l,m,u,_,I,P){for(var D=d.context,q=D.gl,G=d.useProgram("collisionBox"),et=[],ot=0,at=0,pt=0;pt<u.length;pt++){var wt=u[pt],bt=l.getTile(wt),xt=bt.getBucket(m);if(xt){var Et=wt.posMatrix;(_[0]!==0||_[1]!==0)&&(Et=d.translatePosMatrix(wt.posMatrix,bt,_,I));var kt=P?xt.textCollisionBox:xt.iconCollisionBox,Gt=xt.collisionCircleArray;if(Gt.length>0){var Kt=v.create(),ae=Et;v.mul(Kt,xt.placementInvProjMatrix,d.transform.glCoordMatrix),v.mul(Kt,Kt,xt.placementViewportMatrix),et.push({circleArray:Gt,circleOffset:at,transform:ae,invTransform:Kt}),ot+=Gt.length/4,at=ot}kt&&G.draw(D,q.LINES,Q.disabled,Pt.disabled,d.colorModeForRenderPass(),nt.disabled,Sd(Et,d.transform,bt),m.id,kt.layoutVertexBuffer,kt.indexBuffer,kt.segments,null,d.transform.zoom,null,null,kt.collisionVertexBuffer)}}if(!(!P||!et.length)){var oe=d.useProgram("collisionCircle"),ne=new v.StructArrayLayout2f1f2i16;ne.resize(ot*4),ne._trim();for(var he=0,ge=0,Se=et;ge<Se.length;ge+=1)for(var Ce=Se[ge],Ee=0;Ee<Ce.circleArray.length/4;Ee++){var Je=Ee*4,Ai=Ce.circleArray[Je+0],_i=Ce.circleArray[Je+1],Re=Ce.circleArray[Je+2],fi=Ce.circleArray[Je+3];ne.emplace(he++,Ai,_i,Re,fi,0),ne.emplace(he++,Ai,_i,Re,fi,1),ne.emplace(he++,Ai,_i,Re,fi,2),ne.emplace(he++,Ai,_i,Re,fi,3)}(!xo||xo.length<ot*2)&&(xo=$h(ot));for(var si=D.createIndexBuffer(xo,!0),Li=D.createVertexBuffer(ne,v.collisionCircleLayout.members,!0),Mi=0,or=et;Mi<or.length;Mi+=1){var wi=or[Mi],ir=zf(wi.transform,wi.invTransform,d.transform);oe.draw(D,q.TRIANGLES,Q.disabled,Pt.disabled,d.colorModeForRenderPass(),nt.disabled,ir,m.id,Li,si,v.SegmentVector.simpleSegment(0,wi.circleOffset*2,wi.circleArray.length,wi.circleArray.length/2),null,d.transform.zoom,null,null,null)}Li.destroy(),si.destroy()}}function $h(d){var l=d*2,m=new v.StructArrayLayout3ui6;m.resize(l),m._trim();for(var u=0;u<l;u++){var _=u*6;m.uint16[_+0]=u*4+0,m.uint16[_+1]=u*4+1,m.uint16[_+2]=u*4+2,m.uint16[_+3]=u*4+2,m.uint16[_+4]=u*4+3,m.uint16[_+5]=u*4+0}return m}var xh=v.identity(new Float32Array(16));function _u(d,l,m,u,_){if(d.renderPass==="translucent"){var I=Pt.disabled,P=d.colorModeForRenderPass(),D=m.layout.get("text-variable-anchor");D&&ec(u,d,m,l,m.layout.get("text-rotation-alignment"),m.layout.get("text-pitch-alignment"),_),m.paint.get("icon-opacity").constantOr(1)!==0&&Nu(d,l,m,u,!1,m.paint.get("icon-translate"),m.paint.get("icon-translate-anchor"),m.layout.get("icon-rotation-alignment"),m.layout.get("icon-pitch-alignment"),m.layout.get("icon-keep-upright"),I,P),m.paint.get("text-opacity").constantOr(1)!==0&&Nu(d,l,m,u,!0,m.paint.get("text-translate"),m.paint.get("text-translate-anchor"),m.layout.get("text-rotation-alignment"),m.layout.get("text-pitch-alignment"),m.layout.get("text-keep-upright"),I,P),l.map.showCollisionBoxes&&(il(d,l,m,u,m.paint.get("text-translate"),m.paint.get("text-translate-anchor"),!0),il(d,l,m,u,m.paint.get("icon-translate"),m.paint.get("icon-translate-anchor"),!1))}}function tc(d,l,m,u,_,I){var P=v.getAnchorAlignment(d),D=P.horizontalAlign,q=P.verticalAlign,G=-(D-.5)*l,et=-(q-.5)*m,ot=v.evaluateVariableOffset(d,u);return new v.Point((G/_+ot[0])*I,(et/_+ot[1])*I)}function ec(d,l,m,u,_,I,P){for(var D=l.transform,q=_==="map",G=I==="map",et=0,ot=d;et<ot.length;et+=1){var at=ot[et],pt=u.getTile(at),wt=pt.getBucket(m);if(!(!wt||!wt.text||!wt.text.segments.get().length)){var bt=wt.textSizeData,xt=v.evaluateSizeForZoom(bt,D.zoom),Et=Zn(pt,1,l.transform.zoom),kt=qa(at.posMatrix,G,q,l.transform,Et),Gt=m.layout.get("icon-text-fit")!=="none"&&wt.hasIconData();if(xt){var Kt=Math.pow(2,D.zoom-pt.tileID.overscaledZ);ic(wt,q,G,P,v.symbolSize,D,kt,at.posMatrix,Kt,xt,Gt)}}}}function ic(d,l,m,u,_,I,P,D,q,G,et){var ot=d.text.placedSymbolArray,at=d.text.dynamicLayoutVertexArray,pt=d.icon.dynamicLayoutVertexArray,wt={};at.clear();for(var bt=0;bt<ot.length;bt++){var xt=ot.get(bt),Et=d.allowVerticalPlacement&&!xt.placedOrientation,kt=!xt.hidden&&xt.crossTileID&&!Et?u[xt.crossTileID]:null;if(!kt)vi(xt.numGlyphs,at);else{var Gt=new v.Point(xt.anchorX,xt.anchorY),Kt=_e(Gt,m?D:P),ae=fo(I.cameraToCenterDistance,Kt.signedDistanceFromCamera),oe=_.evaluateSizeForFeature(d.textSizeData,G,xt)*ae/v.ONE_EM;m&&(oe*=d.tilePixelRatio/q);for(var ne=kt.width,he=kt.height,ge=kt.anchor,Se=kt.textOffset,Ce=kt.textBoxScale,Ee=tc(ge,ne,he,Se,Ce,oe),Je=m?_e(Gt.add(Ee),P).point:Kt.point.add(l?Ee.rotate(-I.angle):Ee),Ai=d.allowVerticalPlacement&&xt.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,_i=0;_i<xt.numGlyphs;_i++)v.addDynamicAttributes(at,Je,Ai);et&&xt.associatedIconIndex>=0&&(wt[xt.associatedIconIndex]={shiftedAnchor:Je,angle:Ai})}}if(et){pt.clear();for(var Re=d.icon.placedSymbolArray,fi=0;fi<Re.length;fi++){var si=Re.get(fi);if(si.hidden)vi(si.numGlyphs,pt);else{var Li=wt[fi];if(!Li)vi(si.numGlyphs,pt);else for(var Mi=0;Mi<si.numGlyphs;Mi++)v.addDynamicAttributes(pt,Li.shiftedAnchor,Li.angle)}}d.icon.dynamicLayoutVertexBuffer.updateData(pt)}d.text.dynamicLayoutVertexBuffer.updateData(at)}function ba(d,l,m){return m.iconsInText&&l?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Nu(d,l,m,u,_,I,P,D,q,G,et,ot){for(var at=d.context,pt=at.gl,wt=d.transform,bt=D==="map",xt=q==="map",Et=bt&&m.layout.get("symbol-placement")!=="point",kt=bt&&!xt&&!Et,Gt=m.layout.get("symbol-sort-key").constantOr(1)!==void 0,Kt=!1,ae=d.depthModeForSublayer(0,Q.ReadOnly),oe=m.layout.get("text-variable-anchor"),ne=[],he=0,ge=u;he<ge.length;he+=1){var Se=ge[he],Ce=l.getTile(Se),Ee=Ce.getBucket(m);if(Ee){var Je=_?Ee.text:Ee.icon;if(!(!Je||!Je.segments.get().length)){var Ai=Je.programConfigurations.get(m.id),_i=_||Ee.sdfIcons,Re=_?Ee.textSizeData:Ee.iconSizeData,fi=xt||wt.pitch!==0,si=d.useProgram(ba(_i,_,Ee),Ai),Li=v.evaluateSizeForZoom(Re,wt.zoom),Mi=void 0,or=[0,0],wi=void 0,ir=void 0,ri=null,Ti=void 0;if(_){if(wi=Ce.glyphAtlasTexture,ir=pt.LINEAR,Mi=Ce.glyphAtlasTexture.size,Ee.iconsInText){or=Ce.imageAtlasTexture.size,ri=Ce.imageAtlasTexture;var Lr=Re.kind==="composite"||Re.kind==="camera";Ti=fi||d.options.rotating||d.options.zooming||Lr?pt.LINEAR:pt.NEAREST}}else{var cn=m.layout.get("icon-size").constantOr(0)!==1||Ee.iconsNeedLinear;wi=Ce.imageAtlasTexture,ir=_i||d.options.rotating||d.options.zooming||cn||fi?pt.LINEAR:pt.NEAREST,Mi=Ce.imageAtlasTexture.size}var As=Zn(Ce,1,d.transform.zoom),cs=qa(Se.posMatrix,xt,bt,d.transform,As),Aa=Tl(Se.posMatrix,xt,bt,d.transform,As),Ma=oe&&Ee.hasTextData(),bu=m.layout.get("icon-text-fit")!=="none"&&Ma&&Ee.hasIconData();Et&&Ac(Ee,Se.posMatrix,d,_,cs,Aa,xt,G);var Io=d.translatePosMatrix(Se.posMatrix,Ce,I,P),za=Et||_&&oe||bu?xh:cs,Ys=d.translatePosMatrix(Aa,Ce,I,P,!0),Qa=_i&&m.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Da=void 0;_i?Ee.iconsInText?Da=Uf(Re.kind,Li,kt,xt,d,Io,za,Ys,Mi,or):Da=Vf(Re.kind,Li,kt,xt,d,Io,za,Ys,_,Mi):Da=vh(Re.kind,Li,kt,xt,d,Io,za,Ys,_,Mi);var Ms={program:si,buffers:Je,uniformValues:Da,atlasTexture:wi,atlasTextureIcon:ri,atlasInterpolation:ir,atlasInterpolationIcon:Ti,isSDF:_i,hasHalo:Qa};if(Gt&&Ee.canOverlap){Kt=!0;for(var $a=Je.segments.get(),fs=0,gc=$a;fs<gc.length;fs+=1){var th=gc[fs];ne.push({segments:new v.SegmentVector([th]),sortKey:th.sortKey,state:Ms})}}else ne.push({segments:Je.segments,sortKey:0,state:Ms})}}}Kt&&ne.sort(function(Su,Tu){return Su.sortKey-Tu.sortKey});for(var bn=0,cf=ne;bn<cf.length;bn+=1){var yc=cf[bn],lr=yc.state;if(at.activeTexture.set(pt.TEXTURE0),lr.atlasTexture.bind(lr.atlasInterpolation,pt.CLAMP_TO_EDGE),lr.atlasTextureIcon&&(at.activeTexture.set(pt.TEXTURE1),lr.atlasTextureIcon&&lr.atlasTextureIcon.bind(lr.atlasInterpolationIcon,pt.CLAMP_TO_EDGE)),lr.isSDF){var wu=lr.uniformValues;lr.hasHalo&&(wu.u_is_halo=1,bh(lr.buffers,yc.segments,m,d,lr.program,ae,et,ot,wu)),wu.u_is_halo=0}bh(lr.buffers,yc.segments,m,d,lr.program,ae,et,ot,lr.uniformValues)}}function bh(d,l,m,u,_,I,P,D,q){var G=u.context,et=G.gl;_.draw(G,et.TRIANGLES,I,P,D,nt.disabled,q,m.id,d.layoutVertexBuffer,d.indexBuffer,l,m.paint,u.transform.zoom,d.programConfigurations.get(m.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function rl(d,l,m,u){if(d.renderPass==="translucent"){var _=m.paint.get("circle-opacity"),I=m.paint.get("circle-stroke-width"),P=m.paint.get("circle-stroke-opacity"),D=m.layout.get("circle-sort-key").constantOr(1)!==void 0;if(!(_.constantOr(1)===0&&(I.constantOr(1)===0||P.constantOr(1)===0))){for(var q=d.context,G=q.gl,et=d.depthModeForSublayer(0,Q.ReadOnly),ot=Pt.disabled,at=d.colorModeForRenderPass(),pt=[],wt=0;wt<u.length;wt++){var bt=u[wt],xt=l.getTile(bt),Et=xt.getBucket(m);if(Et){var kt=Et.programConfigurations.get(m.id),Gt=d.useProgram("circle",kt),Kt=Et.layoutVertexBuffer,ae=Et.indexBuffer,oe=wd(d,bt,xt,m),ne={programConfiguration:kt,program:Gt,layoutVertexBuffer:Kt,indexBuffer:ae,uniformValues:oe};if(D)for(var he=Et.segments.get(),ge=0,Se=he;ge<Se.length;ge+=1){var Ce=Se[ge];pt.push({segments:new v.SegmentVector([Ce]),sortKey:Ce.sortKey,state:ne})}else pt.push({segments:Et.segments,sortKey:0,state:ne})}}D&&pt.sort(function(wi,ir){return wi.sortKey-ir.sortKey});for(var Ee=0,Je=pt;Ee<Je.length;Ee+=1){var Ai=Je[Ee],_i=Ai.state,Re=_i.programConfiguration,fi=_i.program,si=_i.layoutVertexBuffer,Li=_i.indexBuffer,Mi=_i.uniformValues,or=Ai.segments;fi.draw(q,G.TRIANGLES,et,ot,at,nt.disabled,Mi,m.id,si,Li,or,m.paint,d.transform.zoom,Re)}}}}function Xs(d,l,m,u){if(m.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){var _=d.context,I=_.gl,P=Pt.disabled,D=new O([I.ONE,I.ONE],v.Color.transparent,[!0,!0,!0,!0]);Nf(_,d,m),_.clear({color:v.Color.transparent});for(var q=0;q<u.length;q++){var G=u[q];if(!l.hasRenderableParent(G)){var et=l.getTile(G),ot=et.getBucket(m);if(ot){var at=ot.programConfigurations.get(m.id),pt=d.useProgram("heatmap",at),wt=d.transform,bt=wt.zoom;pt.draw(_,I.TRIANGLES,Q.disabled,P,D,nt.disabled,pu(G.posMatrix,et,bt,m.paint.get("heatmap-intensity")),m.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,m.paint,d.transform.zoom,at)}}}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),ji(d,m))}function Nf(d,l,m){var u=d.gl;d.activeTexture.set(u.TEXTURE1),d.viewport.set([0,0,l.width/4,l.height/4]);var _=m.heatmapFbo;if(_)u.bindTexture(u.TEXTURE_2D,_.colorAttachment.get()),d.bindFramebuffer.set(_.framebuffer);else{var I=u.createTexture();u.bindTexture(u.TEXTURE_2D,I),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),_=m.heatmapFbo=d.createFramebuffer(l.width/4,l.height/4,!1),$c(d,l,I,_)}}function $c(d,l,m,u){var _=d.gl,I=d.extRenderToTextureHalfFloat?d.extTextureHalfFloat.HALF_FLOAT_OES:_.UNSIGNED_BYTE;_.texImage2D(_.TEXTURE_2D,0,_.RGBA,l.width/4,l.height/4,0,_.RGBA,I,null),u.colorAttachment.set(m)}function ji(d,l){var m=d.context,u=m.gl,_=l.heatmapFbo;if(_){m.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,_.colorAttachment.get()),m.activeTexture.set(u.TEXTURE1);var I=l.colorRampTexture;I||(I=l.colorRampTexture=new v.Texture(m,l.colorRamp,u.RGBA)),I.bind(u.LINEAR,u.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(m,u.TRIANGLES,Q.disabled,Pt.disabled,d.colorModeForRenderPass(),nt.disabled,Ff(d,l,0,1),l.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,l.paint,d.transform.zoom)}}function qu(d,l,m,u){if(d.renderPass==="translucent"){var _=m.paint.get("line-opacity"),I=m.paint.get("line-width");if(!(_.constantOr(1)===0||I.constantOr(1)===0))for(var P=d.depthModeForSublayer(0,Q.ReadOnly),D=d.colorModeForRenderPass(),q=m.paint.get("line-dasharray"),G=m.paint.get("line-pattern"),et=G.constantOr(1),ot=m.paint.get("line-gradient"),at=m.getCrossfadeParameters(),pt=et?"linePattern":q?"lineSDF":ot?"lineGradient":"line",wt=d.context,bt=wt.gl,xt=!0,Et=0,kt=u;Et<kt.length;Et+=1){var Gt=kt[Et],Kt=l.getTile(Gt);if(!(et&&!Kt.patternsLoaded())){var ae=Kt.getBucket(m);if(ae){var oe=ae.programConfigurations.get(m.id),ne=d.context.program.get(),he=d.useProgram(pt,oe),ge=xt||he.program!==ne,Se=G.constantOr(null);if(Se&&Kt.imageAtlas){var Ce=Kt.imageAtlas,Ee=Ce.patternPositions[Se.to.toString()],Je=Ce.patternPositions[Se.from.toString()];Ee&&Je&&oe.setConstantPatternPositions(Ee,Je)}var Ai=et?Yc(d,Kt,m,at):q?os(d,Kt,m,q,at):ot?Yi(d,Kt,m,ae.lineClipsArray.length):tl(d,Kt,m);if(et)wt.activeTexture.set(bt.TEXTURE0),Kt.imageAtlasTexture.bind(bt.LINEAR,bt.CLAMP_TO_EDGE),oe.updatePaintBuffers(at);else if(q&&(ge||d.lineAtlas.dirty))wt.activeTexture.set(bt.TEXTURE0),d.lineAtlas.bind(wt);else if(ot){var _i=ae.gradients[m.id],Re=_i.texture;if(m.gradientVersion!==_i.version){var fi=256;if(m.stepInterpolant){var si=l.getSource().maxzoom,Li=Gt.canonical.z===si?Math.ceil(1<<d.transform.maxZoom-Gt.canonical.z):1,Mi=ae.maxLineLength/v.EXTENT,or=1024,wi=Mi*or*Li;fi=v.clamp(v.nextPowerOfTwo(wi),256,wt.maxTextureSize)}_i.gradient=v.renderColorRamp({expression:m.gradientExpression(),evaluationKey:"lineProgress",resolution:fi,image:_i.gradient||void 0,clips:ae.lineClipsArray}),_i.texture?_i.texture.update(_i.gradient):_i.texture=new v.Texture(wt,_i.gradient,bt.RGBA),_i.version=m.gradientVersion,Re=_i.texture}wt.activeTexture.set(bt.TEXTURE0),Re.bind(m.stepInterpolant?bt.NEAREST:bt.LINEAR,bt.CLAMP_TO_EDGE)}he.draw(wt,bt.TRIANGLES,P,d.stencilModeForClipping(Gt),D,nt.disabled,Ai,m.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,m.paint,d.transform.zoom,oe,ae.layoutVertexBuffer2),xt=!1}}}}}function qf(d,l,m,u){var _=m.paint.get("fill-color"),I=m.paint.get("fill-opacity");if(I.constantOr(1)!==0){var P=d.colorModeForRenderPass(),D=m.paint.get("fill-pattern"),q=d.opaquePassEnabledForLayer()&&!D.constantOr(1)&&_.constantOr(v.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===q){var G=d.depthModeForSublayer(1,d.renderPass==="opaque"?Q.ReadWrite:Q.ReadOnly);Zu(d,l,m,u,G,P,!1)}if(d.renderPass==="translucent"&&m.paint.get("fill-antialias")){var et=d.depthModeForSublayer(m.getPaintProperty("fill-outline-color")?2:0,Q.ReadOnly);Zu(d,l,m,u,et,P,!0)}}}function Zu(d,l,m,u,_,I,P){var D=d.context.gl,q=m.paint.get("fill-pattern"),G=q&&q.constantOr(1),et=m.getCrossfadeParameters(),ot,at,pt,wt,bt;P?(at=G&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ot=D.LINES):(at=G?"fillPattern":"fill",ot=D.TRIANGLES);for(var xt=0,Et=u;xt<Et.length;xt+=1){var kt=Et[xt],Gt=l.getTile(kt);if(!(G&&!Gt.patternsLoaded())){var Kt=Gt.getBucket(m);if(Kt){var ae=Kt.programConfigurations.get(m.id),oe=d.useProgram(at,ae);G&&(d.context.activeTexture.set(D.TEXTURE0),Gt.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),ae.updatePaintBuffers(et));var ne=q.constantOr(null);if(ne&&Gt.imageAtlas){var he=Gt.imageAtlas,ge=he.patternPositions[ne.to.toString()],Se=he.patternPositions[ne.from.toString()];ge&&Se&&ae.setConstantPatternPositions(ge,Se)}var Ce=d.translatePosMatrix(kt.posMatrix,Gt,m.paint.get("fill-translate"),m.paint.get("fill-translate-anchor"));if(!P)wt=Kt.indexBuffer,bt=Kt.segments,pt=G?Ml(Ce,d,et,Gt):Qo(Ce);else{wt=Kt.indexBuffer2,bt=Kt.segments2;var Ee=[D.drawingBufferWidth,D.drawingBufferHeight];pt=at==="fillOutlinePattern"&&G?Yh(Ce,d,et,Gt,Ee):$o(Ce,Ee)}oe.draw(d.context,ot,_,d.stencilModeForClipping(kt),I,nt.disabled,pt,m.id,Kt.layoutVertexBuffer,wt,bt,m.paint,d.transform.zoom,ae)}}}}function Ir(d,l,m,u){var _=m.paint.get("fill-extrusion-opacity");if(_!==0&&d.renderPass==="translucent"){var I=new Q(d.context.gl.LEQUAL,Q.ReadWrite,d.depthRangeFor3D);if(_===1&&!m.paint.get("fill-extrusion-pattern").constantOr(1)){var P=d.colorModeForRenderPass();rc(d,l,m,u,I,Pt.disabled,P)}else rc(d,l,m,u,I,Pt.disabled,O.disabled),rc(d,l,m,u,I,d.stencilModeFor3D(),d.colorModeForRenderPass())}}function rc(d,l,m,u,_,I,P){for(var D=d.context,q=D.gl,G=m.paint.get("fill-extrusion-pattern"),et=G.constantOr(1),ot=m.getCrossfadeParameters(),at=m.paint.get("fill-extrusion-opacity"),pt=0,wt=u;pt<wt.length;pt+=1){var bt=wt[pt],xt=l.getTile(bt),Et=xt.getBucket(m);if(Et){var kt=Et.programConfigurations.get(m.id),Gt=d.useProgram(et?"fillExtrusionPattern":"fillExtrusion",kt);et&&(d.context.activeTexture.set(q.TEXTURE0),xt.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),kt.updatePaintBuffers(ot));var Kt=G.constantOr(null);if(Kt&&xt.imageAtlas){var ae=xt.imageAtlas,oe=ae.patternPositions[Kt.to.toString()],ne=ae.patternPositions[Kt.from.toString()];oe&&ne&&kt.setConstantPatternPositions(oe,ne)}var he=d.translatePosMatrix(bt.posMatrix,xt,m.paint.get("fill-extrusion-translate"),m.paint.get("fill-extrusion-translate-anchor")),ge=m.paint.get("fill-extrusion-vertical-gradient"),Se=et?Yo(he,d,ge,at,bt,ot,xt):gh(he,d,ge,at);Gt.draw(D,D.gl.TRIANGLES,_,I,P,nt.backCCW,Se,m.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,m.paint,d.transform.zoom,kt)}}}function nc(d,l,m,u){if(!(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")){for(var _=d.context,I=d.depthModeForSublayer(0,Q.ReadOnly),P=d.colorModeForRenderPass(),D=d.renderPass==="translucent"?d.stencilConfigForOverlap(u):[{},u],q=D[0],G=D[1],et=0,ot=G;et<ot.length;et+=1){var at=ot[et],pt=l.getTile(at);pt.needsHillshadePrepare&&d.renderPass==="offscreen"?Id(d,pt,m,I,Pt.disabled,P):d.renderPass==="translucent"&&Ii(d,pt,m,I,q[at.overscaledZ],P)}_.viewport.set([0,0,d.width,d.height])}}function Ii(d,l,m,u,_,I){var P=d.context,D=P.gl,q=l.fbo;if(q){var G=d.useProgram("hillshade");P.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,q.colorAttachment.get());var et=Wc(d,l,m);G.draw(P,D.TRIANGLES,u,_,I,nt.disabled,et,m.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}}function Id(d,l,m,u,_,I){var P=d.context,D=P.gl,q=l.dem;if(q&&q.data){var G=q.dim,et=q.stride,ot=q.getPixels();if(P.activeTexture.set(D.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||d.getTileTexture(et),l.demTexture){var at=l.demTexture;at.update(ot,{premultiply:!1}),at.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else l.demTexture=new v.Texture(P,ot,D.RGBA,{premultiply:!1}),l.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);P.activeTexture.set(D.TEXTURE0);var pt=l.fbo;if(!pt){var wt=new v.Texture(P,{width:G,height:G,data:null},D.RGBA);wt.bind(D.LINEAR,D.CLAMP_TO_EDGE),pt=l.fbo=P.createFramebuffer(G,G,!0),pt.colorAttachment.set(wt.texture)}P.bindFramebuffer.set(pt.framebuffer),P.viewport.set([0,0,G,G]),d.useProgram("hillshadePrepare").draw(P,D.TRIANGLES,u,_,I,nt.disabled,Kc(l.tileID,q),m.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function ac(d,l,m,u){if(d.renderPass==="translucent"&&m.paint.get("raster-opacity")!==0&&u.length)for(var _=d.context,I=_.gl,P=l.getSource(),D=d.useProgram("raster"),q=d.colorModeForRenderPass(),G=P instanceof sn?[{},u]:d.stencilConfigForOverlap(u),et=G[0],ot=G[1],at=ot[ot.length-1].overscaledZ,pt=!d.options.moving,wt=0,bt=ot;wt<bt.length;wt+=1){var xt=bt[wt],Et=d.depthModeForSublayer(xt.overscaledZ-at,m.paint.get("raster-opacity")===1?Q.ReadWrite:Q.ReadOnly,I.LESS),kt=l.getTile(xt),Gt=d.transform.calculatePosMatrix(xt.toUnwrapped(),pt);kt.registerFadeDuration(m.paint.get("raster-fade-duration"));var Kt=l.findLoadedParent(xt,0),ae=dr(kt,Kt,l,m,d.transform),oe=void 0,ne=void 0,he=m.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;_.activeTexture.set(I.TEXTURE0),kt.texture.bind(he,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(I.TEXTURE1),Kt?(Kt.texture.bind(he,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),oe=Math.pow(2,Kt.tileID.overscaledZ-kt.tileID.overscaledZ),ne=[kt.tileID.canonical.x*oe%1,kt.tileID.canonical.y*oe%1]):kt.texture.bind(he,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);var ge=Bf(Gt,ne||[0,0],oe||1,ae,m);P instanceof sn?D.draw(_,I.TRIANGLES,Et,Pt.disabled,q,nt.disabled,ge,m.id,P.boundsBuffer,d.quadTriangleIndexBuffer,P.boundsSegments):D.draw(_,I.TRIANGLES,Et,et[xt.overscaledZ],q,nt.disabled,ge,m.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}}function dr(d,l,m,u,_){var I=u.paint.get("raster-fade-duration");if(I>0){var P=v.browser.now(),D=(P-d.timeAdded)/I,q=l?(P-l.timeAdded)/I:-1,G=m.getSource(),et=_.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),ot=!l||Math.abs(l.tileID.overscaledZ-et)>Math.abs(d.tileID.overscaledZ-et),at=ot&&d.refreshedUponExpiration?1:v.clamp(ot?D:1-q,0,1);return d.refreshedUponExpiration&&D>=1&&(d.refreshedUponExpiration=!1),l?{opacity:1,mix:1-at}:{opacity:at,mix:0}}else return{opacity:1,mix:0}}function kl(d,l,m){var u=m.paint.get("background-color"),_=m.paint.get("background-opacity");if(_!==0){var I=d.context,P=I.gl,D=d.transform,q=D.tileSize,G=m.paint.get("background-pattern");if(!d.isPatternMissing(G)){var et=!G&&u.a===1&&_===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass===et){var ot=Pt.disabled,at=d.depthModeForSublayer(0,et==="opaque"?Q.ReadWrite:Q.ReadOnly),pt=d.colorModeForRenderPass(),wt=d.useProgram(G?"backgroundPattern":"background"),bt=D.coveringTiles({tileSize:q});G&&(I.activeTexture.set(P.TEXTURE0),d.imageManager.bind(d.context));for(var xt=m.getCrossfadeParameters(),Et=0,kt=bt;Et<kt.length;Et+=1){var Gt=kt[Et],Kt=d.transform.calculatePosMatrix(Gt.toUnwrapped()),ae=G?el(Kt,_,d,G,{tileID:Gt,tileSize:q},xt):Hs(Kt,_,u);wt.draw(I,P.TRIANGLES,at,ot,pt,nt.disabled,ae,m.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}}}}var gu=new v.Color(1,0,0,1),nr=new v.Color(0,1,0,1),Fl=new v.Color(0,0,1,1),tf=new v.Color(1,0,1,1),ef=new v.Color(0,1,1,1);function ju(d){var l=d.transform.padding,m=3;Hu(d,d.transform.height-(l.top||0),m,gu),Hu(d,l.bottom||0,m,nr),rf(d,l.left||0,m,Fl),rf(d,d.transform.width-(l.right||0),m,tf);var u=d.transform.centerPoint;Gu(d,u.x,d.transform.height-u.y,ef)}function Gu(d,l,m,u){var _=20,I=2;sc(d,l-I/2,m-_/2,I,_,u),sc(d,l-_/2,m-I/2,_,I,u)}function Hu(d,l,m,u){sc(d,0,l+m/2,d.transform.width,m,u)}function rf(d,l,m,u){sc(d,l-m/2,0,m,d.transform.height,u)}function sc(d,l,m,u,_,I){var P=d.context,D=P.gl;D.enable(D.SCISSOR_TEST),D.scissor(l*v.browser.devicePixelRatio,m*v.browser.devicePixelRatio,u*v.browser.devicePixelRatio,_*v.browser.devicePixelRatio),P.clear({color:I}),D.disable(D.SCISSOR_TEST)}function oc(d,l,m){for(var u=0;u<m.length;u++)Cd(d,l,m[u])}function Cd(d,l,m){var u=d.context,_=u.gl,I=m.posMatrix,P=d.useProgram("debug"),D=Q.disabled,q=Pt.disabled,G=d.colorModeForRenderPass(),et="$debug";u.activeTexture.set(_.TEXTURE0),d.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),P.draw(u,_.LINE_STRIP,D,q,G,nt.disabled,Df(I,v.Color.red),et,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments);var ot=l.getTileByID(m.key).latestRawTileData,at=ot&&ot.byteLength||0,pt=Math.floor(at/1024),wt=l.getTile(m).tileSize,bt=512/Math.min(wt,512)*(m.overscaledZ/d.transform.zoom)*.5,xt=m.canonical.toString();m.overscaledZ!==m.canonical.z&&(xt+=" => "+m.overscaledZ);var Et=xt+" "+pt+"kb";lc(d,Et),P.draw(u,_.TRIANGLES,D,q,O.alphaBlended,nt.disabled,Df(I,v.Color.transparent,bt),et,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments)}function lc(d,l){d.initDebugOverlayCanvas();var m=d.debugOverlayCanvas,u=d.context.gl,_=d.debugOverlayCanvas.getContext("2d");_.clearRect(0,0,m.width,m.height),_.shadowColor="white",_.shadowBlur=2,_.lineWidth=1.5,_.strokeStyle="white",_.textBaseline="top",_.font="bold 36px Open Sans, sans-serif",_.fillText(l,5,5),_.strokeText(l,5,5),d.debugOverlayTexture.update(m),d.debugOverlayTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}function nf(d,l,m){var u=d.context,_=m.implementation;if(d.renderPass==="offscreen"){var I=_.prerender;I&&(d.setCustomLayerDefaults(),u.setColorMode(d.colorModeForRenderPass()),I.call(_,u.gl,d.transform.customLayerMatrix()),u.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),u.setColorMode(d.colorModeForRenderPass()),u.setStencilMode(Pt.disabled);var P=_.renderingMode==="3d"?new Q(d.context.gl.LEQUAL,Q.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Q.ReadOnly);u.setDepthMode(P),_.render(u.gl,d.transform.customLayerMatrix()),u.setDirty(),d.setBaseState(),u.bindFramebuffer.set(null)}}var ls={symbol:_u,circle:rl,heatmap:Xs,line:qu,fill:qf,"fill-extrusion":Ir,hillshade:nc,raster:ac,background:kl,debug:oc,custom:nf},_r=function(l,m){this.context=new ft(l),this.transform=m,this._tileTextures={},this.setup(),this.numSublayers=St.maxUnderzooming+St.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ou,this.gpuTimers={}};_r.prototype.resize=function(l,m){if(this.width=l*v.browser.devicePixelRatio,this.height=m*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var u=0,_=this.style._order;u<_.length;u+=1){var I=_[u];this.style._layers[I].resize()}},_r.prototype.setup=function(){var l=this.context,m=new v.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(v.EXTENT,0),m.emplaceBack(0,v.EXTENT),m.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(m,Ss.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var u=new v.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(v.EXTENT,0),u.emplaceBack(0,v.EXTENT),u.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(u,Ss.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var _=new v.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(v.EXTENT,0,v.EXTENT,0),_.emplaceBack(0,v.EXTENT,0,v.EXTENT),_.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(_,Fo.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var I=new v.StructArrayLayout2i4;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(I,Ss.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var P=new v.StructArrayLayout1ui2;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(P);var D=new v.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(D),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var q=this.context.gl;this.stencilClearMode=new Pt({func:q.ALWAYS,mask:0},0,255,q.ZERO,q.ZERO,q.ZERO)},_r.prototype.clearStencil=function(){var l=this.context,m=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var u=v.create();v.ortho(u,0,this.width,this.height,0,0,1),v.scale(u,u,[m.drawingBufferWidth,m.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,m.TRIANGLES,Q.disabled,this.stencilClearMode,O.disabled,nt.disabled,Hc(u),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},_r.prototype._renderTileClippingMasks=function(l,m){if(!(this.currentStencilSource===l.source||!l.isTileClipped()||!m||!m.length)){this.currentStencilSource=l.source;var u=this.context,_=u.gl;this.nextStencilID+m.length>256&&this.clearStencil(),u.setColorMode(O.disabled),u.setDepthMode(Q.disabled);var I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var P=0,D=m;P<D.length;P+=1){var q=D[P],G=this._tileClippingMaskIDs[q.key]=this.nextStencilID++;I.draw(u,_.TRIANGLES,Q.disabled,new Pt({func:_.ALWAYS,mask:0},G,255,_.KEEP,_.KEEP,_.REPLACE),O.disabled,nt.disabled,Hc(q.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},_r.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,m=this.context.gl;return new Pt({func:m.NOTEQUAL,mask:255},l,255,m.KEEP,m.KEEP,m.REPLACE)},_r.prototype.stencilModeForClipping=function(l){var m=this.context.gl;return new Pt({func:m.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,m.KEEP,m.KEEP,m.REPLACE)},_r.prototype.stencilConfigForOverlap=function(l){var m,u=this.context.gl,_=l.sort(function(G,et){return et.overscaledZ-G.overscaledZ}),I=_[_.length-1].overscaledZ,P=_[0].overscaledZ-I+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();for(var D={},q=0;q<P;q++)D[q+I]=new Pt({func:u.GEQUAL,mask:255},q+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=P,[D,_]}return[(m={},m[I]=Pt.disabled,m),_]},_r.prototype.colorModeForRenderPass=function(){var l=this.context.gl;if(this._showOverdrawInspector){var m=8,u=1/m;return new O([l.CONSTANT_COLOR,l.ONE],new v.Color(u,u,u,0),[!0,!0,!0,!0])}else return this.renderPass==="opaque"?O.unblended:O.alphaBlended},_r.prototype.depthModeForSublayer=function(l,m,u){if(!this.opaquePassEnabledForLayer())return Q.disabled;var _=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Q(u||this.context.gl.LEQUAL,m,[_,_])},_r.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},_r.prototype.render=function(l,m){var u=this;this.style=l,this.options=m,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var _=this.style._order,I=this.style.sourceCaches;for(var P in I){var D=I[P];D.used&&D.prepare(this.context)}var q={},G={},et={};for(var ot in I){var at=I[ot];q[ot]=at.getVisibleCoordinates(),G[ot]=q[ot].slice().reverse(),et[ot]=at.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var pt=0;pt<_.length;pt++){var wt=_[pt];if(this.style._layers[wt].is3D()){this.opaquePassCutoff=pt;break}}this.renderPass="offscreen";for(var bt=0,xt=_;bt<xt.length;bt+=1){var Et=xt[bt],kt=this.style._layers[Et];if(!(!kt.hasOffscreenPass()||kt.isHidden(this.transform.zoom))){var Gt=G[kt.source];kt.type!=="custom"&&!Gt.length||this.renderLayer(this,I[kt.source],kt,Gt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:m.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=m.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){var Kt=this.style._layers[_[this.currentLayer]],ae=I[Kt.source],oe=q[Kt.source];this._renderTileClippingMasks(Kt,oe),this.renderLayer(this,ae,Kt,oe)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){var ne=this.style._layers[_[this.currentLayer]],he=I[ne.source],ge=(ne.type==="symbol"?et:G)[ne.source];this._renderTileClippingMasks(ne,q[ne.source]),this.renderLayer(this,he,ne,ge)}if(this.options.showTileBoundaries){var Se,Ce,Ee=v.values(this.style._layers);Ee.forEach(function(Je){Je.source&&!Je.isHidden(u.transform.zoom)&&(Je.source!==(Ce&&Ce.id)&&(Ce=u.style.sourceCaches[Je.source]),(!Se||Se.getSource().maxzoom<Ce.getSource().maxzoom)&&(Se=Ce))}),Se&&ls.debug(this,Se,Se.getVisibleCoordinates())}this.options.showPadding&&ju(this),this.context.setDefault()},_r.prototype.renderLayer=function(l,m,u,_){u.isHidden(this.transform.zoom)||u.type!=="background"&&u.type!=="custom"&&!_.length||(this.id=u.id,this.gpuTimingStart(u),ls[u.type](l,m,u,_,this.style.placement.variableOffsets),this.gpuTimingEnd())},_r.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var m=this.context.extTimerQuery,u=this.gpuTimers[l.id];u||(u=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:m.createQueryEXT()}),u.calls++,m.beginQueryEXT(m.TIME_ELAPSED_EXT,u.query)}},_r.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},_r.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},_r.prototype.queryGpuTimers=function(l){var m={};for(var u in l){var _=l[u],I=this.context.extTimerQuery,P=I.getQueryObjectEXT(_.query,I.QUERY_RESULT_EXT)/(1e3*1e3);I.deleteQueryEXT(_.query),m[u]=P}return m},_r.prototype.translatePosMatrix=function(l,m,u,_,I){if(!u[0]&&!u[1])return l;var P=I?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(P){var D=Math.sin(P),q=Math.cos(P);u=[u[0]*q-u[1]*D,u[0]*D+u[1]*q]}var G=[I?u[0]:Zn(m,u[0],this.transform.zoom),I?u[1]:Zn(m,u[1],this.transform.zoom),0],et=new Float32Array(16);return v.translate(et,l,G),et},_r.prototype.saveTileTexture=function(l){var m=this._tileTextures[l.size[0]];m?m.push(l):this._tileTextures[l.size[0]]=[l]},_r.prototype.getTileTexture=function(l){var m=this._tileTextures[l];return m&&m.length>0?m.pop():null},_r.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var m=this.imageManager.getPattern(l.from.toString()),u=this.imageManager.getPattern(l.to.toString());return!m||!u},_r.prototype.useProgram=function(l,m){this.cache=this.cache||{};var u=""+l+(m?m.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[u]||(this.cache[u]=new Gc(this.context,l,mh[l],m,xa[l],this._showOverdrawInspector)),this.cache[u]},_r.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},_r.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},_r.prototype.initDebugOverlayCanvas=function(){if(this.debugOverlayCanvas==null){this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512;var l=this.context.gl;this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,l.RGBA)}},_r.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Ws=function(l,m){this.points=l,this.planes=m};Ws.fromInvProjectionMatrix=function(l,m,u){var _=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]],I=Math.pow(2,u),P=_.map(function(G){return v.transformMat4([],G,l)}).map(function(G){return v.scale$1([],G,1/G[3]/m*I)}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],q=D.map(function(G){var et=v.sub([],P[G[0]],P[G[1]]),ot=v.sub([],P[G[2]],P[G[1]]),at=v.normalize([],v.cross([],et,ot)),pt=-v.dot(at,P[G[1]]);return at.concat(pt)});return new Ws(P,q)};var yu=function(l,m){this.min=l,this.max=m,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};yu.prototype.quadrant=function(l){for(var m=[l%2===0,l<2],u=v.clone$2(this.min),_=v.clone$2(this.max),I=0;I<m.length;I++)u[I]=m[I]?this.min[I]:this.center[I],_[I]=m[I]?this.center[I]:this.max[I];return _[2]=this.max[2],new yu(u,_)},yu.prototype.distanceX=function(l){var m=Math.max(Math.min(this.max[0],l[0]),this.min[0]);return m-l[0]},yu.prototype.distanceY=function(l){var m=Math.max(Math.min(this.max[1],l[1]),this.min[1]);return m-l[1]},yu.prototype.intersects=function(l){for(var m=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],u=!0,_=0;_<l.planes.length;_++){for(var I=l.planes[_],P=0,D=0;D<m.length;D++)P+=v.dot$1(I,m[D])>=0;if(P===0)return 0;P!==m.length&&(u=!1)}if(u)return 2;for(var q=0;q<3;q++){for(var G=Number.MAX_VALUE,et=-Number.MAX_VALUE,ot=0;ot<l.points.length;ot++){var at=l.points[ot][q]-this.min[q];G=Math.min(G,at),et=Math.max(et,at)}if(et<0||G>this.max[q]-this.min[q])return 0}return 1};var us=function(l,m,u,_){if(l===void 0&&(l=0),m===void 0&&(m=0),u===void 0&&(u=0),_===void 0&&(_=0),isNaN(l)||l<0||isNaN(m)||m<0||isNaN(u)||u<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=m,this.left=u,this.right=_};us.prototype.interpolate=function(l,m,u){return m.top!=null&&l.top!=null&&(this.top=v.number(l.top,m.top,u)),m.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,m.bottom,u)),m.left!=null&&l.left!=null&&(this.left=v.number(l.left,m.left,u)),m.right!=null&&l.right!=null&&(this.right=v.number(l.right,m.right,u)),this},us.prototype.getCenter=function(l,m){var u=v.clamp((this.left+l-this.right)/2,0,l),_=v.clamp((this.top+m-this.bottom)/2,0,m);return new v.Point(u,_)},us.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},us.prototype.clone=function(){return new us(this.top,this.bottom,this.left,this.right)},us.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Xi=function(l,m,u,_,I){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=I===void 0?!0:I,this._minZoom=l||0,this._maxZoom=m||22,this._minPitch=u??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new us,this._posMatrixCache={},this._alignedPosMatrixCache={}},ar={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Xi.prototype.clone=function(){var l=new Xi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},ar.minZoom.get=function(){return this._minZoom},ar.minZoom.set=function(d){this._minZoom!==d&&(this._minZoom=d,this.zoom=Math.max(this.zoom,d))},ar.maxZoom.get=function(){return this._maxZoom},ar.maxZoom.set=function(d){this._maxZoom!==d&&(this._maxZoom=d,this.zoom=Math.min(this.zoom,d))},ar.minPitch.get=function(){return this._minPitch},ar.minPitch.set=function(d){this._minPitch!==d&&(this._minPitch=d,this.pitch=Math.max(this.pitch,d))},ar.maxPitch.get=function(){return this._maxPitch},ar.maxPitch.set=function(d){this._maxPitch!==d&&(this._maxPitch=d,this.pitch=Math.min(this.pitch,d))},ar.renderWorldCopies.get=function(){return this._renderWorldCopies},ar.renderWorldCopies.set=function(d){d===void 0?d=!0:d===null&&(d=!1),this._renderWorldCopies=d},ar.worldSize.get=function(){return this.tileSize*this.scale},ar.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ar.size.get=function(){return new v.Point(this.width,this.height)},ar.bearing.get=function(){return-this.angle/Math.PI*180},ar.bearing.set=function(d){var l=-v.wrap(d,-180,180)*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ar.pitch.get=function(){return this._pitch/Math.PI*180},ar.pitch.set=function(d){var l=v.clamp(d,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())},ar.fov.get=function(){return this._fov/Math.PI*180},ar.fov.set=function(d){d=Math.max(.01,Math.min(60,d)),this._fov!==d&&(this._unmodified=!1,this._fov=d/180*Math.PI,this._calcMatrices())},ar.zoom.get=function(){return this._zoom},ar.zoom.set=function(d){var l=Math.min(Math.max(d,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom,this._constrain(),this._calcMatrices())},ar.center.get=function(){return this._center},ar.center.set=function(d){d.lat===this._center.lat&&d.lng===this._center.lng||(this._unmodified=!1,this._center=d,this._constrain(),this._calcMatrices())},ar.padding.get=function(){return this._edgeInsets.toJSON()},ar.padding.set=function(d){this._edgeInsets.equals(d)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,d,1),this._calcMatrices())},ar.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Xi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Xi.prototype.interpolatePadding=function(l,m,u){this._unmodified=!1,this._edgeInsets.interpolate(l,m,u),this._constrain(),this._calcMatrices()},Xi.prototype.coveringZoomLevel=function(l){var m=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,m)},Xi.prototype.getVisibleUnwrappedCoordinates=function(l){var m=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var u=this.pointCoordinate(new v.Point(0,0)),_=this.pointCoordinate(new v.Point(this.width,0)),I=this.pointCoordinate(new v.Point(this.width,this.height)),P=this.pointCoordinate(new v.Point(0,this.height)),D=Math.floor(Math.min(u.x,_.x,I.x,P.x)),q=Math.floor(Math.max(u.x,_.x,I.x,P.x)),G=1,et=D-G;et<=q+G;et++)et!==0&&m.push(new v.UnwrappedTileID(et,l));return m},Xi.prototype.coveringTiles=function(l){var m=this.coveringZoomLevel(l),u=m;if(l.minzoom!==void 0&&m<l.minzoom)return[];l.maxzoom!==void 0&&m>l.maxzoom&&(m=l.maxzoom);var _=v.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,m),P=[I*_.x,I*_.y,0],D=Ws.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m),q=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(q=m);var G=3,et=function(Ee){return{aabb:new yu([Ee*I,0,0],[(Ee+1)*I,I,0]),zoom:0,x:0,y:0,wrap:Ee,fullyVisible:!1}},ot=[],at=[],pt=m,wt=l.reparseOverscaled?u:m;if(this._renderWorldCopies)for(var bt=1;bt<=3;bt++)ot.push(et(-bt)),ot.push(et(bt));for(ot.push(et(0));ot.length>0;){var xt=ot.pop(),Et=xt.x,kt=xt.y,Gt=xt.fullyVisible;if(!Gt){var Kt=xt.aabb.intersects(D);if(Kt===0)continue;Gt=Kt===2}var ae=xt.aabb.distanceX(P),oe=xt.aabb.distanceY(P),ne=Math.max(Math.abs(ae),Math.abs(oe)),he=G+(1<<pt-xt.zoom)-2;if(xt.zoom===pt||ne>he&&xt.zoom>=q){at.push({tileID:new v.OverscaledTileID(xt.zoom===pt?wt:xt.zoom,xt.wrap,xt.zoom,Et,kt),distanceSq:v.sqrLen([P[0]-.5-Et,P[1]-.5-kt])});continue}for(var ge=0;ge<4;ge++){var Se=(Et<<1)+ge%2,Ce=(kt<<1)+(ge>>1);ot.push({aabb:xt.aabb.quadrant(ge),zoom:xt.zoom+1,x:Se,y:Ce,wrap:xt.wrap,fullyVisible:Gt})}}return at.sort(function(Ee,Je){return Ee.distanceSq-Je.distanceSq}).map(function(Ee){return Ee.tileID})},Xi.prototype.resize=function(l,m){this.width=l,this.height=m,this.pixelsToGLUnits=[2/l,-2/m],this._constrain(),this._calcMatrices()},ar.unmodified.get=function(){return this._unmodified},Xi.prototype.zoomScale=function(l){return Math.pow(2,l)},Xi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Xi.prototype.project=function(l){var m=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(m)*this.worldSize)},Xi.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},ar.point.get=function(){return this.project(this.center)},Xi.prototype.setLocationAtPoint=function(l,m){var u=this.pointCoordinate(m),_=this.pointCoordinate(this.centerPoint),I=this.locationCoordinate(l),P=new v.MercatorCoordinate(I.x-(u.x-_.x),I.y-(u.y-_.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())},Xi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Xi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Xi.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},Xi.prototype.coordinateLocation=function(l){return l.toLngLat()},Xi.prototype.pointCoordinate=function(l){var m=0,u=[l.x,l.y,0,1],_=[l.x,l.y,1,1];v.transformMat4(u,u,this.pixelMatrixInverse),v.transformMat4(_,_,this.pixelMatrixInverse);var I=u[3],P=_[3],D=u[0]/I,q=_[0]/P,G=u[1]/I,et=_[1]/P,ot=u[2]/I,at=_[2]/P,pt=ot===at?0:(m-ot)/(at-ot);return new v.MercatorCoordinate(v.number(D,q,pt)/this.worldSize,v.number(G,et,pt)/this.worldSize)},Xi.prototype.coordinatePoint=function(l){var m=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(m,m,this.pixelMatrix),new v.Point(m[0]/m[3],m[1]/m[3])},Xi.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},Xi.prototype.getMaxBounds=function(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])},Xi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Xi.prototype.calculatePosMatrix=function(l,m){m===void 0&&(m=!1);var u=l.key,_=m?this._alignedPosMatrixCache:this._posMatrixCache;if(_[u])return _[u];var I=l.canonical,P=this.worldSize/this.zoomScale(I.z),D=I.x+Math.pow(2,I.z)*l.wrap,q=v.identity(new Float64Array(16));return v.translate(q,q,[D*P,I.y*P,0]),v.scale(q,q,[P/v.EXTENT,P/v.EXTENT,1]),v.multiply(q,m?this.alignedProjMatrix:this.projMatrix,q),_[u]=new Float32Array(q),_[u]},Xi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Xi.prototype._constrain=function(){if(!(!this.center||!this.width||!this.height||this._constraining)){this._constraining=!0;var l=-90,m=90,u=-180,_=180,I,P,D,q,G=this.size,et=this._unmodified;if(this.latRange){var ot=this.latRange;l=v.mercatorYfromLat(ot[1])*this.worldSize,m=v.mercatorYfromLat(ot[0])*this.worldSize,I=m-l<G.y?G.y/(m-l):0}if(this.lngRange){var at=this.lngRange;u=v.mercatorXfromLng(at[0])*this.worldSize,_=v.mercatorXfromLng(at[1])*this.worldSize,P=_-u<G.x?G.x/(_-u):0}var pt=this.point,wt=Math.max(P||0,I||0);if(wt){this.center=this.unproject(new v.Point(P?(_+u)/2:pt.x,I?(m+l)/2:pt.y)),this.zoom+=this.scaleZoom(wt),this._unmodified=et,this._constraining=!1;return}if(this.latRange){var bt=pt.y,xt=G.y/2;bt-xt<l&&(q=l+xt),bt+xt>m&&(q=m-xt)}if(this.lngRange){var Et=pt.x,kt=G.x/2;Et-kt<u&&(D=u+kt),Et+kt>_&&(D=_-kt)}(D!==void 0||q!==void 0)&&(this.center=this.unproject(new v.Point(D!==void 0?D:pt.x,q!==void 0?q:pt.y))),this._unmodified=et,this._constraining=!1}},Xi.prototype._calcMatrices=function(){if(this.height){var l=this._fov/2,m=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(l)*this.height;var u=Math.PI/2+this._pitch,_=this._fov*(.5+m.y/this.height),I=Math.sin(_)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-u-_,.01,Math.PI-.01)),P=this.point,D=P.x,q=P.y,G=Math.cos(Math.PI/2-this._pitch)*I+this.cameraToCenterDistance,et=G*1.01,ot=this.height/50,at=new Float64Array(16);v.perspective(at,this._fov,this.width/this.height,ot,et),at[8]=-m.x*2/this.width,at[9]=m.y*2/this.height,v.scale(at,at,[1,-1,1]),v.translate(at,at,[0,0,-this.cameraToCenterDistance]),v.rotateX(at,at,this._pitch),v.rotateZ(at,at,this.angle),v.translate(at,at,[-D,-q,0]),this.mercatorMatrix=v.scale([],at,[this.worldSize,this.worldSize,this.worldSize]),v.scale(at,at,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=at,this.invProjMatrix=v.invert([],this.projMatrix);var pt=this.width%2/2,wt=this.height%2/2,bt=Math.cos(this.angle),xt=Math.sin(this.angle),Et=D-Math.round(D)+bt*pt+xt*wt,kt=q-Math.round(q)+bt*wt+xt*pt,Gt=new Float64Array(at);if(v.translate(Gt,Gt,[Et>.5?Et-1:Et,kt>.5?kt-1:kt,0]),this.alignedProjMatrix=Gt,at=v.create(),v.scale(at,at,[this.width/2,-this.height/2,1]),v.translate(at,at,[1,-1,0]),this.labelPlaneMatrix=at,at=v.create(),v.scale(at,at,[1,-1,1]),v.translate(at,at,[-1,-1,0]),v.scale(at,at,[2/this.width,2/this.height,1]),this.glCoordMatrix=at,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),at=v.invert(new Float64Array(16),this.pixelMatrix),!at)throw new Error("failed to invert matrix");this.pixelMatrixInverse=at,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Xi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),m=[l.x*this.worldSize,l.y*this.worldSize,0,1],u=v.transformMat4(m,m,this.pixelMatrix);return u[3]/this.cameraToCenterDistance},Xi.prototype.getCameraPoint=function(){var l=this._pitch,m=Math.tan(l)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,m))},Xi.prototype.getCameraQueryGeometry=function(l){var m=this.getCameraPoint();if(l.length===1)return[l[0],m];for(var u=m.x,_=m.y,I=m.x,P=m.y,D=0,q=l;D<q.length;D+=1){var G=q[D];u=Math.min(u,G.x),_=Math.min(_,G.y),I=Math.max(I,G.x),P=Math.max(P,G.y)}return[new v.Point(u,_),new v.Point(I,_),new v.Point(I,P),new v.Point(u,P),new v.Point(u,_)]},Object.defineProperties(Xi.prototype,ar);function uc(d,l){var m=!1,u=null,_=function(){u=null,m&&(d(),u=setTimeout(_,l),m=!1)};return function(){return m=!0,u||_(),u}}var Ll=function(l){this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=uc(this._updateHashUnthrottled.bind(this),30*1e3/100)};Ll.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ll.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ll.prototype.getHashString=function(l){var m=this._map.getCenter(),u=Math.round(this._map.getZoom()*100)/100,_=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,_),P=Math.round(m.lng*I)/I,D=Math.round(m.lat*I)/I,q=this._map.getBearing(),G=this._map.getPitch(),et="";if(l?et+="/"+P+"/"+D+"/"+u:et+=u+"/"+D+"/"+P,(q||G)&&(et+="/"+Math.round(q*10)/10),G&&(et+="/"+Math.round(G)),this._hashName){var ot=this._hashName,at=!1,pt=v.window.location.hash.slice(1).split("&").map(function(wt){var bt=wt.split("=")[0];return bt===ot?(at=!0,bt+"="+et):wt}).filter(function(wt){return wt});return at||pt.push(ot+"="+et),"#"+pt.join("&")}return"#"+et},Ll.prototype._getCurrentHash=function(){var l=this,m=v.window.location.hash.replace("#","");if(this._hashName){var u;return m.split("&").map(function(_){return _.split("=")}).forEach(function(_){_[0]===l._hashName&&(u=_)}),(u&&u[1]||"").split("/")}return m.split("/")},Ll.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(u){return isNaN(u)})){var m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:m,pitch:+(l[4]||0)}),!0}return!1},Ll.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch{}};var wh={linearity:.3,easing:v.bezier(0,0,.3,1)},vu=v.extend({deceleration:2500,maxSpeed:1400},wh),nl=v.extend({deceleration:20,maxSpeed:1400},wh),sr=v.extend({deceleration:1e3,maxSpeed:360},wh),Rl=v.extend({deceleration:1e3,maxSpeed:90},wh),vn=function(l){this._map=l,this.clear()};vn.prototype.clear=function(){this._inertiaBuffer=[]},vn.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},vn.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,m=v.browser.now(),u=160;l.length>0&&m-l[0].time>u;)l.shift()},vn.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var m={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},u=0,_=this._inertiaBuffer;u<_.length;u+=1){var I=_[u],P=I.settings;m.zoom+=P.zoomDelta||0,m.bearing+=P.bearingDelta||0,m.pitch+=P.pitchDelta||0,P.panDelta&&m.pan._add(P.panDelta),P.around&&(m.around=P.around),P.pinchAround&&(m.pinchAround=P.pinchAround)}var D=this._inertiaBuffer[this._inertiaBuffer.length-1],q=D.time-this._inertiaBuffer[0].time,G={};if(m.pan.mag()){var et=Ne(m.pan.mag(),q,v.extend({},vu,l||{}));G.offset=m.pan.mult(et.amount/m.pan.mag()),G.center=this._map.transform.center,bo(G,et)}if(m.zoom){var ot=Ne(m.zoom,q,nl);G.zoom=this._map.transform.zoom+ot.amount,bo(G,ot)}if(m.bearing){var at=Ne(m.bearing,q,sr);G.bearing=this._map.transform.bearing+v.clamp(at.amount,-179,179),bo(G,at)}if(m.pitch){var pt=Ne(m.pitch,q,Rl);G.pitch=this._map.transform.pitch+pt.amount,bo(G,pt)}if(G.zoom||G.bearing){var wt=m.pinchAround===void 0?m.around:m.pinchAround;G.around=wt?this._map.unproject(wt):this._map.getCenter()}return this.clear(),v.extend(G,{noMoveStart:!0})}};function bo(d,l){(!d.duration||d.duration<l.duration)&&(d.duration=l.duration,d.easing=l.easing)}function Ne(d,l,m){var u=m.maxSpeed,_=m.linearity,I=m.deceleration,P=v.clamp(d*_/(l/1e3),-u,u),D=Math.abs(P)/(I*_);return{easing:m.easing,duration:D*1e3,amount:P*(D/2)}}var wa=function(d){function l(u,_,I,P){P===void 0&&(P={});var D=fe.mousePos(_.getCanvasContainer(),I),q=_.unproject(D);d.call(this,u,v.extend({point:D,lngLat:q,originalEvent:I},P)),this._defaultPrevented=!1,this.target=_}d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l;var m={defaultPrevented:{configurable:!0}};return l.prototype.preventDefault=function(){this._defaultPrevented=!0},m.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(l.prototype,m),l}(v.Event),wo=function(d){function l(u,_,I){var P=u==="touchend"?I.changedTouches:I.touches,D=fe.touchPos(_.getCanvasContainer(),P),q=D.map(function(ot){return _.unproject(ot)}),G=D.reduce(function(ot,at,pt,wt){return ot.add(at.div(wt.length))},new v.Point(0,0)),et=_.unproject(G);d.call(this,u,{points:D,point:G,lngLats:q,lngLat:et,originalEvent:I}),this._defaultPrevented=!1}d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l;var m={defaultPrevented:{configurable:!0}};return l.prototype.preventDefault=function(){this._defaultPrevented=!0},m.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(l.prototype,m),l}(v.Event),Zf=function(d){function l(u,_,I){d.call(this,u,{originalEvent:I}),this._defaultPrevented=!1}d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l;var m={defaultPrevented:{configurable:!0}};return l.prototype.preventDefault=function(){this._defaultPrevented=!0},m.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(l.prototype,m),l}(v.Event),Zr=function(l,m){this._map=l,this._clickTolerance=m.clickTolerance};Zr.prototype.reset=function(){delete this._mousedownPos},Zr.prototype.wheel=function(l){return this._firePreventable(new Zf(l.type,this._map,l))},Zr.prototype.mousedown=function(l,m){return this._mousedownPos=m,this._firePreventable(new wa(l.type,this._map,l))},Zr.prototype.mouseup=function(l){this._map.fire(new wa(l.type,this._map,l))},Zr.prototype.click=function(l,m){this._mousedownPos&&this._mousedownPos.dist(m)>=this._clickTolerance||this._map.fire(new wa(l.type,this._map,l))},Zr.prototype.dblclick=function(l){return this._firePreventable(new wa(l.type,this._map,l))},Zr.prototype.mouseover=function(l){this._map.fire(new wa(l.type,this._map,l))},Zr.prototype.mouseout=function(l){this._map.fire(new wa(l.type,this._map,l))},Zr.prototype.touchstart=function(l){return this._firePreventable(new wo(l.type,this._map,l))},Zr.prototype.touchmove=function(l){this._map.fire(new wo(l.type,this._map,l))},Zr.prototype.touchend=function(l){this._map.fire(new wo(l.type,this._map,l))},Zr.prototype.touchcancel=function(l){this._map.fire(new wo(l.type,this._map,l))},Zr.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},Zr.prototype.isEnabled=function(){return!0},Zr.prototype.isActive=function(){return!1},Zr.prototype.enable=function(){},Zr.prototype.disable=function(){};var Fn=function(l){this._map=l};Fn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Fn.prototype.mousemove=function(l){this._map.fire(new wa(l.type,this._map,l))},Fn.prototype.mousedown=function(){this._delayContextMenu=!0},Fn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Fn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new wa(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},Fn.prototype.isEnabled=function(){return!0},Fn.prototype.isActive=function(){return!1},Fn.prototype.enable=function(){},Fn.prototype.disable=function(){};var Sa=function(l,m){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=m.clickTolerance||1};Sa.prototype.isEnabled=function(){return!!this._enabled},Sa.prototype.isActive=function(){return!!this._active},Sa.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Sa.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Sa.prototype.mousedown=function(l,m){this.isEnabled()&&l.shiftKey&&l.button===0&&(fe.disableDrag(),this._startPos=this._lastPos=m,this._active=!0)},Sa.prototype.mousemoveWindow=function(l,m){if(this._active){var u=m;if(!(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)){var _=this._startPos;this._lastPos=u,this._box||(this._box=fe.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var I=Math.min(_.x,u.x),P=Math.max(_.x,u.x),D=Math.min(_.y,u.y),q=Math.max(_.y,u.y);fe.setTransform(this._box,"translate("+I+"px,"+D+"px)"),this._box.style.width=P-I+"px",this._box.style.height=q-D+"px"}}},Sa.prototype.mouseupWindow=function(l,m){var u=this;if(this._active&&l.button===0){var _=this._startPos,I=m;if(this.reset(),fe.suppressClick(),_.x===I.x&&_.y===I.y)this._fireEvent("boxzoomcancel",l);else return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(P){return P.fitScreenCoordinates(_,I,u._map.getBearing(),{linear:!0})}}}},Sa.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},Sa.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(fe.remove(this._box),this._box=null),fe.enableDrag(),delete this._startPos,delete this._lastPos},Sa.prototype._fireEvent=function(l,m){return this._map.fire(new v.Event(l,{originalEvent:m}))};function ke(d,l){for(var m={},u=0;u<d.length;u++)m[d[u].identifier]=l[u];return m}function hc(d){for(var l=new v.Point(0,0),m=0,u=d;m<u.length;m+=1){var _=u[m];l._add(_)}return l.div(d.length)}var af=500,jf=500,sf=30,Ha=function(l){this.reset(),this.numTouches=l.numTouches};Ha.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ha.prototype.touchstart=function(l,m,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=l.timeStamp),u.length===this.numTouches&&(this.centroid=hc(m),this.touches=ke(u,m)))},Ha.prototype.touchmove=function(l,m,u){if(!(this.aborted||!this.centroid)){var _=ke(u,m);for(var I in this.touches){var P=this.touches[I],D=_[I];(!D||D.dist(P)>sf)&&(this.aborted=!0)}}},Ha.prototype.touchend=function(l,m,u){if((!this.centroid||l.timeStamp-this.startTime>jf)&&(this.aborted=!0),u.length===0){var _=!this.aborted&&this.centroid;if(this.reset(),_)return _}};var Bl=function(l){this.singleTap=new Ha(l),this.numTaps=l.numTaps,this.reset()};Bl.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Bl.prototype.touchstart=function(l,m,u){this.singleTap.touchstart(l,m,u)},Bl.prototype.touchmove=function(l,m,u){this.singleTap.touchmove(l,m,u)},Bl.prototype.touchend=function(l,m,u){var _=this.singleTap.touchend(l,m,u);if(_){var I=l.timeStamp-this.lastTime<af,P=!this.lastTap||this.lastTap.dist(_)<sf;if((!I||!P)&&this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}};var Ta=function(){this._zoomIn=new Bl({numTouches:1,numTaps:2}),this._zoomOut=new Bl({numTouches:2,numTaps:1}),this.reset()};Ta.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ta.prototype.touchstart=function(l,m,u){this._zoomIn.touchstart(l,m,u),this._zoomOut.touchstart(l,m,u)},Ta.prototype.touchmove=function(l,m,u){this._zoomIn.touchmove(l,m,u),this._zoomOut.touchmove(l,m,u)},Ta.prototype.touchend=function(l,m,u){var _=this,I=this._zoomIn.touchend(l,m,u),P=this._zoomOut.touchend(l,m,u);if(I)return this._active=!0,l.preventDefault(),setTimeout(function(){return _.reset()},0),{cameraAnimation:function(D){return D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(I)},{originalEvent:l})}};if(P)return this._active=!0,l.preventDefault(),setTimeout(function(){return _.reset()},0),{cameraAnimation:function(D){return D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(P)},{originalEvent:l})}}},Ta.prototype.touchcancel=function(){this.reset()},Ta.prototype.enable=function(){this._enabled=!0},Ta.prototype.disable=function(){this._enabled=!1,this.reset()},Ta.prototype.isEnabled=function(){return this._enabled},Ta.prototype.isActive=function(){return this._active};var Sh=0,cc=2,fc={};fc[Sh]=1,fc[cc]=2;function Gf(d,l){var m=fc[l];return d.buttons===void 0||(d.buttons&m)!==m}var Xa=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Xa.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Xa.prototype._correctButton=function(l,m){return!1},Xa.prototype._move=function(l,m){return{}},Xa.prototype.mousedown=function(l,m){if(!this._lastPoint){var u=fe.mouseButton(l);this._correctButton(l,u)&&(this._lastPoint=m,this._eventButton=u)}},Xa.prototype.mousemoveWindow=function(l,m){var u=this._lastPoint;if(u){if(l.preventDefault(),Gf(l,this._eventButton)){this.reset();return}if(!(!this._moved&&m.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=m,this._move(u,m)}},Xa.prototype.mouseupWindow=function(l){if(this._lastPoint){var m=fe.mouseButton(l);m===this._eventButton&&(this._moved&&fe.suppressClick(),this.reset())}},Xa.prototype.enable=function(){this._enabled=!0},Xa.prototype.disable=function(){this._enabled=!1,this.reset()},Xa.prototype.isEnabled=function(){return this._enabled},Xa.prototype.isActive=function(){return this._active};var Ks=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.mousedown=function(u,_){d.prototype.mousedown.call(this,u,_),this._lastPoint&&(this._active=!0)},l.prototype._correctButton=function(u,_){return _===Sh&&!u.ctrlKey},l.prototype._move=function(u,_){return{around:_,panDelta:_.sub(u)}},l}(Xa),dc=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype._correctButton=function(u,_){return _===Sh&&u.ctrlKey||_===cc},l.prototype._move=function(u,_){var I=.8,P=(_.x-u.x)*I;if(P)return this._active=!0,{bearingDelta:P}},l.prototype.contextmenu=function(u){u.preventDefault()},l}(Xa),ia=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype._correctButton=function(u,_){return _===Sh&&u.ctrlKey||_===cc},l.prototype._move=function(u,_){var I=-.5,P=(_.y-u.y)*I;if(P)return this._active=!0,{pitchDelta:P}},l.prototype.contextmenu=function(u){u.preventDefault()},l}(Xa),xn=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};xn.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},xn.prototype.touchstart=function(l,m,u){return this._calculateTransform(l,m,u)},xn.prototype.touchmove=function(l,m,u){if(!(!this._active||u.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,m,u)},xn.prototype.touchend=function(l,m,u){this._calculateTransform(l,m,u),this._active&&u.length<this._minTouches&&this.reset()},xn.prototype.touchcancel=function(){this.reset()},xn.prototype._calculateTransform=function(l,m,u){u.length>0&&(this._active=!0);var _=ke(u,m),I=new v.Point(0,0),P=new v.Point(0,0),D=0;for(var q in _){var G=_[q],et=this._touches[q];et&&(I._add(G),P._add(G.sub(et)),D++,_[q]=G)}if(this._touches=_,!(D<this._minTouches||!P.mag())){var ot=P.div(D);if(this._sum._add(ot),!(this._sum.mag()<this._clickTolerance)){var at=I.div(D);return{around:at,panDelta:ot}}}},xn.prototype.enable=function(){this._enabled=!0},xn.prototype.disable=function(){this._enabled=!1,this.reset()},xn.prototype.isEnabled=function(){return this._enabled},xn.prototype.isActive=function(){return this._active};var ra=function(){this.reset()};ra.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ra.prototype._start=function(l){},ra.prototype._move=function(l,m,u){return{}},ra.prototype.touchstart=function(l,m,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([m[0],m[1]]))},ra.prototype.touchmove=function(l,m,u){if(this._firstTwoTouches){l.preventDefault();var _=this._firstTwoTouches,I=_[0],P=_[1],D=Xu(u,m,I),q=Xu(u,m,P);if(!(!D||!q)){var G=this._aroundCenter?null:D.add(q).div(2);return this._move([D,q],G,l)}}},ra.prototype.touchend=function(l,m,u){if(this._firstTwoTouches){var _=this._firstTwoTouches,I=_[0],P=_[1],D=Xu(u,m,I),q=Xu(u,m,P);D&&q||(this._active&&fe.suppressClick(),this.reset())}},ra.prototype.touchcancel=function(){this.reset()},ra.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},ra.prototype.disable=function(){this._enabled=!1,this.reset()},ra.prototype.isEnabled=function(){return this._enabled},ra.prototype.isActive=function(){return this._active};function Xu(d,l,m){for(var u=0;u<d.length;u++)if(d[u].identifier===m)return l[u]}var Wu=.1;function So(d,l){return Math.log(d/l)/Math.LN2}var Th=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.reset=function(){d.prototype.reset.call(this),delete this._distance,delete this._startDistance},l.prototype._start=function(u){this._startDistance=this._distance=u[0].dist(u[1])},l.prototype._move=function(u,_){var I=this._distance;if(this._distance=u[0].dist(u[1]),!(!this._active&&Math.abs(So(this._distance,this._startDistance))<Wu))return this._active=!0,{zoomDelta:So(this._distance,I),pinchAround:_}},l}(ra),Is=25;function Wa(d,l){return d.angleWith(l)*180/Math.PI}var Ea=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.reset=function(){d.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},l.prototype._start=function(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])},l.prototype._move=function(u,_){var I=this._vector;if(this._vector=u[0].sub(u[1]),!(!this._active&&this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Wa(this._vector,I),pinchAround:_}},l.prototype._isBelowThreshold=function(u){this._minDiameter=Math.min(this._minDiameter,u.mag());var _=Math.PI*this._minDiameter,I=Is/_*360,P=Wa(u,this._startVector);return Math.abs(P)<I},l}(ra);function hs(d){return Math.abs(d.y)>Math.abs(d.x)}var Fi=100,Ku=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.reset=function(){d.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},l.prototype._start=function(u){this._lastPoints=u,hs(u[0].sub(u[1]))&&(this._valid=!1)},l.prototype._move=function(u,_,I){var P=u[0].sub(this._lastPoints[0]),D=u[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(P,D,I.timeStamp),!!this._valid){this._lastPoints=u,this._active=!0;var q=(P.y+D.y)/2,G=-.5;return{pitchDelta:q*G}}},l.prototype.gestureBeginsVertically=function(u,_,I){if(this._valid!==void 0)return this._valid;var P=2,D=u.mag()>=P,q=_.mag()>=P;if(!(!D&&!q)){if(!D||!q)return this._firstMove===void 0&&(this._firstMove=I),I-this._firstMove<Fi?void 0:!1;var G=u.y>0==_.y>0;return hs(u)&&hs(_)&&G}},l}(ra),Eh={panStep:100,bearingStep:15,pitchStep:10},Gn=function(){var l=Eh;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};Gn.prototype.reset=function(){this._active=!1},Gn.prototype.keydown=function(l){var m=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var u=0,_=0,I=0,P=0,D=0;switch(l.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),P=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),P=1);break;case 38:l.shiftKey?I=1:(l.preventDefault(),D=-1);break;case 40:l.shiftKey?I=-1:(l.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(_=0,I=0),{cameraAnimation:function(q){var G=q.getZoom();q.easeTo({duration:300,easeId:"keyboardHandler",easing:of,zoom:u?Math.round(G)+u*(l.shiftKey?2:1):G,bearing:q.getBearing()+_*m._bearingStep,pitch:q.getPitch()+I*m._pitchStep,offset:[-P*m._panStep,-D*m._panStep],center:q.getCenter()},{originalEvent:l})}}}},Gn.prototype.enable=function(){this._enabled=!0},Gn.prototype.disable=function(){this._enabled=!1,this.reset()},Gn.prototype.isEnabled=function(){return this._enabled},Gn.prototype.isActive=function(){return this._active},Gn.prototype.disableRotation=function(){this._rotationDisabled=!0},Gn.prototype.enableRotation=function(){this._rotationDisabled=!1};function of(d){return d*(2-d)}var Yu=4.000244140625,Ia=1/100,tn=1/450,Ar=2,Xt=function(l,m){this._map=l,this._el=l.getCanvasContainer(),this._handler=m,this._delta=0,this._defaultZoomRate=Ia,this._wheelZoomRate=tn,v.bindAll(["_onTimeout"],this)};Xt.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Xt.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Xt.prototype.isEnabled=function(){return!!this._enabled},Xt.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Xt.prototype.isZooming=function(){return!!this._zooming},Xt.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Xt.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Xt.prototype.wheel=function(l){if(this.isEnabled()){var m=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?l.deltaY*40:l.deltaY,u=v.browser.now(),_=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,m!==0&&m%Yu===0?this._type="wheel":m!==0&&Math.abs(m)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=m,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(_*m)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,m+=this._lastValue)),l.shiftKey&&m&&(m=m/4),this._type&&(this._lastWheelEvent=l,this._delta-=m,this._active||this._start(l)),l.preventDefault()}},Xt.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Xt.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var m=fe.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(m)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Xt.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,!!this.isActive())){var m=this._map.transform;if(this._delta!==0){var u=this._type==="wheel"&&Math.abs(this._delta)>Yu?this._wheelZoomRate:this._defaultZoomRate,_=Ar/(1+Math.exp(-Math.abs(this._delta*u)));this._delta<0&&_!==0&&(_=1/_);var I=typeof this._targetZoom=="number"?m.zoomScale(this._targetZoom):m.scale;this._targetZoom=Math.min(m.maxZoom,Math.max(m.minZoom,m.scaleZoom(I*_))),this._type==="wheel"&&(this._startZoom=m.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var P=typeof this._targetZoom=="number"?this._targetZoom:m.zoom,D=this._startZoom,q=this._easing,G=!1,et;if(this._type==="wheel"&&D&&q){var ot=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),at=q(ot);et=v.number(D,P,at),ot<1?this._frameId||(this._frameId=!0):G=!0}else et=P,G=!0;return this._active=!0,G&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!G,zoomDelta:et-m.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Xt.prototype._smoothOutEasing=function(l){var m=v.ease;if(this._prevEase){var u=this._prevEase,_=(v.browser.now()-u.start)/u.duration,I=u.easing(_+.01)-u.easing(_),P=.27/Math.sqrt(I*I+1e-4)*.01,D=Math.sqrt(.27*.27-P*P);m=v.bezier(P,D,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:m},m},Xt.prototype.reset=function(){this._active=!1};var Ke=function(l,m){this._clickZoom=l,this._tapZoom=m};Ke.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Ke.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Ke.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Ke.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Cs=function(){this.reset()};Cs.prototype.reset=function(){this._active=!1},Cs.prototype.dblclick=function(l,m){return l.preventDefault(),{cameraAnimation:function(u){u.easeTo({duration:300,zoom:u.getZoom()+(l.shiftKey?-1:1),around:u.unproject(m)},{originalEvent:l})}}},Cs.prototype.enable=function(){this._enabled=!0},Cs.prototype.disable=function(){this._enabled=!1,this.reset()},Cs.prototype.isEnabled=function(){return this._enabled},Cs.prototype.isActive=function(){return this._active};var Ca=function(){this._tap=new Bl({numTouches:1,numTaps:1}),this.reset()};Ca.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ca.prototype.touchstart=function(l,m,u){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>af&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=m[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(l,m,u))},Ca.prototype.touchmove=function(l,m,u){if(!this._tapTime)this._tap.touchmove(l,m,u);else if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;var _=m[0],I=_.y-this._swipePoint.y;return this._swipePoint=_,l.preventDefault(),this._active=!0,{zoomDelta:I/128}}},Ca.prototype.touchend=function(l,m,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{var _=this._tap.touchend(l,m,u);_&&(this._tapTime=l.timeStamp)}},Ca.prototype.touchcancel=function(){this.reset()},Ca.prototype.enable=function(){this._enabled=!0},Ca.prototype.disable=function(){this._enabled=!1,this.reset()},Ca.prototype.isEnabled=function(){return this._enabled},Ca.prototype.isActive=function(){return this._active};var Ka=function(l,m,u){this._el=l,this._mousePan=m,this._touchPan=u};Ka.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ka.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ka.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ka.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Nr=function(l,m,u){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=m,this._mousePitch=u};Nr.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Nr.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Nr.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Nr.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var na=function(l,m,u,_){this._el=l,this._touchZoom=m,this._touchRotate=u,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0};na.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},na.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},na.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},na.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},na.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},na.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Ya=function(d){return d.zoom||d.drag||d.pitch||d.rotate},Oi=function(d){function l(){d.apply(this,arguments)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l}(v.Event);function Ol(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}var jr=function(l,m){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vn(l),this._bearingSnap=m.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(m),v.bindAll(["handleEvent","handleWindowEvent"],this);var u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[v.window,"blur",void 0]];for(var _=0,I=this._listeners;_<I.length;_+=1){var P=I[_],D=P[0],q=P[1],G=P[2];fe.addEventListener(D,q,D===v.window.document?this.handleWindowEvent:this.handleEvent,G)}};jr.prototype.destroy=function(){for(var l=0,m=this._listeners;l<m.length;l+=1){var u=m[l],_=u[0],I=u[1],P=u[2];fe.removeEventListener(_,I,_===v.window.document?this.handleWindowEvent:this.handleEvent,P)}},jr.prototype._addDefaultHandlers=function(l){var m=this._map,u=m.getCanvasContainer();this._add("mapEvent",new Zr(m,l));var _=m.boxZoom=new Sa(m,l);this._add("boxZoom",_);var I=new Ta,P=new Cs;m.doubleClickZoom=new Ke(P,I),this._add("tapZoom",I),this._add("clickZoom",P);var D=new Ca;this._add("tapDragZoom",D);var q=m.touchPitch=new Ku;this._add("touchPitch",q);var G=new dc(l),et=new ia(l);m.dragRotate=new Nr(l,G,et),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",et,["mouseRotate"]);var ot=new Ks(l),at=new xn(l);m.dragPan=new Ka(u,ot,at),this._add("mousePan",ot),this._add("touchPan",at,["touchZoom","touchRotate"]);var pt=new Ea,wt=new Th;m.touchZoomRotate=new na(u,wt,pt,D),this._add("touchRotate",pt,["touchPan","touchZoom"]),this._add("touchZoom",wt,["touchPan","touchRotate"]);var bt=m.scrollZoom=new Xt(m,this);this._add("scrollZoom",bt,["mousePan"]);var xt=m.keyboard=new Gn;this._add("keyboard",xt),this._add("blockableMapEvent",new Fn(m));for(var Et=0,kt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Et<kt.length;Et+=1){var Gt=kt[Et];l.interactive&&l[Gt]&&m[Gt].enable(l[Gt])}},jr.prototype._add=function(l,m,u){this._handlers.push({handlerName:l,handler:m,allowed:u}),this._handlersById[l]=m},jr.prototype.stop=function(l){if(!this._updatingCamera){for(var m=0,u=this._handlers;m<u.length;m+=1){var _=u[m],I=_.handler;I.reset()}this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},jr.prototype.isActive=function(){for(var l=0,m=this._handlers;l<m.length;l+=1){var u=m[l],_=u.handler;if(_.isActive())return!0}return!1},jr.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},jr.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},jr.prototype.isMoving=function(){return!!Ya(this._eventsInProgress)||this.isZooming()},jr.prototype._blockedByActive=function(l,m,u){for(var _ in l)if(_!==u&&(!m||m.indexOf(_)<0))return!0;return!1},jr.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},jr.prototype._getMapTouches=function(l){for(var m=[],u=0,_=l;u<_.length;u+=1){var I=_[u],P=I.target;this._el.contains(P)&&m.push(I)}return m},jr.prototype.handleEvent=function(l,m){if(l.type==="blur"){this.stop(!0);return}this._updatingCamera=!0;for(var u=l.type==="renderFrame"?void 0:l,_={needsRenderFrame:!1},I={},P={},D=l.touches?this._getMapTouches(l.touches):void 0,q=D?fe.touchPos(this._el,D):fe.mousePos(this._el,l),G=0,et=this._handlers;G<et.length;G+=1){var ot=et[G],at=ot.handlerName,pt=ot.handler,wt=ot.allowed;if(pt.isEnabled()){var bt=void 0;this._blockedByActive(P,wt,at)?pt.reset():pt[m||l.type]&&(bt=pt[m||l.type](l,q,D),this.mergeHandlerResult(_,I,bt,at,u),bt&&bt.needsRenderFrame&&this._triggerRenderFrame()),(bt||pt.isActive())&&(P[at]=pt)}}var xt={};for(var Et in this._previousActiveHandlers)P[Et]||(xt[Et]=u);this._previousActiveHandlers=P,(Object.keys(xt).length||Ol(_))&&(this._changes.push([_,I,xt]),this._triggerRenderFrame()),(Object.keys(P).length||Ol(_))&&this._map._stop(!0),this._updatingCamera=!1;var kt=_.cameraAnimation;kt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],kt(this._map))},jr.prototype.mergeHandlerResult=function(l,m,u,_,I){if(u){v.extend(l,u);var P={handlerName:_,originalEvent:u.originalEvent||I};u.zoomDelta!==void 0&&(m.zoom=P),u.panDelta!==void 0&&(m.drag=P),u.pitchDelta!==void 0&&(m.pitch=P),u.bearingDelta!==void 0&&(m.rotate=P)}},jr.prototype._applyChanges=function(){for(var l={},m={},u={},_=0,I=this._changes;_<I.length;_+=1){var P=I[_],D=P[0],q=P[1],G=P[2];D.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(D.panDelta)),D.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+D.zoomDelta),D.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+D.bearingDelta),D.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+D.pitchDelta),D.around!==void 0&&(l.around=D.around),D.pinchAround!==void 0&&(l.pinchAround=D.pinchAround),D.noInertia&&(l.noInertia=D.noInertia),v.extend(m,q),v.extend(u,G)}this._updateMapTransform(l,m,u),this._changes=[]},jr.prototype._updateMapTransform=function(l,m,u){var _=this._map,I=_.transform;if(!Ol(l))return this._fireEvents(m,u,!0);var P=l.panDelta,D=l.zoomDelta,q=l.bearingDelta,G=l.pitchDelta,et=l.around,ot=l.pinchAround;ot!==void 0&&(et=ot),_._stop(!0),et=et||_.transform.centerPoint;var at=I.pointLocation(P?et.sub(P):et);q&&(I.bearing+=q),G&&(I.pitch+=G),D&&(I.zoom+=D),I.setLocationAtPoint(at,et),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(m,u,!0)},jr.prototype._fireEvents=function(l,m,u){var _=this,I=Ya(this._eventsInProgress),P=Ya(l),D={};for(var q in l){var G=l[q],et=G.originalEvent;this._eventsInProgress[q]||(D[q+"start"]=et),this._eventsInProgress[q]=l[q]}!I&&P&&this._fireEvent("movestart",P.originalEvent);for(var ot in D)this._fireEvent(ot,D[ot]);P&&this._fireEvent("move",P.originalEvent);for(var at in l){var pt=l[at],wt=pt.originalEvent;this._fireEvent(at,wt)}var bt={},xt;for(var Et in this._eventsInProgress){var kt=this._eventsInProgress[Et],Gt=kt.handlerName,Kt=kt.originalEvent;this._handlersById[Gt].isActive()||(delete this._eventsInProgress[Et],xt=m[Gt]||Kt,bt[Et+"end"]=xt)}for(var ae in bt)this._fireEvent(ae,bt[ae]);var oe=Ya(this._eventsInProgress);if(u&&(I||P)&&!oe){this._updatingCamera=!0;var ne=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),he=function(ge){return ge!==0&&-_._bearingSnap<ge&&ge<_._bearingSnap};ne?(he(ne.bearing||this._map.getBearing())&&(ne.bearing=0),this._map.easeTo(ne,{originalEvent:xt})):(this._map.fire(new v.Event("moveend",{originalEvent:xt})),he(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},jr.prototype._fireEvent=function(l,m){this._map.fire(new v.Event(l,m?{originalEvent:m}:{}))},jr.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(m){delete l._frameId,l.handleEvent(new Oi("renderFrame",{timeStamp:m})),l._applyChanges()})},jr.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var lf=function(d){function l(m,u){d.call(this),this._moving=!1,this._zooming=!1,this.transform=m,this._bearingSnap=u.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},l.prototype.setCenter=function(u,_){return this.jumpTo({center:u},_)},l.prototype.panBy=function(u,_,I){return u=v.Point.convert(u).mult(-1),this.panTo(this.transform.center,v.extend({offset:u},_),I)},l.prototype.panTo=function(u,_,I){return this.easeTo(v.extend({center:u},_),I)},l.prototype.getZoom=function(){return this.transform.zoom},l.prototype.setZoom=function(u,_){return this.jumpTo({zoom:u},_),this},l.prototype.zoomTo=function(u,_,I){return this.easeTo(v.extend({zoom:u},_),I)},l.prototype.zoomIn=function(u,_){return this.zoomTo(this.getZoom()+1,u,_),this},l.prototype.zoomOut=function(u,_){return this.zoomTo(this.getZoom()-1,u,_),this},l.prototype.getBearing=function(){return this.transform.bearing},l.prototype.setBearing=function(u,_){return this.jumpTo({bearing:u},_),this},l.prototype.getPadding=function(){return this.transform.padding},l.prototype.setPadding=function(u,_){return this.jumpTo({padding:u},_),this},l.prototype.rotateTo=function(u,_,I){return this.easeTo(v.extend({bearing:u},_),I)},l.prototype.resetNorth=function(u,_){return this.rotateTo(0,v.extend({duration:1e3},u),_),this},l.prototype.resetNorthPitch=function(u,_){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},u),_),this},l.prototype.snapToNorth=function(u,_){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,_):this},l.prototype.getPitch=function(){return this.transform.pitch},l.prototype.setPitch=function(u,_){return this.jumpTo({pitch:u},_),this},l.prototype.cameraForBounds=function(u,_){u=v.LngLatBounds.convert(u);var I=_&&_.bearing||0;return this._cameraForBoxAndBearing(u.getNorthWest(),u.getSouthEast(),I,_)},l.prototype._cameraForBoxAndBearing=function(u,_,I,P){var D={top:0,bottom:0,right:0,left:0};if(P=v.extend({padding:D,offset:[0,0],maxZoom:this.transform.maxZoom},P),typeof P.padding=="number"){var q=P.padding;P.padding={top:q,bottom:q,right:q,left:q}}P.padding=v.extend(D,P.padding);var G=this.transform,et=G.padding,ot=G.project(v.LngLat.convert(u)),at=G.project(v.LngLat.convert(_)),pt=ot.rotate(-I*Math.PI/180),wt=at.rotate(-I*Math.PI/180),bt=new v.Point(Math.max(pt.x,wt.x),Math.max(pt.y,wt.y)),xt=new v.Point(Math.min(pt.x,wt.x),Math.min(pt.y,wt.y)),Et=bt.sub(xt),kt=(G.width-(et.left+et.right+P.padding.left+P.padding.right))/Et.x,Gt=(G.height-(et.top+et.bottom+P.padding.top+P.padding.bottom))/Et.y;if(Gt<0||kt<0){v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");return}var Kt=Math.min(G.scaleZoom(G.scale*Math.min(kt,Gt)),P.maxZoom),ae=typeof P.offset.x=="number"?new v.Point(P.offset.x,P.offset.y):v.Point.convert(P.offset),oe=(P.padding.left-P.padding.right)/2,ne=(P.padding.top-P.padding.bottom)/2,he=new v.Point(oe,ne),ge=he.rotate(I*Math.PI/180),Se=ae.add(ge),Ce=Se.mult(G.scale/G.zoomScale(Kt)),Ee=G.unproject(ot.add(at).div(2).sub(Ce));return{center:Ee,zoom:Kt,bearing:I}},l.prototype.fitBounds=function(u,_,I){return this._fitInternal(this.cameraForBounds(u,_),_,I)},l.prototype.fitScreenCoordinates=function(u,_,I,P,D){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(u)),this.transform.pointLocation(v.Point.convert(_)),I,P),P,D)},l.prototype._fitInternal=function(u,_,I){return u?(_=v.extend(u,_),delete _.padding,_.linear?this.easeTo(_,I):this.flyTo(_,I)):this},l.prototype.jumpTo=function(u,_){this.stop();var I=this.transform,P=!1,D=!1,q=!1;return"zoom"in u&&I.zoom!==+u.zoom&&(P=!0,I.zoom=+u.zoom),u.center!==void 0&&(I.center=v.LngLat.convert(u.center)),"bearing"in u&&I.bearing!==+u.bearing&&(D=!0,I.bearing=+u.bearing),"pitch"in u&&I.pitch!==+u.pitch&&(q=!0,I.pitch=+u.pitch),u.padding!=null&&!I.isPaddingEqual(u.padding)&&(I.padding=u.padding),this.fire(new v.Event("movestart",_)).fire(new v.Event("move",_)),P&&this.fire(new v.Event("zoomstart",_)).fire(new v.Event("zoom",_)).fire(new v.Event("zoomend",_)),D&&this.fire(new v.Event("rotatestart",_)).fire(new v.Event("rotate",_)).fire(new v.Event("rotateend",_)),q&&this.fire(new v.Event("pitchstart",_)).fire(new v.Event("pitch",_)).fire(new v.Event("pitchend",_)),this.fire(new v.Event("moveend",_))},l.prototype.easeTo=function(u,_){var I=this;this._stop(!1,u.easeId),u=v.extend({offset:[0,0],duration:500,easing:v.ease},u),(u.animate===!1||!u.essential&&v.browser.prefersReducedMotion)&&(u.duration=0);var P=this.transform,D=this.getZoom(),q=this.getBearing(),G=this.getPitch(),et=this.getPadding(),ot="zoom"in u?+u.zoom:D,at="bearing"in u?this._normalizeBearing(u.bearing,q):q,pt="pitch"in u?+u.pitch:G,wt="padding"in u?u.padding:P.padding,bt=v.Point.convert(u.offset),xt=P.centerPoint.add(bt),Et=P.pointLocation(xt),kt=v.LngLat.convert(u.center||Et);this._normalizeCenter(kt);var Gt=P.project(Et),Kt=P.project(kt).sub(Gt),ae=P.zoomScale(ot-D),oe,ne;u.around&&(oe=v.LngLat.convert(u.around),ne=P.locationPoint(oe));var he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ot!==D,this._rotating=this._rotating||q!==at,this._pitching=this._pitching||pt!==G,this._padding=!P.isPaddingEqual(wt),this._easeId=u.easeId,this._prepareEase(_,u.noMoveStart,he),this._ease(function(ge){if(I._zooming&&(P.zoom=v.number(D,ot,ge)),I._rotating&&(P.bearing=v.number(q,at,ge)),I._pitching&&(P.pitch=v.number(G,pt,ge)),I._padding&&(P.interpolatePadding(et,wt,ge),xt=P.centerPoint.add(bt)),oe)P.setLocationAtPoint(oe,ne);else{var Se=P.zoomScale(P.zoom-D),Ce=ot>D?Math.min(2,ae):Math.max(.5,ae),Ee=Math.pow(Ce,1-ge),Je=P.unproject(Gt.add(Kt.mult(ge*Ee)).mult(Se));P.setLocationAtPoint(P.renderWorldCopies?Je.wrap():Je,xt)}I._fireMoveEvents(_)},function(ge){I._afterEase(_,ge)},u),this},l.prototype._prepareEase=function(u,_,I){I===void 0&&(I={}),this._moving=!0,!_&&!I.moving&&this.fire(new v.Event("movestart",u)),this._zooming&&!I.zooming&&this.fire(new v.Event("zoomstart",u)),this._rotating&&!I.rotating&&this.fire(new v.Event("rotatestart",u)),this._pitching&&!I.pitching&&this.fire(new v.Event("pitchstart",u))},l.prototype._fireMoveEvents=function(u){this.fire(new v.Event("move",u)),this._zooming&&this.fire(new v.Event("zoom",u)),this._rotating&&this.fire(new v.Event("rotate",u)),this._pitching&&this.fire(new v.Event("pitch",u))},l.prototype._afterEase=function(u,_){if(!(this._easeId&&_&&this._easeId===_)){delete this._easeId;var I=this._zooming,P=this._rotating,D=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,I&&this.fire(new v.Event("zoomend",u)),P&&this.fire(new v.Event("rotateend",u)),D&&this.fire(new v.Event("pitchend",u)),this.fire(new v.Event("moveend",u))}},l.prototype.flyTo=function(u,_){var I=this;if(!u.essential&&v.browser.prefersReducedMotion){var P=v.pick(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(P,_)}this.stop(),u=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},u);var D=this.transform,q=this.getZoom(),G=this.getBearing(),et=this.getPitch(),ot=this.getPadding(),at="zoom"in u?v.clamp(+u.zoom,D.minZoom,D.maxZoom):q,pt="bearing"in u?this._normalizeBearing(u.bearing,G):G,wt="pitch"in u?+u.pitch:et,bt="padding"in u?u.padding:D.padding,xt=D.zoomScale(at-q),Et=v.Point.convert(u.offset),kt=D.centerPoint.add(Et),Gt=D.pointLocation(kt),Kt=v.LngLat.convert(u.center||Gt);this._normalizeCenter(Kt);var ae=D.project(Gt),oe=D.project(Kt).sub(ae),ne=u.curve,he=Math.max(D.width,D.height),ge=he/xt,Se=oe.mag();if("minZoom"in u){var Ce=v.clamp(Math.min(u.minZoom,q,at),D.minZoom,D.maxZoom),Ee=he/D.zoomScale(Ce-q);ne=Math.sqrt(Ee/Se*2)}var Je=ne*ne;function Ai(ri){var Ti=(ge*ge-he*he+(ri?-1:1)*Je*Je*Se*Se)/(2*(ri?ge:he)*Je*Se);return Math.log(Math.sqrt(Ti*Ti+1)-Ti)}function _i(ri){return(Math.exp(ri)-Math.exp(-ri))/2}function Re(ri){return(Math.exp(ri)+Math.exp(-ri))/2}function fi(ri){return _i(ri)/Re(ri)}var si=Ai(0),Li=function(ri){return Re(si)/Re(si+ne*ri)},Mi=function(ri){return he*((Re(si)*fi(si+ne*ri)-_i(si))/Je)/Se},or=(Ai(1)-si)/ne;if(Math.abs(Se)<1e-6||!isFinite(or)){if(Math.abs(he-ge)<1e-6)return this.easeTo(u,_);var wi=ge<he?-1:1;or=Math.abs(Math.log(ge/he))/ne,Mi=function(){return 0},Li=function(ri){return Math.exp(wi*ne*ri)}}if("duration"in u)u.duration=+u.duration;else{var ir="screenSpeed"in u?+u.screenSpeed/ne:+u.speed;u.duration=1e3*or/ir}return u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0),this._zooming=!0,this._rotating=G!==pt,this._pitching=wt!==et,this._padding=!D.isPaddingEqual(bt),this._prepareEase(_,!1),this._ease(function(ri){var Ti=ri*or,Lr=1/Li(Ti);D.zoom=ri===1?at:q+D.scaleZoom(Lr),I._rotating&&(D.bearing=v.number(G,pt,ri)),I._pitching&&(D.pitch=v.number(et,wt,ri)),I._padding&&(D.interpolatePadding(ot,bt,ri),kt=D.centerPoint.add(Et));var cn=ri===1?Kt:D.unproject(ae.add(oe.mult(Mi(Ti))).mult(Lr));D.setLocationAtPoint(D.renderWorldCopies?cn.wrap():cn,kt),I._fireMoveEvents(_)},function(){return I._afterEase(_)},u),this},l.prototype.isEasing=function(){return!!this._easeFrameId},l.prototype.stop=function(){return this._stop()},l.prototype._stop=function(u,_){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var I=this._onEaseEnd;delete this._onEaseEnd,I.call(this,_)}if(!u){var P=this.handlers;P&&P.stop(!1)}return this},l.prototype._ease=function(u,_,I){I.animate===!1||I.duration===0?(u(1),_()):(this._easeStart=v.browser.now(),this._easeOptions=I,this._onEaseFrame=u,this._onEaseEnd=_,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},l.prototype._renderFrameCallback=function(){var u=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},l.prototype._normalizeBearing=function(u,_){u=v.wrap(u,-180,180);var I=Math.abs(u-_);return Math.abs(u-360-_)<I&&(u-=360),Math.abs(u+360-_)<I&&(u+=360),u},l.prototype._normalizeCenter=function(u){var _=this.transform;if(!(!_.renderWorldCopies||_.lngRange)){var I=u.lng-_.center.lng;u.lng+=I>180?-360:I<-180?360:0}},l}(v.Evented),Ri=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Ri.prototype.getDefaultPosition=function(){return"bottom-right"},Ri.prototype.onAdd=function(l){var m=this.options&&this.options.compact;return this._map=l,this._container=fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=fe.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=fe.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),m&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),m===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Ri.prototype.onRemove=function(){fe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Ri.prototype._setElementTitle=function(l,m){var u=this._map._getUIString("AttributionControl."+m);l.title=u,l.setAttribute("aria-label",u)},Ri.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Ri.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var m=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var u=m.reduce(function(_,I,P){return I.value&&(_+=I.key+"="+I.value+(P<m.length-1?"&":"")),_},"?");l.href=v.config.FEEDBACK_URL+"/"+u+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},Ri.prototype._updateData=function(l){l&&(l.sourceDataType==="metadata"||l.sourceDataType==="visibility"||l.dataType==="style")&&(this._updateAttributions(),this._updateEditLink())},Ri.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(q){return typeof q!="string"?"":q})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}var u=this._map.style.sourceCaches;for(var _ in u){var I=u[_];if(I.used){var P=I.getSource();P.attribution&&l.indexOf(P.attribution)<0&&l.push(P.attribution)}}l.sort(function(q,G){return q.length-G.length}),l=l.filter(function(q,G){for(var et=G+1;et<l.length;et++)if(l[et].indexOf(q)>=0)return!1;return!0});var D=l.join(" | ");D!==this._attribHTML&&(this._attribHTML=D,l.length?(this._innerContainer.innerHTML=D,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Ri.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Mr=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};Mr.prototype.onAdd=function(l){this._map=l,this._container=fe.create("div","mapboxgl-ctrl");var m=fe.create("a","mapboxgl-ctrl-logo");return m.target="_blank",m.rel="noopener nofollow",m.href="https://www.mapbox.com/",m.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),m.setAttribute("rel","noopener nofollow"),this._container.appendChild(m),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Mr.prototype.onRemove=function(){fe.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Mr.prototype.getDefaultPosition=function(){return"bottom-left"},Mr.prototype._updateLogo=function(l){(!l||l.sourceDataType==="metadata")&&(this._container.style.display=this._logoRequired()?"block":"none")},Mr.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var m in l){var u=l[m].getSource();if(u.mapbox_logo)return!0}return!1}},Mr.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var m=l[0];this._map.getCanvasContainer().offsetWidth<250?m.classList.add("mapboxgl-compact"):m.classList.remove("mapboxgl-compact")}};var al=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};al.prototype.add=function(l){var m=++this._id,u=this._queue;return u.push({callback:l,id:m,cancelled:!1}),m},al.prototype.remove=function(l){for(var m=this._currentlyRunning,u=m?this._queue.concat(m):this._queue,_=0,I=u;_<I.length;_+=1){var P=I[_];if(P.id===l){P.cancelled=!0;return}}},al.prototype.run=function(l){l===void 0&&(l=0);var m=this._currentlyRunning=this._queue;this._queue=[];for(var u=0,_=m;u<_.length;u+=1){var I=_[u];if(!I.cancelled&&(I.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},al.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Pd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Vl=v.window.HTMLImageElement,uf=v.window.HTMLElement,To=v.window.ImageBitmap,Ul=-2,Nl=22,Hn=0,ql=60,Ih={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:Ul,maxZoom:Nl,minPitch:Hn,maxPitch:ql,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},pc=function(d){function l(u){var _=this;if(u=v.extend({},Ih,u),u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<Hn)throw new Error("minPitch must be greater than or equal to "+Hn);if(u.maxPitch!=null&&u.maxPitch>ql)throw new Error("maxPitch must be less than or equal to "+ql);var I=new Xi(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies);if(d.call(this,I,u),this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._renderTaskQueue=new al,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},Pd,u.locale),this._clickTolerance=u.clickTolerance,this._requestManager=new v.RequestManager(u.transformRequest,u.accessToken),typeof u.container=="string"){if(this._container=v.window.document.getElementById(u.container),!this._container)throw new Error("Container '"+u.container+"' not found.")}else if(u.container instanceof uf)this._container=u.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");if(u.maxBounds&&this.setMaxBounds(u.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return _._update(!1)}),this.on("moveend",function(){return _._update(!1)}),this.on("zoom",function(){return _._update(!0)}),typeof v.window<"u"&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new jr(this,u);var P=typeof u.hash=="string"&&u.hash||void 0;this._hash=u.hash&&new Ll(P).addTo(this),(!this._hash||!this._hash._onHashChange())&&(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,v.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Ri({customAttribution:u.customAttribution})),this.addControl(new Mr,u.logoPosition),this.on("style.load",function(){_.transform.unmodified&&_.jumpTo(_.style.stylesheet)}),this.on("data",function(D){_._update(D.dataType==="style"),_.fire(new v.Event(D.dataType+"data",D))}),this.on("dataloading",function(D){_.fire(new v.Event(D.dataType+"dataloading",D))})}d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l;var m={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return l.prototype._getMapId=function(){return this._mapId},l.prototype.addControl=function(_,I){if(I===void 0&&(_.getDefaultPosition?I=_.getDefaultPosition():I="top-right"),!_||!_.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var P=_.onAdd(this);this._controls.push(_);var D=this._controlPositions[I];return I.indexOf("bottom")!==-1?D.insertBefore(P,D.firstChild):D.appendChild(P),this},l.prototype.removeControl=function(_){if(!_||!_.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var I=this._controls.indexOf(_);return I>-1&&this._controls.splice(I,1),_.onRemove(this),this},l.prototype.hasControl=function(_){return this._controls.indexOf(_)>-1},l.prototype.resize=function(_){var I=this._containerDimensions(),P=I[0],D=I[1];this._resizeCanvas(P,D),this.transform.resize(P,D),this.painter.resize(P,D);var q=!this._moving;return q&&(this.stop(),this.fire(new v.Event("movestart",_)).fire(new v.Event("move",_))),this.fire(new v.Event("resize",_)),q&&this.fire(new v.Event("moveend",_)),this},l.prototype.getBounds=function(){return this.transform.getBounds()},l.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},l.prototype.setMaxBounds=function(_){return this.transform.setMaxBounds(v.LngLatBounds.convert(_)),this._update()},l.prototype.setMinZoom=function(_){if(_=_??Ul,_>=Ul&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between "+Ul+" and the current maxZoom, inclusive")},l.prototype.getMinZoom=function(){return this.transform.minZoom},l.prototype.setMaxZoom=function(_){if(_=_??Nl,_>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")},l.prototype.getMaxZoom=function(){return this.transform.maxZoom},l.prototype.setMinPitch=function(_){if(_=_??Hn,_<Hn)throw new Error("minPitch must be greater than or equal to "+Hn);if(_>=Hn&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between "+Hn+" and the current maxPitch, inclusive")},l.prototype.getMinPitch=function(){return this.transform.minPitch},l.prototype.setMaxPitch=function(_){if(_=_??ql,_>ql)throw new Error("maxPitch must be less than or equal to "+ql);if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")},l.prototype.getMaxPitch=function(){return this.transform.maxPitch},l.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},l.prototype.setRenderWorldCopies=function(_){return this.transform.renderWorldCopies=_,this._update()},l.prototype.project=function(_){return this.transform.locationPoint(v.LngLat.convert(_))},l.prototype.unproject=function(_){return this.transform.pointLocation(v.Point.convert(_))},l.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},l.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},l.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},l.prototype._createDelegatedListener=function(_,I,P){var D=this,q;if(_==="mouseenter"||_==="mouseover"){var G=!1,et=function(xt){var Et=D.getLayer(I)?D.queryRenderedFeatures(xt.point,{layers:[I]}):[];Et.length?G||(G=!0,P.call(D,new wa(_,D,xt.originalEvent,{features:Et}))):G=!1},ot=function(){G=!1};return{layer:I,listener:P,delegates:{mousemove:et,mouseout:ot}}}else if(_==="mouseleave"||_==="mouseout"){var at=!1,pt=function(xt){var Et=D.getLayer(I)?D.queryRenderedFeatures(xt.point,{layers:[I]}):[];Et.length?at=!0:at&&(at=!1,P.call(D,new wa(_,D,xt.originalEvent)))},wt=function(xt){at&&(at=!1,P.call(D,new wa(_,D,xt.originalEvent)))};return{layer:I,listener:P,delegates:{mousemove:pt,mouseout:wt}}}else{var bt=function(xt){var Et=D.getLayer(I)?D.queryRenderedFeatures(xt.point,{layers:[I]}):[];Et.length&&(xt.features=Et,P.call(D,xt),delete xt.features)};return{layer:I,listener:P,delegates:(q={},q[_]=bt,q)}}},l.prototype.on=function(_,I,P){if(P===void 0)return d.prototype.on.call(this,_,I);var D=this._createDelegatedListener(_,I,P);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(D);for(var q in D.delegates)this.on(q,D.delegates[q]);return this},l.prototype.once=function(_,I,P){if(P===void 0)return d.prototype.once.call(this,_,I);var D=this._createDelegatedListener(_,I,P);for(var q in D.delegates)this.once(q,D.delegates[q]);return this},l.prototype.off=function(_,I,P){var D=this;if(P===void 0)return d.prototype.off.call(this,_,I);var q=function(G){for(var et=G[_],ot=0;ot<et.length;ot++){var at=et[ot];if(at.layer===I&&at.listener===P){for(var pt in at.delegates)D.off(pt,at.delegates[pt]);return et.splice(ot,1),D}}};return this._delegatedListeners&&this._delegatedListeners[_]&&q(this._delegatedListeners),this},l.prototype.queryRenderedFeatures=function(_,I){if(!this.style)return[];I===void 0&&_!==void 0&&!(_ instanceof v.Point)&&!Array.isArray(_)&&(I=_,_=void 0),I=I||{},_=_||[[0,0],[this.transform.width,this.transform.height]];var P;if(_ instanceof v.Point||typeof _[0]=="number")P=[v.Point.convert(_)];else{var D=v.Point.convert(_[0]),q=v.Point.convert(_[1]);P=[D,new v.Point(q.x,D.y),q,new v.Point(D.x,q.y),D]}return this.style.queryRenderedFeatures(P,I,this.transform)},l.prototype.querySourceFeatures=function(_,I){return this.style.querySourceFeatures(_,I)},l.prototype.setStyle=function(_,I){return I=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},I),I.diff!==!1&&I.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,I),this):(this._localIdeographFontFamily=I.localIdeographFontFamily,this._updateStyle(_,I))},l.prototype._getUIString=function(_){var I=this._locale[_];if(I==null)throw new Error("Missing UI string '"+_+"'");return I},l.prototype._updateStyle=function(_,I){if(this.style&&(this.style.setEventedParent(null),this.style._remove()),_)this.style=new lu(this,I||{});else return delete this.style,this;return this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_):this.style.loadJSON(_),this},l.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new lu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},l.prototype._diffStyle=function(_,I){var P=this;if(typeof _=="string"){var D=this._requestManager.normalizeStyleURL(_),q=this._requestManager.transformRequest(D,v.ResourceType.Style);v.getJSON(q,function(G,et){G?P.fire(new v.ErrorEvent(G)):et&&P._updateDiff(et,I)})}else typeof _=="object"&&this._updateDiff(_,I)},l.prototype._updateDiff=function(_,I){try{this.style.setState(_)&&this._update(!0)}catch(P){v.warnOnce("Unable to perform style diff: "+(P.message||P.error||P)+".  Rebuilding the style from scratch."),this._updateStyle(_,I)}},l.prototype.getStyle=function(){if(this.style)return this.style.serialize()},l.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},l.prototype.addSource=function(_,I){return this._lazyInitEmptyStyle(),this.style.addSource(_,I),this._update(!0)},l.prototype.isSourceLoaded=function(_){var I=this.style&&this.style.sourceCaches[_];if(I===void 0){this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+_+"'")));return}return I.loaded()},l.prototype.areTilesLoaded=function(){var _=this.style&&this.style.sourceCaches;for(var I in _){var P=_[I],D=P._tiles;for(var q in D){var G=D[q];if(!(G.state==="loaded"||G.state==="errored"))return!1}}return!0},l.prototype.addSourceType=function(_,I,P){return this._lazyInitEmptyStyle(),this.style.addSourceType(_,I,P)},l.prototype.removeSource=function(_){return this.style.removeSource(_),this._update(!0)},l.prototype.getSource=function(_){return this.style.getSource(_)},l.prototype.addImage=function(_,I,P){P===void 0&&(P={});var D=P.pixelRatio;D===void 0&&(D=1);var q=P.sdf;q===void 0&&(q=!1);var G=P.stretchX,et=P.stretchY,ot=P.content;this._lazyInitEmptyStyle();var at=0;if(I instanceof Vl||To&&I instanceof To){var pt=v.browser.getImageData(I),wt=pt.width,bt=pt.height,xt=pt.data;this.style.addImage(_,{data:new v.RGBAImage({width:wt,height:bt},xt),pixelRatio:D,stretchX:G,stretchY:et,content:ot,sdf:q,version:at})}else{if(I.width===void 0||I.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Et=I.width,kt=I.height,Gt=I.data,Kt=I;this.style.addImage(_,{data:new v.RGBAImage({width:Et,height:kt},new Uint8Array(Gt)),pixelRatio:D,stretchX:G,stretchY:et,content:ot,sdf:q,version:at,userImage:Kt}),Kt.onAdd&&Kt.onAdd(this,_)}},l.prototype.updateImage=function(_,I){var P=this.style.getImage(_);if(!P)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var D=I instanceof Vl||To&&I instanceof To?v.browser.getImageData(I):I,q=D.width,G=D.height,et=D.data;if(q===void 0||G===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(q!==P.data.width||G!==P.data.height)return this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));var ot=!(I instanceof Vl||To&&I instanceof To);P.data.replace(et,ot),this.style.updateImage(_,P)},l.prototype.hasImage=function(_){return _?!!this.style.getImage(_):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},l.prototype.removeImage=function(_){this.style.removeImage(_)},l.prototype.loadImage=function(_,I){v.getImage(this._requestManager.transformRequest(_,v.ResourceType.Image),I)},l.prototype.listImages=function(){return this.style.listImages()},l.prototype.addLayer=function(_,I){return this._lazyInitEmptyStyle(),this.style.addLayer(_,I),this._update(!0)},l.prototype.moveLayer=function(_,I){return this.style.moveLayer(_,I),this._update(!0)},l.prototype.removeLayer=function(_){return this.style.removeLayer(_),this._update(!0)},l.prototype.getLayer=function(_){return this.style.getLayer(_)},l.prototype.setLayerZoomRange=function(_,I,P){return this.style.setLayerZoomRange(_,I,P),this._update(!0)},l.prototype.setFilter=function(_,I,P){return P===void 0&&(P={}),this.style.setFilter(_,I,P),this._update(!0)},l.prototype.getFilter=function(_){return this.style.getFilter(_)},l.prototype.setPaintProperty=function(_,I,P,D){return D===void 0&&(D={}),this.style.setPaintProperty(_,I,P,D),this._update(!0)},l.prototype.getPaintProperty=function(_,I){return this.style.getPaintProperty(_,I)},l.prototype.setLayoutProperty=function(_,I,P,D){return D===void 0&&(D={}),this.style.setLayoutProperty(_,I,P,D),this._update(!0)},l.prototype.getLayoutProperty=function(_,I){return this.style.getLayoutProperty(_,I)},l.prototype.setLight=function(_,I){return I===void 0&&(I={}),this._lazyInitEmptyStyle(),this.style.setLight(_,I),this._update(!0)},l.prototype.getLight=function(){return this.style.getLight()},l.prototype.setFeatureState=function(_,I){return this.style.setFeatureState(_,I),this._update()},l.prototype.removeFeatureState=function(_,I){return this.style.removeFeatureState(_,I),this._update()},l.prototype.getFeatureState=function(_){return this.style.getFeatureState(_)},l.prototype.getContainer=function(){return this._container},l.prototype.getCanvasContainer=function(){return this._canvasContainer},l.prototype.getCanvas=function(){return this._canvas},l.prototype._containerDimensions=function(){var _=0,I=0;return this._container&&(_=this._container.clientWidth||400,I=this._container.clientHeight||300),[_,I]},l.prototype._detectMissingCSS=function(){var _=v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color");_!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},l.prototype._setupContainer=function(){var _=this._container;_.classList.add("mapboxgl-map");var I=this._missingCSSCanary=fe.create("div","mapboxgl-canary",_);I.style.visibility="hidden",this._detectMissingCSS();var P=this._canvasContainer=fe.create("div","mapboxgl-canvas-container",_);this._interactive&&P.classList.add("mapboxgl-interactive"),this._canvas=fe.create("canvas","mapboxgl-canvas",P),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var D=this._containerDimensions();this._resizeCanvas(D[0],D[1]);var q=this._controlContainer=fe.create("div","mapboxgl-control-container",_),G=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(et){G[et]=fe.create("div","mapboxgl-ctrl-"+et,q)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},l.prototype._resizeCanvas=function(_,I){var P=v.browser.devicePixelRatio||1;this._canvas.width=P*_,this._canvas.height=P*I,this._canvas.style.width=_+"px",this._canvas.style.height=I+"px"},l.prototype._setupPainter=function(){var _=v.extend({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),I=this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);if(!I){this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")));return}this.painter=new _r(I,this.transform),v.webpSupported.testSupport(I)},l.prototype._contextLost=function(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:_}))},l.prototype._contextRestored=function(_){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:_}))},l.prototype._onMapScroll=function(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},l.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},l.prototype._update=function(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this},l.prototype._requestRenderFrame=function(_){return this._update(),this._renderTaskQueue.add(_)},l.prototype._cancelRenderFrame=function(_){this._renderTaskQueue.remove(_)},l.prototype._render=function(_){var I=this,P,D=0,q=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(P=q.createQueryEXT(),q.beginQueryEXT(q.TIME_ELAPSED_EXT,P),D=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var et=this.transform.zoom,ot=v.browser.now();this.style.zoomHistory.update(et,ot);var at=new v.EvaluationParameters(et,{now:ot,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pt=at.crossFadingFactor();(pt!==1||pt!==this._crossFadingFactor)&&(G=!0,this._crossFadingFactor=pt),this.style.update(at)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var wt=v.browser.now()-D;q.endQueryEXT(q.TIME_ELAPSED_EXT,P),setTimeout(function(){var Et=q.getQueryObjectEXT(P,q.QUERY_RESULT_EXT)/1e6;q.deleteQueryEXT(P),I.fire(new v.Event("gpu-timing-frame",{cpuTime:wt,gpuTime:Et}))},50)}if(this.listens("gpu-timing-layer")){var bt=this.painter.collectGpuTimers();setTimeout(function(){var Et=I.painter.queryGpuTimers(bt);I.fire(new v.Event("gpu-timing-layer",{layerTimes:Et}))},50)}var xt=this._sourcesDirty||this._styleDirty||this._placementDirty;return xt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),this._loaded&&!this._fullyLoaded&&!xt&&(this._fullyLoaded=!0),this}},l.prototype.remove=function(){this._hash&&this._hash.remove();for(var _=0,I=this._controls;_<I.length;_+=1){var P=I[_];P.onRemove(this)}this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof v.window<"u"&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var D=this.painter.context.gl.getExtension("WEBGL_lose_context");D&&D.loseContext&&D.loseContext(),Ju(this._canvasContainer),Ju(this._controlContainer),Ju(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},l.prototype.triggerRepaint=function(){var _=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(I){_._frame=null,_._render(I)}))},l.prototype._onWindowOnline=function(){this._update()},l.prototype._onWindowResize=function(_){this._trackResize&&this.resize({originalEvent:_})._update()},m.showTileBoundaries.get=function(){return!!this._showTileBoundaries},m.showTileBoundaries.set=function(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())},m.showPadding.get=function(){return!!this._showPadding},m.showPadding.set=function(u){this._showPadding!==u&&(this._showPadding=u,this._update())},m.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},m.showCollisionBoxes.set=function(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())},m.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},m.showOverdrawInspector.set=function(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())},m.repaint.get=function(){return!!this._repaint},m.repaint.set=function(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())},m.vertices.get=function(){return!!this._vertices},m.vertices.set=function(u){this._vertices=u,this._update()},l.prototype._setCacheLimits=function(_,I){v.setCacheLimits(_,I)},m.version.get=function(){return v.version},Object.defineProperties(l.prototype,m),l}(lf);function Ju(d){d.parentNode&&d.parentNode.removeChild(d)}var Ch={showCompass:!0,showZoom:!0,visualizePitch:!1},sl=function(l){var m=this;this.options=v.extend({},Ch,l),this._container=fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(u){return u.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(u){return m._map.zoomIn({},{originalEvent:u})}),fe.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(u){return m._map.zoomOut({},{originalEvent:u})}),fe.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(u){m.options.visualizePitch?m._map.resetNorthPitch({},{originalEvent:u}):m._map.resetNorth({},{originalEvent:u})}),this._compassIcon=fe.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};sl.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),m=l===this._map.getMaxZoom(),u=l===this._map.getMinZoom();this._zoomInButton.disabled=m,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",m.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},sl.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},sl.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new aa(this._map,this._compass,this.options.visualizePitch)),this._container},sl.prototype.onRemove=function(){fe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},sl.prototype._createButton=function(l,m){var u=fe.create("button",l,this._container);return u.type="button",u.addEventListener("click",m),u},sl.prototype._setButtonTitle=function(l,m){var u=this._map._getUIString("NavigationControl."+m);l.title=u,l.setAttribute("aria-label",u)};var aa=function(l,m,u){u===void 0&&(u=!1),this._clickTolerance=10,this.element=m,this.mouseRotate=new dc({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,u&&(this.mousePitch=new ia({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),fe.addEventListener(m,"mousedown",this.mousedown),fe.addEventListener(m,"touchstart",this.touchstart,{passive:!1}),fe.addEventListener(m,"touchmove",this.touchmove),fe.addEventListener(m,"touchend",this.touchend),fe.addEventListener(m,"touchcancel",this.reset)};aa.prototype.down=function(l,m){this.mouseRotate.mousedown(l,m),this.mousePitch&&this.mousePitch.mousedown(l,m),fe.disableDrag()},aa.prototype.move=function(l,m){var u=this.map,_=this.mouseRotate.mousemoveWindow(l,m);if(_&&_.bearingDelta&&u.setBearing(u.getBearing()+_.bearingDelta),this.mousePitch){var I=this.mousePitch.mousemoveWindow(l,m);I&&I.pitchDelta&&u.setPitch(u.getPitch()+I.pitchDelta)}},aa.prototype.off=function(){var l=this.element;fe.removeEventListener(l,"mousedown",this.mousedown),fe.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),fe.removeEventListener(l,"touchmove",this.touchmove),fe.removeEventListener(l,"touchend",this.touchend),fe.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},aa.prototype.offTemp=function(){fe.enableDrag(),fe.removeEventListener(v.window,"mousemove",this.mousemove),fe.removeEventListener(v.window,"mouseup",this.mouseup)},aa.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),fe.mousePos(this.element,l)),fe.addEventListener(v.window,"mousemove",this.mousemove),fe.addEventListener(v.window,"mouseup",this.mouseup)},aa.prototype.mousemove=function(l){this.move(l,fe.mousePos(this.element,l))},aa.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},aa.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=fe.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},aa.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=fe.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},aa.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},aa.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};function Ln(d,l,m){if(d=new v.LngLat(d.lng,d.lat),l){var u=new v.LngLat(d.lng-360,d.lat),_=new v.LngLat(d.lng+360,d.lat),I=m.locationPoint(d).distSqr(l);m.locationPoint(u).distSqr(l)<I?d=u:m.locationPoint(_).distSqr(l)<I&&(d=_)}for(;Math.abs(d.lng-m.center.lng)>180;){var P=m.locationPoint(d);if(P.x>=0&&P.y>=0&&P.x<=m.width&&P.y<=m.height)break;d.lng>m.center.lng?d.lng-=360:d.lng+=360}return d}var gr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zl(d,l,m){var u=d.classList;for(var _ in gr)u.remove("mapboxgl-"+m+"-anchor-"+_);u.add("mapboxgl-"+m+"-anchor-"+l)}var ol=function(d){function l(m,u){if(d.call(this),(m instanceof v.window.HTMLElement||u)&&(m=v.extend({element:m},u)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=m&&m.anchor||"center",this._color=m&&m.color||"#3FB1CE",this._scale=m&&m.scale||1,this._draggable=m&&m.draggable||!1,this._clickTolerance=m&&m.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=m&&m.rotation||0,this._rotationAlignment=m&&m.rotationAlignment||"auto",this._pitchAlignment=m&&m.pitchAlignment&&m.pitchAlignment!=="auto"?m.pitchAlignment:this._rotationAlignment,!m||!m.element){this._defaultMarker=!0,this._element=fe.create("div"),this._element.setAttribute("aria-label","Map marker");var _=fe.createNS("http://www.w3.org/2000/svg","svg"),I=41,P=27;_.setAttributeNS(null,"display","block"),_.setAttributeNS(null,"height",I+"px"),_.setAttributeNS(null,"width",P+"px"),_.setAttributeNS(null,"viewBox","0 0 "+P+" "+I);var D=fe.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"stroke","none"),D.setAttributeNS(null,"stroke-width","1"),D.setAttributeNS(null,"fill","none"),D.setAttributeNS(null,"fill-rule","evenodd");var q=fe.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill-rule","nonzero");var G=fe.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(3.0, 29.0)"),G.setAttributeNS(null,"fill","#000000");for(var et=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}],ot=0,at=et;ot<at.length;ot+=1){var pt=at[ot],wt=fe.createNS("http://www.w3.org/2000/svg","ellipse");wt.setAttributeNS(null,"opacity","0.04"),wt.setAttributeNS(null,"cx","10.5"),wt.setAttributeNS(null,"cy","5.80029008"),wt.setAttributeNS(null,"rx",pt.rx),wt.setAttributeNS(null,"ry",pt.ry),G.appendChild(wt)}var bt=fe.createNS("http://www.w3.org/2000/svg","g");bt.setAttributeNS(null,"fill",this._color);var xt=fe.createNS("http://www.w3.org/2000/svg","path");xt.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),bt.appendChild(xt);var Et=fe.createNS("http://www.w3.org/2000/svg","g");Et.setAttributeNS(null,"opacity","0.25"),Et.setAttributeNS(null,"fill","#000000");var kt=fe.createNS("http://www.w3.org/2000/svg","path");kt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Et.appendChild(kt);var Gt=fe.createNS("http://www.w3.org/2000/svg","g");Gt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Gt.setAttributeNS(null,"fill","#FFFFFF");var Kt=fe.createNS("http://www.w3.org/2000/svg","g");Kt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var ae=fe.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#000000"),ae.setAttributeNS(null,"opacity","0.25"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962");var oe=fe.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#FFFFFF"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962"),Kt.appendChild(ae),Kt.appendChild(oe),q.appendChild(G),q.appendChild(bt),q.appendChild(Et),q.appendChild(Gt),q.appendChild(Kt),_.appendChild(q),_.setAttributeNS(null,"height",I*this._scale+"px"),_.setAttributeNS(null,"width",P*this._scale+"px"),this._element.appendChild(_),this._offset=v.Point.convert(m&&m.offset||[0,-14])}else this._element=m.element,this._offset=v.Point.convert(m&&m.offset||[0,0]);this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(ne){ne.preventDefault()}),this._element.addEventListener("mousedown",function(ne){ne.preventDefault()}),Zl(this._element,this._anchor,"marker"),this._popup=null}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.addTo=function(u){return this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._update),u.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},l.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),fe.remove(this._element),this._popup&&this._popup.remove(),this},l.prototype.getLngLat=function(){return this._lngLat},l.prototype.setLngLat=function(u){return this._lngLat=v.LngLat.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},l.prototype.getElement=function(){return this._element},l.prototype.setPopup=function(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){var _=38.1,I=13.5,P=Math.sqrt(Math.pow(I,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-_],"bottom-left":[P,(_-I+P)*-1],"bottom-right":[-P,(_-I+P)*-1],left:[I,(_-I)*-1],right:[-I,(_-I)*-1]}:this._offset}this._popup=u,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},l.prototype._onKeyPress=function(u){var _=u.code,I=u.charCode||u.keyCode;(_==="Space"||_==="Enter"||I===32||I===13)&&this.togglePopup()},l.prototype._onMapClick=function(u){var _=u.originalEvent.target,I=this._element;this._popup&&(_===I||I.contains(_))&&this.togglePopup()},l.prototype.getPopup=function(){return this._popup},l.prototype.togglePopup=function(){var u=this._popup;if(u)u.isOpen()?u.remove():u.addTo(this._map);else return this;return this},l.prototype._update=function(u){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ln(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(_="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I="rotateX("+this._map.getPitch()+"deg)"),(!u||u.type==="moveend")&&(this._pos=this._pos.round()),fe.setTransform(this._element,gr[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+I+" "+_)}},l.prototype.getOffset=function(){return this._offset},l.prototype.setOffset=function(u){return this._offset=v.Point.convert(u),this._update(),this},l.prototype._onMove=function(u){if(!this._isDragging){var _=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},l.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},l.prototype._addDragHandler=function(u){this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},l.prototype.setDraggable=function(u){return this._draggable=!!u,this._map&&(u?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},l.prototype.isDraggable=function(){return this._draggable},l.prototype.setRotation=function(u){return this._rotation=u||0,this._update(),this},l.prototype.getRotation=function(){return this._rotation},l.prototype.setRotationAlignment=function(u){return this._rotationAlignment=u||"auto",this._update(),this},l.prototype.getRotationAlignment=function(){return this._rotationAlignment},l.prototype.setPitchAlignment=function(u){return this._pitchAlignment=u&&u!=="auto"?u:this._rotationAlignment,this._update(),this},l.prototype.getPitchAlignment=function(){return this._pitchAlignment},l}(v.Evented),mc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Eo;function xu(d){Eo!==void 0?d(Eo):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(l){Eo=l.state!=="denied",d(Eo)}):(Eo=!!v.window.navigator.geolocation,d(Eo))}var jl=0,Xn=!1,Qu=function(d){function l(m){d.call(this),this.options=v.extend({},mc,m),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.onAdd=function(u){return this._map=u,this._container=fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),xu(this._setupUI),this._container},l.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),fe.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,jl=0,Xn=!1},l.prototype._isOutOfMapMaxBounds=function(u){var _=this._map.getMaxBounds(),I=u.coords;return _&&(I.longitude<_.getWest()||I.longitude>_.getEast()||I.latitude<_.getSouth()||I.latitude>_.getNorth())},l.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break}},l.prototype._onSuccess=function(u){if(this._map){if(this._isOutOfMapMaxBounds(u)){this._setErrorState(),this.fire(new v.Event("outofmaxbounds",u)),this._updateMarker(),this._finish();return}if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",u)),this._finish()}},l.prototype._updateCamera=function(u){var _=new v.LngLat(u.coords.longitude,u.coords.latitude),I=u.coords.accuracy,P=this._map.getBearing(),D=v.extend({bearing:P},this.options.fitBoundsOptions);this._map.fitBounds(_.toBounds(I),D,{geolocateSource:!0})},l.prototype._updateMarker=function(u){if(u){var _=new v.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(_).addTo(this._map),this._userLocationDotMarker.setLngLat(_).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},l.prototype._updateCircleRadius=function(){var u=this._map._container.clientHeight/2,_=this._map.unproject([0,u]),I=this._map.unproject([1,u]),P=_.distanceTo(I),D=Math.ceil(2*this._accuracy/P);this._circleElement.style.width=D+"px",this._circleElement.style.height=D+"px"},l.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},l.prototype._onError=function(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var _=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&Xn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",u)),this._finish()}},l.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},l.prototype._setupUI=function(u){var _=this;if(this._container.addEventListener("contextmenu",function(D){return D.preventDefault()}),this._geolocateButton=fe.create("button","mapboxgl-ctrl-geolocate",this._container),fe.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",u===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var I=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=I,this._geolocateButton.setAttribute("aria-label",I)}else{var P=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=P,this._geolocateButton.setAttribute("aria-label",P)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=fe.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ol(this._dotElement),this._circleElement=fe.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ol({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(D){var q=D.originalEvent&&D.originalEvent.type==="resize";!D.geolocateSource&&_._watchState==="ACTIVE_LOCK"&&!q&&(_._watchState="BACKGROUND",_._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),_._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),_.fire(new v.Event("trackuserlocationend")))})},l.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":jl--,Xn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"));break}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error");break}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),jl++;var u;jl>1?(u={maximumAge:6e5,timeout:0},Xn=!0):(u=this.options.positionOptions,Xn=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},l.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},l}(v.Evented),Xe={maxWidth:100,unit:"metric"},Ye=function(l){this.options=v.extend({},Xe,l),v.bindAll(["_onMove","setUnit"],this)};Ye.prototype.getDefaultPosition=function(){return"bottom-left"},Ye.prototype._onMove=function(){$u(this._map,this._container,this.options)},Ye.prototype.onAdd=function(l){return this._map=l,this._container=fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Ye.prototype.onRemove=function(){fe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Ye.prototype.setUnit=function(l){this.options.unit=l,$u(this._map,this._container,this.options)};function $u(d,l,m){var u=m&&m.maxWidth||100,_=d._container.clientHeight/2,I=d.unproject([0,_]),P=d.unproject([u,_]),D=I.distanceTo(P);if(m&&m.unit==="imperial"){var q=3.2808*D;if(q>5280){var G=q/5280;ll(l,u,G,d._getUIString("ScaleControl.Miles"))}else ll(l,u,q,d._getUIString("ScaleControl.Feet"))}else if(m&&m.unit==="nautical"){var et=D/1852;ll(l,u,et,d._getUIString("ScaleControl.NauticalMiles"))}else D>=1e3?ll(l,u,D/1e3,d._getUIString("ScaleControl.Kilometers")):ll(l,u,D,d._getUIString("ScaleControl.Meters"))}function ll(d,l,m,u){var _=Pa(m),I=_/m;d.style.width=l*I+"px",d.innerHTML=_+"&nbsp;"+u}function _c(d){var l=Math.pow(10,Math.ceil(-Math.log(d)/Math.LN10));return Math.round(d*l)/l}function Pa(d){var l=Math.pow(10,(""+Math.floor(d)).length-1),m=d/l;return m=m>=10?10:m>=5?5:m>=3?3:m>=2?2:m>=1?1:_c(m),l*m}var Ja=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ja.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ja.prototype.onRemove=function(){fe.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ja.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},Ja.prototype._setupUI=function(){var l=this._fullscreenButton=fe.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);fe.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ja.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Ja.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ja.prototype._isFullscreen=function(){return this._fullscreen},Ja.prototype._changeIcon=function(){var l=v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement;l===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ja.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Ps={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},hf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ph=function(d){function l(m){d.call(this),this.options=v.extend(Object.create(Ps),m),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return d&&(l.__proto__=d),l.prototype=Object.create(d&&d.prototype),l.prototype.constructor=l,l.prototype.addTo=function(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},l.prototype.isOpen=function(){return!!this._map},l.prototype.remove=function(){return this._content&&fe.remove(this._content),this._container&&(fe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},l.prototype.getLngLat=function(){return this._lngLat},l.prototype.setLngLat=function(u){return this._lngLat=v.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},l.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},l.prototype.getElement=function(){return this._container},l.prototype.setText=function(u){return this.setDOMContent(v.window.document.createTextNode(u))},l.prototype.setHTML=function(u){var _=v.window.document.createDocumentFragment(),I=v.window.document.createElement("body"),P;for(I.innerHTML=u;P=I.firstChild,!!P;)_.appendChild(P);return this.setDOMContent(_)},l.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},l.prototype.setMaxWidth=function(u){return this.options.maxWidth=u,this._update(),this},l.prototype.setDOMContent=function(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=fe.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this},l.prototype.addClassName=function(u){this._container&&this._container.classList.add(u)},l.prototype.removeClassName=function(u){this._container&&this._container.classList.remove(u)},l.prototype.setOffset=function(u){return this.options.offset=u,this._update(),this},l.prototype.toggleClassName=function(u){if(this._container)return this._container.classList.toggle(u)},l.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=fe.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},l.prototype._onMouseUp=function(u){this._update(u.point)},l.prototype._onMouseMove=function(u){this._update(u.point)},l.prototype._onDrag=function(u){this._update(u.point)},l.prototype._update=function(u){var _=this,I=this._lngLat||this._trackPointer;if(!(!this._map||!I||!this._content)&&(this._container||(this._container=fe.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=fe.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(pt){return _._container.classList.add(pt)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ln(this._lngLat,this._pos,this._map.transform)),!(this._trackPointer&&!u))){var P=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat),D=this.options.anchor,q=Hf(this.options.offset);if(!D){var G=this._container.offsetWidth,et=this._container.offsetHeight,ot;P.y+q.bottom.y<et?ot=["top"]:P.y>this._map.transform.height-et?ot=["bottom"]:ot=[],P.x<G/2?ot.push("left"):P.x>this._map.transform.width-G/2&&ot.push("right"),ot.length===0?D="bottom":D=ot.join("-")}var at=P.add(q[D]).round();fe.setTransform(this._container,gr[D]+" translate("+at.x+"px,"+at.y+"px)"),Zl(this._container,D,"popup")}},l.prototype._focusFirstElement=function(){if(!(!this.options.focusAfterOpen||!this._container)){var u=this._container.querySelector(hf);u&&u.focus()}},l.prototype._onClose=function(){this.remove()},l}(v.Evented);function Hf(d){if(d)if(typeof d=="number"){var l=Math.round(Math.sqrt(.5*Math.pow(d,2)));return{center:new v.Point(0,0),top:new v.Point(0,d),"top-left":new v.Point(l,l),"top-right":new v.Point(-l,l),bottom:new v.Point(0,-d),"bottom-left":new v.Point(l,-l),"bottom-right":new v.Point(-l,-l),left:new v.Point(d,0),right:new v.Point(-d,0)}}else if(d instanceof v.Point||Array.isArray(d)){var m=v.Point.convert(d);return{center:m,top:m,"top-left":m,"top-right":m,bottom:m,"bottom-left":m,"bottom-right":m,left:m,right:m}}else return{center:v.Point.convert(d.center||[0,0]),top:v.Point.convert(d.top||[0,0]),"top-left":v.Point.convert(d["top-left"]||[0,0]),"top-right":v.Point.convert(d["top-right"]||[0,0]),bottom:v.Point.convert(d.bottom||[0,0]),"bottom-left":v.Point.convert(d["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(d["bottom-right"]||[0,0]),left:v.Point.convert(d.left||[0,0]),right:v.Point.convert(d.right||[0,0])};else return Hf(new v.Point(0,0))}var Gr={version:v.version,supported:C,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:pc,NavigationControl:sl,GeolocateControl:Qu,AttributionControl:Ri,ScaleControl:Ye,FullscreenControl:Ja,Popup:Ph,Marker:ol,Style:lu,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:Ie,clearPrewarmedResources:We,get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(d){v.config.ACCESS_TOKEN=d},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(d){v.config.API_URL=d},get workerCount(){return ee.workerCount},set workerCount(d){ee.workerCount=d},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){v.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return Gr}),Vh})}(Lg)),Lg.exports}var Rg={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var jg;function ry(){return jg||(jg=1,function(ao,Qd){(function(ks,rs){ao.exports=rs()})(Gg,function(){var ks={},rs={};function Vh(v,C,fe){if(rs[v]=fe,v==="index"){var Yr="var sharedModule = {}; ("+rs.shared+")(sharedModule); ("+rs.worker+")(sharedModule);",Jr={};return rs.shared(Jr),rs.index(ks,Jr),typeof window<"u"&&ks.setWorkerUrl(window.URL.createObjectURL(new Blob([Yr],{type:"text/javascript"}))),ks}}Vh("shared",["exports"],function(v){function C(n,r,s,c){function y(b){return b instanceof s?b:new s(function(T){T(b)})}return new(s||(s=Promise))(function(b,T){function A(U){try{B(c.next(U))}catch(j){T(j)}}function F(U){try{B(c.throw(U))}catch(j){T(j)}}function B(U){U.done?b(U.value):y(U.value).then(A,F)}B((c=c.apply(n,r||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;function fe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Yr=Jr;function Jr(n,r){this.x=n,this.y=r}Jr.prototype={clone:function(){return new Jr(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,r){return this.clone()._rotateAround(n,r)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var r=n.x-this.x,s=n.y-this.y;return r*r+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,r){return Math.atan2(this.x*r-this.y*n,this.x*n+this.y*r)},_matMult:function(n){var r=n[0]*this.x+n[1]*this.y,s=n[2]*this.x+n[3]*this.y;return this.x=r,this.y=s,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var r=Math.cos(n),s=Math.sin(n),c=r*this.x-s*this.y,y=s*this.x+r*this.y;return this.x=c,this.y=y,this},_rotateAround:function(n,r){var s=Math.cos(n),c=Math.sin(n),y=r.x+s*(this.x-r.x)-c*(this.y-r.y),b=r.y+c*(this.x-r.x)+s*(this.y-r.y);return this.x=y,this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Jr.convert=function(n){return n instanceof Jr?n:Array.isArray(n)?new Jr(n[0],n[1]):n};var pe=fe(Yr),ha=me;function me(n,r,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=r,this.p2x=s,this.p2y=c}me.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,r){if(r===void 0&&(r=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,c=0;c<8;c++){var y=this.sampleCurveX(s)-n;if(Math.abs(y)<r)return s;var b=this.sampleCurveDerivativeX(s);if(Math.abs(b)<1e-6)break;s=s-y/b}var T=0,A=1;for(s=n,c=0;c<20&&(y=this.sampleCurveX(s),!(Math.abs(y-n)<r));c++)n>y?T=s:A=s,s=(A-T)*.5+T;return s},solve:function(n,r){return this.sampleCurveY(this.solveCurveX(n,r))}};var Qt=fe(ha);let ca;function In(){return ca==null&&(ca=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ca}let ns;function Fa(){if(ns==null&&(ns=!1,In())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let y=0;y<5*5;y++){const b=y*4;s.fillStyle=`rgb(${b},${b+1},${b+2})`,s.fillRect(y%5,Math.floor(y/5),1,1)}const c=s.getImageData(0,0,5,5).data;for(let y=0;y<5*5*4;y++)if(y%4!==3&&c[y]!==y){ns=!0;break}}}return ns||!1}function fa(n){let r=1/0,s=1/0,c=-1/0,y=-1/0;for(const b of n)r=Math.min(r,b.x),s=Math.min(s,b.y),c=Math.max(c,b.x),y=Math.max(y,b.y);return[r,s,c,y]}function zo(n){if(n<=0)return 0;if(n>=1)return 1;const r=n*n,s=r*n;return 4*(n<.5?s:3*(n-r)+s-.75)}function ml(n,r,s,c){const y=new Qt(n,r,s,c);return b=>y.solve(b)}const an=ml(.25,.1,.25,1);function Fs(n,r,s){return Math.min(s,Math.max(r,n))}function Or(n,r,s){const c=s-r,y=((n-r)%c+c)%c+r;return y===r?s:y}function _l(n,r){const s=[];for(const c in n)c in r||s.push(c);return s}function da(n,...r){for(const s of r)for(const c in s)n[c]=s[c];return n}function Ls(n,r){const s={};for(let c=0;c<r.length;c++){const y=r[c];y in n&&(s[y]=n[y])}return s}let pa=1;function gs(){return pa++}function Rs(n){return Math.log(n)/Math.LN2%1===0}function Jl(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Do(n,r,s){const c={};for(const y in n)c[y]=r.call(this,n[y],y,n);return c}function La(n,r,s){const c={};for(const y in n)r.call(this,n[y],y,n)&&(c[y]=n[y]);return c}function Ra(n,r){if(Array.isArray(n)){if(!Array.isArray(r)||n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(!Ra(n[s],r[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&r!==null){if(typeof r!="object"||Object.keys(n).length!==Object.keys(r).length)return!1;for(const c in n)if(!Ra(n[c],r[c]))return!1;return!0}return n===r}function qr(n){return Array.isArray(n)?n.map(qr):typeof n=="object"&&n?Do(n,qr):n}function so(n,r){for(let s=0;s<n.length;s++)if(r.indexOf(n[s])>=0)return!0;return!1}const ko={};function rr(n){ko[n]||(typeof console<"u"&&console.warn(n),ko[n]=!0)}function mn(n,r,s){return(s.y-n.y)*(r.x-n.x)>(r.y-n.y)*(s.x-n.x)}function Ql(n,r,s,c){const y=r.y-n.y,b=r.x-n.x,T=c.y-s.y,A=c.x-s.x,F=T*b-A*y;if(F===0)return null;const B=n.y-s.y,U=n.x-s.x,j=(A*B-T*U)/F;return new pe(n.x+j*b,n.y+j*y)}function Fo([n,r,s]){return r+=90,r*=Math.PI/180,s*=Math.PI/180,{x:n*Math.cos(r)*Math.sin(s),y:n*Math.sin(r)*Math.sin(s),z:n*Math.cos(s)}}function sn(n){return typeof WorkerGlobalScope<"u"&&typeof n<"u"&&n instanceof WorkerGlobalScope}function Lo(n){const r=/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,s={};if(n.replace(r,(c,y,b,T)=>{const A=b||T;return s[y]=A?A.toLowerCase():!0,""}),s["max-age"]){const c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s}let On=null;function Ba(n){if(On==null){const r=n.navigator?n.navigator.userAgent:null;On=!!n.safari||!!(r&&(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return On}function Qi(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Oa=n=>C(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(r)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),oo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",oh=n=>new Promise((r,s)=>{const c=new Image;c.onload=()=>{r(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=oo})},c.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const y=new Blob([new Uint8Array(n)],{type:"image/png"});c.src=n.byteLength?URL.createObjectURL(y):oo});function $l(n,r,s,c,y){const b=Math.max(-r,0)*4,F=(Math.max(0,s)-s)*c*4+b,B=c*4,U=Math.max(0,r),j=Math.max(0,s),$=Math.min(n.width,r+c),st=Math.min(n.height,s+y);return{rect:{x:U,y:j,width:$-U,height:st-j},layout:[{offset:F,stride:B}]}}function lo(n,r,s,c,y){return C(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(n,{timestamp:0});try{const T=b==null?void 0:b.format;if(!T||!(T.startsWith("BGR")||T.startsWith("RGB")))throw new Error(`Unrecognized format ${T}`);const A=T.startsWith("BGR"),F=new Uint8ClampedArray(c*y*4);if(yield b.copyTo(F,$l(n,r,s,c,y)),A)for(let B=0;B<F.length;B+=4){const U=F[B];F[B]=F[B+2],F[B+2]=U}return F}finally{b.close()}})}let ma,Cn;function Bs(n,r,s,c,y){const b=n.width,T=n.height;(!ma||!Cn)&&(ma=new OffscreenCanvas(b,T),Cn=ma.getContext("2d",{willReadFrequently:!0})),ma.width=b,ma.height=T,Cn.drawImage(n,0,0,b,T);const A=Cn.getImageData(r,s,c,y);return Cn.clearRect(0,0,b,T),A.data}function zi(n,r,s,c,y){return C(this,void 0,void 0,function*(){if(Fa())try{return yield lo(n,r,s,c,y)}catch{}return Bs(n,r,s,c,y)})}function uo(n,r,s,c){return n.addEventListener(r,s,c),{unsubscribe:()=>{n.removeEventListener(r,s,c)}}}function on(n){return n*Math.PI/180}const _n=25,Qn=0,Va="AbortError";function bi(n){return n.message===Va}function Ro(){return new Error(Va)}const Os={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ys(n){return Os.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}function ln(n,r){Os.REGISTERED_PROTOCOLS[n]=r}function un(n){delete Os.REGISTERED_PROTOCOLS[n]}const Vn="global-dispatcher";class $n extends Error{constructor(r,s,c,y){super(`AJAXError: ${s} (${r}): ${c}`),this.status=r,this.statusText=s,this.url=c,this.body=y}}const Ua=()=>sn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Au=n=>/^file:/.test(n)||/^file:/.test(Ua())&&!/^\w+:/.test(n);function Bo(n,r){return C(this,void 0,void 0,function*(){const s=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,cache:n.cache,referrer:Ua(),signal:r.signal});n.type==="json"&&!s.headers.has("Accept")&&s.headers.set("Accept","application/json");const c=yield fetch(s);if(!c.ok){const T=yield c.blob();throw new $n(c.status,c.statusText,n.url,T)}let y;n.type==="arrayBuffer"||n.type==="image"?y=c.arrayBuffer():n.type==="json"?y=c.json():y=c.text();const b=yield y;if(r.signal.aborted)throw Ro();return{data:b,cacheControl:c.headers.get("Cache-Control"),expires:c.headers.get("Expires")}})}function Pn(n,r){return new Promise((s,c)=>{var y;const b=new XMLHttpRequest;b.open(n.method||"GET",n.url,!0),(n.type==="arrayBuffer"||n.type==="image")&&(b.responseType="arraybuffer");for(const T in n.headers)b.setRequestHeader(T,n.headers[T]);n.type==="json"&&(b.responseType="text",!((y=n.headers)===null||y===void 0)&&y.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=n.credentials==="include",b.onerror=()=>{c(new Error(b.statusText))},b.onload=()=>{if(!r.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let T=b.response;if(n.type==="json")try{T=JSON.parse(b.response)}catch(A){c(A);return}s({data:T,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const T=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});c(new $n(b.status,b.statusText,n.url,T))}},r.signal.addEventListener("abort",()=>{b.abort(),c(Ro())}),b.send(n.body)})}const ta=function(n,r){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const s=ys(n.url);if(s)return s(n,r);if(sn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Vn},r)}if(!Au(n.url)){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Bo(n,r);if(sn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Vn},r)}return Pn(n,r)},gl=(n,r)=>ta(da(n,{type:"json"}),r),yl=(n,r)=>ta(da(n,{type:"arrayBuffer"}),r);function ea(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const r=new URL(n),s=window.location;return r.protocol===s.protocol&&r.host===s.host}const vl=n=>{const r=window.document.createElement("video");return r.muted=!0,new Promise(s=>{r.onloadstart=()=>{s(r)};for(const c of n){const y=window.document.createElement("source");ea(c)||(r.crossOrigin="Anonymous"),y.src=c,r.appendChild(y)}})};function xl(n,r,s){s[n]&&s[n].indexOf(r)!==-1||(s[n]=s[n]||[],s[n].push(r))}function Un(n,r,s){if(s&&s[n]){const c=s[n].indexOf(r);c!==-1&&s[n].splice(c,1)}}class bl{constructor(r,s={}){da(this,s),this.type=r}}class Oo extends bl{constructor(r,s={}){super("error",da({error:r},s))}}class ho{on(r,s){return this._listeners=this._listeners||{},xl(r,s,this._listeners),this}off(r,s){return Un(r,s,this._listeners),Un(r,s,this._oneTimeListeners),this}once(r,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},xl(r,s,this._oneTimeListeners),this):new Promise(c=>this.once(r,c))}fire(r,s){typeof r=="string"&&(r=new bl(r,s||{}));const c=r.type;if(this.listens(c)){r.target=this;const y=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const A of y)A.call(this,r);const b=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const A of b)Un(c,A,this._oneTimeListeners),A.call(this,r);const T=this._eventedParent;T&&(da(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(r))}else r instanceof Oo&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,s){return this._eventedParent=r,this._eventedParentData=s,this}}var Vr=8,Vo={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},tu={"*":{type:"source"}},Uo=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],Na={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},co={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Nn={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},vs={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},eu={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},iu={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},ru={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},wl=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],Sl={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},dt={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},tt={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Q={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},lt={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},gt={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Pt={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Nt={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Mt={type:"array",value:"*"},N={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},O={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},H={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},W={type:"array",value:"*",minimum:1},nt={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},ft={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},St={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},It={type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},Lt=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],Vt={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},qt={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},ee={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},Jt={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},se={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},Ae={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},Ie={"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},We={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},di={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},mi={"*":{type:"string"}},Ht={$version:Vr,$root:Vo,sources:tu,source:Uo,source_vector:Na,source_raster:co,source_raster_dem:Nn,source_geojson:vs,source_video:eu,source_image:iu,layer:ru,layout:wl,layout_background:Sl,layout_fill:dt,layout_circle:tt,layout_heatmap:Q,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:lt,layout_symbol:gt,layout_raster:Pt,layout_hillshade:Nt,filter:Mt,filter_operator:N,geometry_type:O,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:H,expression:W,light:nt,sky:ft,terrain:St,projection:It,paint:Lt,paint_fill:Vt,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:qt,paint_circle:ee,paint_heatmap:Jt,paint_symbol:se,paint_raster:Ae,paint_hillshade:Ie,paint_background:We,transition:di,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:mi};const ii=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function tr(n,r){const s={};for(const c in n)c!=="ref"&&(s[c]=n[c]);return ii.forEach(c=>{c in r&&(s[c]=r[c])}),s}function Qr(n){n=n.slice();const r=Object.create(null);for(let s=0;s<n.length;s++)r[n[s].id]=n[s];for(let s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=tr(n[s],r[n[s].ref]));return n}function Ei(n,r){if(Array.isArray(n)){if(!Array.isArray(r)||n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(!Ei(n[s],r[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&r!==null){if(typeof r!="object"||Object.keys(n).length!==Object.keys(r).length)return!1;for(const c in n)if(!Ei(n[c],r[c]))return!1;return!0}return n===r}function er(n,r){n.push(r)}function xs(n,r,s){er(s,{command:"addSource",args:[n,r[n]]})}function qn(n,r,s){er(r,{command:"removeSource",args:[n]}),s[n]=!0}function _a(n,r,s,c){qn(n,s,c),xs(n,r,s)}function as(n,r,s){let c;for(c in n[s])if(Object.prototype.hasOwnProperty.call(n[s],c)&&c!=="data"&&!Ei(n[s][c],r[s][c]))return!1;for(c in r[s])if(Object.prototype.hasOwnProperty.call(r[s],c)&&c!=="data"&&!Ei(n[s][c],r[s][c]))return!1;return!0}function No(n,r,s,c){n=n||{},r=r||{};let y;for(y in n)Object.prototype.hasOwnProperty.call(n,y)&&(Object.prototype.hasOwnProperty.call(r,y)||qn(y,s,c));for(y in r)Object.prototype.hasOwnProperty.call(r,y)&&(Object.prototype.hasOwnProperty.call(n,y)?Ei(n[y],r[y])||(n[y].type==="geojson"&&r[y].type==="geojson"&&as(n,r,y)?er(s,{command:"setGeoJSONSourceData",args:[y,r[y].data]}):_a(y,r,s,c)):xs(y,r,s))}function mr(n,r,s,c,y,b){n=n||{},r=r||{};for(const T in n)Object.prototype.hasOwnProperty.call(n,T)&&(Ei(n[T],r[T])||s.push({command:b,args:[c,T,r[T],y]}));for(const T in r)!Object.prototype.hasOwnProperty.call(r,T)||Object.prototype.hasOwnProperty.call(n,T)||Ei(n[T],r[T])||s.push({command:b,args:[c,T,r[T],y]})}function Vs(n){return n.id}function pi(n,r){return n[r.id]=r,n}function qa(n,r,s){n=n||[],r=r||[];const c=n.map(Vs),y=r.map(Vs),b=n.reduce(pi,{}),T=r.reduce(pi,{}),A=c.slice(),F=Object.create(null);let B,U,j,$,st;for(let ct=0,yt=0;ct<c.length;ct++)B=c[ct],Object.prototype.hasOwnProperty.call(T,B)?yt++:(er(s,{command:"removeLayer",args:[B]}),A.splice(A.indexOf(B,yt),1));for(let ct=0,yt=0;ct<y.length;ct++)B=y[y.length-1-ct],A[A.length-1-ct]!==B&&(Object.prototype.hasOwnProperty.call(b,B)?(er(s,{command:"removeLayer",args:[B]}),A.splice(A.lastIndexOf(B,A.length-yt),1)):yt++,$=A[A.length-ct],er(s,{command:"addLayer",args:[T[B],$]}),A.splice(A.length-ct,0,B),F[B]=!0);for(let ct=0;ct<y.length;ct++)if(B=y[ct],U=b[B],j=T[B],!(F[B]||Ei(U,j))){if(!Ei(U.source,j.source)||!Ei(U["source-layer"],j["source-layer"])||!Ei(U.type,j.type)){er(s,{command:"removeLayer",args:[B]}),$=A[A.lastIndexOf(B)+1],er(s,{command:"addLayer",args:[j,$]});continue}mr(U.layout,j.layout,s,B,null,"setLayoutProperty"),mr(U.paint,j.paint,s,B,null,"setPaintProperty"),Ei(U.filter,j.filter)||er(s,{command:"setFilter",args:[B,j.filter]}),(!Ei(U.minzoom,j.minzoom)||!Ei(U.maxzoom,j.maxzoom))&&er(s,{command:"setLayerZoomRange",args:[B,j.minzoom,j.maxzoom]});for(st in U)Object.prototype.hasOwnProperty.call(U,st)&&(st==="layout"||st==="paint"||st==="filter"||st==="metadata"||st==="minzoom"||st==="maxzoom"||(st.indexOf("paint.")===0?mr(U[st],j[st],s,B,st.slice(6),"setPaintProperty"):Ei(U[st],j[st])||er(s,{command:"setLayerProperty",args:[B,st,j[st]]})));for(st in j)!Object.prototype.hasOwnProperty.call(j,st)||Object.prototype.hasOwnProperty.call(U,st)||st==="layout"||st==="paint"||st==="filter"||st==="metadata"||st==="minzoom"||st==="maxzoom"||(st.indexOf("paint.")===0?mr(U[st],j[st],s,B,st.slice(6),"setPaintProperty"):Ei(U[st],j[st])||er(s,{command:"setLayerProperty",args:[B,st,j[st]]}))}}function Tl(n,r){if(!n)return[{command:"setStyle",args:[r]}];let s=[];try{if(!Ei(n.version,r.version))return[{command:"setStyle",args:[r]}];Ei(n.center,r.center)||s.push({command:"setCenter",args:[r.center]}),Ei(n.zoom,r.zoom)||s.push({command:"setZoom",args:[r.zoom]}),Ei(n.bearing,r.bearing)||s.push({command:"setBearing",args:[r.bearing]}),Ei(n.pitch,r.pitch)||s.push({command:"setPitch",args:[r.pitch]}),Ei(n.sprite,r.sprite)||s.push({command:"setSprite",args:[r.sprite]}),Ei(n.glyphs,r.glyphs)||s.push({command:"setGlyphs",args:[r.glyphs]}),Ei(n.transition,r.transition)||s.push({command:"setTransition",args:[r.transition]}),Ei(n.light,r.light)||s.push({command:"setLight",args:[r.light]}),Ei(n.terrain,r.terrain)||s.push({command:"setTerrain",args:[r.terrain]}),Ei(n.sky,r.sky)||s.push({command:"setSky",args:[r.sky]}),Ei(n.projection,r.projection)||s.push({command:"setProjection",args:[r.projection]});const c={},y=[];No(n.sources,r.sources,y,c);const b=[];n.layers&&n.layers.forEach(T=>{"source"in T&&c[T.source]?s.push({command:"removeLayer",args:[T.id]}):b.push(T)}),s=s.concat(y),qa(b,r.layers,s)}catch(c){console.warn("Unable to compute style diff:",c),s=[{command:"setStyle",args:[r]}]}return s}class _e{constructor(r,s,c,y){this.message=(r?`${r}: `:"")+c,y&&(this.identifier=y),s!=null&&s.__line__&&(this.line=s.__line__)}}function fo(n,...r){for(const s of r)for(const c in s)n[c]=s[c];return n}class po extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}class Ac{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[c,y]of s)this.bindings[c]=y}concat(r){return new Ac(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return this.bindings[r]?!0:this.parent?this.parent.has(r):!1}}const nu={kind:"null"},Me={kind:"number"},Di={kind:"string"},Ci={kind:"boolean"},Za={kind:"color"},Mu={kind:"object"},vi={kind:"value"},wf={kind:"error"},gn={kind:"collator"},ja={kind:"formatted"},Zn={kind:"padding"},Us={kind:"resolvedImage"},Ns={kind:"variableAnchorOffsetCollection"};function Ga(n,r){return{kind:"array",itemType:n,N:r}}function zr(n){if(n.kind==="array"){const r=zr(n.itemType);return typeof n.N=="number"?`array<${r}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${r}>`}else return n.kind}const pd=[nu,Me,Di,Ci,Za,ja,Mu,Ga(vi),Zn,Us,Ns];function mo(n,r){if(r.kind==="error")return null;if(n.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!mo(n.itemType,r.itemType))&&(typeof n.N!="number"||n.N===r.N))return null}else{if(n.kind===r.kind)return null;if(n.kind==="value"){for(const s of pd)if(!mo(s,r))return null}}return`Expected ${zr(n)} but found ${zr(r)} instead.`}function Uh(n,r){return r.some(s=>s.kind===n.kind)}function qo(n,r){return r.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function An(n,r){return n.kind==="array"&&r.kind==="array"?n.itemType.kind===r.itemType.kind&&typeof n.N=="number":n.kind===r.kind}const ue=.96422,Ue=1,zu=.82521,au=4/29,vr=6/29,qs=3*vr*vr,_o=vr*vr*vr,lh=Math.PI/180,Du=180/Math.PI;function ze(n){return n=n%360,n<0&&(n+=360),n}function ki([n,r,s,c]){n=xi(n),r=xi(r),s=xi(s);let y,b;const T=bs((.2225045*n+.7168786*r+.0606169*s)/Ue);n===r&&r===s?y=b=T:(y=bs((.4360747*n+.3850649*r+.1430804*s)/ue),b=bs((.0139322*n+.0971045*r+.7141733*s)/zu));const A=116*T-16;return[A<0?0:A,500*(y-T),200*(T-b),c]}function xi(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function bs(n){return n>_o?Math.pow(n,1/3):n/qs+au}function Zo([n,r,s,c]){let y=(n+16)/116,b=isNaN(r)?y:y+r/500,T=isNaN(s)?y:y-s/200;return y=Ue*su(y),b=ue*su(b),T=zu*su(T),[Si(3.1338561*b-1.6168667*y-.4906146*T),Si(-.9787684*b+1.9161415*y+.033454*T),Si(.0719453*b-.2289914*y+1.4052427*T),c]}function Si(n){return n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055,n<0?0:n>1?1:n}function su(n){return n>vr?n*n*n:qs*(n-au)}function ou(n){const[r,s,c,y]=ki(n),b=Math.sqrt(s*s+c*c);return[Math.round(b*1e4)?ze(Math.atan2(c,s)*Du):NaN,b,r,y]}function El([n,r,s,c]){return n=isNaN(n)?0:n*lh,Zo([s,Math.cos(n)*r,Math.sin(n)*r,c])}function uh([n,r,s,c]){n=ze(n),r/=100,s/=100;function y(b){const T=(b+n/30)%12,A=r*Math.min(s,1-s);return s-A*Math.max(-1,Math.min(T-3,9-T,1))}return[y(0),y(8),y(4),c]}function ws(n){if(n=n.toLowerCase().trim(),n==="transparent")return[0,0,0,0];const r=hh[n];if(r){const[y,b,T]=r;return[y/255,b/255,T/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const b=n.length<6?1:2;let T=1;return[br(n.slice(T,T+=b)),br(n.slice(T,T+=b)),br(n.slice(T,T+=b)),br(n.slice(T,T+b)||"ff")]}if(n.startsWith("rgb")){const y=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,b=n.match(y);if(b){const[T,A,F,B,U,j,$,st,ct,yt,At,Ut]=b,re=[B||" ",$||" ",yt].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const Yt=[F,j,ct].join(""),te=Yt==="%%%"?100:Yt===""?255:0;if(te){const de=[Ss(+A/te,0,1),Ss(+U/te,0,1),Ss(+st/te,0,1),At?lu(+At,Ut):1];if(Nh(de))return de}}return}}const s=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,c=n.match(s);if(c){const[y,b,T,A,F,B,U,j,$]=c,st=[T||" ",F||" ",U].join("");if(st==="  "||st==="  /"||st===",,"||st===",,,"){const ct=[+b,Ss(+A,0,100),Ss(+B,0,100),j?lu(+j,$):1];if(Nh(ct))return uh(ct)}}}function br(n){return parseInt(n.padEnd(2,n),16)/255}function lu(n,r){return Ss(r?n/100:n,0,1)}function Ss(n,r,s){return Math.min(Math.max(r,n),s)}function Nh(n){return!n.some(Number.isNaN)}const hh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class cr{constructor(r,s,c,y=1,b=!0){this.r=r,this.g=s,this.b=c,this.a=y,b||(this.r*=y,this.g*=y,this.b*=y,y||this.overwriteGetter("rgb",[r,s,c,y]))}static parse(r){if(r instanceof cr)return r;if(typeof r!="string")return;const s=ws(r);if(s)return new cr(...s,!1)}get rgb(){const{r,g:s,b:c,a:y}=this,b=y||1/0;return this.overwriteGetter("rgb",[r/b,s/b,c/b,y])}get hcl(){return this.overwriteGetter("hcl",ou(this.rgb))}get lab(){return this.overwriteGetter("lab",ki(this.rgb))}overwriteGetter(r,s){return Object.defineProperty(this,r,{value:s}),s}toString(){const[r,s,c,y]=this.rgb;return`rgba(${[r,s,c].map(b=>Math.round(b*255)).join(",")},${y})`}}cr.black=new cr(0,0,0,1),cr.white=new cr(1,1,1,1),cr.transparent=new cr(0,0,0,0),cr.red=new cr(1,0,0,1);class qh{constructor(r,s,c){r?this.sensitivity=s?"variant":"case":this.sensitivity=s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ki{constructor(r,s,c,y,b){this.text=r,this.image=s,this.scale=c,this.fontStack=y,this.textColor=b}}class jn{constructor(r){this.sections=r}static fromString(r){return new jn([new Ki(r,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof jn?r:jn.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class ga{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof ga)return r;if(typeof r=="number")return new ga([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const s of r)if(typeof s!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]];break}return new ga(r)}}toString(){return JSON.stringify(this.values)}}const Mn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Pr{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Pr)return r;if(!(!Array.isArray(r)||r.length<1||r.length%2!==0)){for(let s=0;s<r.length;s+=2){const c=r[s],y=r[s+1];if(typeof c!="string"||!Mn.has(c)||!Array.isArray(y)||y.length!==2||typeof y[0]!="number"||typeof y[1]!="number")return}return new Pr(r)}}toString(){return JSON.stringify(this.values)}}class ss{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new ss({name:r,available:!1}):null}}function ch(n,r,s,c){return typeof n=="number"&&n>=0&&n<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof s=="number"&&s>=0&&s<=255?typeof c>"u"||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[n,r,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[n,r,s,c]:[n,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Dr(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof cr||n instanceof qh||n instanceof jn||n instanceof ga||n instanceof Pr||n instanceof ss)return!0;if(Array.isArray(n)){for(const r of n)if(!Dr(r))return!1;return!0}else if(typeof n=="object"){for(const r in n)if(!Dr(n[r]))return!1;return!0}else return!1}function kr(n){if(n===null)return nu;if(typeof n=="string")return Di;if(typeof n=="boolean")return Ci;if(typeof n=="number")return Me;if(n instanceof cr)return Za;if(n instanceof qh)return gn;if(n instanceof jn)return ja;if(n instanceof ga)return Zn;if(n instanceof Pr)return Ns;if(n instanceof ss)return Us;if(Array.isArray(n)){const r=n.length;let s;for(const c of n){const y=kr(c);if(!s)s=y;else{if(s===y)continue;s=vi;break}}return Ga(s||vi,r)}else return Mu}function ya(n){const r=typeof n;return n===null?"":r==="string"||r==="number"||r==="boolean"?String(n):n instanceof cr||n instanceof jn||n instanceof ga||n instanceof Pr||n instanceof ss?n.toString():JSON.stringify(n)}class Fr{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(r.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Dr(r[1]))return s.error("invalid value");const c=r[1];let y=kr(c);const b=s.expectedType;return y.kind==="array"&&y.N===0&&b&&b.kind==="array"&&(typeof b.N!="number"||b.N===0)&&(y=b),new Fr(y,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ur{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const zn={string:Di,number:Me,boolean:Ci,object:Mu};class yn{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let c=1,y;const b=r[0];if(b==="array"){let A;if(r.length>2){const B=r[1];if(typeof B!="string"||!(B in zn)||B==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);A=zn[B],c++}else A=vi;let F;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);F=r[2],c++}y=Ga(A,F)}else{if(!zn[b])throw new Error(`Types doesn't contain name = ${b}`);y=zn[b]}const T=[];for(;c<r.length;c++){const A=s.parse(r[c],c,vi);if(!A)return null;T.push(A)}return new yn(y,T)}evaluate(r){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(r);if(mo(this.type,kr(c))){if(s===this.args.length-1)throw new Ur(`Expected value to be of type ${zr(this.type)}, but found ${zr(kr(c))} instead.`)}else return c}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const jo={"to-boolean":Ci,"to-color":Za,"to-number":Me,"to-string":Di};class Il{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const c=r[0];if(!jo[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&r.length!==2)return s.error("Expected one argument.");const y=jo[c],b=[];for(let T=1;T<r.length;T++){const A=s.parse(r[T],T,vi);if(!A)return null;b.push(A)}return new Il(y,b)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let s,c;for(const y of this.args){if(s=y.evaluate(r),c=null,s instanceof cr)return s;if(typeof s=="string"){const b=r.parseColor(s);if(b)return b}else if(Array.isArray(s)&&(s.length<3||s.length>4?c=`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:c=ch(s[0],s[1],s[2],s[3]),!c))return new cr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Ur(c||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const c of this.args){s=c.evaluate(r);const y=ga.parse(s);if(y)return y}throw new Ur(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const c of this.args){s=c.evaluate(r);const y=Pr.parse(s);if(y)return y}throw new Ur(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const c of this.args){if(s=c.evaluate(r),s===null)return 0;const y=Number(s);if(!isNaN(y))return y}throw new Ur(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return jn.fromString(ya(this.args[0].evaluate(r)));case"resolvedImage":return ss.fromString(ya(this.args[0].evaluate(r)));default:return ya(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Ts=["Unknown","Point","LineString","Polygon"];class Sf{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ts[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let s=this._parseColorCache[r];return s||(s=this._parseColorCache[r]=cr.parse(r)),s}}class Zs{constructor(r,s,c=[],y,b=new Ac,T=[]){this.registry=r,this.path=c,this.key=c.map(A=>`[${A}]`).join(""),this.scope=b,this.errors=T,this.expectedType=y,this._isConstant=s}parse(r,s,c,y,b={}){return s?this.concat(s,c,y)._parse(r,b):this._parse(r,b)}_parse(r,s){(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number")&&(r=["literal",r]);function c(y,b,T){return T==="assert"?new yn(b,[y]):T==="coerce"?new Il(b,[y]):y}if(Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=r[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[y];if(b){let T=b.parse(r,this);if(!T)return null;if(this.expectedType){const A=this.expectedType,F=T.type;if((A.kind==="string"||A.kind==="number"||A.kind==="boolean"||A.kind==="object"||A.kind==="array")&&F.kind==="value")T=c(T,A,s.typeAnnotation||"assert");else if((A.kind==="color"||A.kind==="formatted"||A.kind==="resolvedImage")&&(F.kind==="value"||F.kind==="string"))T=c(T,A,s.typeAnnotation||"coerce");else if(A.kind==="padding"&&(F.kind==="value"||F.kind==="number"||F.kind==="array"))T=c(T,A,s.typeAnnotation||"coerce");else if(A.kind==="variableAnchorOffsetCollection"&&(F.kind==="value"||F.kind==="array"))T=c(T,A,s.typeAnnotation||"coerce");else if(this.checkSubtype(A,F))return null}if(!(T instanceof Fr)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const A=new Sf;try{T=new Fr(T.type,T.evaluate(A))}catch(F){return this.error(F.message),null}}return T}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof r>"u"?this.error("'undefined' value invalid. Use null instead."):typeof r=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof r} instead.`)}concat(r,s,c){const y=typeof r=="number"?this.path.concat(r):this.path,b=c?this.scope.concat(c):this.scope;return new Zs(this.registry,this._isConstant,y,s||null,b,this.errors)}error(r,...s){const c=`${this.key}${s.map(y=>`[${y}]`).join("")}`;this.errors.push(new po(c,r))}checkSubtype(r,s){const c=mo(r,s);return c&&this.error(c),c}}class hn{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const c=[];for(let b=1;b<r.length-1;b+=2){const T=r[b];if(typeof T!="string")return s.error(`Expected string, but found ${typeof T} instead.`,b);if(/[^a-zA-Z0-9_]/.test(T))return s.error("Variable names must contain only alphanumeric characters or '_'.",b);const A=s.parse(r[b+1],b+1);if(!A)return null;c.push([T,A])}const y=s.parse(r[r.length-1],r.length-1,s.expectedType,c);return y?new hn(c,y):null}outputDefined(){return this.result.outputDefined()}}class Zh{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(r.length!==2||typeof r[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=r[1];return s.scope.has(c)?new Zh(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class go{constructor(r,s,c){this.type=r,this.index=s,this.input=c}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,Me),y=s.parse(r[2],2,Ga(s.expectedType||vi));if(!c||!y)return null;const b=y.type;return new go(b.itemType,c,y)}evaluate(r){const s=this.index.evaluate(r),c=this.input.evaluate(r);if(s<0)throw new Ur(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new Ur(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new Ur(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class yo{constructor(r,s){this.type=Ci,this.needle=r,this.haystack=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,vi),y=s.parse(r[2],2,vi);return!c||!y?null:Uh(c.type,[Ci,Di,Me,nu,vi])?new yo(c,y):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${zr(c.type)} instead`)}evaluate(r){const s=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!c)return!1;if(!qo(s,["boolean","string","number","null"]))throw new Ur(`Expected first argument to be of type boolean, string, number or null, but found ${zr(kr(s))} instead.`);if(!qo(c,["string","array"]))throw new Ur(`Expected second argument to be of type array or string, but found ${zr(kr(c))} instead.`);return c.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class ku{constructor(r,s,c){this.type=Me,this.needle=r,this.haystack=s,this.fromIndex=c}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,vi),y=s.parse(r[2],2,vi);if(!c||!y)return null;if(!Uh(c.type,[Ci,Di,Me,nu,vi]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${zr(c.type)} instead`);if(r.length===4){const b=s.parse(r[3],3,Me);return b?new ku(c,y,b):null}else return new ku(c,y)}evaluate(r){const s=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!qo(s,["boolean","string","number","null"]))throw new Ur(`Expected first argument to be of type boolean, string, number or null, but found ${zr(kr(s))} instead.`);let y;if(this.fromIndex&&(y=this.fromIndex.evaluate(r)),qo(c,["string"])){const b=c.indexOf(s,y);return b===-1?-1:[...c.slice(0,b)].length}else{if(qo(c,["array"]))return c.indexOf(s,y);throw new Ur(`Expected second argument to be of type array or string, but found ${zr(kr(c))} instead.`)}}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Mc{constructor(r,s,c,y,b,T){this.inputType=r,this.type=s,this.input=c,this.cases=y,this.outputs=b,this.otherwise=T}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!==1)return s.error("Expected an even number of arguments.");let c,y;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);const b={},T=[];for(let B=2;B<r.length-1;B+=2){let U=r[B];const j=r[B+1];Array.isArray(U)||(U=[U]);const $=s.concat(B);if(U.length===0)return $.error("Expected at least one branch label.");for(const ct of U){if(typeof ct!="number"&&typeof ct!="string")return $.error("Branch labels must be numbers or strings.");if(typeof ct=="number"&&Math.abs(ct)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ct=="number"&&Math.floor(ct)!==ct)return $.error("Numeric branch labels must be integer values.");if(!c)c=kr(ct);else if($.checkSubtype(c,kr(ct)))return null;if(typeof b[String(ct)]<"u")return $.error("Branch labels must be unique.");b[String(ct)]=T.length}const st=s.parse(j,B,y);if(!st)return null;y=y||st.type,T.push(st)}const A=s.parse(r[1],1,vi);if(!A)return null;const F=s.parse(r[r.length-1],r.length-1,y);return!F||A.type.kind!=="value"&&s.concat(1).checkSubtype(c,A.type)?null:new Mc(c,y,A,b,T,F)}evaluate(r){const s=this.input.evaluate(r);return(kr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class zc{constructor(r,s,c){this.type=r,this.branches=s,this.otherwise=c}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!==0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const y=[];for(let T=1;T<r.length-1;T+=2){const A=s.parse(r[T],T,Ci);if(!A)return null;const F=s.parse(r[T+1],T+1,c);if(!F)return null;y.push([A,F]),c=c||F.type}const b=s.parse(r[r.length-1],r.length-1,c);if(!b)return null;if(!c)throw new Error("Can't infer output type");return new zc(c,y,b)}evaluate(r){for(const[s,c]of this.branches)if(s.evaluate(r))return c.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,c]of this.branches)r(s),r(c);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class uu{constructor(r,s,c,y){this.type=r,this.input=s,this.beginIndex=c,this.endIndex=y}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,vi),y=s.parse(r[2],2,Me);if(!c||!y)return null;if(!Uh(c.type,[Ga(vi),Di,vi]))return s.error(`Expected first argument to be of type array or string, but found ${zr(c.type)} instead`);if(r.length===4){const b=s.parse(r[3],3,Me);return b?new uu(c.type,c,y,b):null}else return new uu(c.type,c,y)}evaluate(r){const s=this.input.evaluate(r),c=this.beginIndex.evaluate(r);let y;if(this.endIndex&&(y=this.endIndex.evaluate(r)),qo(s,["string"]))return[...s].slice(c,y).join("");if(qo(s,["array"]))return s.slice(c,y);throw new Ur(`Expected first argument to be of type array or string, but found ${zr(kr(s))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function jh(n,r){const s=n.length-1;let c=0,y=s,b=0,T,A;for(;c<=y;)if(b=Math.floor((c+y)/2),T=n[b],A=n[b+1],T<=r){if(b===s||r<A)return b;c=b+1}else if(T>r)y=b-1;else throw new Ur("Input is not a number.");return 0}class fh{constructor(r,s,c){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[y,b]of c)this.labels.push(y),this.outputs.push(b)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!==0)return s.error("Expected an even number of arguments.");const c=s.parse(r[1],1,Me);if(!c)return null;const y=[];let b=null;s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let T=1;T<r.length;T+=2){const A=T===1?-1/0:r[T],F=r[T+1],B=T,U=T+1;if(typeof A!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(y.length&&y[y.length-1][0]>=A)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);const j=s.parse(F,U,b);if(!j)return null;b=b||j.type,y.push([A,j])}return new fh(b,c,y)}evaluate(r){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(r);const y=this.input.evaluate(r);if(y<=s[0])return c[0].evaluate(r);const b=s.length;if(y>=s[b-1])return c[b-1].evaluate(r);const T=jh(s,y);return c[T].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function md(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Dc=Tf;function Tf(n,r,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=r,this.p2x=s,this.p2y=c}Tf.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,r){if(r===void 0&&(r=1e-6),n<0)return 0;if(n>1)return 1;for(var s=n,c=0;c<8;c++){var y=this.sampleCurveX(s)-n;if(Math.abs(y)<r)return s;var b=this.sampleCurveDerivativeX(s);if(Math.abs(b)<1e-6)break;s=s-y/b}var T=0,A=1;for(s=n,c=0;c<20&&(y=this.sampleCurveX(s),!(Math.abs(y-n)<r));c++)n>y?T=s:A=s,s=(A-T)*.5+T;return s},solve:function(n,r){return this.sampleCurveY(this.solveCurveX(n,r))}};var _d=md(Dc);function Ef(n){return n==="rgb"||n==="hcl"||n==="lab"}function hu(n,r,s){return n+s*(r-n)}function gd(n,r,s,c="rgb"){switch(c){case"rgb":{const[y,b,T,A]=dh(n.rgb,r.rgb,s);return new cr(y,b,T,A,!1)}case"hcl":{const[y,b,T,A]=n.hcl,[F,B,U,j]=r.hcl;let $,st;if(!isNaN(y)&&!isNaN(F)){let re=F-y;F>y&&re>180?re-=360:F<y&&y-F>180&&(re+=360),$=y+s*re}else isNaN(y)?isNaN(F)?$=NaN:($=F,(T===1||T===0)&&(st=B)):($=y,(U===1||U===0)&&(st=b));const[ct,yt,At,Ut]=El([$,st??hu(b,B,s),hu(T,U,s),hu(A,j,s)]);return new cr(ct,yt,At,Ut,!1)}case"lab":{const[y,b,T,A]=Zo(dh(n.lab,r.lab,s));return new cr(y,b,T,A,!1)}}}function dh(n,r,s){return n.map((c,y)=>hu(c,r[y],s))}function yd(n,r,s){return new ga(dh(n.values,r.values,s))}function kc(n,r,s){const c=n.values,y=r.values;if(c.length!==y.length)throw new Ur(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${r.toString()}`);const b=[];for(let T=0;T<c.length;T+=2){if(c[T]!==y[T])throw new Ur(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${c[T]}, to[${T}]: ${y[T]}`);b.push(c[T]);const[A,F]=c[T+1],[B,U]=y[T+1];b.push([hu(A,B,s),hu(F,U,s)])}return new Pr(b)}const Dn={number:hu,color:gd,array:dh,padding:yd,variableAnchorOffsetCollection:kc};class Pi{constructor(r,s,c,y,b){this.type=r,this.operator=s,this.interpolation=c,this.input=y,this.labels=[],this.outputs=[];for(const[T,A]of b)this.labels.push(T),this.outputs.push(A)}static interpolationFactor(r,s,c,y){let b=0;if(r.name==="exponential")b=Fc(s,r.base,c,y);else if(r.name==="linear")b=Fc(s,1,c,y);else if(r.name==="cubic-bezier"){const T=r.controlPoints;b=new _d(T[0],T[1],T[2],T[3]).solve(Fc(s,1,c,y))}return b}static parse(r,s){let[c,y,b,...T]=r;if(!Array.isArray(y)||y.length===0)return s.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const B=y[1];if(typeof B!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:B}}else if(y[0]==="cubic-bezier"){const B=y.slice(1);if(B.length!==4||B.some(U=>typeof U!="number"||U<0||U>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:B}}else return s.error(`Unknown interpolation type ${String(y[0])}`,1,0);if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!==0)return s.error("Expected an even number of arguments.");if(b=s.parse(b,2,Me),!b)return null;const A=[];let F=null;c==="interpolate-hcl"||c==="interpolate-lab"?F=Za:s.expectedType&&s.expectedType.kind!=="value"&&(F=s.expectedType);for(let B=0;B<T.length;B+=2){const U=T[B],j=T[B+1],$=B+3,st=B+4;if(typeof U!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(A.length&&A[A.length-1][0]>=U)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const ct=s.parse(j,st,F);if(!ct)return null;F=F||ct.type,A.push([U,ct])}return!An(F,Me)&&!An(F,Za)&&!An(F,Zn)&&!An(F,Ns)&&!An(F,Ga(Me))?s.error(`Type ${zr(F)} is not interpolatable.`):new Pi(F,c,y,b,A)}evaluate(r){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(r);const y=this.input.evaluate(r);if(y<=s[0])return c[0].evaluate(r);const b=s.length;if(y>=s[b-1])return c[b-1].evaluate(r);const T=jh(s,y),A=s[T],F=s[T+1],B=Pi.interpolationFactor(this.interpolation,y,A,F),U=c[T].evaluate(r),j=c[T+1].evaluate(r);switch(this.operator){case"interpolate":return Dn[this.type.kind](U,j,B);case"interpolate-hcl":return Dn.color(U,j,B,"hcl");case"interpolate-lab":return Dn.color(U,j,B,"lab")}}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function Fc(n,r,s,c){const y=c-s,b=n-s;return y===0?0:r===1?b/y:(Math.pow(r,b)-1)/(Math.pow(r,y)-1)}class Fu{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expectected at least one argument.");let c=null;const y=s.expectedType;y&&y.kind!=="value"&&(c=y);const b=[];for(const A of r.slice(1)){const F=s.parse(A,1+b.length,c,void 0,{typeAnnotation:"omit"});if(!F)return null;c=c||F.type,b.push(F)}if(!c)throw new Error("No output type");return y&&b.some(A=>mo(y,A.type))?new Fu(vi,b):new Fu(c,b)}evaluate(r){let s=null,c=0,y;for(const b of this.args)if(c++,s=b.evaluate(r),s&&s instanceof ss&&!s.available&&(y||(y=s.name),s=null,c===this.args.length&&(s=y)),s!==null)break;return s}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}function Lc(n,r){return n==="=="||n==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function vd(n,r,s){return r===s}function xd(n,r,s){return r!==s}function js(n,r,s){return r<s}function Gh(n,r,s){return r>s}function cu(n,r,s){return r<=s}function Lu(n,r,s){return r>=s}function Go(n,r,s,c){return c.compare(r,s)===0}function Ho(n,r,s,c){return!Go(n,r,s,c)}function Rc(n,r,s,c){return c.compare(r,s)<0}function Hh(n,r,s,c){return c.compare(r,s)>0}function Xo(n,r,s,c){return c.compare(r,s)<=0}function $r(n,r,s,c){return c.compare(r,s)>=0}function Ru(n,r,s){const c=n!=="=="&&n!=="!=";return class Hg{constructor(b,T,A){this.type=Ci,this.lhs=b,this.rhs=T,this.collator=A,this.hasUntypedArgument=b.type.kind==="value"||T.type.kind==="value"}static parse(b,T){if(b.length!==3&&b.length!==4)return T.error("Expected two or three arguments.");const A=b[0];let F=T.parse(b[1],1,vi);if(!F)return null;if(!Lc(A,F.type))return T.concat(1).error(`"${A}" comparisons are not supported for type '${zr(F.type)}'.`);let B=T.parse(b[2],2,vi);if(!B)return null;if(!Lc(A,B.type))return T.concat(2).error(`"${A}" comparisons are not supported for type '${zr(B.type)}'.`);if(F.type.kind!==B.type.kind&&F.type.kind!=="value"&&B.type.kind!=="value")return T.error(`Cannot compare types '${zr(F.type)}' and '${zr(B.type)}'.`);c&&(F.type.kind==="value"&&B.type.kind!=="value"?F=new yn(B.type,[F]):F.type.kind!=="value"&&B.type.kind==="value"&&(B=new yn(F.type,[B])));let U=null;if(b.length===4){if(F.type.kind!=="string"&&B.type.kind!=="string"&&F.type.kind!=="value"&&B.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(U=T.parse(b[3],3,gn),!U)return null}return new Hg(F,B,U)}evaluate(b){const T=this.lhs.evaluate(b),A=this.rhs.evaluate(b);if(c&&this.hasUntypedArgument){const F=kr(T),B=kr(A);if(F.kind!==B.kind||!(F.kind==="string"||F.kind==="number"))throw new Ur(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${F.kind}, ${B.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const F=kr(T),B=kr(A);if(F.kind!=="string"||B.kind!=="string")return r(b,T,A)}return this.collator?s(b,T,A,this.collator.evaluate(b)):r(b,T,A)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const bd=Ru("==",vd,Go),Xh=Ru("!=",xd,Ho),If=Ru("<",js,Rc),Cf=Ru(">",Gh,Hh),Bc=Ru("<=",cu,Xo),Oc=Ru(">=",Lu,$r);class Wo{constructor(r,s,c){this.type=gn,this.locale=c,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(r.length!==2)return s.error("Expected one argument.");const c=r[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const y=s.parse(c["case-sensitive"]===void 0?!1:c["case-sensitive"],1,Ci);if(!y)return null;const b=s.parse(c["diacritic-sensitive"]===void 0?!1:c["diacritic-sensitive"],1,Ci);if(!b)return null;let T=null;return c.locale&&(T=s.parse(c.locale,1,Di),!T)?null:new Wo(y,b,T)}evaluate(r){return new qh(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class Wh{constructor(r,s,c,y,b){this.type=Di,this.number=r,this.locale=s,this.currency=c,this.minFractionDigits=y,this.maxFractionDigits=b}static parse(r,s){if(r.length!==3)return s.error("Expected two arguments.");const c=s.parse(r[1],1,Me);if(!c)return null;const y=r[2];if(typeof y!="object"||Array.isArray(y))return s.error("NumberFormat options argument must be an object.");let b=null;if(y.locale&&(b=s.parse(y.locale,1,Di),!b))return null;let T=null;if(y.currency&&(T=s.parse(y.currency,1,Di),!T))return null;let A=null;if(y["min-fraction-digits"]&&(A=s.parse(y["min-fraction-digits"],1,Me),!A))return null;let F=null;return y["max-fraction-digits"]&&(F=s.parse(y["max-fraction-digits"],1,Me),!F)?null:new Wh(c,b,T,A,F)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class Kh{constructor(r){this.type=ja,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const c=r[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const y=[];let b=!1;for(let T=1;T<=r.length-1;++T){const A=r[T];if(b&&typeof A=="object"&&!Array.isArray(A)){b=!1;let F=null;if(A["font-scale"]&&(F=s.parse(A["font-scale"],1,Me),!F))return null;let B=null;if(A["text-font"]&&(B=s.parse(A["text-font"],1,Ga(Di)),!B))return null;let U=null;if(A["text-color"]&&(U=s.parse(A["text-color"],1,Za),!U))return null;const j=y[y.length-1];j.scale=F,j.font=B,j.textColor=U}else{const F=s.parse(r[T],1,vi);if(!F)return null;const B=F.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,y.push({content:F,scale:null,font:null,textColor:null})}}return new Kh(y)}evaluate(r){const s=c=>{const y=c.content.evaluate(r);return kr(y)===Us?new Ki("",y,null,null,null):new Ki(ya(y),null,c.scale?c.scale.evaluate(r):null,c.font?c.font.evaluate(r).join(","):null,c.textColor?c.textColor.evaluate(r):null)};return new jn(this.sections.map(s))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor)}outputDefined(){return!1}}class Vc{constructor(r){this.type=Us,this.input=r}static parse(r,s){if(r.length!==2)return s.error("Expected two arguments.");const c=s.parse(r[1],1,Di);return c?new Vc(c):s.error("No image name provided.")}evaluate(r){const s=this.input.evaluate(r),c=ss.fromString(s);return c&&r.availableImages&&(c.available=r.availableImages.indexOf(s)>-1),c}eachChild(r){r(this.input)}outputDefined(){return!1}}class Uc{constructor(r){this.type=Me,this.input=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const c=s.parse(r[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${zr(c.type)} instead.`):new Uc(c):null}evaluate(r){const s=this.input.evaluate(r);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new Ur(`Expected value to be of type string or array, but found ${zr(kr(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const Es=8192;function Nc(n,r){const s=qc(n[0]),c=Pf(n[1]),y=Math.pow(2,r.z);return[Math.round(s*y*Es),Math.round(c*y*Es)]}function ph(n,r){const s=Math.pow(2,r.z),c=(n[0]/Es+r.x)/s,y=(n[1]/Es+r.y)/s;return[Zc(c),wr(y)]}function qc(n){return(180+n)/360}function Zc(n){return n*360-180}function Pf(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function wr(n){return 360/Math.PI*Math.atan(Math.exp((180-n*360)*Math.PI/180))-90}function mh(n,r){n[0]=Math.min(n[0],r[0]),n[1]=Math.min(n[1],r[1]),n[2]=Math.max(n[2],r[0]),n[3]=Math.max(n[3],r[1])}function Cl(n,r){return!(n[0]<=r[0]||n[2]>=r[2]||n[1]<=r[1]||n[3]>=r[3])}function jc(n,r,s){return r[1]>n[1]!=s[1]>n[1]&&n[0]<(s[0]-r[0])*(n[1]-r[1])/(s[1]-r[1])+r[0]}function Gc(n,r,s){const c=n[0]-r[0],y=n[1]-r[1],b=n[0]-s[0],T=n[1]-s[1];return c*T-b*y===0&&c*b<=0&&y*T<=0}function Ko(n,r,s,c){const y=[r[0]-n[0],r[1]-n[1]],b=[c[0]-s[0],c[1]-s[1]];return Pl(b,y)===0?!1:!!(Al(n,r,s,c)&&Al(s,c,n,r))}function _h(n,r,s){for(const c of s)for(let y=0;y<c.length-1;++y)if(Ko(n,r,c[y],c[y+1]))return!0;return!1}function fu(n,r,s=!1){let c=!1;for(const y of r)for(let b=0;b<y.length-1;b++){if(Gc(n,y[b],y[b+1]))return s;jc(n,y[b],y[b+1])&&(c=!c)}return c}function kn(n,r){for(const s of r)if(fu(n,s))return!0;return!1}function gh(n,r){for(const s of n)if(!fu(s,r))return!1;for(let s=0;s<n.length-1;++s)if(_h(n[s],n[s+1],r))return!1;return!0}function Yo(n,r){for(const s of r)if(gh(n,s))return!0;return!1}function Pl(n,r){return n[0]*r[1]-n[1]*r[0]}function Al(n,r,s,c){const y=n[0]-s[0],b=n[1]-s[1],T=r[0]-s[0],A=r[1]-s[1],F=c[0]-s[0],B=c[1]-s[1],U=y*B-F*b,j=T*B-F*A;return U>0&&j<0||U<0&&j>0}function Jo(n,r,s){const c=[];for(let y=0;y<n.length;y++){const b=[];for(let T=0;T<n[y].length;T++){const A=Nc(n[y][T],s);mh(r,A),b.push(A)}c.push(b)}return c}function Gs(n,r,s){const c=[];for(let y=0;y<n.length;y++){const b=Jo(n[y],r,s);c.push(b)}return c}function Qo(n,r,s,c){if(n[0]<s[0]||n[0]>s[2]){const y=c*.5;let b=n[0]-s[0]>y?-c:s[0]-n[0]>y?c:0;b===0&&(b=n[0]-s[2]>y?-c:s[2]-n[0]>y?c:0),n[0]+=b}mh(r,n)}function Ml(n){n[0]=n[1]=1/0,n[2]=n[3]=-1/0}function $o(n,r,s,c){const y=Math.pow(2,c.z)*Es,b=[c.x*Es,c.y*Es],T=[];for(const A of n)for(const F of A){const B=[F.x+b[0],F.y+b[1]];Qo(B,r,s,y),T.push(B)}return T}function Yh(n,r,s,c){const y=Math.pow(2,c.z)*Es,b=[c.x*Es,c.y*Es],T=[];for(const A of n){const F=[];for(const B of A){const U=[B.x+b[0],B.y+b[1]];mh(r,U),F.push(U)}T.push(F)}if(r[2]-r[0]<=y/2){Ml(r);for(const A of T)for(const F of A)Qo(F,r,s,y)}return T}function Af(n,r){const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(r.type==="Polygon"){const b=Jo(r.coordinates,c,y),T=$o(n.geometry(),s,c,y);if(!Cl(s,c))return!1;for(const A of T)if(!fu(A,b))return!1}if(r.type==="MultiPolygon"){const b=Gs(r.coordinates,c,y),T=$o(n.geometry(),s,c,y);if(!Cl(s,c))return!1;for(const A of T)if(!kn(A,b))return!1}return!0}function wd(n,r){const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(r.type==="Polygon"){const b=Jo(r.coordinates,c,y),T=Yh(n.geometry(),s,c,y);if(!Cl(s,c))return!1;for(const A of T)if(!gh(A,b))return!1}if(r.type==="MultiPolygon"){const b=Gs(r.coordinates,c,y),T=Yh(n.geometry(),s,c,y);if(!Cl(s,c))return!1;for(const A of T)if(!Yo(A,b))return!1}return!0}class du{constructor(r,s){this.type=Ci,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Dr(r[1])){const c=r[1];if(c.type==="FeatureCollection"){const y=[];for(const b of c.features){const{type:T,coordinates:A}=b.geometry;T==="Polygon"&&y.push(A),T==="MultiPolygon"&&y.push(...A)}if(y.length){const b={type:"MultiPolygon",coordinates:y};return new du(c,b)}}else if(c.type==="Feature"){const y=c.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new du(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new du(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return Af(r,this.geometries);if(r.geometryType()==="LineString")return wd(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Mf=class{constructor(r=[],s=(c,y)=>c<y?-1:c>y?1:0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:c}=this,y=s[r];for(;r>0;){const b=r-1>>1,T=s[b];if(c(y,T)>=0)break;s[r]=T,r=b}s[r]=y}_down(r){const{data:s,compare:c}=this,y=this.length>>1,b=s[r];for(;r<y;){let T=(r<<1)+1;const A=T+1;if(A<this.length&&c(s[A],s[T])<0&&(T=A),c(s[T],b)>=0)break;s[r]=s[T],r=T}s[r]=b}};function Sd(n,r,s,c,y){zf(n,r,s,c||n.length-1,y||Df)}function zf(n,r,s,c,y){for(;c>s;){if(c-s>600){var b=c-s+1,T=r-s+1,A=Math.log(b),F=.5*Math.exp(2*A/3),B=.5*Math.sqrt(A*F*(b-F)/b)*(T-b/2<0?-1:1),U=Math.max(s,Math.floor(r-T*F/b+B)),j=Math.min(c,Math.floor(r+(b-T)*F/b+B));zf(n,r,U,j,y)}var $=n[r],st=s,ct=c;for(Bu(n,s,r),y(n[c],$)>0&&Bu(n,s,c);st<ct;){for(Bu(n,st,ct),st++,ct--;y(n[st],$)<0;)st++;for(;y(n[ct],$)>0;)ct--}y(n[s],$)===0?Bu(n,s,ct):(ct++,Bu(n,ct,c)),ct<=r&&(s=ct+1),r<=ct&&(c=ct-1)}}function Bu(n,r,s){var c=n[r];n[r]=n[s],n[s]=c}function Df(n,r){return n<r?-1:n>r?1:0}function Jh(n,r){if(n.length<=1)return[n];const c=[];let y,b;for(const T of n){const A=kf(T);A!==0&&(T.area=Math.abs(A),b===void 0&&(b=A<0),b===A<0?(y&&c.push(y),y=[T]):y.push(T))}if(y&&c.push(y),r>1)for(let T=0;T<c.length;T++)c[T].length<=r||(Sd(c[T],r,1,c[T].length-1,Hc),c[T]=c[T].slice(0,r));return c}function Hc(n,r){return r.area-n.area}function kf(n){let r=0;for(let s=0,c=n.length,y=c-1,b,T;s<c;y=s++)b=n[s],T=n[y],r+=(T.x-b.x)*(b.y+T.y);return r}const Td=6378.137,pu=1/298.257223563,Ff=pu*(2-pu),Lf=Math.PI/180;class Xc{constructor(r){const s=Lf*Td*1e3,c=Math.cos(r*Lf),y=1/(1-Ff*(1-c*c)),b=Math.sqrt(y);this.kx=s*b*c,this.ky=s*b*y*(1-Ff)}distance(r,s){const c=this.wrap(r[0]-s[0])*this.kx,y=(r[1]-s[1])*this.ky;return Math.sqrt(c*c+y*y)}pointOnLine(r,s){let c=1/0,y,b,T,A;for(let F=0;F<r.length-1;F++){let B=r[F][0],U=r[F][1],j=this.wrap(r[F+1][0]-B)*this.kx,$=(r[F+1][1]-U)*this.ky,st=0;(j!==0||$!==0)&&(st=(this.wrap(s[0]-B)*this.kx*j+(s[1]-U)*this.ky*$)/(j*j+$*$),st>1?(B=r[F+1][0],U=r[F+1][1]):st>0&&(B+=j/this.kx*st,U+=$/this.ky*st)),j=this.wrap(s[0]-B)*this.kx,$=(s[1]-U)*this.ky;const ct=j*j+$*$;ct<c&&(c=ct,y=B,b=U,T=F,A=st)}return{point:[y,b],index:T,t:Math.max(0,Math.min(1,A))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}const Wc=100,Kc=50;function Rf(n,r){return r[0]-n[0]}function vo(n){return n[1]-n[0]+1}function va(n,r){return n[1]>=n[0]&&n[1]<r}function zl(n,r){if(n[0]>n[1])return[null,null];const s=vo(n);if(r){if(s===2)return[n,null];const y=Math.floor(s/2);return[[n[0],n[0]+y],[n[0]+y,n[1]]]}if(s===1)return[n,null];const c=Math.floor(s/2)-1;return[[n[0],n[0]+c],[n[0]+c+1,n[1]]]}function Ou(n,r){if(!va(r,n.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let c=r[0];c<=r[1];++c)mh(s,n[c]);return s}function tl(n){const r=[1/0,1/0,-1/0,-1/0];for(const s of n)for(const c of s)mh(r,c);return r}function Yi(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Yc(n,r,s){if(!Yi(n)||!Yi(r))return NaN;let c=0,y=0;return n[2]<r[0]&&(c=r[0]-n[2]),n[0]>r[2]&&(c=n[0]-r[2]),n[1]>r[3]&&(y=n[1]-r[3]),n[3]<r[1]&&(y=r[1]-n[3]),s.distance([0,0],[c,y])}function os(n,r,s){const c=s.pointOnLine(r,n);return s.distance(n,c.point)}function Vu(n,r,s,c,y){const b=Math.min(os(n,[s,c],y),os(r,[s,c],y)),T=Math.min(os(s,[n,r],y),os(c,[n,r],y));return Math.min(b,T)}function mu(n,r,s,c,y){if(!(va(r,n.length)&&va(c,s.length)))return 1/0;let T=1/0;for(let A=r[0];A<r[1];++A){const F=n[A],B=n[A+1];for(let U=c[0];U<c[1];++U){const j=s[U],$=s[U+1];if(Ko(F,B,j,$))return 0;T=Math.min(T,Vu(F,B,j,$,y))}}return T}function Uu(n,r,s,c,y){if(!(va(r,n.length)&&va(c,s.length)))return NaN;let T=1/0;for(let A=r[0];A<=r[1];++A)for(let F=c[0];F<=c[1];++F)if(T=Math.min(T,y.distance(n[A],s[F])),T===0)return T;return T}function Bf(n,r,s){if(fu(n,r,!0))return 0;let c=1/0;for(const y of r){const b=y[0],T=y[y.length-1];if(b!==T&&(c=Math.min(c,os(n,[T,b],s)),c===0))return c;const A=s.pointOnLine(y,n);if(c=Math.min(c,s.distance(n,A.point)),c===0)return c}return c}function Jc(n,r,s,c){if(!va(r,n.length))return NaN;for(let b=r[0];b<=r[1];++b)if(fu(n[b],s,!0))return 0;let y=1/0;for(let b=r[0];b<r[1];++b){const T=n[b],A=n[b+1];for(const F of s)for(let B=0,U=F.length,j=U-1;B<U;j=B++){const $=F[j],st=F[B];if(Ko(T,A,$,st))return 0;y=Math.min(y,Vu(T,A,$,st,c))}}return y}function fr(n,r){for(const s of n)for(const c of s)if(fu(c,r,!0))return!0;return!1}function Qh(n,r,s,c=1/0){const y=tl(n),b=tl(r);if(c!==1/0&&Yc(y,b,s)>=c)return c;if(Cl(y,b)){if(fr(n,r))return 0}else if(fr(r,n))return 0;let T=1/0;for(const A of n)for(let F=0,B=A.length,U=B-1;F<B;U=F++){const j=A[U],$=A[F];for(const st of r)for(let ct=0,yt=st.length,At=yt-1;ct<yt;At=ct++){const Ut=st[At],re=st[ct];if(Ko(j,$,Ut,re))return 0;T=Math.min(T,Vu(j,$,Ut,re,s))}}return T}function Of(n,r,s,c,y,b){if(!b)return;const T=Yc(Ou(c,b),y,s);T<r&&n.push([T,b,[0,0]])}function yh(n,r,s,c,y,b,T){if(!b||!T)return;const A=Yc(Ou(c,b),Ou(y,T),s);A<r&&n.push([A,b,T])}function Dl(n,r,s,c,y=1/0){let b=Math.min(c.distance(n[0],s[0][0]),y);if(b===0)return b;const T=new Mf([[0,[0,n.length-1],[0,0]]],Rf),A=tl(s);for(;T.length>0;){const F=T.pop();if(F[0]>=b)continue;const B=F[1],U=r?Kc:Wc;if(vo(B)<=U){if(!va(B,n.length))return NaN;if(r){const j=Jc(n,B,s,c);if(isNaN(j)||j===0)return j;b=Math.min(b,j)}else for(let j=B[0];j<=B[1];++j){const $=Bf(n[j],s,c);if(b=Math.min(b,$),b===0)return 0}}else{const j=zl(B,r);Of(T,b,c,n,A,j[0]),Of(T,b,c,n,A,j[1])}}return b}function vh(n,r,s,c,y,b=1/0){let T=Math.min(b,y.distance(n[0],s[0]));if(T===0)return T;const A=new Mf([[0,[0,n.length-1],[0,s.length-1]]],Rf);for(;A.length>0;){const F=A.pop();if(F[0]>=T)continue;const B=F[1],U=F[2],j=r?Kc:Wc,$=c?Kc:Wc;if(vo(B)<=j&&vo(U)<=$){if(!va(B,n.length)&&va(U,s.length))return NaN;let st;if(r&&c)st=mu(n,B,s,U,y),T=Math.min(T,st);else if(r&&!c){const ct=n.slice(B[0],B[1]+1);for(let yt=U[0];yt<=U[1];++yt)if(st=os(s[yt],ct,y),T=Math.min(T,st),T===0)return T}else if(!r&&c){const ct=s.slice(U[0],U[1]+1);for(let yt=B[0];yt<=B[1];++yt)if(st=os(n[yt],ct,y),T=Math.min(T,st),T===0)return T}else st=Uu(n,B,s,U,y),T=Math.min(T,st)}else{const st=zl(B,r),ct=zl(U,c);yh(A,T,y,n,s,st[0],ct[0]),yh(A,T,y,n,s,st[0],ct[1]),yh(A,T,y,n,s,st[1],ct[0]),yh(A,T,y,n,s,st[1],ct[1])}}return T}function Vf(n,r){const s=n.geometry(),c=s.flat().map(T=>ph([T.x,T.y],n.canonical));if(s.length===0)return NaN;const y=new Xc(c[0][1]);let b=1/0;for(const T of r){switch(T.type){case"Point":b=Math.min(b,vh(c,!1,[T.coordinates],!1,y,b));break;case"LineString":b=Math.min(b,vh(c,!1,T.coordinates,!0,y,b));break;case"Polygon":b=Math.min(b,Dl(c,!1,T.coordinates,y,b));break}if(b===0)return b}return b}function Uf(n,r){const s=n.geometry(),c=s.flat().map(T=>ph([T.x,T.y],n.canonical));if(s.length===0)return NaN;const y=new Xc(c[0][1]);let b=1/0;for(const T of r){switch(T.type){case"Point":b=Math.min(b,vh(c,!0,[T.coordinates],!1,y,b));break;case"LineString":b=Math.min(b,vh(c,!0,T.coordinates,!0,y,b));break;case"Polygon":b=Math.min(b,Dl(c,!0,T.coordinates,y,b));break}if(b===0)return b}return b}function Ed(n,r){const s=n.geometry();if(s.length===0||s[0].length===0)return NaN;const c=Jh(s,0).map(T=>T.map(A=>A.map(F=>ph([F.x,F.y],n.canonical)))),y=new Xc(c[0][0][0][1]);let b=1/0;for(const T of r)for(const A of c){switch(T.type){case"Point":b=Math.min(b,Dl([T.coordinates],!1,A,y,b));break;case"LineString":b=Math.min(b,Dl(T.coordinates,!0,A,y,b));break;case"Polygon":b=Math.min(b,Qh(A,T.coordinates,y,b));break}if(b===0)return b}return b}function Qc(n){return n.type==="MultiPolygon"?n.coordinates.map(r=>({type:"Polygon",coordinates:r})):n.type==="MultiLineString"?n.coordinates.map(r=>({type:"LineString",coordinates:r})):n.type==="MultiPoint"?n.coordinates.map(r=>({type:"Point",coordinates:r})):[n]}class Hs{constructor(r,s){this.type=Me,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Dr(r[1])){const c=r[1];if(c.type==="FeatureCollection")return new Hs(c,c.features.map(y=>Qc(y.geometry)).flat());if(c.type==="Feature")return new Hs(c,Qc(c.geometry));if("type"in c&&"coordinates"in c)return new Hs(c,Qc(c))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return Vf(r,this.geometries);if(r.geometryType()==="LineString")return Uf(r,this.geometries);if(r.geometryType()==="Polygon")return Ed(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const el={"==":bd,"!=":Xh,">":Cf,"<":If,">=":Oc,"<=":Bc,array:yn,at:go,boolean:yn,case:zc,coalesce:Fu,collator:Wo,format:Kh,image:Vc,in:yo,"index-of":ku,interpolate:Pi,"interpolate-hcl":Pi,"interpolate-lab":Pi,length:Uc,let:hn,literal:Fr,match:Mc,number:yn,"number-format":Wh,object:yn,slice:uu,step:fh,string:yn,"to-boolean":Il,"to-color":Il,"to-number":Il,"to-string":Il,var:Zh,within:du,distance:Hs};class xa{constructor(r,s,c,y){this.name=r,this.type=s,this._evaluate=c,this.args=y}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,s){const c=r[0],y=xa.definitions[c];if(!y)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(y)?y[0]:y.type,T=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,A=T.filter(([B])=>!Array.isArray(B)||B.length===r.length-1);let F=null;for(const[B,U]of A){F=new Zs(s.registry,ec,s.path,null,s.scope);const j=[];let $=!1;for(let st=1;st<r.length;st++){const ct=r[st],yt=Array.isArray(B)?B[st-1]:B.type,At=F.parse(ct,1+j.length,yt);if(!At){$=!0;break}j.push(At)}if(!$){if(Array.isArray(B)&&B.length!==j.length){F.error(`Expected ${B.length} arguments, but found ${j.length} instead.`);continue}for(let st=0;st<j.length;st++){const ct=Array.isArray(B)?B[st]:B.type,yt=j[st];F.concat(st+1).checkSubtype(ct,yt.type)}if(F.errors.length===0)return new xa(c,b,U,j)}}if(A.length===1)s.errors.push(...F.errors);else{const U=(A.length?A:T).map(([$])=>tc($)).join(" | "),j=[];for(let $=1;$<r.length;$++){const st=s.parse(r[$],1+j.length);if(!st)return null;j.push(zr(st.type))}s.error(`Expected arguments of type ${U}, but found (${j.join(", ")}) instead.`)}return null}static register(r,s){xa.definitions=s;for(const c in s)r[c]=xa}}function xo(n,[r,s,c,y]){r=r.evaluate(n),s=s.evaluate(n),c=c.evaluate(n);const b=y?y.evaluate(n):1,T=ch(r,s,c,b);if(T)throw new Ur(T);return new cr(r/255,s/255,c/255,b,!1)}function il(n,r){return n in r}function $h(n,r){const s=r[n];return typeof s>"u"?null:s}function xh(n,r,s,c){for(;s<=c;){const y=s+c>>1;if(r[y]===n)return!0;r[y]>n?c=y-1:s=y+1}return!1}function _u(n){return{type:n}}xa.register(el,{error:[wf,[Di],(n,[r])=>{throw new Ur(r.evaluate(n))}],typeof:[Di,[vi],(n,[r])=>zr(kr(r.evaluate(n)))],"to-rgba":[Ga(Me,4),[Za],(n,[r])=>{const[s,c,y,b]=r.evaluate(n).rgb;return[s*255,c*255,y*255,b]}],rgb:[Za,[Me,Me,Me],xo],rgba:[Za,[Me,Me,Me,Me],xo],has:{type:Ci,overloads:[[[Di],(n,[r])=>il(r.evaluate(n),n.properties())],[[Di,Mu],(n,[r,s])=>il(r.evaluate(n),s.evaluate(n))]]},get:{type:vi,overloads:[[[Di],(n,[r])=>$h(r.evaluate(n),n.properties())],[[Di,Mu],(n,[r,s])=>$h(r.evaluate(n),s.evaluate(n))]]},"feature-state":[vi,[Di],(n,[r])=>$h(r.evaluate(n),n.featureState||{})],properties:[Mu,[],n=>n.properties()],"geometry-type":[Di,[],n=>n.geometryType()],id:[vi,[],n=>n.id()],zoom:[Me,[],n=>n.globals.zoom],"heatmap-density":[Me,[],n=>n.globals.heatmapDensity||0],"line-progress":[Me,[],n=>n.globals.lineProgress||0],accumulated:[vi,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Me,_u(Me),(n,r)=>{let s=0;for(const c of r)s+=c.evaluate(n);return s}],"*":[Me,_u(Me),(n,r)=>{let s=1;for(const c of r)s*=c.evaluate(n);return s}],"-":{type:Me,overloads:[[[Me,Me],(n,[r,s])=>r.evaluate(n)-s.evaluate(n)],[[Me],(n,[r])=>-r.evaluate(n)]]},"/":[Me,[Me,Me],(n,[r,s])=>r.evaluate(n)/s.evaluate(n)],"%":[Me,[Me,Me],(n,[r,s])=>r.evaluate(n)%s.evaluate(n)],ln2:[Me,[],()=>Math.LN2],pi:[Me,[],()=>Math.PI],e:[Me,[],()=>Math.E],"^":[Me,[Me,Me],(n,[r,s])=>Math.pow(r.evaluate(n),s.evaluate(n))],sqrt:[Me,[Me],(n,[r])=>Math.sqrt(r.evaluate(n))],log10:[Me,[Me],(n,[r])=>Math.log(r.evaluate(n))/Math.LN10],ln:[Me,[Me],(n,[r])=>Math.log(r.evaluate(n))],log2:[Me,[Me],(n,[r])=>Math.log(r.evaluate(n))/Math.LN2],sin:[Me,[Me],(n,[r])=>Math.sin(r.evaluate(n))],cos:[Me,[Me],(n,[r])=>Math.cos(r.evaluate(n))],tan:[Me,[Me],(n,[r])=>Math.tan(r.evaluate(n))],asin:[Me,[Me],(n,[r])=>Math.asin(r.evaluate(n))],acos:[Me,[Me],(n,[r])=>Math.acos(r.evaluate(n))],atan:[Me,[Me],(n,[r])=>Math.atan(r.evaluate(n))],min:[Me,_u(Me),(n,r)=>Math.min(...r.map(s=>s.evaluate(n)))],max:[Me,_u(Me),(n,r)=>Math.max(...r.map(s=>s.evaluate(n)))],abs:[Me,[Me],(n,[r])=>Math.abs(r.evaluate(n))],round:[Me,[Me],(n,[r])=>{const s=r.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[Me,[Me],(n,[r])=>Math.floor(r.evaluate(n))],ceil:[Me,[Me],(n,[r])=>Math.ceil(r.evaluate(n))],"filter-==":[Ci,[Di,vi],(n,[r,s])=>n.properties()[r.value]===s.value],"filter-id-==":[Ci,[vi],(n,[r])=>n.id()===r.value],"filter-type-==":[Ci,[Di],(n,[r])=>n.geometryType()===r.value],"filter-<":[Ci,[Di,vi],(n,[r,s])=>{const c=n.properties()[r.value],y=s.value;return typeof c==typeof y&&c<y}],"filter-id-<":[Ci,[vi],(n,[r])=>{const s=n.id(),c=r.value;return typeof s==typeof c&&s<c}],"filter->":[Ci,[Di,vi],(n,[r,s])=>{const c=n.properties()[r.value],y=s.value;return typeof c==typeof y&&c>y}],"filter-id->":[Ci,[vi],(n,[r])=>{const s=n.id(),c=r.value;return typeof s==typeof c&&s>c}],"filter-<=":[Ci,[Di,vi],(n,[r,s])=>{const c=n.properties()[r.value],y=s.value;return typeof c==typeof y&&c<=y}],"filter-id-<=":[Ci,[vi],(n,[r])=>{const s=n.id(),c=r.value;return typeof s==typeof c&&s<=c}],"filter->=":[Ci,[Di,vi],(n,[r,s])=>{const c=n.properties()[r.value],y=s.value;return typeof c==typeof y&&c>=y}],"filter-id->=":[Ci,[vi],(n,[r])=>{const s=n.id(),c=r.value;return typeof s==typeof c&&s>=c}],"filter-has":[Ci,[vi],(n,[r])=>r.value in n.properties()],"filter-has-id":[Ci,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ci,[Ga(Di)],(n,[r])=>r.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ci,[Ga(vi)],(n,[r])=>r.value.indexOf(n.id())>=0],"filter-in-small":[Ci,[Di,Ga(vi)],(n,[r,s])=>s.value.indexOf(n.properties()[r.value])>=0],"filter-in-large":[Ci,[Di,Ga(vi)],(n,[r,s])=>xh(n.properties()[r.value],s.value,0,s.value.length-1)],all:{type:Ci,overloads:[[[Ci,Ci],(n,[r,s])=>r.evaluate(n)&&s.evaluate(n)],[_u(Ci),(n,r)=>{for(const s of r)if(!s.evaluate(n))return!1;return!0}]]},any:{type:Ci,overloads:[[[Ci,Ci],(n,[r,s])=>r.evaluate(n)||s.evaluate(n)],[_u(Ci),(n,r)=>{for(const s of r)if(s.evaluate(n))return!0;return!1}]]},"!":[Ci,[Ci],(n,[r])=>!r.evaluate(n)],"is-supported-script":[Ci,[Di],(n,[r])=>{const s=n.globals&&n.globals.isSupportedScript;return s?s(r.evaluate(n)):!0}],upcase:[Di,[Di],(n,[r])=>r.evaluate(n).toUpperCase()],downcase:[Di,[Di],(n,[r])=>r.evaluate(n).toLowerCase()],concat:[Di,_u(vi),(n,r)=>r.map(s=>ya(s.evaluate(n))).join("")],"resolved-locale":[Di,[gn],(n,[r])=>r.evaluate(n).resolvedLocale()]});function tc(n){return Array.isArray(n)?`(${n.map(zr).join(", ")})`:`(${zr(n.type)}...)`}function ec(n){if(n instanceof Zh)return ec(n.boundExpression);if(n instanceof xa&&n.name==="error")return!1;if(n instanceof Wo)return!1;if(n instanceof du)return!1;if(n instanceof Hs)return!1;const r=n instanceof Il||n instanceof yn;let s=!0;return n.eachChild(c=>{r?s=s&&ec(c):s=s&&c instanceof Fr}),s?ic(n)&&Nu(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]):!1}function ic(n){if(n instanceof xa){if(n.name==="get"&&n.args.length===1)return!1;if(n.name==="feature-state")return!1;if(n.name==="has"&&n.args.length===1)return!1;if(n.name==="properties"||n.name==="geometry-type"||n.name==="id")return!1;if(/^filter-/.test(n.name))return!1}if(n instanceof du||n instanceof Hs)return!1;let r=!0;return n.eachChild(s=>{r&&!ic(s)&&(r=!1)}),r}function ba(n){if(n instanceof xa&&n.name==="feature-state")return!1;let r=!0;return n.eachChild(s=>{r&&!ba(s)&&(r=!1)}),r}function Nu(n,r){if(n instanceof xa&&r.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(c=>{s&&!Nu(c,r)&&(s=!1)}),s}function bh(n){return{result:"success",value:n}}function rl(n){return{result:"error",value:n}}function Xs(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Nf(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function $c(n){return!!n.expression&&n.expression.interpolated}function ji(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function qu(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function qf(n){return n}function Zu(n,r){const s=r.type==="color",c=n.stops&&typeof n.stops[0][0]=="object",y=c||n.property!==void 0,b=c||!y,T=n.type||($c(r)?"exponential":"interval");if(s||r.type==="padding"){const U=s?cr.parse:ga.parse;n=fo({},n),n.stops&&(n.stops=n.stops.map(j=>[j[0],U(j[1])])),n.default?n.default=U(n.default):n.default=U(r.default)}if(n.colorSpace&&!Ef(n.colorSpace))throw new Error(`Unknown color space: "${n.colorSpace}"`);let A,F,B;if(T==="exponential")A=Ii;else if(T==="interval")A=nc;else if(T==="categorical"){A=rc,F=Object.create(null);for(const U of n.stops)F[U[0]]=U[1];B=typeof n.stops[0][0]}else if(T==="identity")A=Id;else throw new Error(`Unknown function type "${T}"`);if(c){const U={},j=[];for(let ct=0;ct<n.stops.length;ct++){const yt=n.stops[ct],At=yt[0].zoom;U[At]===void 0&&(U[At]={zoom:At,type:n.type,property:n.property,default:n.default,stops:[]},j.push(At)),U[At].stops.push([yt[0].value,yt[1]])}const $=[];for(const ct of j)$.push([U[ct].zoom,Zu(U[ct],r)]);const st={name:"linear"};return{kind:"composite",interpolationType:st,interpolationFactor:Pi.interpolationFactor.bind(void 0,st),zoomStops:$.map(ct=>ct[0]),evaluate({zoom:ct},yt){return Ii({stops:$,base:n.base},r,ct).evaluate(ct,yt)}}}else if(b){const U=T==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:U,interpolationFactor:Pi.interpolationFactor.bind(void 0,U),zoomStops:n.stops.map(j=>j[0]),evaluate:({zoom:j})=>A(n,r,j,F,B)}}else return{kind:"source",evaluate(U,j){const $=j&&j.properties?j.properties[n.property]:void 0;return $===void 0?Ir(n.default,r.default):A(n,r,$,F,B)}}}function Ir(n,r,s){if(n!==void 0)return n;if(r!==void 0)return r;if(s!==void 0)return s}function rc(n,r,s,c,y){const b=typeof s===y?c[s]:void 0;return Ir(b,n.default,r.default)}function nc(n,r,s){if(ji(s)!=="number")return Ir(n.default,r.default);const c=n.stops.length;if(c===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[c-1][0])return n.stops[c-1][1];const y=jh(n.stops.map(b=>b[0]),s);return n.stops[y][1]}function Ii(n,r,s){const c=n.base!==void 0?n.base:1;if(ji(s)!=="number")return Ir(n.default,r.default);const y=n.stops.length;if(y===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[y-1][0])return n.stops[y-1][1];const b=jh(n.stops.map(U=>U[0]),s),T=ac(s,c,n.stops[b][0],n.stops[b+1][0]),A=n.stops[b][1],F=n.stops[b+1][1],B=Dn[r.type]||qf;return typeof A.evaluate=="function"?{evaluate(...U){const j=A.evaluate.apply(void 0,U),$=F.evaluate.apply(void 0,U);if(!(j===void 0||$===void 0))return B(j,$,T,n.colorSpace)}}:B(A,F,T,n.colorSpace)}function Id(n,r,s){switch(r.type){case"color":s=cr.parse(s);break;case"formatted":s=jn.fromString(s.toString());break;case"resolvedImage":s=ss.fromString(s.toString());break;case"padding":s=ga.parse(s);break;default:ji(s)!==r.type&&(r.type!=="enum"||!r.values[s])&&(s=void 0)}return Ir(s,n.default,r.default)}function ac(n,r,s,c){const y=c-s,b=n-s;return y===0?0:r===1?b/y:(Math.pow(r,b)-1)/(Math.pow(r,y)-1)}class dr{constructor(r,s){this.expression=r,this._warningHistory={},this._evaluator=new Sf,this._defaultValue=s?sc(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(r,s,c,y,b,T){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=y,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(r,s,c,y,b,T){this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=y,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!==A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Ur(`Expected value to be one of ${Object.keys(this._enumValues).map(F=>JSON.stringify(F)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function kl(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in el}function gu(n,r){const s=new Zs(el,ec,[],r?rf(r):void 0),c=s.parse(n,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?bh(new dr(c,r)):rl(s.errors)}class nr{constructor(r,s){this.kind=r,this._styleExpression=s,this.isStateDependent=r!=="constant"&&!ba(s.expression)}evaluateWithoutErrorHandling(r,s,c,y,b,T){return this._styleExpression.evaluateWithoutErrorHandling(r,s,c,y,b,T)}evaluate(r,s,c,y,b,T){return this._styleExpression.evaluate(r,s,c,y,b,T)}}class Fl{constructor(r,s,c,y){this.kind=r,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=r!=="camera"&&!ba(s.expression),this.interpolationType=y}evaluateWithoutErrorHandling(r,s,c,y,b,T){return this._styleExpression.evaluateWithoutErrorHandling(r,s,c,y,b,T)}evaluate(r,s,c,y,b,T){return this._styleExpression.evaluate(r,s,c,y,b,T)}interpolationFactor(r,s,c){return this.interpolationType?Pi.interpolationFactor(this.interpolationType,r,s,c):0}}function tf(n){return n._styleExpression!==void 0}function ef(n,r){const s=gu(n,r);if(s.result==="error")return s;const c=s.value.expression,y=ic(c);if(!y&&!Xs(r))return rl([new po("","data expressions not supported")]);const b=Nu(c,["zoom"]);if(!b&&!Nf(r))return rl([new po("","zoom expressions not supported")]);const T=Hu(c);if(!T&&!b)return rl([new po("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(T instanceof po)return rl([T]);if(T instanceof Pi&&!$c(r))return rl([new po("",'"interpolate" expressions cannot be used with this property')]);if(!T)return bh(y?new nr("constant",s.value):new nr("source",s.value));const A=T instanceof Pi?T.interpolation:void 0;return bh(y?new Fl("camera",s.value,T.labels,A):new Fl("composite",s.value,T.labels,A))}class ju{constructor(r,s){this._parameters=r,this._specification=s,fo(this,Zu(this._parameters,this._specification))}static deserialize(r){return new ju(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Gu(n,r){if(qu(n))return new ju(n,r);if(kl(n)){const s=ef(n,r);if(s.result==="error")throw new Error(s.value.map(c=>`${c.key}: ${c.message}`).join(", "));return s.value}else{let s=n;return r.type==="color"&&typeof n=="string"?s=cr.parse(n):r.type==="padding"&&(typeof n=="number"||Array.isArray(n))?s=ga.parse(n):r.type==="variableAnchorOffsetCollection"&&Array.isArray(n)&&(s=Pr.parse(n)),{kind:"constant",evaluate:()=>s}}}function Hu(n){let r=null;if(n instanceof hn)r=Hu(n.result);else if(n instanceof Fu){for(const s of n.args)if(r=Hu(s),r)break}else(n instanceof fh||n instanceof Pi)&&n.input instanceof xa&&n.input.name==="zoom"&&(r=n);return r instanceof po||n.eachChild(s=>{const c=Hu(s);c instanceof po?r=c:!r&&c?r=new po("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&c&&r!==c&&(r=new po("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function rf(n){const r={color:Za,string:Di,number:Me,enum:Di,boolean:Ci,formatted:ja,padding:Zn,resolvedImage:Us,variableAnchorOffsetCollection:Ns};return n.type==="array"?Ga(r[n.value]||vi,n.length):r[n.type]}function sc(n){return n.type==="color"&&qu(n.default)?new cr(0,0,0,0):n.type==="color"?cr.parse(n.default)||null:n.type==="padding"?ga.parse(n.default)||null:n.type==="variableAnchorOffsetCollection"?Pr.parse(n.default)||null:n.default===void 0?null:n.default}function oc(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const r of n.slice(1))if(!oc(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const Cd={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function lc(n){if(n==null)return{filter:()=>!0,needGeometry:!1};oc(n)||(n=_r(n));const r=gu(n,Cd);if(r.result==="error")throw new Error(r.value.map(s=>`${s.key}: ${s.message}`).join(", "));{const s=ls(n);return{filter:(c,y,b)=>r.value.evaluate(c,y,{},b),needGeometry:s}}}function nf(n,r){return n<r?-1:n>r?1:0}function ls(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let r=1;r<n.length;r++)if(ls(n[r]))return!0;return!1}function _r(n){if(!n)return!0;const r=n[0];return n.length<=1?r!=="any":r==="=="?Ws(n[1],n[2],"=="):r==="!="?ar(Ws(n[1],n[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Ws(n[1],n[2],r):r==="any"?yu(n.slice(1)):r==="all"?["all"].concat(n.slice(1).map(_r)):r==="none"?["all"].concat(n.slice(1).map(_r).map(ar)):r==="in"?us(n[1],n.slice(2)):r==="!in"?ar(us(n[1],n.slice(2))):r==="has"?Xi(n[1]):r==="!has"?ar(Xi(n[1])):!0}function Ws(n,r,s){switch(n){case"$type":return[`filter-type-${s}`,r];case"$id":return[`filter-id-${s}`,r];default:return[`filter-${s}`,n,r]}}function yu(n){return["any"].concat(n.map(_r))}function us(n,r){if(r.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(s=>typeof s!=typeof r[0])?["filter-in-large",n,["literal",r.sort(nf)]]:["filter-in-small",n,["literal",r]]}}function Xi(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ar(n){return["!",n]}function uc(n){const r=typeof n;if(r==="number"||r==="boolean"||r==="string"||n===void 0||n===null)return JSON.stringify(n);if(Array.isArray(n)){let y="[";for(const b of n)y+=`${uc(b)},`;return`${y}]`}const s=Object.keys(n).sort();let c="{";for(let y=0;y<s.length;y++)c+=`${JSON.stringify(s[y])}:${uc(n[s[y]])},`;return`${c}}`}function Ll(n){let r="";for(const s of ii)r+=`/${uc(n[s])}`;return r}function wh(n,r){const s={};for(let y=0;y<n.length;y++){const b=r&&r[n[y].id]||Ll(n[y]);r&&(r[n[y].id]=b);let T=s[b];T||(T=s[b]=[]),T.push(n[y])}const c=[];for(const y in s)c.push(s[y]);return c}function vu(){const n={},r=Ht.$version;for(const s in Ht.$root){const c=Ht.$root[s];if(c.required){let y=null;s==="version"?y=r:c.type==="array"?y=[]:y={},y!=null&&(n[s]=y)}}return n}function nl(n){const r=n.key,s=n.value;return s?[new _e(r,s,"constants have been deprecated as of v8")]:[]}function sr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Rl(n){if(Array.isArray(n))return n.map(Rl);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const r={};for(const s in n)r[s]=Rl(n[s]);return r}return sr(n)}function vn(n){const r=n.key,s=n.value,c=n.valueSpec||{},y=n.objectElementValidators||{},b=n.style,T=n.styleSpec,A=n.validateSpec;let F=[];const B=ji(s);if(B!=="object")return[new _e(r,s,`object expected, ${B} found`)];for(const U in s){const j=U.split(".")[0],$=c[j]||c["*"];let st;if(y[j])st=y[j];else if(c[j])st=A;else if(y["*"])st=y["*"];else if(c["*"])st=A;else{F.push(new _e(r,s[U],`unknown property "${U}"`));continue}F=F.concat(st({key:(r&&`${r}.`)+U,value:s[U],valueSpec:$,style:b,styleSpec:T,object:s,objectKey:U,validateSpec:A},s))}for(const U in c)y[U]||c[U].required&&c[U].default===void 0&&s[U]===void 0&&F.push(new _e(r,s,`missing required property "${U}"`));return F}function bo(n){const r=n.value,s=n.valueSpec,c=n.validateSpec,y=n.style,b=n.styleSpec,T=n.key,A=n.arrayElementValidator||c;if(ji(r)!=="array")return[new _e(T,r,`array expected, ${ji(r)} found`)];if(s.length&&r.length!==s.length)return[new _e(T,r,`array length ${s.length} expected, length ${r.length} found`)];if(s["min-length"]&&r.length<s["min-length"])return[new _e(T,r,`array length at least ${s["min-length"]} expected, length ${r.length} found`)];let F={type:s.value,values:s.values};b.$version<7&&(F.function=s.function),ji(s.value)==="object"&&(F=s.value);let B=[];for(let U=0;U<r.length;U++)B=B.concat(A({array:r,arrayIndex:U,value:r[U],valueSpec:F,validateSpec:n.validateSpec,style:y,styleSpec:b,key:`${T}[${U}]`}));return B}function Ne(n){const r=n.key,s=n.value,c=n.valueSpec;let y=ji(s);return y==="number"&&s!==s&&(y="NaN"),y!=="number"?[new _e(r,s,`number expected, ${y} found`)]:"minimum"in c&&s<c.minimum?[new _e(r,s,`${s} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&s>c.maximum?[new _e(r,s,`${s} is greater than the maximum value ${c.maximum}`)]:[]}function wa(n){const r=n.valueSpec,s=sr(n.value.type);let c,y={},b,T;const A=s!=="categorical"&&n.value.property===void 0,F=!A,B=ji(n.value.stops)==="array"&&ji(n.value.stops[0])==="array"&&ji(n.value.stops[0][0])==="object",U=vn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:j,default:ct}});return s==="identity"&&A&&U.push(new _e(n.key,n.value,'missing required property "property"')),s!=="identity"&&!n.value.stops&&U.push(new _e(n.key,n.value,'missing required property "stops"')),s==="exponential"&&n.valueSpec.expression&&!$c(n.valueSpec)&&U.push(new _e(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(F&&!Xs(n.valueSpec)?U.push(new _e(n.key,n.value,"property functions not supported")):A&&!Nf(n.valueSpec)&&U.push(new _e(n.key,n.value,"zoom functions not supported"))),(s==="categorical"||B)&&n.value.property===void 0&&U.push(new _e(n.key,n.value,'"property" property is required')),U;function j(yt){if(s==="identity")return[new _e(yt.key,yt.value,'identity function may not have a "stops" property')];let At=[];const Ut=yt.value;return At=At.concat(bo({key:yt.key,value:Ut,valueSpec:yt.valueSpec,validateSpec:yt.validateSpec,style:yt.style,styleSpec:yt.styleSpec,arrayElementValidator:$})),ji(Ut)==="array"&&Ut.length===0&&At.push(new _e(yt.key,Ut,"array must have at least one stop")),At}function $(yt){let At=[];const Ut=yt.value,re=yt.key;if(ji(Ut)!=="array")return[new _e(re,Ut,`array expected, ${ji(Ut)} found`)];if(Ut.length!==2)return[new _e(re,Ut,`array length 2 expected, length ${Ut.length} found`)];if(B){if(ji(Ut[0])!=="object")return[new _e(re,Ut,`object expected, ${ji(Ut[0])} found`)];if(Ut[0].zoom===void 0)return[new _e(re,Ut,"object stop key must have zoom")];if(Ut[0].value===void 0)return[new _e(re,Ut,"object stop key must have value")];if(T&&T>sr(Ut[0].zoom))return[new _e(re,Ut[0].zoom,"stop zoom values must appear in ascending order")];sr(Ut[0].zoom)!==T&&(T=sr(Ut[0].zoom),b=void 0,y={}),At=At.concat(vn({key:`${re}[0]`,value:Ut[0],valueSpec:{zoom:{}},validateSpec:yt.validateSpec,style:yt.style,styleSpec:yt.styleSpec,objectElementValidators:{zoom:Ne,value:st}}))}else At=At.concat(st({key:`${re}[0]`,value:Ut[0],validateSpec:yt.validateSpec,style:yt.style,styleSpec:yt.styleSpec},Ut));return kl(Rl(Ut[1]))?At.concat([new _e(`${re}[1]`,Ut[1],"expressions are not allowed in function stops.")]):At.concat(yt.validateSpec({key:`${re}[1]`,value:Ut[1],valueSpec:r,validateSpec:yt.validateSpec,style:yt.style,styleSpec:yt.styleSpec}))}function st(yt,At){const Ut=ji(yt.value),re=sr(yt.value),Yt=yt.value!==null?yt.value:At;if(!c)c=Ut;else if(Ut!==c)return[new _e(yt.key,Yt,`${Ut} stop domain type must match previous stop domain type ${c}`)];if(Ut!=="number"&&Ut!=="string"&&Ut!=="boolean")return[new _e(yt.key,Yt,"stop domain value must be a number, string, or boolean")];if(Ut!=="number"&&s!=="categorical"){let te=`number expected, ${Ut} found`;return Xs(r)&&s===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _e(yt.key,Yt,te)]}return s==="categorical"&&Ut==="number"&&(!isFinite(re)||Math.floor(re)!==re)?[new _e(yt.key,Yt,`integer expected, found ${re}`)]:s!=="categorical"&&Ut==="number"&&b!==void 0&&re<b?[new _e(yt.key,Yt,"stop domain values must appear in ascending order")]:(b=re,s==="categorical"&&re in y?[new _e(yt.key,Yt,"stop domain values must be unique")]:(y[re]=!0,[]))}function ct(yt){return yt.validateSpec({key:yt.key,value:yt.value,valueSpec:r,validateSpec:yt.validateSpec,style:yt.style,styleSpec:yt.styleSpec})}}function wo(n){const r=(n.expressionContext==="property"?ef:gu)(Rl(n.value),n.valueSpec);if(r.result==="error")return r.value.map(c=>new _e(`${n.key}${c.key}`,n.value,c.message));const s=r.value.expression||r.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new _e(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!ba(s))return[new _e(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!ba(s))return[new _e(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Nu(s,["zoom","feature-state"]))return[new _e(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ic(s))return[new _e(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zf(n){const r=n.value,s=n.key,c=ji(r);return c!=="boolean"?[new _e(s,r,`boolean expected, ${c} found`)]:[]}function Zr(n){const r=n.key,s=n.value,c=ji(s);return c!=="string"?[new _e(r,s,`color expected, ${c} found`)]:cr.parse(String(s))?[]:[new _e(r,s,`color expected, "${s}" found`)]}function Fn(n){const r=n.key,s=n.value,c=n.valueSpec,y=[];return Array.isArray(c.values)?c.values.indexOf(sr(s))===-1&&y.push(new _e(r,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(sr(s))===-1&&y.push(new _e(r,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),y}function Sa(n){return oc(Rl(n.value))?wo(fo({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ke(n)}function ke(n){const r=n.value,s=n.key;if(ji(r)!=="array")return[new _e(s,r,`array expected, ${ji(r)} found`)];const c=n.styleSpec;let y,b=[];if(r.length<1)return[new _e(s,r,"filter array must have at least 1 element")];switch(b=b.concat(Fn({key:`${s}[0]`,value:r[0],valueSpec:c.filter_operator,style:n.style,styleSpec:n.styleSpec})),sr(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&sr(r[1])==="$type"&&b.push(new _e(s,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&b.push(new _e(s,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(y=ji(r[1]),y!=="string"&&b.push(new _e(`${s}[1]`,r[1],`string expected, ${y} found`)));for(let T=2;T<r.length;T++)y=ji(r[T]),sr(r[1])==="$type"?b=b.concat(Fn({key:`${s}[${T}]`,value:r[T],valueSpec:c.geometry_type,style:n.style,styleSpec:n.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&b.push(new _e(`${s}[${T}]`,r[T],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let T=1;T<r.length;T++)b=b.concat(ke({key:`${s}[${T}]`,value:r[T],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":y=ji(r[1]),r.length!==2?b.push(new _e(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):y!=="string"&&b.push(new _e(`${s}[1]`,r[1],`string expected, ${y} found`));break}return b}function hc(n,r){const s=n.key,c=n.validateSpec,y=n.style,b=n.styleSpec,T=n.value,A=n.objectKey,F=b[`${r}_${n.layerType}`];if(!F)return[];const B=A.match(/^(.*)-transition$/);if(r==="paint"&&B&&F[B[1]]&&F[B[1]].transition)return c({key:s,value:T,valueSpec:b.transition,style:y,styleSpec:b});const U=n.valueSpec||F[A];if(!U)return[new _e(s,T,`unknown property "${A}"`)];let j;if(ji(T)==="string"&&Xs(U)&&!U.tokens&&(j=/^{([^}]+)}$/.exec(T)))return[new _e(s,T,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const $=[];return n.layerType==="symbol"&&(A==="text-field"&&y&&!y.glyphs&&$.push(new _e(s,T,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&qu(Rl(T))&&sr(T.type)==="identity"&&$.push(new _e(s,T,'"text-font" does not support identity functions'))),$.concat(c({key:n.key,value:T,valueSpec:U,style:y,styleSpec:b,expressionContext:"property",propertyType:r,propertyKey:A}))}function af(n){return hc(n,"paint")}function jf(n){return hc(n,"layout")}function sf(n){let r=[];const s=n.value,c=n.key,y=n.style,b=n.styleSpec;!s.type&&!s.ref&&r.push(new _e(c,s,'either "type" or "ref" is required'));let T=sr(s.type);const A=sr(s.ref);if(s.id){const F=sr(s.id);for(let B=0;B<n.arrayIndex;B++){const U=y.layers[B];sr(U.id)===F&&r.push(new _e(c,s.id,`duplicate layer id "${s.id}", previously used at line ${U.id.__line__}`))}}if("ref"in s){["type","source","source-layer","filter","layout"].forEach(B=>{B in s&&r.push(new _e(c,s[B],`"${B}" is prohibited for ref layers`))});let F;y.layers.forEach(B=>{sr(B.id)===A&&(F=B)}),F?F.ref?r.push(new _e(c,s.ref,"ref cannot reference another ref layer")):T=sr(F.type):r.push(new _e(c,s.ref,`ref layer "${A}" not found`))}else if(T!=="background")if(!s.source)r.push(new _e(c,s,'missing required property "source"'));else{const F=y.sources&&y.sources[s.source],B=F&&sr(F.type);F?B==="vector"&&T==="raster"?r.push(new _e(c,s.source,`layer "${s.id}" requires a raster source`)):B!=="raster-dem"&&T==="hillshade"?r.push(new _e(c,s.source,`layer "${s.id}" requires a raster-dem source`)):B==="raster"&&T!=="raster"?r.push(new _e(c,s.source,`layer "${s.id}" requires a vector source`)):B==="vector"&&!s["source-layer"]?r.push(new _e(c,s,`layer "${s.id}" must specify a "source-layer"`)):B==="raster-dem"&&T!=="hillshade"?r.push(new _e(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):T==="line"&&s.paint&&s.paint["line-gradient"]&&(B!=="geojson"||!F.lineMetrics)&&r.push(new _e(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new _e(c,s.source,`source "${s.source}" not found`))}return r=r.concat(vn({key:c,value:s,valueSpec:b.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*"(){return[]},type(){return n.validateSpec({key:`${c}.type`,value:s.type,valueSpec:b.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:s,objectKey:"type"})},filter:Sa,layout(F){return vn({layer:s,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*"(B){return jf(fo({layerType:T},B))}}})},paint(F){return vn({layer:s,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*"(B){return af(fo({layerType:T},B))}}})}}})),r}function Ha(n){const r=n.value,s=n.key,c=ji(r);return c!=="string"?[new _e(s,r,`string expected, ${c} found`)]:[]}function Bl(n){var r;const s=(r=n.sourceName)!==null&&r!==void 0?r:"",c=n.value,y=n.styleSpec,b=y.source_raster_dem,T=n.style;let A=[];const F=ji(c);if(c===void 0)return A;if(F!=="object")return A.push(new _e("source_raster_dem",c,`object expected, ${F} found`)),A;const U=sr(c.encoding)==="custom",j=["redFactor","greenFactor","blueFactor","baseShift"],$=n.value.encoding?`"${n.value.encoding}"`:"Default";for(const st in c)!U&&j.includes(st)?A.push(new _e(st,c[st],`In "${s}": "${st}" is only valid when "encoding" is set to "custom". ${$} encoding found`)):b[st]?A=A.concat(n.validateSpec({key:st,value:c[st],valueSpec:b[st],validateSpec:n.validateSpec,style:T,styleSpec:y})):A.push(new _e(st,c[st],`unknown property "${st}"`));return A}const Ta={promoteId:cc};function Sh(n){const r=n.value,s=n.key,c=n.styleSpec,y=n.style,b=n.validateSpec;if(!r.type)return[new _e(s,r,'"type" is required')];const T=sr(r.type);let A;switch(T){case"vector":case"raster":return A=vn({key:s,value:r,valueSpec:c[`source_${T.replace("-","_")}`],style:n.style,styleSpec:c,objectElementValidators:Ta,validateSpec:b}),A;case"raster-dem":return A=Bl({sourceName:s,value:r,style:n.style,styleSpec:c,validateSpec:b}),A;case"geojson":if(A=vn({key:s,value:r,valueSpec:c.source_geojson,style:y,styleSpec:c,validateSpec:b,objectElementValidators:Ta}),r.cluster)for(const F in r.clusterProperties){const[B,U]=r.clusterProperties[F],j=typeof B=="string"?[B,["accumulated"],["get",F]]:B;A.push(...wo({key:`${s}.${F}.map`,value:U,expressionContext:"cluster-map"})),A.push(...wo({key:`${s}.${F}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return A;case"video":return vn({key:s,value:r,valueSpec:c.source_video,style:y,validateSpec:b,styleSpec:c});case"image":return vn({key:s,value:r,valueSpec:c.source_image,style:y,validateSpec:b,styleSpec:c});case"canvas":return[new _e(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fn({key:`${s}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function cc({key:n,value:r}){if(ji(r)==="string")return Ha({key:n,value:r});{const s=[];for(const c in r)s.push(...Ha({key:`${n}.${c}`,value:r[c]}));return s}}function fc(n){const r=n.value,s=n.styleSpec,c=s.light,y=n.style;let b=[];const T=ji(r);if(r===void 0)return b;if(T!=="object")return b=b.concat([new _e("light",r,`object expected, ${T} found`)]),b;for(const A in r){const F=A.match(/^(.*)-transition$/);F&&c[F[1]]&&c[F[1]].transition?b=b.concat(n.validateSpec({key:A,value:r[A],valueSpec:s.transition,validateSpec:n.validateSpec,style:y,styleSpec:s})):c[A]?b=b.concat(n.validateSpec({key:A,value:r[A],valueSpec:c[A],validateSpec:n.validateSpec,style:y,styleSpec:s})):b=b.concat([new _e(A,r[A],`unknown property "${A}"`)])}return b}function Gf(n){const r=n.value,s=n.styleSpec,c=s.sky,y=n.style,b=ji(r);if(r===void 0)return[];if(b!=="object")return[new _e("sky",r,`object expected, ${b} found`)];let T=[];for(const A in r)c[A]?T=T.concat(n.validateSpec({key:A,value:r[A],valueSpec:c[A],style:y,styleSpec:s})):T=T.concat([new _e(A,r[A],`unknown property "${A}"`)]);return T}function Xa(n){const r=n.value,s=n.styleSpec,c=s.terrain,y=n.style;let b=[];const T=ji(r);if(r===void 0)return b;if(T!=="object")return b=b.concat([new _e("terrain",r,`object expected, ${T} found`)]),b;for(const A in r)c[A]?b=b.concat(n.validateSpec({key:A,value:r[A],valueSpec:c[A],validateSpec:n.validateSpec,style:y,styleSpec:s})):b=b.concat([new _e(A,r[A],`unknown property "${A}"`)]);return b}function Ks(n){return Ha(n).length===0?[]:wo(n)}function dc(n){return Ha(n).length===0?[]:wo(n)}function ia(n){const r=n.key,s=n.value;if(ji(s)==="array"){if(s.length<1||s.length>4)return[new _e(r,s,`padding requires 1 to 4 values; ${s.length} values found`)];const y={type:"number"};let b=[];for(let T=0;T<s.length;T++)b=b.concat(n.validateSpec({key:`${r}[${T}]`,value:s[T],validateSpec:n.validateSpec,valueSpec:y}));return b}else return Ne({key:r,value:s,valueSpec:{}})}function xn(n){const r=n.key,s=n.value,c=ji(s),y=n.styleSpec;if(c!=="array"||s.length<1||s.length%2!==0)return[new _e(r,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let T=0;T<s.length;T+=2)b=b.concat(Fn({key:`${r}[${T}]`,value:s[T],valueSpec:y.layout_symbol["text-anchor"]})),b=b.concat(bo({key:`${r}[${T+1}]`,value:s[T+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:y}));return b}function ra(n){let r=[];const s=n.value,c=n.key;if(Array.isArray(s)){const y=[],b=[];for(const T in s){s[T].id&&y.includes(s[T].id)&&r.push(new _e(c,s,`all the sprites' ids must be unique, but ${s[T].id} is duplicated`)),y.push(s[T].id),s[T].url&&b.includes(s[T].url)&&r.push(new _e(c,s,`all the sprites' URLs must be unique, but ${s[T].url} is duplicated`)),b.push(s[T].url);const A={id:{type:"string",required:!0},url:{type:"string",required:!0}};r=r.concat(vn({key:`${c}[${T}]`,value:s[T],valueSpec:A,validateSpec:n.validateSpec}))}return r}else return Ha({key:c,value:s})}function Xu(n){const r=n.value,s=n.styleSpec,c=s.projection,y=n.style,b=ji(r);if(r===void 0)return[];if(b!=="object")return[new _e("projection",r,`object expected, ${b} found`)];let T=[];for(const A in r)c[A]?T=T.concat(n.validateSpec({key:A,value:r[A],valueSpec:c[A],style:y,styleSpec:s})):T=T.concat([new _e(A,r[A],`unknown property "${A}"`)]);return T}const Wu={"*"(){return[]},array:bo,boolean:Zf,number:Ne,color:Zr,constants:nl,enum:Fn,filter:Sa,function:wa,layer:sf,object:vn,source:Sh,light:fc,sky:Gf,terrain:Xa,projection:Xu,string:Ha,formatted:Ks,resolvedImage:dc,padding:ia,variableAnchorOffsetCollection:xn,sprite:ra};function So(n){const r=n.value,s=n.valueSpec,c=n.styleSpec;return n.validateSpec=So,s.expression&&qu(sr(r))?wa(n):s.expression&&kl(Rl(r))?wo(n):s.type&&Wu[s.type]?Wu[s.type](n):vn(fo({},n,{valueSpec:s.type?c[s.type]:s}))}function Th(n){const r=n.value,s=n.key,c=Ha(n);return c.length||(r.indexOf("{fontstack}")===-1&&c.push(new _e(s,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&c.push(new _e(s,r,'"glyphs" url must include a "{range}" token'))),c}function Is(n,r=Ht){let s=[];return s=s.concat(So({key:"",value:n,valueSpec:r.$root,styleSpec:r,style:n,validateSpec:So,objectElementValidators:{glyphs:Th,"*"(){return[]}}})),n.constants&&(s=s.concat(nl({key:"constants",value:n.constants}))),Ea(s)}Is.source=hs(Wa(Sh)),Is.sprite=hs(Wa(ra)),Is.glyphs=hs(Wa(Th)),Is.light=hs(Wa(fc)),Is.sky=hs(Wa(Gf)),Is.terrain=hs(Wa(Xa)),Is.layer=hs(Wa(sf)),Is.filter=hs(Wa(Sa)),Is.paintProperty=hs(Wa(af)),Is.layoutProperty=hs(Wa(jf));function Wa(n){return function(r){return n({...r,validateSpec:So})}}function Ea(n){return[].concat(n).sort((r,s)=>r.line-s.line)}function hs(n){return function(...r){return Ea(n.apply(this,r))}}const Fi=Is;Fi.source;const Ku=Fi.light,Eh=Fi.sky;Fi.terrain,Fi.filter;const Gn=Fi.paintProperty,of=Fi.layoutProperty;function Yu(n,r){let s=!1;if(r&&r.length)for(const c of r)n.fire(new Oo(new Error(c.message))),s=!0;return s}const Ia=3;class tn{constructor(r,s,c){const y=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const T=new Int32Array(this.arrayBuffer);r=T[0],s=T[1],c=T[2],this.d=s+2*c;for(let B=0;B<this.d*this.d;B++){const U=T[Ia+B],j=T[Ia+B+1];y.push(U===j?null:T.subarray(U,j))}const A=T[Ia+y.length],F=T[Ia+y.length+1];this.keys=T.subarray(A,F),this.bboxes=T.subarray(F),this.insert=this._insertReadonly}else{this.d=s+2*c;for(let T=0;T<this.d*this.d;T++)y.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=r,this.padding=c,this.scale=s/r,this.uid=0;const b=c/s*r;this.min=-b,this.max=r+b}insert(r,s,c,y,b){this._forEachCell(s,c,y,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(y),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,s,c,y,b,T){this.cells[b].push(T)}query(r,s,c,y,b){const T=this.min,A=this.max;if(r<=T&&s<=T&&A<=c&&A<=y&&!b)return Array.prototype.slice.call(this.keys);{const F=[],B={};return this._forEachCell(r,s,c,y,this._queryCell,F,B,b),F}}_queryCell(r,s,c,y,b,T,A,F){const B=this.cells[b];if(B!==null){const U=this.keys,j=this.bboxes;for(let $=0;$<B.length;$++){const st=B[$];if(A[st]===void 0){const ct=st*4;(F?F(j[ct+0],j[ct+1],j[ct+2],j[ct+3]):r<=j[ct+2]&&s<=j[ct+3]&&c>=j[ct+0]&&y>=j[ct+1])?(A[st]=!0,T.push(U[st])):A[st]=!1}}}}_forEachCell(r,s,c,y,b,T,A,F){const B=this._convertToCellCoord(r),U=this._convertToCellCoord(s),j=this._convertToCellCoord(c),$=this._convertToCellCoord(y);for(let st=B;st<=j;st++)for(let ct=U;ct<=$;ct++){const yt=this.d*ct+st;if(!(F&&!F(this._convertFromCellCoord(st),this._convertFromCellCoord(ct),this._convertFromCellCoord(st+1),this._convertFromCellCoord(ct+1)))&&b.call(this,r,s,c,y,yt,T,A,F))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,s=Ia+this.cells.length+1+1;let c=0;for(let T=0;T<this.cells.length;T++)c+=this.cells[T].length;const y=new Int32Array(s+c+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let b=s;for(let T=0;T<r.length;T++){const A=r[T];y[Ia+T]=b,y.set(A,b),b+=A.length}return y[Ia+r.length]=b,y.set(this.keys,b),b+=this.keys.length,y[Ia+r.length+1]=b,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer}static serialize(r,s){const c=r.toArrayBuffer();return s&&s.push(c),{buffer:c}}static deserialize(r){return new tn(r.buffer)}}const Ar={};function Xt(n,r,s={}){if(Ar[n])throw new Error(`${n} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:n,writeable:!1}),Ar[n]={klass:r,omit:s.omit||[],shallow:s.shallow||[]}}Xt("Object",Object),Xt("TransferableGridIndex",tn),Xt("Color",cr),Xt("Error",Error),Xt("AJAXError",$n),Xt("ResolvedImage",ss),Xt("StylePropertyFunction",ju),Xt("StyleExpression",dr,{omit:["_evaluator"]}),Xt("ZoomDependentExpression",Fl),Xt("ZoomConstantExpression",nr),Xt("CompoundExpression",xa,{omit:["_evaluate"]});for(const n in el)el[n]._classRegistryKey||Xt(`Expression_${n}`,el[n]);function Ke(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Cs(n){const r=n.constructor;return n.$name||r._classRegistryKey}function Ca(n){if(n===null||typeof n!="object")return!1;const r=Cs(n);return!!(r&&r!=="Object")}function Ka(n){return!Ca(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Ke(n)||Qi(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Nr(n,r){if(Ka(n)){if((Ke(n)||Qi(n))&&r&&r.push(n),ArrayBuffer.isView(n)){const b=n;r&&r.push(b.buffer)}return n instanceof ImageData&&r&&r.push(n.data.buffer),n}if(Array.isArray(n)){const b=[];for(const T of n)b.push(Nr(T,r));return b}if(typeof n!="object")throw new Error(`can't serialize object of type ${typeof n}`);const s=Cs(n);if(!s)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Ar[s])throw new Error(`${s} is not registered.`);const{klass:c}=Ar[s],y=c.serialize?c.serialize(n,r):{};if(c.serialize){if(r&&y===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in n){if(!n.hasOwnProperty(b)||Ar[s].omit.indexOf(b)>=0)continue;const T=n[b];y[b]=Ar[s].shallow.indexOf(b)>=0?T:Nr(T,r)}n instanceof Error&&(y.message=n.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(y.$name=s),y}function na(n){if(Ka(n))return n;if(Array.isArray(n))return n.map(na);if(typeof n!="object")throw new Error(`can't deserialize object of type ${typeof n}`);const r=Cs(n)||"Object";if(!Ar[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:s}=Ar[r];if(!s)throw new Error(`can't deserialize unregistered class ${r}`);if(s.deserialize)return s.deserialize(n);const c=Object.create(s.prototype);for(const y of Object.keys(n)){if(y==="$name")continue;const b=n[y];c[y]=Ar[r].shallow.indexOf(y)>=0?b:na(b)}return c}class Ya{constructor(){this.first=!0}update(r,s){const c=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),r!==this.lastZoom?(this.lastZoom=r,this.lastFloorZoom=c,!0):!1)}}const Oi={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Ol(n){for(const r of n)if(To(r.charCodeAt(0)))return!0;return!1}function jr(n){for(const r of n)if(!al(r.charCodeAt(0)))return!1;return!0}function lf(n){const r=n.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(r.join("|"),"u")}const Mr=lf(["Arab","Dupl","Mong","Ougr","Syrc"]);function al(n){return!Mr.test(String.fromCodePoint(n))}const Vl=lf(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function uf(n){return n<11904?!1:Oi["CJK Compatibility Forms"](n)||Oi["CJK Compatibility"](n)||Oi["CJK Strokes"](n)||Oi["CJK Symbols and Punctuation"](n)||Oi["Enclosed CJK Letters and Months"](n)||Oi["Halfwidth and Fullwidth Forms"](n)||Oi["Ideographic Description Characters"](n)||Oi["Vertical Forms"](n)?!0:Vl.test(String.fromCodePoint(n))}function To(n){return n===746||n===747?!0:n<4352?!1:!!(Oi["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Oi["CJK Compatibility"](n)||Oi["CJK Strokes"](n)||Oi["CJK Symbols and Punctuation"](n)&&!(n>=12296&&n<=12305)&&!(n>=12308&&n<=12319)&&n!==12336||Oi["Enclosed CJK Letters and Months"](n)||Oi["Ideographic Description Characters"](n)||Oi.Kanbun(n)||Oi.Katakana(n)&&n!==12540||Oi["Halfwidth and Fullwidth Forms"](n)&&n!==65288&&n!==65289&&n!==65293&&!(n>=65306&&n<=65310)&&n!==65339&&n!==65341&&n!==65343&&!(n>=65371&&n<=65503)&&n!==65507&&!(n>=65512&&n<=65519)||Oi["Small Form Variants"](n)&&!(n>=65112&&n<=65118)&&!(n>=65123&&n<=65126)||Oi["Vertical Forms"](n)||Oi["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Vl.test(String.fromCodePoint(n)))}function Ul(n){return!!(Oi["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Oi["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Oi["Letterlike Symbols"](n)||Oi["Number Forms"](n)||Oi["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Oi["Control Pictures"](n)&&n!==9251||Oi["Optical Character Recognition"](n)||Oi["Enclosed Alphanumerics"](n)||Oi["Geometric Shapes"](n)||Oi["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Oi["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Oi["CJK Symbols and Punctuation"](n)||Oi.Katakana(n)||Oi["Private Use Area"](n)||Oi["CJK Compatibility Forms"](n)||Oi["Small Form Variants"](n)||Oi["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}function Nl(n){return!(To(n)||Ul(n))}function Hn(n){return new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(n))}const Ih=lf(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function pc(n){return Ih.test(String.fromCodePoint(n))}function Ju(n,r){return!(!r&&pc(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Oi.Khmer(n))}function Ch(n){for(const r of n)if(pc(r.charCodeAt(0)))return!0;return!1}function sl(n,r){for(const s of n)if(!Ju(s.charCodeAt(0),r))return!1;return!0}class aa{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}}const Ln=new aa;class gr{constructor(r,s){this.zoom=r,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ya,this.transition={})}isSupportedScript(r){return sl(r,Ln.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,s=r-Math.floor(r),c=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class Zl{constructor(r,s){this.property=r,this.value=s,this.expression=Gu(s===void 0?r.specification.default:s,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,s,c){return this.property.possiblyEvaluate(this,r,s,c)}}class ol{constructor(r){this.property=r,this.value=new Zl(r,void 0)}transitioned(r,s){return new Eo(this.property,this.value,s,da({},r.transition,this.transition),r.now)}untransitioned(){return new Eo(this.property,this.value,null,{},0)}}class mc{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return qr(this._values[r].value.value)}setValue(r,s){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new ol(this._values[r].property)),this._values[r].value=new Zl(this._values[r].property,s===null?void 0:qr(s))}getTransition(r){return qr(this._values[r].transition)}setTransition(r,s){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new ol(this._values[r].property)),this._values[r].transition=qr(s)||void 0}serialize(){const r={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(r[s]=c);const y=this.getTransition(s);y!==void 0&&(r[`${s}-transition`]=y)}return r}transitioned(r,s){const c=new xu(this._properties);for(const y of Object.keys(this._values))c._values[y]=this._values[y].transitioned(r,s._values[y]);return c}untransitioned(){const r=new xu(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].untransitioned();return r}}class Eo{constructor(r,s,c,y,b){this.property=r,this.value=s,this.begin=b+y.delay||0,this.end=this.begin+y.duration||0,r.specification.transition&&(y.delay||y.duration)&&(this.prior=c)}possiblyEvaluate(r,s,c){const y=r.now||0,b=this.value.possiblyEvaluate(r,s,c),T=this.prior;if(T){if(y>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(y<this.begin)return T.possiblyEvaluate(r,s,c);{const A=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(r,s,c),b,zo(A))}}else return b}}class xu{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,s,c){const y=new Qu(this._properties);for(const b of Object.keys(this._values))y._values[b]=this._values[b].possiblyEvaluate(r,s,c);return y}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class jl{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}hasValue(r){return this._values[r].value!==void 0}getValue(r){return qr(this._values[r].value)}setValue(r,s){this._values[r]=new Zl(this._values[r].property,s===null?void 0:qr(s))}serialize(){const r={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(r[s]=c)}return r}possiblyEvaluate(r,s,c){const y=new Qu(this._properties);for(const b of Object.keys(this._values))y._values[b]=this._values[b].possiblyEvaluate(r,s,c);return y}}class Xn{constructor(r,s,c){this.property=r,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,s,c,y){return this.property.evaluate(this.value,this.parameters,r,s,c,y)}}class Qu{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Xe{constructor(r){this.specification=r}possiblyEvaluate(r,s){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(s)}interpolate(r,s,c){const y=this.specification.type,b=Dn[y];return b?b(r,s,c):r}}class Ye{constructor(r,s){this.specification=r,this.overrides=s}possiblyEvaluate(r,s,c,y){return r.expression.kind==="constant"||r.expression.kind==="camera"?new Xn(this,{kind:"constant",value:r.expression.evaluate(s,null,{},c,y)},s):new Xn(this,r.expression,s)}interpolate(r,s,c){if(r.value.kind!=="constant"||s.value.kind!=="constant")return r;if(r.value.value===void 0||s.value.value===void 0)return new Xn(this,{kind:"constant",value:void 0},r.parameters);const y=this.specification.type,b=Dn[y];if(b){const T=b(r.value.value,s.value.value,c);return new Xn(this,{kind:"constant",value:T},r.parameters)}else return r}evaluate(r,s,c,y,b,T){return r.kind==="constant"?r.value:r.evaluate(s,c,y,b,T)}}class $u extends Ye{possiblyEvaluate(r,s,c,y){if(r.value===void 0)return new Xn(this,{kind:"constant",value:void 0},s);if(r.expression.kind==="constant"){const b=r.expression.evaluate(s,null,{},c,y),A=r.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,F=this._calculate(A,A,A,s);return new Xn(this,{kind:"constant",value:F},s)}else if(r.expression.kind==="camera"){const b=this._calculate(r.expression.evaluate({zoom:s.zoom-1}),r.expression.evaluate({zoom:s.zoom}),r.expression.evaluate({zoom:s.zoom+1}),s);return new Xn(this,{kind:"constant",value:b},s)}else return new Xn(this,r.expression,s)}evaluate(r,s,c,y,b,T){if(r.kind==="source"){const A=r.evaluate(s,c,y,b,T);return this._calculate(A,A,A,s)}else return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(s.zoom)-1},c,y),r.evaluate({zoom:Math.floor(s.zoom)},c,y),r.evaluate({zoom:Math.floor(s.zoom)+1},c,y),s):r.value}_calculate(r,s,c,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:r,to:s}:{from:c,to:s}}interpolate(r){return r}}class ll{constructor(r){this.specification=r}possiblyEvaluate(r,s,c,y){if(r.value!==void 0)if(r.expression.kind==="constant"){const b=r.expression.evaluate(s,null,{},c,y);return this._calculate(b,b,b,s)}else return this._calculate(r.expression.evaluate(new gr(Math.floor(s.zoom-1),s)),r.expression.evaluate(new gr(Math.floor(s.zoom),s)),r.expression.evaluate(new gr(Math.floor(s.zoom+1),s)),s)}_calculate(r,s,c,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:r,to:s}:{from:c,to:s}}interpolate(r){return r}}class _c{constructor(r){this.specification=r}possiblyEvaluate(r,s,c,y){return!!r.expression.evaluate(s,null,{},c,y)}interpolate(){return!1}}class Pa{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in r){const c=r[s];c.specification.overridable&&this.overridableProperties.push(s);const y=this.defaultPropertyValues[s]=new Zl(c,void 0),b=this.defaultTransitionablePropertyValues[s]=new ol(c);this.defaultTransitioningPropertyValues[s]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=y.possiblyEvaluate({})}}}Xt("DataDrivenProperty",Ye),Xt("DataConstantProperty",Xe),Xt("CrossFadedDataDrivenProperty",$u),Xt("CrossFadedProperty",ll),Xt("ColorRampProperty",_c);const Ja="-transition";class Ps extends ho{constructor(r,s){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(r=r,this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),s.layout&&(this._unevaluatedLayout=new jl(s.layout)),s.paint)){this._transitionablePaint=new mc(s.paint);for(const c in r.paint)this.setPaintProperty(c,r.paint[c],{validate:!1});for(const c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qu(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,s,c={}){if(s!=null){const y=`layers.${this.id}.layout.${r}`;if(this._validate(of,y,r,s,c))return}if(r==="visibility"){this.visibility=s;return}this._unevaluatedLayout.setValue(r,s)}getPaintProperty(r){return r.endsWith(Ja)?this._transitionablePaint.getTransition(r.slice(0,-Ja.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,s,c={}){if(s!=null){const y=`layers.${this.id}.paint.${r}`;if(this._validate(Gn,y,r,s,c))return!1}if(r.endsWith(Ja))return this._transitionablePaint.setTransition(r.slice(0,-Ja.length),s||void 0),!1;{const y=this._transitionablePaint._values[r],b=y.property.specification["property-type"]==="cross-faded-data-driven",T=y.value.isDataDriven(),A=y.value;this._transitionablePaint.setValue(r,s),this._handleSpecialPaintPropertyUpdate(r);const F=this._transitionablePaint._values[r].value;return F.isDataDriven()||T||b||this._handleOverridablePaintPropertyUpdate(r,A,F)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,s,c){return!1}isHidden(r){return this.minzoom&&r<this.minzoom||this.maxzoom&&r>=this.maxzoom?!0:this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,s){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,s)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),La(r,(s,c)=>s!==void 0&&!(c==="layout"&&!Object.keys(s).length)&&!(c==="paint"&&!Object.keys(s).length))}_validate(r,s,c,y,b={}){return b&&b.validate===!1?!1:Yu(this,r.call(Fi,{key:s,layerType:this.type,objectKey:c,value:y,styleSpec:Ht,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const s=this.paint.get(r);if(!(!(s instanceof Xn)||!Xs(s.property.specification))&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const hf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ph{constructor(r,s){this._structArray=r,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const Hf=128,Gr=5;class d{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,s){return r._trim(),s&&(r.isTransferred=!0,s.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const s=Object.create(this.prototype);return s.arrayBuffer=r.arrayBuffer,s.length=r.length,s.capacity=r.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(this.capacity*Gr),Hf),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function l(n,r=1){let s=0,c=0;const y=n.map(T=>{const A=m(T.type),F=s=u(s,Math.max(r,A)),B=T.components||1;return c=Math.max(c,A),s+=A*B,{name:T.name,type:T.type,components:B,offset:F}}),b=u(s,Math.max(c,r));return{members:y,size:b,alignment:r}}function m(n){return hf[n].BYTES_PER_ELEMENT}function u(n,r){return Math.ceil(n/r)*r}class _ extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s){const c=this.length;return this.resize(c+1),this.emplace(c,r,s)}emplace(r,s,c){const y=r*2;return this.int16[y+0]=s,this.int16[y+1]=c,r}}_.prototype.bytesPerElement=4,Xt("StructArrayLayout2i4",_);class I extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,c)}emplace(r,s,c,y){const b=r*3;return this.int16[b+0]=s,this.int16[b+1]=c,this.int16[b+2]=y,r}}I.prototype.bytesPerElement=6,Xt("StructArrayLayout3i6",I);class P extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,c,y)}emplace(r,s,c,y,b){const T=r*4;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=y,this.int16[T+3]=b,r}}P.prototype.bytesPerElement=8,Xt("StructArrayLayout4i8",P);class D extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,y,b,T){const A=this.length;return this.resize(A+1),this.emplace(A,r,s,c,y,b,T)}emplace(r,s,c,y,b,T,A){const F=r*6;return this.int16[F+0]=s,this.int16[F+1]=c,this.int16[F+2]=y,this.int16[F+3]=b,this.int16[F+4]=T,this.int16[F+5]=A,r}}D.prototype.bytesPerElement=12,Xt("StructArrayLayout2i4i12",D);class q extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,y,b,T){const A=this.length;return this.resize(A+1),this.emplace(A,r,s,c,y,b,T)}emplace(r,s,c,y,b,T,A){const F=r*4,B=r*8;return this.int16[F+0]=s,this.int16[F+1]=c,this.uint8[B+4]=y,this.uint8[B+5]=b,this.uint8[B+6]=T,this.uint8[B+7]=A,r}}q.prototype.bytesPerElement=8,Xt("StructArrayLayout2i4ub8",q);class G extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s){const c=this.length;return this.resize(c+1),this.emplace(c,r,s)}emplace(r,s,c){const y=r*2;return this.float32[y+0]=s,this.float32[y+1]=c,r}}G.prototype.bytesPerElement=8,Xt("StructArrayLayout2f8",G);class et extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,y,b,T,A,F,B,U){const j=this.length;return this.resize(j+1),this.emplace(j,r,s,c,y,b,T,A,F,B,U)}emplace(r,s,c,y,b,T,A,F,B,U,j){const $=r*10;return this.uint16[$+0]=s,this.uint16[$+1]=c,this.uint16[$+2]=y,this.uint16[$+3]=b,this.uint16[$+4]=T,this.uint16[$+5]=A,this.uint16[$+6]=F,this.uint16[$+7]=B,this.uint16[$+8]=U,this.uint16[$+9]=j,r}}et.prototype.bytesPerElement=20,Xt("StructArrayLayout10ui20",et);class ot extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,y,b,T,A,F,B,U,j,$){const st=this.length;return this.resize(st+1),this.emplace(st,r,s,c,y,b,T,A,F,B,U,j,$)}emplace(r,s,c,y,b,T,A,F,B,U,j,$,st){const ct=r*12;return this.int16[ct+0]=s,this.int16[ct+1]=c,this.int16[ct+2]=y,this.int16[ct+3]=b,this.uint16[ct+4]=T,this.uint16[ct+5]=A,this.uint16[ct+6]=F,this.uint16[ct+7]=B,this.int16[ct+8]=U,this.int16[ct+9]=j,this.int16[ct+10]=$,this.int16[ct+11]=st,r}}ot.prototype.bytesPerElement=24,Xt("StructArrayLayout4i4ui4i24",ot);class at extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,c)}emplace(r,s,c,y){const b=r*3;return this.float32[b+0]=s,this.float32[b+1]=c,this.float32[b+2]=y,r}}at.prototype.bytesPerElement=12,Xt("StructArrayLayout3f12",at);class pt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){const c=r*1;return this.uint32[c+0]=s,r}}pt.prototype.bytesPerElement=4,Xt("StructArrayLayout1ul4",pt);class wt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,y,b,T,A,F,B){const U=this.length;return this.resize(U+1),this.emplace(U,r,s,c,y,b,T,A,F,B)}emplace(r,s,c,y,b,T,A,F,B,U){const j=r*10,$=r*5;return this.int16[j+0]=s,this.int16[j+1]=c,this.int16[j+2]=y,this.int16[j+3]=b,this.int16[j+4]=T,this.int16[j+5]=A,this.uint32[$+3]=F,this.uint16[j+8]=B,this.uint16[j+9]=U,r}}wt.prototype.bytesPerElement=20,Xt("StructArrayLayout6i1ul2ui20",wt);class bt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,y,b,T){const A=this.length;return this.resize(A+1),this.emplace(A,r,s,c,y,b,T)}emplace(r,s,c,y,b,T,A){const F=r*6;return this.int16[F+0]=s,this.int16[F+1]=c,this.int16[F+2]=y,this.int16[F+3]=b,this.int16[F+4]=T,this.int16[F+5]=A,r}}bt.prototype.bytesPerElement=12,Xt("StructArrayLayout2i2i2i12",bt);class xt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,s,c,y,b)}emplace(r,s,c,y,b,T){const A=r*4,F=r*8;return this.float32[A+0]=s,this.float32[A+1]=c,this.float32[A+2]=y,this.int16[F+6]=b,this.int16[F+7]=T,r}}xt.prototype.bytesPerElement=16,Xt("StructArrayLayout2f1f2i16",xt);class Et extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,y,b,T){const A=this.length;return this.resize(A+1),this.emplace(A,r,s,c,y,b,T)}emplace(r,s,c,y,b,T,A){const F=r*16,B=r*4,U=r*8;return this.uint8[F+0]=s,this.uint8[F+1]=c,this.float32[B+1]=y,this.float32[B+2]=b,this.int16[U+6]=T,this.int16[U+7]=A,r}}Et.prototype.bytesPerElement=16,Xt("StructArrayLayout2ub2f2i16",Et);class kt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,c)}emplace(r,s,c,y){const b=r*3;return this.uint16[b+0]=s,this.uint16[b+1]=c,this.uint16[b+2]=y,r}}kt.prototype.bytesPerElement=6,Xt("StructArrayLayout3ui6",kt);class Gt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,y,b,T,A,F,B,U,j,$,st,ct,yt,At,Ut){const re=this.length;return this.resize(re+1),this.emplace(re,r,s,c,y,b,T,A,F,B,U,j,$,st,ct,yt,At,Ut)}emplace(r,s,c,y,b,T,A,F,B,U,j,$,st,ct,yt,At,Ut,re){const Yt=r*24,te=r*12,de=r*48;return this.int16[Yt+0]=s,this.int16[Yt+1]=c,this.uint16[Yt+2]=y,this.uint16[Yt+3]=b,this.uint32[te+2]=T,this.uint32[te+3]=A,this.uint32[te+4]=F,this.uint16[Yt+10]=B,this.uint16[Yt+11]=U,this.uint16[Yt+12]=j,this.float32[te+7]=$,this.float32[te+8]=st,this.uint8[de+36]=ct,this.uint8[de+37]=yt,this.uint8[de+38]=At,this.uint32[te+10]=Ut,this.int16[Yt+22]=re,r}}Gt.prototype.bytesPerElement=48,Xt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Gt);class Kt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,y,b,T,A,F,B,U,j,$,st,ct,yt,At,Ut,re,Yt,te,de,qe,$e,yi,hi,je,ci,Qe){const li=this.length;return this.resize(li+1),this.emplace(li,r,s,c,y,b,T,A,F,B,U,j,$,st,ct,yt,At,Ut,re,Yt,te,de,qe,$e,yi,hi,je,ci,Qe)}emplace(r,s,c,y,b,T,A,F,B,U,j,$,st,ct,yt,At,Ut,re,Yt,te,de,qe,$e,yi,hi,je,ci,Qe,li){const be=r*32,He=r*16;return this.int16[be+0]=s,this.int16[be+1]=c,this.int16[be+2]=y,this.int16[be+3]=b,this.int16[be+4]=T,this.int16[be+5]=A,this.int16[be+6]=F,this.int16[be+7]=B,this.uint16[be+8]=U,this.uint16[be+9]=j,this.uint16[be+10]=$,this.uint16[be+11]=st,this.uint16[be+12]=ct,this.uint16[be+13]=yt,this.uint16[be+14]=At,this.uint16[be+15]=Ut,this.uint16[be+16]=re,this.uint16[be+17]=Yt,this.uint16[be+18]=te,this.uint16[be+19]=de,this.uint16[be+20]=qe,this.uint16[be+21]=$e,this.uint16[be+22]=yi,this.uint32[He+12]=hi,this.float32[He+13]=je,this.float32[He+14]=ci,this.uint16[be+30]=Qe,this.uint16[be+31]=li,r}}Kt.prototype.bytesPerElement=64,Xt("StructArrayLayout8i15ui1ul2f2ui64",Kt);class ae extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){const c=r*1;return this.float32[c+0]=s,r}}ae.prototype.bytesPerElement=4,Xt("StructArrayLayout1f4",ae);class oe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,c)}emplace(r,s,c,y){const b=r*6,T=r*3;return this.uint16[b+0]=s,this.float32[T+1]=c,this.float32[T+2]=y,r}}oe.prototype.bytesPerElement=12,Xt("StructArrayLayout1ui2f12",oe);class ne extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,c)}emplace(r,s,c,y){const b=r*2,T=r*4;return this.uint32[b+0]=s,this.uint16[T+2]=c,this.uint16[T+3]=y,r}}ne.prototype.bytesPerElement=8,Xt("StructArrayLayout1ul2ui8",ne);class he extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s){const c=this.length;return this.resize(c+1),this.emplace(c,r,s)}emplace(r,s,c){const y=r*2;return this.uint16[y+0]=s,this.uint16[y+1]=c,r}}he.prototype.bytesPerElement=4,Xt("StructArrayLayout2ui4",he);class ge extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){const c=r*1;return this.uint16[c+0]=s,r}}ge.prototype.bytesPerElement=2,Xt("StructArrayLayout1ui2",ge);class Se extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,c,y)}emplace(r,s,c,y,b){const T=r*4;return this.float32[T+0]=s,this.float32[T+1]=c,this.float32[T+2]=y,this.float32[T+3]=b,r}}Se.prototype.bytesPerElement=16,Xt("StructArrayLayout4f16",Se);class Ce extends Ph{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new pe(this.anchorPointX,this.anchorPointY)}}Ce.prototype.size=20;class Ee extends wt{get(r){return new Ce(this,r)}}Xt("CollisionBoxArray",Ee);class Je extends Ph{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Je.prototype.size=48;class Ai extends Gt{get(r){return new Je(this,r)}}Xt("PlacedSymbolArray",Ai);class _i extends Ph{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}_i.prototype.size=64;class Re extends Kt{get(r){return new _i(this,r)}}Xt("SymbolInstanceArray",Re);class fi extends ae{getoffsetX(r){return this.float32[r*1+0]}}Xt("GlyphOffsetArray",fi);class si extends I{getx(r){return this.int16[r*3+0]}gety(r){return this.int16[r*3+1]}gettileUnitDistanceFromAnchor(r){return this.int16[r*3+2]}}Xt("SymbolLineVertexArray",si);class Li extends Ph{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Li.prototype.size=12;class Mi extends oe{get(r){return new Li(this,r)}}Xt("TextAnchorOffsetArray",Mi);class or extends Ph{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}or.prototype.size=8;class wi extends ne{get(r){return new or(this,r)}}Xt("FeatureIndexArray",wi);class ir extends _{}class ri extends I{}class Ti extends P{}class Lr extends _{}class cn extends _{}class As extends D{}class cs extends q{}class Aa extends G{}class Ma extends et{}class bu extends ot{}class Io extends at{}class za extends pt{}class Ys extends bt{}class Qa extends xt{}class Da extends Et{}class Ms extends kt{}class $a extends kt{}class fs extends he{}class gc extends ge{}const th=l([{name:"a_pos",components:2,type:"Int16"}],4),{members:bn,size:cf,alignment:yc}=th;class lr{constructor(r=[]){this.segments=r}prepareSegment(r,s,c,y){let b=this.segments[this.segments.length-1];return r>lr.MAX_VERTEX_ARRAY_LENGTH&&rr(`Max vertices per segment is ${lr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!b||b.vertexLength+r>lr.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==y)&&(b={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},y!==void 0&&(b.sortKey=y),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const r of this.segments)for(const s in r.vaos)r.vaos[s].destroy()}static simpleSegment(r,s,c,y){return new lr([{vertexOffset:r,primitiveOffset:s,vertexLength:c,primitiveLength:y,vaos:{},sortKey:0}])}}lr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xt("SegmentVector",lr);function wu(n,r){return n=Fs(Math.floor(n),0,255),r=Fs(Math.floor(r),0,255),256*n+r}const Su=l([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Tu={exports:{}},w={exports:{}};(function(n){function r(s,c){var y,b,T,A,F,B,U,j;for(y=s.length&3,b=s.length-y,T=c,F=3432918353,B=461845907,j=0;j<b;)U=s.charCodeAt(j)&255|(s.charCodeAt(++j)&255)<<8|(s.charCodeAt(++j)&255)<<16|(s.charCodeAt(++j)&255)<<24,++j,U=(U&65535)*F+(((U>>>16)*F&65535)<<16)&4294967295,U=U<<15|U>>>17,U=(U&65535)*B+(((U>>>16)*B&65535)<<16)&4294967295,T^=U,T=T<<13|T>>>19,A=(T&65535)*5+(((T>>>16)*5&65535)<<16)&4294967295,T=(A&65535)+27492+(((A>>>16)+58964&65535)<<16);switch(U=0,y){case 3:U^=(s.charCodeAt(j+2)&255)<<16;case 2:U^=(s.charCodeAt(j+1)&255)<<8;case 1:U^=s.charCodeAt(j)&255,U=(U&65535)*F+(((U>>>16)*F&65535)<<16)&4294967295,U=U<<15|U>>>17,U=(U&65535)*B+(((U>>>16)*B&65535)<<16)&4294967295,T^=U}return T^=s.length,T^=T>>>16,T=(T&65535)*2246822507+(((T>>>16)*2246822507&65535)<<16)&4294967295,T^=T>>>13,T=(T&65535)*3266489909+(((T>>>16)*3266489909&65535)<<16)&4294967295,T^=T>>>16,T>>>0}n.exports=r})(w);var t=w.exports,o={exports:{}};(function(n){function r(s,c){for(var y=s.length,b=c^y,T=0,A;y>=4;)A=s.charCodeAt(T)&255|(s.charCodeAt(++T)&255)<<8|(s.charCodeAt(++T)&255)<<16|(s.charCodeAt(++T)&255)<<24,A=(A&65535)*1540483477+(((A>>>16)*1540483477&65535)<<16),A^=A>>>24,A=(A&65535)*1540483477+(((A>>>16)*1540483477&65535)<<16),b=(b&65535)*1540483477+(((b>>>16)*1540483477&65535)<<16)^A,y-=4,++T;switch(y){case 3:b^=(s.charCodeAt(T+2)&255)<<16;case 2:b^=(s.charCodeAt(T+1)&255)<<8;case 1:b^=s.charCodeAt(T)&255,b=(b&65535)*1540483477+(((b>>>16)*1540483477&65535)<<16)}return b^=b>>>13,b=(b&65535)*1540483477+(((b>>>16)*1540483477&65535)<<16),b^=b>>>15,b>>>0}n.exports=r})(o);var f=o.exports,g=t,S=f;Tu.exports=g,Tu.exports.murmur3=g,Tu.exports.murmur2=S;var z=Tu.exports,k=fe(z);class R{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,s,c,y){this.ids.push(X(r)),this.positions.push(s,c,y)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=X(r);let c=0,y=this.ids.length-1;for(;c<y;){const T=c+y>>1;this.ids[T]>=s?y=T:c=T+1}const b=[];for(;this.ids[c]===s;){const T=this.positions[3*c],A=this.positions[3*c+1],F=this.positions[3*c+2];b.push({index:T,start:A,end:F}),c++}return b}static serialize(r,s){const c=new Float64Array(r.ids),y=new Uint32Array(r.positions);return K(c,y,0,c.length-1),s&&s.push(c.buffer,y.buffer),{ids:c,positions:y}}static deserialize(r){const s=new R;return s.ids=r.ids,s.positions=r.positions,s.indexed=!0,s}}function X(n){const r=+n;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:k(String(n))}function K(n,r,s,c){for(;s<c;){const y=n[s+c>>1];let b=s-1,T=c+1;for(;;){do b++;while(n[b]<y);do T--;while(n[T]>y);if(b>=T)break;J(n,b,T),J(r,3*b,3*T),J(r,3*b+1,3*T+1),J(r,3*b+2,3*T+2)}T-s<c-T?(K(n,r,s,T),s=T+1):(K(n,r,T+1,c),c=T)}}function J(n,r,s){const c=n[r];n[r]=n[s],n[s]=c}Xt("FeaturePositionMap",R);class ut{constructor(r,s){this.gl=r.gl,this.location=s}}class mt extends ut{constructor(r,s){super(r,s),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class vt extends ut{constructor(r,s){super(r,s),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Tt extends ut{constructor(r,s){super(r,s),this.current=[0,0]}set(r){(r[0]!==this.current[0]||r[1]!==this.current[1])&&(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}}class Ft extends ut{constructor(r,s){super(r,s),this.current=[0,0,0]}set(r){(r[0]!==this.current[0]||r[1]!==this.current[1]||r[2]!==this.current[2])&&(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}}class Bt extends ut{constructor(r,s){super(r,s),this.current=[0,0,0,0]}set(r){(r[0]!==this.current[0]||r[1]!==this.current[1]||r[2]!==this.current[2]||r[3]!==this.current[3])&&(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Ot extends ut{constructor(r,s){super(r,s),this.current=cr.transparent}set(r){(r.r!==this.current.r||r.g!==this.current.g||r.b!==this.current.b||r.a!==this.current.a)&&(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Dt=new Float32Array(16);class ie extends ut{constructor(r,s){super(r,s),this.current=Dt}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);return}for(let s=1;s<16;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}function $t(n){return[wu(255*n.r,255*n.g),wu(255*n.b,255*n.a)]}class ce{constructor(r,s,c){this.value=r,this.uniformNames=s.map(y=>`u_${y}`),this.type=c}setUniform(r,s,c){r.set(c.constantOr(this.value))}getBinding(r,s,c){return this.type==="color"?new Ot(r,s):new vt(r,s)}}class we{constructor(r,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=r.tlbr}setUniform(r,s,c,y){const b=y==="u_pattern_to"?this.patternTo:y==="u_pattern_from"?this.patternFrom:y==="u_pixel_ratio_to"?this.pixelRatioTo:y==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&r.set(b)}getBinding(r,s,c){return c.substr(0,9)==="u_pattern"?new Bt(r,s):new vt(r,s)}}class Fe{constructor(r,s,c,y){this.expression=r,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,s,c,y,b){const T=this.paintVertexArray.length,A=this.expression.evaluate(new gr(0),s,{},y,[],b);this.paintVertexArray.resize(r),this._setPaintValue(T,r,A)}updatePaintArray(r,s,c,y){const b=this.expression.evaluate({zoom:0},c,y);this._setPaintValue(r,s,b)}_setPaintValue(r,s,c){if(this.type==="color"){const y=$t(c);for(let b=r;b<s;b++)this.paintVertexArray.emplace(b,y[0],y[1])}else{for(let y=r;y<s;y++)this.paintVertexArray.emplace(y,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ge{constructor(r,s,c,y,b,T){this.expression=r,this.uniformNames=s.map(A=>`u_${A}_t`),this.type=c,this.useIntegerZoom=y,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=s.map(A=>({name:`a_${A}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(r,s,c,y,b){const T=this.expression.evaluate(new gr(this.zoom),s,{},y,[],b),A=this.expression.evaluate(new gr(this.zoom+1),s,{},y,[],b),F=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(F,r,T,A)}updatePaintArray(r,s,c,y){const b=this.expression.evaluate({zoom:this.zoom},c,y),T=this.expression.evaluate({zoom:this.zoom+1},c,y);this._setPaintValue(r,s,b,T)}_setPaintValue(r,s,c,y){if(this.type==="color"){const b=$t(c),T=$t(y);for(let A=r;A<s;A++)this.paintVertexArray.emplace(A,b[0],b[1],T[0],T[1])}else{for(let b=r;b<s;b++)this.paintVertexArray.emplace(b,c,y);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(y))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=Fs(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);r.set(y)}getBinding(r,s,c){return new vt(r,s)}}class Ze{constructor(r,s,c,y,b,T){this.expression=r,this.type=s,this.useIntegerZoom=c,this.zoom=y,this.layerId=T,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(r,s,c){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(y,r,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(r,s,c,y,b){this._setPaintValues(r,s,c.patterns&&c.patterns[this.layerId],b)}_setPaintValues(r,s,c,y){if(!y||!c)return;const{min:b,mid:T,max:A}=c,F=y[b],B=y[T],U=y[A];if(!(!F||!B||!U))for(let j=r;j<s;j++)this.zoomInPaintVertexArray.emplace(j,B.tl[0],B.tl[1],B.br[0],B.br[1],F.tl[0],F.tl[1],F.br[0],F.br[1],B.pixelRatio,F.pixelRatio),this.zoomOutPaintVertexArray.emplace(j,B.tl[0],B.tl[1],B.br[0],B.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],B.pixelRatio,U.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,Su.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,Su.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ei{constructor(r,s,c){this.binders={},this._buffers=[];const y=[];for(const b in r.paint._values){if(!c(b))continue;const T=r.paint.get(b);if(!(T instanceof Xn)||!Xs(T.property.specification))continue;const A=ui(b,r.type),F=T.value,B=T.property.specification.type,U=T.property.useIntegerZoom,j=T.property.specification["property-type"],$=j==="cross-faded"||j==="cross-faded-data-driven";if(F.kind==="constant")this.binders[b]=$?new we(F.value,A):new ce(F.value,A,B),y.push(`/u_${b}`);else if(F.kind==="source"||$){const st=Gi(b,B,"source");this.binders[b]=$?new Ze(F,B,U,s,st,r.id):new Fe(F,A,B,st),y.push(`/a_${b}`)}else{const st=Gi(b,B,"composite");this.binders[b]=new Ge(F,A,B,U,s,st),y.push(`/z_${b}`)}}this.cacheKey=y.sort().join("")}getMaxValue(r){const s=this.binders[r];return s instanceof Fe||s instanceof Ge?s.maxValue:0}populatePaintArrays(r,s,c,y,b){for(const T in this.binders){const A=this.binders[T];(A instanceof Fe||A instanceof Ge||A instanceof Ze)&&A.populatePaintArray(r,s,c,y,b)}}setConstantPatternPositions(r,s){for(const c in this.binders){const y=this.binders[c];y instanceof we&&y.setConstantPatternPositions(r,s)}}updatePaintArrays(r,s,c,y,b){let T=!1;for(const A in r){const F=s.getPositions(A);for(const B of F){const U=c.feature(B.index);for(const j in this.binders){const $=this.binders[j];if(($ instanceof Fe||$ instanceof Ge||$ instanceof Ze)&&$.expression.isStateDependent===!0){const st=y.paint.get(j);$.expression=st.value,$.updatePaintArray(B.start,B.end,U,r[A],b),T=!0}}}}return T}defines(){const r=[];for(const s in this.binders){const c=this.binders[s];(c instanceof ce||c instanceof we)&&r.push(...c.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return r}getBinderAttributes(){const r=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Fe||c instanceof Ge)for(let y=0;y<c.paintVertexAttributes.length;y++)r.push(c.paintVertexAttributes[y].name);else if(c instanceof Ze)for(let y=0;y<Su.members.length;y++)r.push(Su.members[y].name)}return r}getBinderUniforms(){const r=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof ce||c instanceof we||c instanceof Ge)for(const y of c.uniformNames)r.push(y)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,s){const c=[];for(const y in this.binders){const b=this.binders[y];if(b instanceof ce||b instanceof we||b instanceof Ge){for(const T of b.uniformNames)if(s[T]){const A=b.getBinding(r,s[T],T);c.push({name:T,property:y,binding:A})}}}return c}setUniforms(r,s,c,y){for(const{name:b,property:T,binding:A}of s)this.binders[T].setUniform(A,y,c.get(T),b)}updatePaintBuffers(r){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(r&&c instanceof Ze){const y=r.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(c instanceof Fe||c instanceof Ge)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(r){for(const s in this.binders){const c=this.binders[s];(c instanceof Fe||c instanceof Ge||c instanceof Ze)&&c.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const s=this.binders[r];(s instanceof Fe||s instanceof Ge||s instanceof Ze)&&s.destroy()}}}class Le{constructor(r,s,c=()=>!0){this.programConfigurations={};for(const y of r)this.programConfigurations[y.id]=new ei(y,s,c);this.needsUpload=!1,this._featureMap=new R,this._bufferOffset=0}populatePaintArrays(r,s,c,y,b,T){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(r,s,y,b,T);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,s,c,y){for(const b of c)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(r,this._featureMap,s,b,y)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function ui(n,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${r}-`,"").replace(/-/g,"_")]}function ti(n){return{"line-pattern":{source:Ma,composite:Ma},"fill-pattern":{source:Ma,composite:Ma},"fill-extrusion-pattern":{source:Ma,composite:Ma}}[n]}function Gi(n,r,s){const c={color:{source:G,composite:Se},number:{source:ae,composite:G}},y=ti(n);return y&&y[s]||c[r][s]}Xt("ConstantBinder",ce),Xt("CrossFadedConstantBinder",we),Xt("SourceExpressionBinder",Fe),Xt("CrossFadedCompositeBinder",Ze),Xt("CompositeExpressionBinder",Ge),Xt("ProgramConfiguration",ei,{omit:["_buffers"]}),Xt("ProgramConfigurationSet",Le);const ye=8192,Ui=Math.pow(2,15-1)-1,Wi=-Ui-1;function Ni(n){const r=ye/n.extent,s=n.loadGeometry();for(let c=0;c<s.length;c++){const y=s[c];for(let b=0;b<y.length;b++){const T=y[b],A=Math.round(T.x*r),F=Math.round(T.y*r);T.x=Fs(A,Wi,Ui),T.y=Fs(F,Wi,Ui),(A<T.x||A>T.x+1||F<T.y||F>T.y+1)&&rr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Hr(n,r){return{type:n.type,id:n.id,properties:n.properties,geometry:r?Ni(n):[]}}function Xr(n,r,s,c,y){n.emplaceBack(r*2+(c+1)/2,s*2+(y+1)/2)}class ur{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Lr,this.indexArray=new $a,this.segments=new lr,this.programConfigurations=new Le(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,c){const y=this.layers[0],b=[];let T=null,A=!1;y.type==="circle"&&(T=y.layout.get("circle-sort-key"),A=!T.isConstant());for(const{feature:F,id:B,index:U,sourceLayerIndex:j}of r){const $=this.layers[0]._featureFilter.needGeometry,st=Hr(F,$);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom),st,c))continue;const ct=A?T.evaluate(st,{},c):void 0,yt={id:B,properties:F.properties,type:F.type,sourceLayerIndex:j,index:U,geometry:$?st.geometry:Ni(F),patterns:{},sortKey:ct};b.push(yt)}A&&b.sort((F,B)=>F.sortKey-B.sortKey);for(const F of b){const{geometry:B,index:U,sourceLayerIndex:j}=F,$=r[U].feature;this.addFeature(F,B,U,c),s.featureIndex.insert($,B,U,j,this.index)}}update(r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,bn),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,c,y){for(const b of s)for(const T of b){const A=T.x,F=T.y;if(A<0||A>=ye||F<0||F>=ye)continue;const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),U=B.vertexLength;Xr(this.layoutVertexArray,A,F,-1,-1),Xr(this.layoutVertexArray,A,F,1,-1),Xr(this.layoutVertexArray,A,F,1,1),Xr(this.layoutVertexArray,A,F,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+3,U+2),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,{},y)}}Xt("CircleBucket",ur,{omit:["layers"]});function Rr(n,r){for(let s=0;s<n.length;s++)if(Qs(r,n[s]))return!0;for(let s=0;s<r.length;s++)if(Qs(n,r[s]))return!0;return!!Rn(n,r)}function yr(n,r,s){return!!(Qs(n,r)||Js(r,n,s))}function ul(n,r){if(n.length===1)return Bn(r,n[0]);for(let s=0;s<r.length;s++){const c=r[s];for(let y=0;y<c.length;y++)if(Qs(n,c[y]))return!0}for(let s=0;s<n.length;s++)if(Bn(r,n[s]))return!0;for(let s=0;s<r.length;s++)if(Rn(n,r[s]))return!0;return!1}function ds(n,r,s){for(let c=0;c<r.length;c++){const y=r[c];if(n.length>=3){for(let b=0;b<y.length;b++)if(Qs(n,y[b]))return!0}if(sa(n,y,s))return!0}return!1}function sa(n,r,s){if(n.length>1){if(Rn(n,r))return!0;for(let c=0;c<r.length;c++)if(Js(r[c],n,s))return!0}for(let c=0;c<n.length;c++)if(Js(n[c],r,s))return!0;return!1}function Rn(n,r){if(n.length===0||r.length===0)return!1;for(let s=0;s<n.length-1;s++){const c=n[s],y=n[s+1];for(let b=0;b<r.length-1;b++){const T=r[b],A=r[b+1];if(Gl(c,y,T,A))return!0}}return!1}function Gl(n,r,s,c){return mn(n,s,c)!==mn(r,s,c)&&mn(n,r,s)!==mn(n,r,c)}function Js(n,r,s){const c=s*s;if(r.length===1)return n.distSqr(r[0])<c;for(let y=1;y<r.length;y++){const b=r[y-1],T=r[y];if(Eu(n,b,T)<c)return!0}return!1}function Eu(n,r,s){const c=r.distSqr(s);if(c===0)return n.distSqr(r);const y=((n.x-r.x)*(s.x-r.x)+(n.y-r.y)*(s.y-r.y))/c;return y<0?n.distSqr(r):y>1?n.distSqr(s):n.distSqr(s.sub(r)._mult(y)._add(r))}function Bn(n,r){let s=!1,c,y,b;for(let T=0;T<n.length;T++){c=n[T];for(let A=0,F=c.length-1;A<c.length;F=A++)y=c[A],b=c[F],y.y>r.y!=b.y>r.y&&r.x<(b.x-y.x)*(r.y-y.y)/(b.y-y.y)+y.x&&(s=!s)}return s}function Qs(n,r){let s=!1;for(let c=0,y=n.length-1;c<n.length;y=c++){const b=n[c],T=n[y];b.y>r.y!=T.y>r.y&&r.x<(T.x-b.x)*(r.y-b.y)/(T.y-b.y)+b.x&&(s=!s)}return s}function Xf(n,r,s,c,y){for(const T of n)if(r<=T.x&&s<=T.y&&c>=T.x&&y>=T.y)return!0;const b=[new pe(r,s),new pe(r,y),new pe(c,y),new pe(c,s)];if(n.length>2){for(const T of b)if(Qs(n,T))return!0}for(let T=0;T<n.length-1;T++){const A=n[T],F=n[T+1];if(ff(A,F,b))return!0}return!1}function ff(n,r,s){const c=s[0],y=s[2];if(n.x<c.x&&r.x<c.x||n.x>y.x&&r.x>y.x||n.y<c.y&&r.y<c.y||n.y>y.y&&r.y>y.y)return!1;const b=mn(n,r,s[0]);return b!==mn(n,r,s[1])||b!==mn(n,r,s[2])||b!==mn(n,r,s[3])}function Hl(n,r,s){const c=r.paint.get(n).value;return c.kind==="constant"?c.value:s.programConfigurations.get(r.id).getMaxValue(n)}function Co(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function $s(n,r,s,c,y){if(!r[0]&&!r[1])return n;const b=pe.convert(r)._mult(y);s==="viewport"&&b._rotate(-c);const T=[];for(let A=0;A<n.length;A++){const F=n[A];T.push(F.sub(b))}return T}function eh(n,r){const s=[];for(let c=0;c<n.length;c++){const y=n[c],b=[];for(let T=0;T<y.length;T++){const A=y[T-1],F=y[T],B=y[T+1],U=T===0?new pe(0,0):F.sub(A)._unit()._perp(),j=T===y.length-1?new pe(0,0):B.sub(F)._unit()._perp(),$=U._add(j)._unit(),st=$.x*j.x+$.y*j.y;st!==0&&$._mult(1/st),b.push($._mult(r)._add(F))}s.push(b)}return s}let Ah;const oa=()=>Ah=Ah||new Pa({"circle-sort-key":new Ye(Ht.layout_circle["circle-sort-key"])});let to;const ps=()=>to=to||new Pa({"circle-radius":new Ye(Ht.paint_circle["circle-radius"]),"circle-color":new Ye(Ht.paint_circle["circle-color"]),"circle-blur":new Ye(Ht.paint_circle["circle-blur"]),"circle-opacity":new Ye(Ht.paint_circle["circle-opacity"]),"circle-translate":new Xe(Ht.paint_circle["circle-translate"]),"circle-translate-anchor":new Xe(Ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xe(Ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xe(Ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ye(Ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ye(Ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ye(Ht.paint_circle["circle-stroke-opacity"])});var Xl={get paint(){return ps()},get layout(){return oa()}},en=1e-6,rn=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,r=arguments.length;r--;)n+=arguments[r]*arguments[r];return Math.sqrt(n)});function ih(){var n=new rn(16);return rn!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Ip(n){var r=new rn(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r}function nn(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n}function vc(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function $d(n,r){var s=r[0],c=r[1],y=r[2],b=r[3],T=r[4],A=r[5],F=r[6],B=r[7],U=r[8],j=r[9],$=r[10],st=r[11],ct=r[12],yt=r[13],At=r[14],Ut=r[15],re=s*A-c*T,Yt=s*F-y*T,te=s*B-b*T,de=c*F-y*A,qe=c*B-b*A,$e=y*B-b*F,yi=U*yt-j*ct,hi=U*At-$*ct,je=U*Ut-st*ct,ci=j*At-$*yt,Qe=j*Ut-st*yt,li=$*Ut-st*At,be=re*li-Yt*Qe+te*ci+de*je-qe*hi+$e*yi;return be?(be=1/be,n[0]=(A*li-F*Qe+B*ci)*be,n[1]=(y*Qe-c*li-b*ci)*be,n[2]=(yt*$e-At*qe+Ut*de)*be,n[3]=($*qe-j*$e-st*de)*be,n[4]=(F*je-T*li-B*hi)*be,n[5]=(s*li-y*je+b*hi)*be,n[6]=(At*te-ct*$e-Ut*Yt)*be,n[7]=(U*$e-$*te+st*Yt)*be,n[8]=(T*Qe-A*je+B*yi)*be,n[9]=(c*je-s*Qe-b*yi)*be,n[10]=(ct*qe-yt*te+Ut*re)*be,n[11]=(j*te-U*qe-st*re)*be,n[12]=(A*hi-T*ci-F*yi)*be,n[13]=(s*ci-c*hi+y*yi)*be,n[14]=(yt*Yt-ct*de-At*re)*be,n[15]=(U*de-j*Yt+$*re)*be,n):null}function df(n,r,s){var c=r[0],y=r[1],b=r[2],T=r[3],A=r[4],F=r[5],B=r[6],U=r[7],j=r[8],$=r[9],st=r[10],ct=r[11],yt=r[12],At=r[13],Ut=r[14],re=r[15],Yt=s[0],te=s[1],de=s[2],qe=s[3];return n[0]=Yt*c+te*A+de*j+qe*yt,n[1]=Yt*y+te*F+de*$+qe*At,n[2]=Yt*b+te*B+de*st+qe*Ut,n[3]=Yt*T+te*U+de*ct+qe*re,Yt=s[4],te=s[5],de=s[6],qe=s[7],n[4]=Yt*c+te*A+de*j+qe*yt,n[5]=Yt*y+te*F+de*$+qe*At,n[6]=Yt*b+te*B+de*st+qe*Ut,n[7]=Yt*T+te*U+de*ct+qe*re,Yt=s[8],te=s[9],de=s[10],qe=s[11],n[8]=Yt*c+te*A+de*j+qe*yt,n[9]=Yt*y+te*F+de*$+qe*At,n[10]=Yt*b+te*B+de*st+qe*Ut,n[11]=Yt*T+te*U+de*ct+qe*re,Yt=s[12],te=s[13],de=s[14],qe=s[15],n[12]=Yt*c+te*A+de*j+qe*yt,n[13]=Yt*y+te*F+de*$+qe*At,n[14]=Yt*b+te*B+de*st+qe*Ut,n[15]=Yt*T+te*U+de*ct+qe*re,n}function Wl(n,r,s){var c=s[0],y=s[1],b=s[2],T,A,F,B,U,j,$,st,ct,yt,At,Ut;return r===n?(n[12]=r[0]*c+r[4]*y+r[8]*b+r[12],n[13]=r[1]*c+r[5]*y+r[9]*b+r[13],n[14]=r[2]*c+r[6]*y+r[10]*b+r[14],n[15]=r[3]*c+r[7]*y+r[11]*b+r[15]):(T=r[0],A=r[1],F=r[2],B=r[3],U=r[4],j=r[5],$=r[6],st=r[7],ct=r[8],yt=r[9],At=r[10],Ut=r[11],n[0]=T,n[1]=A,n[2]=F,n[3]=B,n[4]=U,n[5]=j,n[6]=$,n[7]=st,n[8]=ct,n[9]=yt,n[10]=At,n[11]=Ut,n[12]=T*c+U*y+ct*b+r[12],n[13]=A*c+j*y+yt*b+r[13],n[14]=F*c+$*y+At*b+r[14],n[15]=B*c+st*y+Ut*b+r[15]),n}function tp(n,r,s){var c=s[0],y=s[1],b=s[2];return n[0]=r[0]*c,n[1]=r[1]*c,n[2]=r[2]*c,n[3]=r[3]*c,n[4]=r[4]*y,n[5]=r[5]*y,n[6]=r[6]*y,n[7]=r[7]*y,n[8]=r[8]*b,n[9]=r[9]*b,n[10]=r[10]*b,n[11]=r[11]*b,n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n}function xc(n,r,s){var c=Math.sin(s),y=Math.cos(s),b=r[4],T=r[5],A=r[6],F=r[7],B=r[8],U=r[9],j=r[10],$=r[11];return r!==n&&(n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[4]=b*y+B*c,n[5]=T*y+U*c,n[6]=A*y+j*c,n[7]=F*y+$*c,n[8]=B*y-b*c,n[9]=U*y-T*c,n[10]=j*y-A*c,n[11]=$*y-F*c,n}function Ad(n,r,s){var c=Math.sin(s),y=Math.cos(s),b=r[0],T=r[1],A=r[2],F=r[3],B=r[4],U=r[5],j=r[6],$=r[7];return r!==n&&(n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=b*y+B*c,n[1]=T*y+U*c,n[2]=A*y+j*c,n[3]=F*y+$*c,n[4]=B*y-b*c,n[5]=U*y-T*c,n[6]=j*y-A*c,n[7]=$*y-F*c,n}function Wf(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Md(n,r,s,c,y){var b=1/Math.tan(r/2),T;return n[0]=b/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,y!=null&&y!==1/0?(T=1/(c-y),n[10]=(y+c)*T,n[14]=2*y*c*T):(n[10]=-1,n[14]=-2*c),n}var Mh=Md;function Cp(n,r,s,c,y,b,T){var A=1/(r-s),F=1/(c-y),B=1/(b-T);return n[0]=-2*A,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*F,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*B,n[11]=0,n[12]=(r+s)*A,n[13]=(y+c)*F,n[14]=(T+b)*B,n[15]=1,n}var Pp=Cp;function d_(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]&&n[6]===r[6]&&n[7]===r[7]&&n[8]===r[8]&&n[9]===r[9]&&n[10]===r[10]&&n[11]===r[11]&&n[12]===r[12]&&n[13]===r[13]&&n[14]===r[14]&&n[15]===r[15]}function ym(n,r){var s=n[0],c=n[1],y=n[2],b=n[3],T=n[4],A=n[5],F=n[6],B=n[7],U=n[8],j=n[9],$=n[10],st=n[11],ct=n[12],yt=n[13],At=n[14],Ut=n[15],re=r[0],Yt=r[1],te=r[2],de=r[3],qe=r[4],$e=r[5],yi=r[6],hi=r[7],je=r[8],ci=r[9],Qe=r[10],li=r[11],be=r[12],He=r[13],ai=r[14],Hi=r[15];return Math.abs(s-re)<=en*Math.max(1,Math.abs(s),Math.abs(re))&&Math.abs(c-Yt)<=en*Math.max(1,Math.abs(c),Math.abs(Yt))&&Math.abs(y-te)<=en*Math.max(1,Math.abs(y),Math.abs(te))&&Math.abs(b-de)<=en*Math.max(1,Math.abs(b),Math.abs(de))&&Math.abs(T-qe)<=en*Math.max(1,Math.abs(T),Math.abs(qe))&&Math.abs(A-$e)<=en*Math.max(1,Math.abs(A),Math.abs($e))&&Math.abs(F-yi)<=en*Math.max(1,Math.abs(F),Math.abs(yi))&&Math.abs(B-hi)<=en*Math.max(1,Math.abs(B),Math.abs(hi))&&Math.abs(U-je)<=en*Math.max(1,Math.abs(U),Math.abs(je))&&Math.abs(j-ci)<=en*Math.max(1,Math.abs(j),Math.abs(ci))&&Math.abs($-Qe)<=en*Math.max(1,Math.abs($),Math.abs(Qe))&&Math.abs(st-li)<=en*Math.max(1,Math.abs(st),Math.abs(li))&&Math.abs(ct-be)<=en*Math.max(1,Math.abs(ct),Math.abs(be))&&Math.abs(yt-He)<=en*Math.max(1,Math.abs(yt),Math.abs(He))&&Math.abs(At-ai)<=en*Math.max(1,Math.abs(At),Math.abs(ai))&&Math.abs(Ut-Hi)<=en*Math.max(1,Math.abs(Ut),Math.abs(Hi))}var zd=df;function p_(){var n=new rn(4);return rn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Ap(n,r,s){return n[0]=r[0]*s[0],n[1]=r[1]*s[1],n[2]=r[2]*s[2],n[3]=r[3]*s[3],n}function m_(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]+n[3]*r[3]}function Kf(n,r,s){var c=r[0],y=r[1],b=r[2],T=r[3];return n[0]=s[0]*c+s[4]*y+s[8]*b+s[12]*T,n[1]=s[1]*c+s[5]*y+s[9]*b+s[13]*T,n[2]=s[2]*c+s[6]*y+s[10]*b+s[14]*T,n[3]=s[3]*c+s[7]*y+s[11]*b+s[15]*T,n}var Mp=Ap;(function(){var n=p_();return function(r,s,c,y,b,T){var A,F;for(s||(s=4),c||(c=0),y?F=Math.min(y*s+c,r.length):F=r.length,A=c;A<F;A+=s)n[0]=r[A],n[1]=r[A+1],n[2]=r[A+2],n[3]=r[A+3],b(n,n,T),r[A]=n[0],r[A+1]=n[1],r[A+2]=n[2],r[A+3]=n[3];return r}})();class __ extends Ps{constructor(r){super(r,Xl)}createBucket(r){return new ur(r)}queryRadius(r){const s=r;return Hl("circle-radius",this,s)+Hl("circle-stroke-width",this,s)+Co(this.paint.get("circle-translate"))}queryIntersectsFeature(r,s,c,y,b,T,A,F){const B=$s(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,A),U=this.paint.get("circle-radius").evaluate(s,c),j=this.paint.get("circle-stroke-width").evaluate(s,c),$=U+j,st=this.paint.get("circle-pitch-alignment")==="map",ct=st?B:g_(B,F),yt=st?$*A:$;for(const At of y)for(const Ut of At){const re=st?Ut:Kl(Ut,F);let Yt=yt;const te=Kf([],[Ut.x,Ut.y,0,1],F);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Yt*=te[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Yt*=T.cameraToCenterDistance/te[3]),yr(ct,re,Yt))return!0}return!1}}function Kl(n,r){const s=Kf([],[n.x,n.y,0,1],r);return new pe(s[0]/s[3],s[1]/s[3])}function g_(n,r){return n.map(s=>Kl(s,r))}class vm extends ur{}Xt("HeatmapBucket",vm,{omit:["layers"]});let xm;const y_=()=>xm=xm||new Pa({"heatmap-radius":new Ye(Ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ye(Ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xe(Ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _c(Ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xe(Ht.paint_heatmap["heatmap-opacity"])});var v_={get paint(){return y_()}};function zp(n,{width:r,height:s},c,y){if(!y)y=new Uint8Array(r*s*c);else if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==r*s*c)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${r*s*c}`);return n.width=r,n.height=s,n.data=y,n}function Dp(n,{width:r,height:s},c){if(r===n.width&&s===n.height)return;const y=zp({},{width:r,height:s},c);bc(n,y,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,r),height:Math.min(n.height,s)},c),n.width=r,n.height=s,n.data=y.data}function bc(n,r,s,c,y,b){if(y.width===0||y.height===0)return r;if(y.width>n.width||y.height>n.height||s.x>n.width-y.width||s.y>n.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>r.width||y.height>r.height||c.x>r.width-y.width||c.y>r.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const T=n.data,A=r.data;if(T===A)throw new Error("srcData equals dstData, so image is already copied");for(let F=0;F<y.height;F++){const B=((s.y+F)*n.width+s.x)*b,U=((c.y+F)*r.width+c.x)*b;for(let j=0;j<y.width*b;j++)A[U+j]=T[B+j]}return r}class Dd{constructor(r,s){zp(this,r,1,s)}resize(r){Dp(this,r,1)}clone(){return new Dd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,c,y,b){bc(r,s,c,y,b,1)}}class hl{constructor(r,s){zp(this,r,4,s)}resize(r){Dp(this,r,4)}replace(r,s){s?this.data.set(r):r instanceof Uint8ClampedArray?this.data=new Uint8Array(r.buffer):this.data=r}clone(){return new hl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,c,y,b){bc(r,s,c,y,b,4)}}Xt("AlphaImage",Dd),Xt("RGBAImage",hl);function bm(n){const r={},s=n.resolution||256,c=n.clips?n.clips.length:1,y=n.image||new hl({width:s,height:c});if(!Rs(s))throw new Error(`width is not a power of 2 - ${s}`);const b=(T,A,F)=>{r[n.evaluationKey]=F;const B=n.expression.evaluate(r);y.data[T+A+0]=Math.floor(B.r*255/B.a),y.data[T+A+1]=Math.floor(B.g*255/B.a),y.data[T+A+2]=Math.floor(B.b*255/B.a),y.data[T+A+3]=Math.floor(B.a*255)};if(n.clips)for(let T=0,A=0;T<c;++T,A+=s*4)for(let F=0,B=0;F<s;F++,B+=4){const U=F/(s-1),{start:j,end:$}=n.clips[T],st=j*(1-U)+$*U;b(A,B,st)}else for(let T=0,A=0;T<s;T++,A+=4){const F=T/(s-1);b(0,A,F)}return y}const kp="big-fb";class wm extends Ps{createBucket(r){return new vm(r)}constructor(r){super(r,v_),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){const r=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=bm({expression:r,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(kp)&&this.heatmapFbos.delete(kp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Fp;const x_=()=>Fp=Fp||new Pa({"hillshade-illumination-direction":new Xe(Ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xe(Ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xe(Ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xe(Ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xe(Ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xe(Ht.paint_hillshade["hillshade-accent-color"])});var b_={get paint(){return x_()}};class w_ extends Ps{constructor(r){super(r,b_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const S_=l([{name:"a_pos",components:2,type:"Int16"}],4),{members:T_,size:Bg,alignment:Og}=S_;function Sm(n,r,s=2){const c=r&&r.length,y=c?r[0]*s:n.length;let b=pf(n,0,y,s,!0);const T=[];if(!b||b.next===b.prev)return T;let A,F,B;if(c&&(b=I_(n,r,b,s)),n.length>80*s){A=1/0,F=1/0;let U=-1/0,j=-1/0;for(let $=s;$<y;$+=s){const st=n[$],ct=n[$+1];st<A&&(A=st),ct<F&&(F=ct),st>U&&(U=st),ct>j&&(j=ct)}B=Math.max(U-A,j-F),B=B!==0?32767/B:0}return kd(b,T,s,A,F,B,0),T}function pf(n,r,s,c,y){let b;if(y===L_(n,r,s,c)>0)for(let T=r;T<s;T+=c)b=Op(T/c|0,n[T],n[T+1],b);else for(let T=s-c;T>=r;T-=c)b=Op(T/c|0,n[T],n[T+1],b);return b&&ep(b,b.next)&&(Wn(b),b=b.next),b}function mf(n,r){if(!n)return n;r||(r=n);let s=n,c;do if(c=!1,!s.steiner&&(ep(s,s.next)||wn(s.prev,s,s.next)===0)){if(Wn(s),s=r=s.prev,s===s.next)break;c=!0}else s=s.next;while(c||s!==r);return r}function kd(n,r,s,c,y,b,T){if(!n)return;!T&&b&&Tm(n,c,y,b);let A=n;for(;n.prev!==n.next;){const F=n.prev,B=n.next;if(b?Fd(n,c,y,b):Lp(n)){r.push(F.i,n.i,B.i),Wn(n),n=B.next,A=B.next;continue}if(n=B,n===A){T?T===1?(n=Iu(mf(n),r),kd(n,r,s,c,y,b,2)):T===2&&E_(n,r,s,c,y,b):kd(mf(n),r,s,c,y,b,1);break}}}function Lp(n){const r=n.prev,s=n,c=n.next;if(wn(r,s,c)>=0)return!1;const y=r.x,b=s.x,T=c.x,A=r.y,F=s.y,B=c.y,U=y<b?y<T?y:T:b<T?b:T,j=A<F?A<B?A:B:F<B?F:B,$=y>b?y>T?y:T:b>T?b:T,st=A>F?A>B?A:B:F>B?F:B;let ct=c.next;for(;ct!==r;){if(ct.x>=U&&ct.x<=$&&ct.y>=j&&ct.y<=st&&Yf(y,A,b,F,T,B,ct.x,ct.y)&&wn(ct.prev,ct,ct.next)>=0)return!1;ct=ct.next}return!0}function Fd(n,r,s,c){const y=n.prev,b=n,T=n.next;if(wn(y,b,T)>=0)return!1;const A=y.x,F=b.x,B=T.x,U=y.y,j=b.y,$=T.y,st=A<F?A<B?A:B:F<B?F:B,ct=U<j?U<$?U:$:j<$?j:$,yt=A>F?A>B?A:B:F>B?F:B,At=U>j?U>$?U:$:j>$?j:$,Ut=Rp(st,ct,r,s,c),re=Rp(yt,At,r,s,c);let Yt=n.prevZ,te=n.nextZ;for(;Yt&&Yt.z>=Ut&&te&&te.z<=re;){if(Yt.x>=st&&Yt.x<=yt&&Yt.y>=ct&&Yt.y<=At&&Yt!==y&&Yt!==T&&Yf(A,U,F,j,B,$,Yt.x,Yt.y)&&wn(Yt.prev,Yt,Yt.next)>=0||(Yt=Yt.prevZ,te.x>=st&&te.x<=yt&&te.y>=ct&&te.y<=At&&te!==y&&te!==T&&Yf(A,U,F,j,B,$,te.x,te.y)&&wn(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;Yt&&Yt.z>=Ut;){if(Yt.x>=st&&Yt.x<=yt&&Yt.y>=ct&&Yt.y<=At&&Yt!==y&&Yt!==T&&Yf(A,U,F,j,B,$,Yt.x,Yt.y)&&wn(Yt.prev,Yt,Yt.next)>=0)return!1;Yt=Yt.prevZ}for(;te&&te.z<=re;){if(te.x>=st&&te.x<=yt&&te.y>=ct&&te.y<=At&&te!==y&&te!==T&&Yf(A,U,F,j,B,$,te.x,te.y)&&wn(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function Iu(n,r){let s=n;do{const c=s.prev,y=s.next.next;!ep(c,y)&&Em(c,s,s.next,y)&&Bd(c,y)&&Bd(y,c)&&(r.push(c.i,s.i,y.i),Wn(s),Wn(s.next),s=n=y),s=s.next}while(s!==n);return mf(s)}function E_(n,r,s,c,y,b){let T=n;do{let A=T.next.next;for(;A!==T.prev;){if(T.i!==A.i&&D_(T,A)){let F=Bp(T,A);T=mf(T,T.next),F=mf(F,F.next),kd(T,r,s,c,y,b,0),kd(F,r,s,c,y,b,0);return}A=A.next}T=T.next}while(T!==n)}function I_(n,r,s,c){const y=[];for(let b=0,T=r.length;b<T;b++){const A=r[b]*c,F=b<T-1?r[b+1]*c:n.length,B=pf(n,A,F,c,!1);B===B.next&&(B.steiner=!0),y.push(z_(B))}y.sort(C_);for(let b=0;b<y.length;b++)s=P_(y[b],s);return s}function C_(n,r){return n.x-r.x}function P_(n,r){const s=A_(n,r);if(!s)return r;const c=Bp(s,n);return mf(c,c.next),mf(s,s.next)}function A_(n,r){let s=r;const c=n.x,y=n.y;let b=-1/0,T;do{if(y<=s.y&&y>=s.next.y&&s.next.y!==s.y){const j=s.x+(y-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(j<=c&&j>b&&(b=j,T=s.x<s.next.x?s:s.next,j===c))return T}s=s.next}while(s!==r);if(!T)return null;const A=T,F=T.x,B=T.y;let U=1/0;s=T;do{if(c>=s.x&&s.x>=F&&c!==s.x&&Yf(y<B?c:b,y,F,B,y<B?b:c,y,s.x,s.y)){const j=Math.abs(y-s.y)/(c-s.x);Bd(s,n)&&(j<U||j===U&&(s.x>T.x||s.x===T.x&&Ld(T,s)))&&(T=s,U=j)}s=s.next}while(s!==A);return T}function Ld(n,r){return wn(n.prev,n,r.prev)<0&&wn(r.next,n,n.next)<0}function Tm(n,r,s,c){let y=n;do y.z===0&&(y.z=Rp(y.x,y.y,r,s,c)),y.prevZ=y.prev,y.nextZ=y.next,y=y.next;while(y!==n);y.prevZ.nextZ=null,y.prevZ=null,M_(y)}function M_(n){let r,s=1;do{let c=n,y;n=null;let b=null;for(r=0;c;){r++;let T=c,A=0;for(let B=0;B<s&&(A++,T=T.nextZ,!!T);B++);let F=s;for(;A>0||F>0&&T;)A!==0&&(F===0||!T||c.z<=T.z)?(y=c,c=c.nextZ,A--):(y=T,T=T.nextZ,F--),b?b.nextZ=y:n=y,y.prevZ=b,b=y;c=T}b.nextZ=null,s*=2}while(r>1);return n}function Rp(n,r,s,c,y){return n=(n-s)*y|0,r=(r-c)*y|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,n|r<<1}function z_(n){let r=n,s=n;do(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next;while(r!==n);return s}function Yf(n,r,s,c,y,b,T,A){return(y-T)*(r-A)>=(n-T)*(b-A)&&(n-T)*(c-A)>=(s-T)*(r-A)&&(s-T)*(b-A)>=(y-T)*(c-A)}function D_(n,r){return n.next.i!==r.i&&n.prev.i!==r.i&&!k_(n,r)&&(Bd(n,r)&&Bd(r,n)&&F_(n,r)&&(wn(n.prev,n,r.prev)||wn(n,r.prev,r))||ep(n,r)&&wn(n.prev,n,n.next)>0&&wn(r.prev,r,r.next)>0)}function wn(n,r,s){return(r.y-n.y)*(s.x-r.x)-(r.x-n.x)*(s.y-r.y)}function ep(n,r){return n.x===r.x&&n.y===r.y}function Em(n,r,s,c){const y=ip(wn(n,r,s)),b=ip(wn(n,r,c)),T=ip(wn(s,c,n)),A=ip(wn(s,c,r));return!!(y!==b&&T!==A||y===0&&Rd(n,s,r)||b===0&&Rd(n,c,r)||T===0&&Rd(s,n,c)||A===0&&Rd(s,r,c))}function Rd(n,r,s){return r.x<=Math.max(n.x,s.x)&&r.x>=Math.min(n.x,s.x)&&r.y<=Math.max(n.y,s.y)&&r.y>=Math.min(n.y,s.y)}function ip(n){return n>0?1:n<0?-1:0}function k_(n,r){let s=n;do{if(s.i!==n.i&&s.next.i!==n.i&&s.i!==r.i&&s.next.i!==r.i&&Em(s,s.next,n,r))return!0;s=s.next}while(s!==n);return!1}function Bd(n,r){return wn(n.prev,n,n.next)<0?wn(n,r,n.next)>=0&&wn(n,n.prev,r)>=0:wn(n,r,n.prev)<0||wn(n,n.next,r)<0}function F_(n,r){let s=n,c=!1;const y=(n.x+r.x)/2,b=(n.y+r.y)/2;do s.y>b!=s.next.y>b&&s.next.y!==s.y&&y<(s.next.x-s.x)*(b-s.y)/(s.next.y-s.y)+s.x&&(c=!c),s=s.next;while(s!==n);return c}function Bp(n,r){const s=Vp(n.i,n.x,n.y),c=Vp(r.i,r.x,r.y),y=n.next,b=r.prev;return n.next=r,r.prev=n,s.next=y,y.prev=s,c.next=s,s.prev=c,b.next=c,c.prev=b,c}function Op(n,r,s,c){const y=Vp(n,r,s);return c?(y.next=c.next,y.prev=c,c.next.prev=y,c.next=y):(y.prev=y,y.next=y),y}function Wn(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Vp(n,r,s){return{i:n,x:r,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function L_(n,r,s,c){let y=0;for(let b=r,T=s-c;b<s;b+=c)y+=(n[T]-n[b])*(n[b+1]+n[T+1]),T=b;return y}function rp(n,r,s){const c=s.patternDependencies;let y=!1;for(const b of r){const T=b.paint.get(`${n}-pattern`);T.isConstant()||(y=!0);const A=T.constantOr(null);A&&(y=!0,c[A.to]=!0,c[A.from]=!0)}return y}function Up(n,r,s,c,y){const b=y.patternDependencies;for(const T of r){const F=T.paint.get(`${n}-pattern`).value;if(F.kind!=="constant"){let B=F.evaluate({zoom:c-1},s,{},y.availableImages),U=F.evaluate({zoom:c},s,{},y.availableImages),j=F.evaluate({zoom:c+1},s,{},y.availableImages);B=B&&B.name?B.name:B,U=U&&U.name?U.name:U,j=j&&j.name?j.name:j,b[B]=!0,b[U]=!0,b[j]=!0,s.patterns[T.id]={min:B,mid:U,max:j}}}return s}const Im=500;class Np{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new cn,this.indexArray=new $a,this.indexArray2=new fs,this.programConfigurations=new Le(r.layers,r.zoom),this.segments=new lr,this.segments2=new lr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,c){this.hasPattern=rp("fill",this.layers,s);const y=this.layers[0].layout.get("fill-sort-key"),b=!y.isConstant(),T=[];for(const{feature:A,id:F,index:B,sourceLayerIndex:U}of r){const j=this.layers[0]._featureFilter.needGeometry,$=Hr(A,j);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom),$,c))continue;const st=b?y.evaluate($,{},c,s.availableImages):void 0,ct={id:F,properties:A.properties,type:A.type,sourceLayerIndex:U,index:B,geometry:j?$.geometry:Ni(A),patterns:{},sortKey:st};T.push(ct)}b&&T.sort((A,F)=>A.sortKey-F.sortKey);for(const A of T){const{geometry:F,index:B,sourceLayerIndex:U}=A;if(this.hasPattern){const $=Up("fill",this.layers,A,this.zoom,s);this.patternFeatures.push($)}else this.addFeature(A,F,B,c,{});const j=r[B].feature;s.featureIndex.insert(j,F,B,U,this.index)}}update(r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c)}addFeatures(r,s,c){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,T_),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,s,c,y,b){for(const T of Jh(s,Im)){let A=0;for(const st of T)A+=st.length;const F=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),B=F.vertexLength,U=[],j=[];for(const st of T){if(st.length===0)continue;st!==T[0]&&j.push(U.length/2);const ct=this.segments2.prepareSegment(st.length,this.layoutVertexArray,this.indexArray2),yt=ct.vertexLength;this.layoutVertexArray.emplaceBack(st[0].x,st[0].y),this.indexArray2.emplaceBack(yt+st.length-1,yt),U.push(st[0].x),U.push(st[0].y);for(let At=1;At<st.length;At++)this.layoutVertexArray.emplaceBack(st[At].x,st[At].y),this.indexArray2.emplaceBack(yt+At-1,yt+At),U.push(st[At].x),U.push(st[At].y);ct.vertexLength+=st.length,ct.primitiveLength+=st.length}const $=Sm(U,j);for(let st=0;st<$.length;st+=3)this.indexArray.emplaceBack(B+$[st],B+$[st+1],B+$[st+2]);F.vertexLength+=A,F.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,b,y)}}Xt("FillBucket",Np,{omit:["layers","patternFeatures"]});let qp;const R_=()=>qp=qp||new Pa({"fill-sort-key":new Ye(Ht.layout_fill["fill-sort-key"])});let Cm;const B_=()=>Cm=Cm||new Pa({"fill-antialias":new Xe(Ht.paint_fill["fill-antialias"]),"fill-opacity":new Ye(Ht.paint_fill["fill-opacity"]),"fill-color":new Ye(Ht.paint_fill["fill-color"]),"fill-outline-color":new Ye(Ht.paint_fill["fill-outline-color"]),"fill-translate":new Xe(Ht.paint_fill["fill-translate"]),"fill-translate-anchor":new Xe(Ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new $u(Ht.paint_fill["fill-pattern"])});var O_={get paint(){return B_()},get layout(){return R_()}};class Pm extends Ps{constructor(r){super(r,O_)}recalculate(r,s){super.recalculate(r,s);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Np(r)}queryRadius(){return Co(this.paint.get("fill-translate"))}queryIntersectsFeature(r,s,c,y,b,T,A){const F=$s(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,A);return ul(F,y)}isTileClipped(){return!0}}const V_=l([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),U_=l([{name:"a_centroid",components:2,type:"Int16"}],4),{members:N_,size:Vg,alignment:np}=V_;var wc={},la=Yr,Am=Jf;function Jf(n,r,s,c,y){this.properties={},this.extent=s,this.type=0,this._pbf=n,this._geometry=-1,this._keys=c,this._values=y,n.readFields(ap,this,r)}function ap(n,r,s){n==1?r.id=s.readVarint():n==2?sp(s,r):n==3?r.type=s.readVarint():n==4&&(r._geometry=s.pos)}function sp(n,r){for(var s=n.readVarint()+n.pos;n.pos<s;){var c=r._keys[n.readVarint()],y=r._values[n.readVarint()];r.properties[c]=y}}Jf.types=["Unknown","Point","LineString","Polygon"],Jf.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var r=n.readVarint()+n.pos,s=1,c=0,y=0,b=0,T=[],A;n.pos<r;){if(c<=0){var F=n.readVarint();s=F&7,c=F>>3}if(c--,s===1||s===2)y+=n.readSVarint(),b+=n.readSVarint(),s===1&&(A&&T.push(A),A=[]),A.push(new la(y,b));else if(s===7)A&&A.push(A[0].clone());else throw new Error("unknown command "+s)}return A&&T.push(A),T},Jf.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var r=n.readVarint()+n.pos,s=1,c=0,y=0,b=0,T=1/0,A=-1/0,F=1/0,B=-1/0;n.pos<r;){if(c<=0){var U=n.readVarint();s=U&7,c=U>>3}if(c--,s===1||s===2)y+=n.readSVarint(),b+=n.readSVarint(),y<T&&(T=y),y>A&&(A=y),b<F&&(F=b),b>B&&(B=b);else if(s!==7)throw new Error("unknown command "+s)}return[T,F,A,B]},Jf.prototype.toGeoJSON=function(n,r,s){var c=this.extent*Math.pow(2,s),y=this.extent*n,b=this.extent*r,T=this.loadGeometry(),A=Jf.types[this.type],F,B;function U(st){for(var ct=0;ct<st.length;ct++){var yt=st[ct],At=180-(yt.y+b)*360/c;st[ct]=[(yt.x+y)*360/c-180,360/Math.PI*Math.atan(Math.exp(At*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(F=0;F<T.length;F++)j[F]=T[F][0];T=j,U(T);break;case 2:for(F=0;F<T.length;F++)U(T[F]);break;case 3:for(T=Sr(T),F=0;F<T.length;F++)for(B=0;B<T[F].length;B++)U(T[F][B]);break}T.length===1?T=T[0]:A="Multi"+A;var $={type:"Feature",geometry:{type:A,coordinates:T},properties:this.properties};return"id"in this&&($.id=this.id),$};function Sr(n){var r=n.length;if(r<=1)return[n];for(var s=[],c,y,b=0;b<r;b++){var T=Zp(n[b]);T!==0&&(y===void 0&&(y=T<0),y===T<0?(c&&s.push(c),c=[n[b]]):c.push(n[b]))}return c&&s.push(c),s}function Zp(n){for(var r=0,s=0,c=n.length,y=c-1,b,T;s<c;y=s++)b=n[s],T=n[y],r+=(T.x-b.x)*(b.y+T.y);return r}var Mm=Am,zm=jp;function jp(n,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(q_,this,r),this.length=this._features.length}function q_(n,r,s){n===15?r.version=s.readVarint():n===1?r.name=s.readString():n===5?r.extent=s.readVarint():n===2?r._features.push(s.pos):n===3?r._keys.push(s.readString()):n===4&&r._values.push(zh(s))}function zh(n){for(var r=null,s=n.readVarint()+n.pos;n.pos<s;){var c=n.readVarint()>>3;r=c===1?n.readString():c===2?n.readFloat():c===3?n.readDouble():c===4?n.readVarint64():c===5?n.readVarint():c===6?n.readSVarint():c===7?n.readBoolean():null}return r}jp.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var r=this._pbf.readVarint()+this._pbf.pos;return new Mm(this._pbf,r,this.extent,this._keys,this._values)};var Qf=zm,Z_=j_;function j_(n,r){this.layers=n.readFields(G_,{},r)}function G_(n,r,s){if(n===3){var c=new Qf(s,s.readVarint()+s.pos);c.length&&(r[c.name]=c)}}wc.VectorTile=Z_,wc.VectorTileFeature=Am,wc.VectorTileLayer=zm;const Dm=wc.VectorTileFeature.types,H_=500,Gp=Math.pow(2,13);function Od(n,r,s,c,y,b,T,A){n.emplaceBack(r,s,Math.floor(c*Gp)*2+T,y*Gp*2,b*Gp*2,Math.round(A))}class Hp{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new As,this.centroidVertexArray=new ir,this.indexArray=new $a,this.programConfigurations=new Le(r.layers,r.zoom),this.segments=new lr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,c){this.features=[],this.hasPattern=rp("fill-extrusion",this.layers,s);for(const{feature:y,id:b,index:T,sourceLayerIndex:A}of r){const F=this.layers[0]._featureFilter.needGeometry,B=Hr(y,F);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom),B,c))continue;const U={id:b,sourceLayerIndex:A,index:T,geometry:F?B.geometry:Ni(y),properties:y.properties,type:y.type,patterns:{}};this.hasPattern?this.features.push(Up("fill-extrusion",this.layers,U,this.zoom,s)):this.addFeature(U,U.geometry,T,c,{}),s.featureIndex.insert(y,U.geometry,T,A,this.index,!0)}}addFeatures(r,s,c){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,s,c)}}update(r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,N_),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,U_.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,s,c,y,b){for(const T of Jh(s,H_)){const A={x:0,y:0,vertexCount:0};let F=0;for(const ct of T)F+=ct.length;let B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ct of T){if(ct.length===0||W_(ct))continue;let yt=0;for(let At=0;At<ct.length;At++){const Ut=ct[At];if(At>=1){const re=ct[At-1];if(!X_(Ut,re)){B.vertexLength+4>lr.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Yt=Ut.sub(re)._perp()._unit(),te=re.dist(Ut);yt+te>32768&&(yt=0),Od(this.layoutVertexArray,Ut.x,Ut.y,Yt.x,Yt.y,0,0,yt),Od(this.layoutVertexArray,Ut.x,Ut.y,Yt.x,Yt.y,0,1,yt),A.x+=2*Ut.x,A.y+=2*Ut.y,A.vertexCount+=2,yt+=te,Od(this.layoutVertexArray,re.x,re.y,Yt.x,Yt.y,0,0,yt),Od(this.layoutVertexArray,re.x,re.y,Yt.x,Yt.y,0,1,yt),A.x+=2*re.x,A.y+=2*re.y,A.vertexCount+=2;const de=B.vertexLength;this.indexArray.emplaceBack(de,de+2,de+1),this.indexArray.emplaceBack(de+1,de+2,de+3),B.vertexLength+=4,B.primitiveLength+=2}}}}if(B.vertexLength+F>lr.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),Dm[r.type]!=="Polygon")continue;const U=[],j=[],$=B.vertexLength;for(const ct of T)if(ct.length!==0){ct!==T[0]&&j.push(U.length/2);for(let yt=0;yt<ct.length;yt++){const At=ct[yt];Od(this.layoutVertexArray,At.x,At.y,0,0,1,1,0),A.x+=At.x,A.y+=At.y,A.vertexCount+=1,U.push(At.x),U.push(At.y)}}const st=Sm(U,j);for(let ct=0;ct<st.length;ct+=3)this.indexArray.emplaceBack($+st[ct],$+st[ct+2],$+st[ct+1]);B.primitiveLength+=st.length/3,B.vertexLength+=F;for(let ct=0;ct<A.vertexCount;ct++){const yt=Math.floor(A.x/A.vertexCount),At=Math.floor(A.y/A.vertexCount);this.centroidVertexArray.emplaceBack(yt,At)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,b,y)}}Xt("FillExtrusionBucket",Hp,{omit:["layers","features"]});function X_(n,r){return n.x===r.x&&(n.x<0||n.x>ye)||n.y===r.y&&(n.y<0||n.y>ye)}function W_(n){return n.every(r=>r.x<0)||n.every(r=>r.x>ye)||n.every(r=>r.y<0)||n.every(r=>r.y>ye)}let km;const K_=()=>km=km||new Pa({"fill-extrusion-opacity":new Xe(Ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ye(Ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xe(Ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xe(Ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $u(Ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ye(Ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ye(Ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xe(Ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])});var Y_={get paint(){return K_()}};class op extends Ps{constructor(r){super(r,Y_)}createBucket(r){return new Hp(r)}queryRadius(){return Co(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(r,s,c,y,b,T,A,F){const B=$s(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,A),U=this.paint.get("fill-extrusion-height").evaluate(s,c),j=this.paint.get("fill-extrusion-base").evaluate(s,c),$=$_(B,F,T,0),st=Q_(y,j,U,F),ct=st[0],yt=st[1];return J_(ct,yt,$)}}function rh(n,r){return n.x*r.x+n.y*r.y}function Xp(n,r){if(n.length===1){let s=0;const c=r[s++];let y;for(;!y||c.equals(y);)if(y=r[s++],!y)return 1/0;for(;s<r.length;s++){const b=r[s],T=n[0],A=y.sub(c),F=b.sub(c),B=T.sub(c),U=rh(A,A),j=rh(A,F),$=rh(F,F),st=rh(B,A),ct=rh(B,F),yt=U*$-j*j,At=($*st-j*ct)/yt,Ut=(U*ct-j*st)/yt,re=1-At-Ut,Yt=c.z*re+y.z*At+b.z*Ut;if(isFinite(Yt))return Yt}return 1/0}else{let s=1/0;for(const c of r)s=Math.min(s,c.z);return s}}function J_(n,r,s){let c=1/0;ul(s,r)&&(c=Xp(s,r[0]));for(let y=0;y<r.length;y++){const b=r[y],T=n[y];for(let A=0;A<b.length-1;A++){const F=b[A],B=b[A+1],U=T[A],j=T[A+1],$=[F,B,j,U,F];Rr(s,$)&&(c=Math.min(c,Xp(s,$)))}}return c===1/0?!1:c}function Q_(n,r,s,c){const y=[],b=[],T=c[8]*r,A=c[9]*r,F=c[10]*r,B=c[11]*r,U=c[8]*s,j=c[9]*s,$=c[10]*s,st=c[11]*s;for(const ct of n){const yt=[],At=[];for(const Ut of ct){const re=Ut.x,Yt=Ut.y,te=c[0]*re+c[4]*Yt+c[12],de=c[1]*re+c[5]*Yt+c[13],qe=c[2]*re+c[6]*Yt+c[14],$e=c[3]*re+c[7]*Yt+c[15],yi=te+T,hi=de+A,je=qe+F,ci=$e+B,Qe=te+U,li=de+j,be=qe+$,He=$e+st,ai=new pe(yi/ci,hi/ci);ai.z=je/ci,yt.push(ai);const Hi=new pe(Qe/He,li/He);Hi.z=be/He,At.push(Hi)}y.push(yt),b.push(At)}return[y,b]}function $_(n,r,s,c){const y=[];for(const b of n){const T=[b.x,b.y,c,1];Kf(T,T,r),y.push(new pe(T[0]/T[3],T[1]/T[3]))}return y}const Wp=l([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:tg,size:Ug,alignment:Ng}=Wp,eg=l([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ig,size:rg,alignment:Po}=eg,lp=wc.VectorTileFeature.types,$f=63,Vd=Math.cos(75/2*(Math.PI/180)),Ao=15,Ud=20,ng=15,Kp=1/2,Yp=Math.pow(2,ng-1)/Kp;class Sc{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new cs,this.layoutVertexArray2=new Aa,this.indexArray=new $a,this.programConfigurations=new Le(r.layers,r.zoom),this.segments=new lr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,c){this.hasPattern=rp("line",this.layers,s);const y=this.layers[0].layout.get("line-sort-key"),b=!y.isConstant(),T=[];for(const{feature:A,id:F,index:B,sourceLayerIndex:U}of r){const j=this.layers[0]._featureFilter.needGeometry,$=Hr(A,j);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom),$,c))continue;const st=b?y.evaluate($,{},c):void 0,ct={id:F,properties:A.properties,type:A.type,sourceLayerIndex:U,index:B,geometry:j?$.geometry:Ni(A),patterns:{},sortKey:st};T.push(ct)}b&&T.sort((A,F)=>A.sortKey-F.sortKey);for(const A of T){const{geometry:F,index:B,sourceLayerIndex:U}=A;if(this.hasPattern){const $=Up("line",this.layers,A,this.zoom,s);this.patternFeatures.push($)}else this.addFeature(A,F,B,c,{});const j=r[B].feature;s.featureIndex.insert(j,F,B,U,this.index)}}update(r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c)}addFeatures(r,s,c){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,ig)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,tg),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end")){const s=+r.properties.mapbox_clip_start,c=+r.properties.mapbox_clip_end;return{start:s,end:c}}}addFeature(r,s,c,y,b){const T=this.layers[0].layout,A=T.get("line-join").evaluate(r,{}),F=T.get("line-cap"),B=T.get("line-miter-limit"),U=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const j of s)this.addLine(j,r,A,F,B,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,b,y)}addLine(r,s,c,y,b,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ut=0;Ut<r.length-1;Ut++)this.totalDistance+=r[Ut].dist(r[Ut+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=lp[s.type]==="Polygon";let F=r.length;for(;F>=2&&r[F-1].equals(r[F-2]);)F--;let B=0;for(;B<F-1&&r[B].equals(r[B+1]);)B++;if(F<(A?3:2))return;c==="bevel"&&(b=1.05);const U=this.overscaling<=16?Ao*ye/(512*this.overscaling):0,j=this.segments.prepareSegment(F*10,this.layoutVertexArray,this.indexArray);let $,st,ct,yt,At;this.e1=this.e2=-1,A&&($=r[F-2],At=r[B].sub($)._unit()._perp());for(let Ut=B;Ut<F;Ut++){if(ct=Ut===F-1?A?r[B+1]:void 0:r[Ut+1],ct&&r[Ut].equals(ct))continue;At&&(yt=At),$&&(st=$),$=r[Ut],At=ct?ct.sub($)._unit()._perp():yt,yt=yt||At;let re=yt.add(At);(re.x!==0||re.y!==0)&&re._unit();const Yt=yt.x*At.x+yt.y*At.y,te=re.x*At.x+re.y*At.y,de=te!==0?1/te:1/0,qe=2*Math.sqrt(2-2*te),$e=te<Vd&&st&&ct,yi=yt.x*At.y-yt.y*At.x>0;if($e&&Ut>B){const ci=$.dist(st);if(ci>2*U){const Qe=$.sub($.sub(st)._mult(U/ci)._round());this.updateDistance(st,Qe),this.addCurrentVertex(Qe,yt,0,0,j),st=Qe}}const hi=st&&ct;let je=hi?c:A?"butt":y;if(hi&&je==="round"&&(de<T?je="miter":de<=2&&(je="fakeround")),je==="miter"&&de>b&&(je="bevel"),je==="bevel"&&(de>2&&(je="flipbevel"),de<b&&(je="miter")),st&&this.updateDistance(st,$),je==="miter")re._mult(de),this.addCurrentVertex($,re,0,0,j);else if(je==="flipbevel"){if(de>100)re=At.mult(-1);else{const ci=de*yt.add(At).mag()/yt.sub(At).mag();re._perp()._mult(ci*(yi?-1:1))}this.addCurrentVertex($,re,0,0,j),this.addCurrentVertex($,re.mult(-1),0,0,j)}else if(je==="bevel"||je==="fakeround"){const ci=-Math.sqrt(de*de-1),Qe=yi?ci:0,li=yi?0:ci;if(st&&this.addCurrentVertex($,yt,Qe,li,j),je==="fakeround"){const be=Math.round(qe*180/Math.PI/Ud);for(let He=1;He<be;He++){let ai=He/be;if(ai!==.5){const pn=ai-.5,no=1.0904+Yt*(-3.2452+Yt*(3.55645-Yt*1.43519)),Cr=.848013+Yt*(-1.06021+Yt*.215638);ai=ai+ai*pn*(ai-1)*(no*pn*pn+Cr)}const Hi=At.sub(yt)._mult(ai)._add(yt)._unit()._mult(yi?-1:1);this.addHalfVertex($,Hi.x,Hi.y,!1,yi,0,j)}}ct&&this.addCurrentVertex($,At,-Qe,-li,j)}else if(je==="butt")this.addCurrentVertex($,re,0,0,j);else if(je==="square"){const ci=st?1:-1;this.addCurrentVertex($,re,ci,ci,j)}else je==="round"&&(st&&(this.addCurrentVertex($,yt,0,0,j),this.addCurrentVertex($,yt,1,1,j,!0)),ct&&(this.addCurrentVertex($,At,-1,-1,j,!0),this.addCurrentVertex($,At,0,0,j)));if($e&&Ut<F-1){const ci=$.dist(ct);if(ci>2*U){const Qe=$.add(ct.sub($)._mult(U/ci)._round());this.updateDistance($,Qe),this.addCurrentVertex(Qe,At,0,0,j),$=Qe}}}}addCurrentVertex(r,s,c,y,b,T=!1){const A=s.x+s.y*c,F=s.y-s.x*c,B=-s.x+s.y*y,U=-s.y-s.x*y;this.addHalfVertex(r,A,F,T,!1,c,b),this.addHalfVertex(r,B,U,T,!0,-y,b),this.distance>Yp/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,s,c,y,b,T))}addHalfVertex({x:r,y:s},c,y,b,T,A,F){const U=(this.lineClips?this.scaledDistance*(Yp-1):this.scaledDistance)*Kp;if(this.layoutVertexArray.emplaceBack((r<<1)+(b?1:0),(s<<1)+(T?1:0),Math.round($f*c)+128,Math.round($f*y)+128,(A===0?0:A<0?-1:1)+1|(U&63)<<2,U>>6),this.lineClips){const $=this.scaledDistance-this.lineClips.start,st=this.lineClips.end-this.lineClips.start,ct=$/st;this.layoutVertexArray2.emplaceBack(ct,this.lineClipsArray.length)}const j=F.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),F.primitiveLength++),T?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,s){this.distance+=r.dist(s),this.updateScaledDistance()}}Xt("LineBucket",Sc,{omit:["layers","patternFeatures"]});let ka;const ag=()=>ka=ka||new Pa({"line-cap":new Xe(Ht.layout_line["line-cap"]),"line-join":new Ye(Ht.layout_line["line-join"]),"line-miter-limit":new Xe(Ht.layout_line["line-miter-limit"]),"line-round-limit":new Xe(Ht.layout_line["line-round-limit"]),"line-sort-key":new Ye(Ht.layout_line["line-sort-key"])});let Nd;const nh=()=>Nd=Nd||new Pa({"line-opacity":new Ye(Ht.paint_line["line-opacity"]),"line-color":new Ye(Ht.paint_line["line-color"]),"line-translate":new Xe(Ht.paint_line["line-translate"]),"line-translate-anchor":new Xe(Ht.paint_line["line-translate-anchor"]),"line-width":new Ye(Ht.paint_line["line-width"]),"line-gap-width":new Ye(Ht.paint_line["line-gap-width"]),"line-offset":new Ye(Ht.paint_line["line-offset"]),"line-blur":new Ye(Ht.paint_line["line-blur"]),"line-dasharray":new ll(Ht.paint_line["line-dasharray"]),"line-pattern":new $u(Ht.paint_line["line-pattern"]),"line-gradient":new _c(Ht.paint_line["line-gradient"])});var zs={get paint(){return nh()},get layout(){return ag()}};class Fm extends Ye{possiblyEvaluate(r,s){return s=new gr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(r,s)}evaluate(r,s,c,y){return s=da({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(r,s,c,y)}}let up;class Lm extends Ps{constructor(r){super(r,zs),this.gradientVersion=0,up||(up=new Fm(zs.paint.properties["line-width"].specification),up.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const s=this.gradientExpression();tf(s)?this.stepInterpolant=s._styleExpression.expression instanceof fh:this.stepInterpolant=!1,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,s){super.recalculate(r,s),this.paint._values["line-floorwidth"]=up.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Sc(r)}queryRadius(r){const s=r,c=Rm(Hl("line-width",this,s),Hl("line-gap-width",this,s)),y=Hl("line-offset",this,s);return c/2+Math.abs(y)+Co(this.paint.get("line-translate"))}queryIntersectsFeature(r,s,c,y,b,T,A){const F=$s(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,A),B=A/2*Rm(this.paint.get("line-width").evaluate(s,c),this.paint.get("line-gap-width").evaluate(s,c)),U=this.paint.get("line-offset").evaluate(s,c);return U&&(y=eh(y,U*A)),ds(F,y,B)}isTileClipped(){return!0}}function Rm(n,r){return r>0?r+2*n:n}const Bm=l([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Om=l([{name:"a_projected_pos",components:3,type:"Float32"}],4);l([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jp=l([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);l([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const hp=l([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sg=l([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);l([{name:"triangle",components:3,type:"Uint16"}]),l([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),l([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),l([{type:"Float32",name:"offsetX"}]),l([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),l([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);function og(n,r,s){const c=r.layout.get("text-transform").evaluate(s,{});return c==="uppercase"?n=n.toLocaleUpperCase():c==="lowercase"&&(n=n.toLocaleLowerCase()),Ln.applyArabicShaping&&(n=Ln.applyArabicShaping(n)),n}function lg(n,r,s){return n.sections.forEach(c=>{c.text=og(c.text,r,s)}),n}function ug(n){const r={},s={},c=[];let y=0;function b(B){c.push(n[B]),y++}function T(B,U,j){const $=s[B];return delete s[B],s[U]=$,c[$].geometry[0].pop(),c[$].geometry[0]=c[$].geometry[0].concat(j[0]),$}function A(B,U,j){const $=r[U];return delete r[U],r[B]=$,c[$].geometry[0].shift(),c[$].geometry[0]=j[0].concat(c[$].geometry[0]),$}function F(B,U,j){const $=j?U[0][U[0].length-1]:U[0][0];return`${B}:${$.x}:${$.y}`}for(let B=0;B<n.length;B++){const U=n[B],j=U.geometry,$=U.text?U.text.toString():null;if(!$){b(B);continue}const st=F($,j),ct=F($,j,!0);if(st in s&&ct in r&&s[st]!==r[ct]){const yt=A(st,ct,j),At=T(st,ct,c[yt].geometry);delete r[st],delete s[ct],s[F($,c[At].geometry,!0)]=At,c[yt].geometry=null}else st in s?T(st,ct,j):ct in r?A(st,ct,j):(b(B),r[st]=y-1,s[ct]=y-1)}return c.filter(B=>B.geometry)}const td={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function ed(n){let r="";for(let s=0;s<n.length;s++){const c=n.charCodeAt(s+1)||null,y=n.charCodeAt(s-1)||null;(!c||!Nl(c)||td[n[s+1]])&&(!y||!Nl(y)||td[n[s-1]])&&td[n[s]]?r+=td[n[s]]:r+=n[s]}return r}var Tr=24,qd={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */qd.read=function(n,r,s,c,y){var b,T,A=y*8-c-1,F=(1<<A)-1,B=F>>1,U=-7,j=s?y-1:0,$=s?-1:1,st=n[r+j];for(j+=$,b=st&(1<<-U)-1,st>>=-U,U+=A;U>0;b=b*256+n[r+j],j+=$,U-=8);for(T=b&(1<<-U)-1,b>>=-U,U+=c;U>0;T=T*256+n[r+j],j+=$,U-=8);if(b===0)b=1-B;else{if(b===F)return T?NaN:(st?-1:1)*(1/0);T=T+Math.pow(2,c),b=b-B}return(st?-1:1)*T*Math.pow(2,b-c)},qd.write=function(n,r,s,c,y,b){var T,A,F,B=b*8-y-1,U=(1<<B)-1,j=U>>1,$=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,st=c?0:b-1,ct=c?1:-1,yt=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(A=isNaN(r)?1:0,T=U):(T=Math.floor(Math.log(r)/Math.LN2),r*(F=Math.pow(2,-T))<1&&(T--,F*=2),T+j>=1?r+=$/F:r+=$*Math.pow(2,1-j),r*F>=2&&(T++,F/=2),T+j>=U?(A=0,T=U):T+j>=1?(A=(r*F-1)*Math.pow(2,y),T=T+j):(A=r*Math.pow(2,j-1)*Math.pow(2,y),T=0));y>=8;n[s+st]=A&255,st+=ct,A/=256,y-=8);for(T=T<<y|A,B+=y;B>0;n[s+st]=T&255,st+=ct,T/=256,B-=8);n[s+st-ct]|=yt*128};var Qp=Er,Zd=qd;function Er(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Er.Varint=0,Er.Fixed64=1,Er.Bytes=2,Er.Fixed32=5;var cp=65536*65536,$p=1/cp,Vm=12,tm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");Er.prototype={destroy:function(){this.buf=null},readFields:function(n,r,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),y=c>>3,b=this.pos;this.type=c&7,n(y,r,this),this.pos===b&&this.skip(c)}return r},readMessage:function(n,r){return this.readFields(n,r,this.readVarint()+this.pos)},readFixed32:function(){var n=kh(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Zm(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=kh(this.buf,this.pos)+kh(this.buf,this.pos+4)*cp;return this.pos+=8,n},readSFixed64:function(){var n=kh(this.buf,this.pos)+Zm(this.buf,this.pos+4)*cp;return this.pos+=8,n},readFloat:function(){var n=Zd.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Zd.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var r=this.buf,s,c;return c=r[this.pos++],s=c&127,c<128||(c=r[this.pos++],s|=(c&127)<<7,c<128)||(c=r[this.pos++],s|=(c&127)<<14,c<128)||(c=r[this.pos++],s|=(c&127)<<21,c<128)?s:(c=r[this.pos],s|=(c&15)<<28,hg(s,n,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2===1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,r=this.pos;return this.pos=n,n-r>=Vm&&tm?em(this.buf,r,n):nd(this.buf,r,n)},readBytes:function(){var n=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,n);return this.pos=n,r},readPackedVarint:function(n,r){if(this.type!==Er.Bytes)return n.push(this.readVarint(r));var s=Dh(this);for(n=n||[];this.pos<s;)n.push(this.readVarint(r));return n},readPackedSVarint:function(n){if(this.type!==Er.Bytes)return n.push(this.readSVarint());var r=Dh(this);for(n=n||[];this.pos<r;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Er.Bytes)return n.push(this.readBoolean());var r=Dh(this);for(n=n||[];this.pos<r;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Er.Bytes)return n.push(this.readFloat());var r=Dh(this);for(n=n||[];this.pos<r;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Er.Bytes)return n.push(this.readDouble());var r=Dh(this);for(n=n||[];this.pos<r;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Er.Bytes)return n.push(this.readFixed32());var r=Dh(this);for(n=n||[];this.pos<r;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Er.Bytes)return n.push(this.readSFixed32());var r=Dh(this);for(n=n||[];this.pos<r;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Er.Bytes)return n.push(this.readFixed64());var r=Dh(this);for(n=n||[];this.pos<r;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Er.Bytes)return n.push(this.readSFixed64());var r=Dh(this);for(n=n||[];this.pos<r;)n.push(this.readSFixed64());return n},skip:function(n){var r=n&7;if(r===Er.Varint)for(;this.buf[this.pos++]>127;);else if(r===Er.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Er.Fixed32)this.pos+=4;else if(r===Er.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+r)},writeTag:function(n,r){this.writeVarint(n<<3|r)},realloc:function(n){for(var r=this.length||16;r<this.pos+n;)r*=2;if(r!==this.length){var s=new Uint8Array(r);s.set(this.buf),this.buf=s,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),rd(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),rd(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),rd(this.buf,n&-1,this.pos),rd(this.buf,Math.floor(n*$p),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),rd(this.buf,n&-1,this.pos),rd(this.buf,Math.floor(n*$p),this.pos+4),this.pos+=8},writeVarint:function(n){if(n=+n||0,n>268435455||n<0){Um(n,this);return}this.realloc(4),this.buf[this.pos++]=n&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=n>>>7&127)))},writeSVarint:function(n){this.writeVarint(n<0?-n*2-1:n*2)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(n.length*4),this.pos++;var r=this.pos;this.pos=jm(this.buf,n,this.pos);var s=this.pos-r;s>=128&&Gd(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeFloat:function(n){this.realloc(4),Zd.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Zd.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var r=n.length;this.writeVarint(r),this.realloc(r);for(var s=0;s<r;s++)this.buf[this.pos++]=n[s]},writeRawMessage:function(n,r){this.pos++;var s=this.pos;n(r,this);var c=this.pos-s;c>=128&&Gd(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(n,r,s){this.writeTag(n,Er.Bytes),this.writeRawMessage(r,s)},writePackedVarint:function(n,r){r.length&&this.writeMessage(n,qm,r)},writePackedSVarint:function(n,r){r.length&&this.writeMessage(n,fp,r)},writePackedBoolean:function(n,r){r.length&&this.writeMessage(n,pp,r)},writePackedFloat:function(n,r){r.length&&this.writeMessage(n,dp,r)},writePackedDouble:function(n,r){r.length&&this.writeMessage(n,cg,r)},writePackedFixed32:function(n,r){r.length&&this.writeMessage(n,id,r)},writePackedSFixed32:function(n,r){r.length&&this.writeMessage(n,fg,r)},writePackedFixed64:function(n,r){r.length&&this.writeMessage(n,dg,r)},writePackedSFixed64:function(n,r){r.length&&this.writeMessage(n,pg,r)},writeBytesField:function(n,r){this.writeTag(n,Er.Bytes),this.writeBytes(r)},writeFixed32Field:function(n,r){this.writeTag(n,Er.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(n,r){this.writeTag(n,Er.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(n,r){this.writeTag(n,Er.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(n,r){this.writeTag(n,Er.Fixed64),this.writeSFixed64(r)},writeVarintField:function(n,r){this.writeTag(n,Er.Varint),this.writeVarint(r)},writeSVarintField:function(n,r){this.writeTag(n,Er.Varint),this.writeSVarint(r)},writeStringField:function(n,r){this.writeTag(n,Er.Bytes),this.writeString(r)},writeFloatField:function(n,r){this.writeTag(n,Er.Fixed32),this.writeFloat(r)},writeDoubleField:function(n,r){this.writeTag(n,Er.Fixed64),this.writeDouble(r)},writeBooleanField:function(n,r){this.writeVarintField(n,!!r)}};function hg(n,r,s){var c=s.buf,y,b;if(b=c[s.pos++],y=(b&112)>>4,b<128||(b=c[s.pos++],y|=(b&127)<<3,b<128)||(b=c[s.pos++],y|=(b&127)<<10,b<128)||(b=c[s.pos++],y|=(b&127)<<17,b<128)||(b=c[s.pos++],y|=(b&127)<<24,b<128)||(b=c[s.pos++],y|=(b&1)<<31,b<128))return _f(n,y,r);throw new Error("Expected varint not more than 10 bytes")}function Dh(n){return n.type===Er.Bytes?n.readVarint()+n.pos:n.pos+1}function _f(n,r,s){return s?r*4294967296+(n>>>0):(r>>>0)*4294967296+(n>>>0)}function Um(n,r){var s,c;if(n>=0?(s=n%4294967296|0,c=n/4294967296|0):(s=~(-n%4294967296),c=~(-n/4294967296),s^4294967295?s=s+1|0:(s=0,c=c+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),jd(s,c,r),Nm(c,r)}function jd(n,r,s){s.buf[s.pos++]=n&127|128,n>>>=7,s.buf[s.pos++]=n&127|128,n>>>=7,s.buf[s.pos++]=n&127|128,n>>>=7,s.buf[s.pos++]=n&127|128,n>>>=7,s.buf[s.pos]=n&127}function Nm(n,r){var s=(n&7)<<4;r.buf[r.pos++]|=s|((n>>>=3)?128:0),n&&(r.buf[r.pos++]=n&127|((n>>>=7)?128:0),n&&(r.buf[r.pos++]=n&127|((n>>>=7)?128:0),n&&(r.buf[r.pos++]=n&127|((n>>>=7)?128:0),n&&(r.buf[r.pos++]=n&127|((n>>>=7)?128:0),n&&(r.buf[r.pos++]=n&127)))))}function Gd(n,r,s){var c=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(Math.LN2*7));s.realloc(c);for(var y=s.pos-1;y>=n;y--)s.buf[y+c]=s.buf[y]}function qm(n,r){for(var s=0;s<n.length;s++)r.writeVarint(n[s])}function fp(n,r){for(var s=0;s<n.length;s++)r.writeSVarint(n[s])}function dp(n,r){for(var s=0;s<n.length;s++)r.writeFloat(n[s])}function cg(n,r){for(var s=0;s<n.length;s++)r.writeDouble(n[s])}function pp(n,r){for(var s=0;s<n.length;s++)r.writeBoolean(n[s])}function id(n,r){for(var s=0;s<n.length;s++)r.writeFixed32(n[s])}function fg(n,r){for(var s=0;s<n.length;s++)r.writeSFixed32(n[s])}function dg(n,r){for(var s=0;s<n.length;s++)r.writeFixed64(n[s])}function pg(n,r){for(var s=0;s<n.length;s++)r.writeSFixed64(n[s])}function kh(n,r){return(n[r]|n[r+1]<<8|n[r+2]<<16)+n[r+3]*16777216}function rd(n,r,s){n[s]=r,n[s+1]=r>>>8,n[s+2]=r>>>16,n[s+3]=r>>>24}function Zm(n,r){return(n[r]|n[r+1]<<8|n[r+2]<<16)+(n[r+3]<<24)}function nd(n,r,s){for(var c="",y=r;y<s;){var b=n[y],T=null,A=b>239?4:b>223?3:b>191?2:1;if(y+A>s)break;var F,B,U;A===1?b<128&&(T=b):A===2?(F=n[y+1],(F&192)===128&&(T=(b&31)<<6|F&63,T<=127&&(T=null))):A===3?(F=n[y+1],B=n[y+2],(F&192)===128&&(B&192)===128&&(T=(b&15)<<12|(F&63)<<6|B&63,(T<=2047||T>=55296&&T<=57343)&&(T=null))):A===4&&(F=n[y+1],B=n[y+2],U=n[y+3],(F&192)===128&&(B&192)===128&&(U&192)===128&&(T=(b&15)<<18|(F&63)<<12|(B&63)<<6|U&63,(T<=65535||T>=1114112)&&(T=null))),T===null?(T=65533,A=1):T>65535&&(T-=65536,c+=String.fromCharCode(T>>>10&1023|55296),T=56320|T&1023),c+=String.fromCharCode(T),y+=A}return c}function em(n,r,s){return tm.decode(n.subarray(r,s))}function jm(n,r,s){for(var c=0,y,b;c<r.length;c++){if(y=r.charCodeAt(c),y>55295&&y<57344)if(b)if(y<56320){n[s++]=239,n[s++]=191,n[s++]=189,b=y;continue}else y=b-55296<<10|y-56320|65536,b=null;else{y>56319||c+1===r.length?(n[s++]=239,n[s++]=191,n[s++]=189):b=y;continue}else b&&(n[s++]=239,n[s++]=191,n[s++]=189,b=null);y<128?n[s++]=y:(y<2048?n[s++]=y>>6|192:(y<65536?n[s++]=y>>12|224:(n[s++]=y>>18|240,n[s++]=y>>12&63|128),n[s++]=y>>6&63|128),n[s++]=y&63|128)}return s}var im=fe(Qp);const Hd=3;function mg(n,r,s){n===1&&s.readMessage(Xd,r)}function Xd(n,r,s){if(n===3){const{id:c,bitmap:y,width:b,height:T,left:A,top:F,advance:B}=s.readMessage(Tc,{});r.push({id:c,bitmap:new Dd({width:b+2*Hd,height:T+2*Hd},y),metrics:{width:b,height:T,left:A,top:F,advance:B}})}}function Tc(n,r,s){n===1?r.id=s.readVarint():n===2?r.bitmap=s.readBytes():n===3?r.width=s.readVarint():n===4?r.height=s.readVarint():n===5?r.left=s.readSVarint():n===6?r.top=s.readSVarint():n===7&&(r.advance=s.readVarint())}function Gm(n){return new im(n).readFields(mg,[])}const Hm=Hd;function Xm(n){let r=0,s=0;for(const A of n)r+=A.w*A.h,s=Math.max(s,A.w);n.sort((A,F)=>F.h-A.h);const y=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),s),h:1/0}];let b=0,T=0;for(const A of n)for(let F=y.length-1;F>=0;F--){const B=y[F];if(!(A.w>B.w||A.h>B.h)){if(A.x=B.x,A.y=B.y,T=Math.max(T,A.y+A.h),b=Math.max(b,A.x+A.w),A.w===B.w&&A.h===B.h){const U=y.pop();F<y.length&&(y[F]=U)}else A.h===B.h?(B.x+=A.w,B.w-=A.w):A.w===B.w?(B.y+=A.h,B.h-=A.h):(y.push({x:B.x+A.w,y:B.y,w:B.w-A.w,h:A.h}),B.y+=A.h,B.h-=A.h);break}}return{w:b,h:T,fill:r/(b*T)||0}}const eo=1;class rm{constructor(r,{pixelRatio:s,version:c,stretchX:y,stretchY:b,content:T,textFitWidth:A,textFitHeight:F}){this.paddedRect=r,this.pixelRatio=s,this.stretchX=y,this.stretchY=b,this.content=T,this.version=c,this.textFitWidth=A,this.textFitHeight=F}get tl(){return[this.paddedRect.x+eo,this.paddedRect.y+eo]}get br(){return[this.paddedRect.x+this.paddedRect.w-eo,this.paddedRect.y+this.paddedRect.h-eo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-eo*2)/this.pixelRatio,(this.paddedRect.h-eo*2)/this.pixelRatio]}}class Wm{constructor(r,s){const c={},y={};this.haveRenderCallbacks=[];const b=[];this.addImages(r,c,b),this.addImages(s,y,b);const{w:T,h:A}=Xm(b),F=new hl({width:T||1,height:A||1});for(const B in r){const U=r[B],j=c[B].paddedRect;hl.copy(U.data,F,{x:0,y:0},{x:j.x+eo,y:j.y+eo},U.data)}for(const B in s){const U=s[B],j=y[B].paddedRect,$=j.x+eo,st=j.y+eo,ct=U.data.width,yt=U.data.height;hl.copy(U.data,F,{x:0,y:0},{x:$,y:st},U.data),hl.copy(U.data,F,{x:0,y:yt-1},{x:$,y:st-1},{width:ct,height:1}),hl.copy(U.data,F,{x:0,y:0},{x:$,y:st+yt},{width:ct,height:1}),hl.copy(U.data,F,{x:ct-1,y:0},{x:$-1,y:st},{width:1,height:yt}),hl.copy(U.data,F,{x:0,y:0},{x:$+ct,y:st},{width:1,height:yt})}this.image=F,this.iconPositions=c,this.patternPositions=y}addImages(r,s,c){for(const y in r){const b=r[y],T={x:0,y:0,w:b.data.width+2*eo,h:b.data.height+2*eo};c.push(T),s[y]=new rm(T,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(r,s){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in r.updatedImages)this.patchUpdatedImage(this.iconPositions[c],r.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],r.getImage(c),s)}patchUpdatedImage(r,s,c){if(!r||!s||r.version===s.version)return;r.version=s.version;const[y,b]=r.tl;c.update(s.data,void 0,{x:y,y:b})}}Xt("ImagePosition",rm),Xt("ImageAtlas",Wm),v.ah=void 0,function(n){n[n.none=0]="none",n[n.horizontal=1]="horizontal",n[n.vertical=2]="vertical",n[n.horizontalOnly=3]="horizontalOnly"}(v.ah||(v.ah={}));const Ec=-17;function nm(n){for(const r of n)if(r.positionedGlyphs.length!==0)return!1;return!0}const Km=57344,gf=63743;class Fh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,s){const c=new Fh;return c.scale=r||1,c.fontStack=s,c}static forImage(r){const s=new Fh;return s.imageName=r,s}}class Ji{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,s){const c=new Ji;for(let y=0;y<r.sections.length;y++){const b=r.sections[y];b.image?c.addImageSection(b):c.addTextSection(b,s)}return c}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=ed(this.text)}trim(){let r=0;for(let c=0;c<this.text.length&&_p[this.text.charCodeAt(c)];c++)r++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=r&&_p[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(r,s),this.sectionIndex=this.sectionIndex.slice(r,s)}substring(r,s){const c=new Ji;return c.text=this.text.substring(r,s),c.sectionIndex=this.sectionIndex.slice(r,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,s)=>Math.max(r,this.sections[s].scale),0)}addTextSection(r,s){this.text+=r.text,this.sections.push(Fh.forText(r.scale,r.fontStack||s));const c=this.sections.length-1;for(let y=0;y<r.text.length;++y)this.sectionIndex.push(c)}addImageSection(r){const s=r.image?r.image.name:"";if(s.length===0){rr("Can't add FormattedSection with an empty image.");return}const c=this.getNextImageSectionCharCode();if(!c){rr(`Reached maximum number of images ${gf-Km+2}`);return}this.text+=String.fromCharCode(c),this.sections.push(Fh.forImage(s)),this.sectionIndex.push(this.sections.length-1)}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=gf?null:++this.imageSectionID:(this.imageSectionID=Km,this.imageSectionID)}}function _g(n,r){const s=[],c=n.text;let y=0;for(const b of r)s.push(n.substring(y,b)),y=b;return y<c.length&&s.push(n.substring(y,c.length)),s}function mp(n,r,s,c,y,b,T,A,F,B,U,j,$,st,ct){const yt=Ji.fromFeature(n,y);j===v.ah.vertical&&yt.verticalizePunctuation();let At;const{processBidirectionalText:Ut,processStyledBidirectionalText:re}=Ln;if(Ut&&yt.sections.length===1){At=[];const de=Ut(yt.toString(),sm(yt,B,b,r,c,st));for(const qe of de){const $e=new Ji;$e.text=qe,$e.sections=yt.sections;for(let yi=0;yi<qe.length;yi++)$e.sectionIndex.push(0);At.push($e)}}else if(re){At=[];const de=re(yt.text,yt.sectionIndex,sm(yt,B,b,r,c,st));for(const qe of de){const $e=new Ji;$e.text=qe[0],$e.sectionIndex=qe[1],$e.sections=yt.sections,At.push($e)}}else At=_g(yt,sm(yt,B,b,r,c,st));const Yt=[],te={positionedLines:Yt,text:yt.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:j,iconsInText:!1,verticalizable:!1};return vg(te,r,s,c,At,T,A,F,j,B,$,ct),nm(Yt)?!1:te}const _p={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},am={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ad={40:!0};function Ym(n,r,s,c,y,b){if(r.imageName){const T=c[r.imageName];return T?T.displaySize[0]*r.scale*Tr/b+y:0}else{const T=s[r.fontStack],A=T&&T[n];return A?A.metrics.advance*r.scale+y:0}}function gg(n,r,s,c,y,b){let T=0;for(let F=0;F<n.length();F++){const B=n.getSection(F);T+=Ym(n.getCharCode(F),B,c,y,r,b)}const A=Math.max(1,Math.ceil(T/s));return T/A}function Jm(n,r,s,c){const y=Math.pow(n-r,2);return c?n<r?y/2:y*2:y+Math.abs(s)*s}function yg(n,r,s){let c=0;return n===10&&(c-=1e4),s&&(c+=150),(n===40||n===65288)&&(c+=50),(r===41||r===65289)&&(c+=50),c}function Qm(n,r,s,c,y,b){let T=null,A=Jm(r,s,y,b);for(const F of c){const B=r-F.x,U=Jm(B,s,y,b)+F.badness;U<=A&&(T=F,A=U)}return{index:n,x:r,priorBreak:T,badness:A}}function $m(n){return n?$m(n.priorBreak).concat(n.index):[]}function sm(n,r,s,c,y,b){if(!n)return[];const T=[],A=gg(n,r,s,c,y,b),F=n.text.indexOf("​")>=0;let B=0;for(let U=0;U<n.length();U++){const j=n.getSection(U),$=n.getCharCode(U);if(_p[$]||(B+=Ym($,j,c,y,r,b)),U<n.length()-1){const st=uf($);(am[$]||st||j.imageName||U!==n.length()-2&&ad[n.getCharCode(U+1)])&&T.push(Qm(U+1,B,A,T,yg($,n.getCharCode(U+1),st&&F),!1))}}return $m(Qm(n.length(),B,A,T,0,!0))}function om(n){let r=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0;break}return{horizontalAlign:r,verticalAlign:s}}function vg(n,r,s,c,y,b,T,A,F,B,U,j){let $=0,st=Ec,ct=0,yt=0;const At=A==="right"?1:A==="left"?0:.5;let Ut=0;for(const de of y){de.trim();const qe=de.getMaxScale(),$e=(qe-1)*Tr,yi={positionedGlyphs:[],lineOffset:0};n.positionedLines[Ut]=yi;const hi=yi.positionedGlyphs;let je=0;if(!de.length()){st+=b,++Ut;continue}for(let Qe=0;Qe<de.length();Qe++){const li=de.getSection(Qe),be=de.getSectionIndex(Qe),He=de.getCharCode(Qe);let ai=0,Hi=null,pn=null,no=null,Cr=Tr;const ua=!(F===v.ah.horizontal||!U&&!To(He)||U&&(_p[He]||Hn(He)));if(li.imageName){const is=c[li.imageName];if(!is)continue;no=li.imageName,n.iconsInText=n.iconsInText||!0,pn=is.paddedRect;const Ds=is.displaySize;li.scale=li.scale*Tr/j,Hi={width:Ds[0],height:Ds[1],left:eo,top:-3,advance:ua?Ds[1]:Ds[0]};const Yl=Tr-Ds[1]*li.scale;ai=$e+Yl,Cr=Hi.advance;const dl=ua?Ds[0]*li.scale-Tr*qe:Ds[1]*li.scale-Tr*qe;dl>0&&dl>je&&(je=dl)}else{const is=s[li.fontStack],Ds=is&&is[He];if(Ds&&Ds.rect)pn=Ds.rect,Hi=Ds.metrics;else{const Yl=r[li.fontStack],dl=Yl&&Yl[He];if(!dl)continue;Hi=dl.metrics}ai=(qe-li.scale)*Tr}ua?(n.verticalizable=!0,hi.push({glyph:He,imageName:no,x:$,y:st+ai,vertical:ua,scale:li.scale,fontStack:li.fontStack,sectionIndex:be,metrics:Hi,rect:pn}),$+=Cr*li.scale+B):(hi.push({glyph:He,imageName:no,x:$,y:st+ai,vertical:ua,scale:li.scale,fontStack:li.fontStack,sectionIndex:be,metrics:Hi,rect:pn}),$+=Hi.advance*li.scale+B)}if(hi.length!==0){const Qe=$-B;ct=Math.max(Qe,ct),xg(hi,0,hi.length-1,At,je)}$=0;const ci=b*qe+je;yi.lineOffset=Math.max(je,$e),st+=ci,yt=Math.max(ci,yt),++Ut}const re=st-Ec,{horizontalAlign:Yt,verticalAlign:te}=om(T);bg(n.positionedLines,At,Yt,te,ct,yt,b,re,y.length),n.top+=-te*re,n.bottom=n.top+re,n.left+=-Yt*ct,n.right=n.left+ct}function xg(n,r,s,c,y){if(!c&&!y)return;const b=n[s],T=b.metrics.advance*b.scale,A=(n[s].x+T)*c;for(let F=r;F<=s;F++)n[F].x-=A,n[F].y+=y}function bg(n,r,s,c,y,b,T,A,F){const B=(r-s)*y;let U=0;b!==T?U=-A*c-Ec:U=(-c*F+.5)*T;for(const j of n)for(const $ of j.positionedGlyphs)$.x+=B,$.y+=U}function t_(n,r,s){const{horizontalAlign:c,verticalAlign:y}=om(s),b=r[0],T=r[1],A=b-n.displaySize[0]*c,F=A+n.displaySize[0],B=T-n.displaySize[1]*y,U=B+n.displaySize[1];return{image:n,top:B,bottom:U,left:A,right:F}}function lm(n){var r,s;let c=n.left,y=n.top,b=n.right-c,T=n.bottom-y;const A=n.image.content[2]-n.image.content[0],F=n.image.content[3]-n.image.content[1],B=(r=n.image.textFitWidth)!==null&&r!==void 0?r:"stretchOrShrink",U=(s=n.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",j=A/F;if(U==="proportional"){if(B==="stretchOnly"&&b/T<j||B==="proportional"){const $=Math.ceil(T*j);c*=$/b,b=$}}else if(B==="proportional"&&U==="stretchOnly"&&j!==0&&b/T>j){const $=Math.ceil(b/j);y*=$/T,T=$}return{x1:c,y1:y,x2:c+b,y2:y+T}}function um(n,r,s,c,y,b){const T=n.image;let A;if(T.content){const At=T.content,Ut=T.pixelRatio||1;A=[At[0]/Ut,At[1]/Ut,T.displaySize[0]-At[2]/Ut,T.displaySize[1]-At[3]/Ut]}const F=r.left*b,B=r.right*b;let U,j,$,st;s==="width"||s==="both"?(st=y[0]+F-c[3],j=y[0]+B+c[1]):(st=y[0]+(F+B-T.displaySize[0])/2,j=st+T.displaySize[0]);const ct=r.top*b,yt=r.bottom*b;return s==="height"||s==="both"?(U=y[1]+ct-c[0],$=y[1]+yt+c[2]):(U=y[1]+(ct+yt-T.displaySize[1])/2,$=U+T.displaySize[1]),{image:T,top:U,right:j,bottom:$,left:st,collisionPadding:A}}const sd=255,cl=128,Mo=sd*cl;function gp(n,r){const{expression:s}=r;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new gr(n+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:y}=s;let b=0;for(;b<c.length&&c[b]<=n;)b++;b=Math.max(0,b-1);let T=b;for(;T<c.length&&c[T]<n+1;)T++;T=Math.min(c.length-1,T);const A=c[b],F=c[T];if(s.kind==="composite")return{kind:"composite",minZoom:A,maxZoom:F,interpolationType:y};const B=s.evaluate(new gr(A)),U=s.evaluate(new gr(F));return{kind:"camera",minZoom:A,maxZoom:F,minSize:B,maxSize:U,interpolationType:y}}}function od(n,{uSize:r,uSizeT:s},{lowerSize:c,upperSize:y}){return n.kind==="source"?c/cl:n.kind==="composite"?Dn.number(c/cl,y/cl,s):r}function wg(n,r){let s=0,c=0;if(n.kind==="constant")c=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:y,minZoom:b,maxZoom:T}=n,A=y?Fs(Pi.interpolationFactor(y,r,b,T),0,1):0;n.kind==="camera"?c=Dn.number(n.minSize,n.maxSize,A):s=A}return{uSizeT:s,uSize:c}}function yp(n,r,s){let c="never";const y=n.get(r);return y?c=y:n.get(s)&&(c="always"),c}const Sn=wc.VectorTileFeature.types,e_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xr(n,r,s,c,y,b,T,A,F,B,U,j,$){const st=A?Math.min(Mo,Math.round(A[0])):0,ct=A?Math.min(Mo,Math.round(A[1])):0;n.emplaceBack(r,s,Math.round(c*32),Math.round(y*32),b,T,(st<<1)+(F?1:0),ct,B*16,U*16,j*256,$*256)}function vp(n,r,s){n.emplaceBack(r.x,r.y,s),n.emplaceBack(r.x,r.y,s),n.emplaceBack(r.x,r.y,s),n.emplaceBack(r.x,r.y,s)}function i_(n){for(const r of n.sections)if(Ch(r.text))return!0;return!1}class xp{constructor(r){this.layoutVertexArray=new bu,this.indexArray=new $a,this.programConfigurations=r,this.segments=new lr,this.dynamicLayoutVertexArray=new Io,this.opacityVertexArray=new za,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ai}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,s,c,y){this.isEmpty()||(c&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Bm.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Om.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,e_,!0),this.opacityVertexBuffer.itemSize=1),(c||y)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Xt("SymbolBuffers",xp);class bp{constructor(r,s,c){this.layoutVertexArray=new r,this.layoutAttributes=s,this.indexArray=new c,this.segments=new lr,this.collisionVertexArray=new Da}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Jp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Xt("CollisionBuffers",bp);class yf{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(F=>F.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=vc([]),this.placementViewportMatrix=vc([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gp(this.zoom,c["text-size"]),this.iconSizeData=gp(this.zoom,c["icon-size"]);const y=this.layers[0].layout,b=y.get("symbol-sort-key"),T=y.get("symbol-z-order");this.canOverlap=yp(y,"text-overlap","text-allow-overlap")!=="never"||yp(y,"icon-overlap","icon-allow-overlap")!=="never"||y.get("text-ignore-placement")||y.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&!b.isConstant();const A=T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey;this.sortFeaturesByY=A&&this.canOverlap,y.get("symbol-placement")==="point"&&(this.writingModes=y.get("text-writing-mode").map(F=>v.ah[F])),this.stateDependentLayerIds=this.layers.filter(F=>F.isStateDependent()).map(F=>F.id),this.sourceID=r.sourceID}createArrays(){this.text=new xp(new Le(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new xp(new Le(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new fi,this.lineVertexArray=new si,this.symbolInstances=new Re,this.textAnchorOffsets=new Mi}calculateGlyphDependencies(r,s,c,y,b){for(let T=0;T<r.length;T++)if(s[r.charCodeAt(T)]=!0,(c||y)&&b){const A=td[r.charAt(T)];A&&(s[A.charCodeAt(0)]=!0)}}populate(r,s,c){const y=this.layers[0],b=y.layout,T=b.get("text-font"),A=b.get("text-field"),F=b.get("icon-image"),B=(A.value.kind!=="constant"||A.value.value instanceof jn&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),U=F.value.kind!=="constant"||!!F.value.value||Object.keys(F.parameters).length>0,j=b.get("symbol-sort-key");if(this.features=[],!B&&!U)return;const $=s.iconDependencies,st=s.glyphDependencies,ct=s.availableImages,yt=new gr(this.zoom);for(const{feature:At,id:Ut,index:re,sourceLayerIndex:Yt}of r){const te=y._featureFilter.needGeometry,de=Hr(At,te);if(!y._featureFilter.filter(yt,de,c))continue;te||(de.geometry=Ni(At));let qe;if(B){const je=y.getValueAndResolveTokens("text-field",de,c,ct),ci=jn.factory(je),Qe=this.hasRTLText=this.hasRTLText||i_(ci);(!Qe||Ln.getRTLTextPluginStatus()==="unavailable"||Qe&&Ln.isParsed())&&(qe=lg(ci,y,de))}let $e;if(U){const je=y.getValueAndResolveTokens("icon-image",de,c,ct);je instanceof ss?$e=je:$e=ss.fromString(je)}if(!qe&&!$e)continue;const yi=this.sortFeaturesByKey?j.evaluate(de,{},c):void 0,hi={id:Ut,text:qe,icon:$e,index:re,sourceLayerIndex:Yt,geometry:de.geometry,properties:At.properties,type:Sn[At.type],sortKey:yi};if(this.features.push(hi),$e&&($[$e.name]=!0),qe){const je=T.evaluate(de,{},c).join(","),ci=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(v.ah.vertical)>=0;for(const Qe of qe.sections)if(Qe.image)$[Qe.image.name]=!0;else{const li=Ol(qe.toString()),be=Qe.fontStack||je,He=st[be]=st[be]||{};this.calculateGlyphDependencies(Qe.text,He,ci,this.allowVerticalPlacement,li)}}}b.get("symbol-placement")==="line"&&(this.features=ug(this.features)),this.sortFeaturesByKey&&this.features.sort((At,Ut)=>At.sortKey-Ut.sortKey)}update(r,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(r,s,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,s){const c=this.lineVertexArray.length;if(r.segment!==void 0){let y=r.dist(s[r.segment+1]),b=r.dist(s[r.segment]);const T={};for(let A=r.segment+1;A<s.length;A++)T[A]={x:s[A].x,y:s[A].y,tileUnitDistanceFromAnchor:y},A<s.length-1&&(y+=s[A+1].dist(s[A]));for(let A=r.segment||0;A>=0;A--)T[A]={x:s[A].x,y:s[A].y,tileUnitDistanceFromAnchor:b},A>0&&(b+=s[A-1].dist(s[A]));for(let A=0;A<s.length;A++){const F=T[A];this.lineVertexArray.emplaceBack(F.x,F.y,F.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(r,s,c,y,b,T,A,F,B,U,j,$){const st=r.indexArray,ct=r.layoutVertexArray,yt=r.segments.prepareSegment(4*s.length,ct,st,this.canOverlap?T.sortKey:void 0),At=this.glyphOffsetArray.length,Ut=yt.vertexLength,re=this.allowVerticalPlacement&&A===v.ah.vertical?Math.PI/2:0,Yt=T.text&&T.text.sections;for(let te=0;te<s.length;te++){const{tl:de,tr:qe,bl:$e,br:yi,tex:hi,pixelOffsetTL:je,pixelOffsetBR:ci,minFontScaleX:Qe,minFontScaleY:li,glyphOffset:be,isSDF:He,sectionIndex:ai}=s[te],Hi=yt.vertexLength,pn=be[1];xr(ct,F.x,F.y,de.x,pn+de.y,hi.x,hi.y,c,He,je.x,je.y,Qe,li),xr(ct,F.x,F.y,qe.x,pn+qe.y,hi.x+hi.w,hi.y,c,He,ci.x,je.y,Qe,li),xr(ct,F.x,F.y,$e.x,pn+$e.y,hi.x,hi.y+hi.h,c,He,je.x,ci.y,Qe,li),xr(ct,F.x,F.y,yi.x,pn+yi.y,hi.x+hi.w,hi.y+hi.h,c,He,ci.x,ci.y,Qe,li),vp(r.dynamicLayoutVertexArray,F,re),st.emplaceBack(Hi,Hi+1,Hi+2),st.emplaceBack(Hi+1,Hi+2,Hi+3),yt.vertexLength+=4,yt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(be[0]),(te===s.length-1||ai!==s[te+1].sectionIndex)&&r.programConfigurations.populatePaintArrays(ct.length,T,T.index,{},$,Yt&&Yt[ai])}r.placedSymbolArray.emplaceBack(F.x,F.y,At,this.glyphOffsetArray.length-At,Ut,B,U,F.segment,c?c[0]:0,c?c[1]:0,y[0],y[1],A,0,!1,0,j)}_addCollisionDebugVertex(r,s,c,y,b,T){return s.emplaceBack(0,0),r.emplaceBack(c.x,c.y,y,b,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(r,s,c,y,b,T,A){const F=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),B=F.vertexLength,U=b.layoutVertexArray,j=b.collisionVertexArray,$=A.anchorX,st=A.anchorY;this._addCollisionDebugVertex(U,j,T,$,st,new pe(r,s)),this._addCollisionDebugVertex(U,j,T,$,st,new pe(c,s)),this._addCollisionDebugVertex(U,j,T,$,st,new pe(c,y)),this._addCollisionDebugVertex(U,j,T,$,st,new pe(r,y)),F.vertexLength+=4;const ct=b.indexArray;ct.emplaceBack(B,B+1),ct.emplaceBack(B+1,B+2),ct.emplaceBack(B+2,B+3),ct.emplaceBack(B+3,B),F.primitiveLength+=4}addDebugCollisionBoxes(r,s,c,y){for(let b=r;b<s;b++){const T=this.collisionBoxArray.get(b),A=T.x1,F=T.y1,B=T.x2,U=T.y2;this.addCollisionDebugVertices(A,F,B,U,y?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bp(Ys,hp.members,fs),this.iconCollisionBox=new bp(Ys,hp.members,fs);for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(r,s,c,y,b,T,A,F,B){const U={};for(let j=s;j<c;j++){const $=r.get(j);U.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},U.textFeatureIndex=$.featureIndex;break}for(let j=y;j<b;j++){const $=r.get(j);U.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},U.verticalTextFeatureIndex=$.featureIndex;break}for(let j=T;j<A;j++){const $=r.get(j);U.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},U.iconFeatureIndex=$.featureIndex;break}for(let j=F;j<B;j++){const $=r.get(j);U.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},U.verticalIconFeatureIndex=$.featureIndex;break}return U}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,s){const c=r.placedSymbolArray.get(s),y=c.vertexStartIndex+c.numGlyphs*4;for(let b=c.vertexStartIndex;b<y;b+=4)r.indexArray.emplaceBack(b,b+1,b+2),r.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(r),c=Math.cos(r),y=[],b=[],T=[];for(let A=0;A<this.symbolInstances.length;++A){T.push(A);const F=this.symbolInstances.get(A);y.push(Math.round(s*F.anchorX+c*F.anchorY)|0),b.push(F.featureIndex)}return T.sort((A,F)=>y[A]-y[F]||b[F]-b[A]),T}addToSortKeyRanges(r,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((y,b,T)=>{y>=0&&T.indexOf(y)===b&&this.addIndicesForPlacedSymbol(this.text,y)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xt("SymbolBucket",yf,{omit:["layers","collisionBoxArray","features","compareText"]}),yf.MAX_GLYPHS=65535,yf.addDynamicAttributes=vp;function Sg(n,r){return r.replace(/{([^{}]+)}/g,(s,c)=>n&&c in n?String(n[c]):"")}let wp;const Tg=()=>wp=wp||new Pa({"symbol-placement":new Xe(Ht.layout_symbol["symbol-placement"]),"symbol-spacing":new Xe(Ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xe(Ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ye(Ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xe(Ht.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xe(Ht.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Xe(Ht.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Xe(Ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xe(Ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xe(Ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ye(Ht.layout_symbol["icon-size"]),"icon-text-fit":new Xe(Ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xe(Ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ye(Ht.layout_symbol["icon-image"]),"icon-rotate":new Ye(Ht.layout_symbol["icon-rotate"]),"icon-padding":new Ye(Ht.layout_symbol["icon-padding"]),"icon-keep-upright":new Xe(Ht.layout_symbol["icon-keep-upright"]),"icon-offset":new Ye(Ht.layout_symbol["icon-offset"]),"icon-anchor":new Ye(Ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xe(Ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xe(Ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xe(Ht.layout_symbol["text-rotation-alignment"]),"text-field":new Ye(Ht.layout_symbol["text-field"]),"text-font":new Ye(Ht.layout_symbol["text-font"]),"text-size":new Ye(Ht.layout_symbol["text-size"]),"text-max-width":new Ye(Ht.layout_symbol["text-max-width"]),"text-line-height":new Xe(Ht.layout_symbol["text-line-height"]),"text-letter-spacing":new Ye(Ht.layout_symbol["text-letter-spacing"]),"text-justify":new Ye(Ht.layout_symbol["text-justify"]),"text-radial-offset":new Ye(Ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xe(Ht.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ye(Ht.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ye(Ht.layout_symbol["text-anchor"]),"text-max-angle":new Xe(Ht.layout_symbol["text-max-angle"]),"text-writing-mode":new Xe(Ht.layout_symbol["text-writing-mode"]),"text-rotate":new Ye(Ht.layout_symbol["text-rotate"]),"text-padding":new Xe(Ht.layout_symbol["text-padding"]),"text-keep-upright":new Xe(Ht.layout_symbol["text-keep-upright"]),"text-transform":new Ye(Ht.layout_symbol["text-transform"]),"text-offset":new Ye(Ht.layout_symbol["text-offset"]),"text-allow-overlap":new Xe(Ht.layout_symbol["text-allow-overlap"]),"text-overlap":new Xe(Ht.layout_symbol["text-overlap"]),"text-ignore-placement":new Xe(Ht.layout_symbol["text-ignore-placement"]),"text-optional":new Xe(Ht.layout_symbol["text-optional"])});let r_;const vf=()=>r_=r_||new Pa({"icon-opacity":new Ye(Ht.paint_symbol["icon-opacity"]),"icon-color":new Ye(Ht.paint_symbol["icon-color"]),"icon-halo-color":new Ye(Ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ye(Ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ye(Ht.paint_symbol["icon-halo-blur"]),"icon-translate":new Xe(Ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xe(Ht.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ye(Ht.paint_symbol["text-opacity"]),"text-color":new Ye(Ht.paint_symbol["text-color"],{runtimeType:Za,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Ye(Ht.paint_symbol["text-halo-color"]),"text-halo-width":new Ye(Ht.paint_symbol["text-halo-width"]),"text-halo-blur":new Ye(Ht.paint_symbol["text-halo-blur"]),"text-translate":new Xe(Ht.paint_symbol["text-translate"]),"text-translate-anchor":new Xe(Ht.paint_symbol["text-translate-anchor"])});var Lh={get paint(){return vf()},get layout(){return Tg()}};class hm{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:nu,this.defaultValue=r}evaluate(r){if(r.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(r.formattedSection))return s.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){if(!this.defaultValue.isConstant()){const s=this.defaultValue.value;r(s._styleExpression.expression)}}outputDefined(){return!1}serialize(){return null}}Xt("FormatSectionOverride",hm,{omit:["defaultValue"]});class Wr extends Ps{constructor(r){super(r,Lh)}recalculate(r,s){if(super.recalculate(r,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout.get("symbol-placement")!=="point"?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout.get("symbol-placement")!=="point"?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const y=[];for(const b of c)y.indexOf(b)<0&&y.push(b);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,s,c,y){const b=this.layout.get(r).evaluate(s,{},c,y),T=this._unevaluatedLayout._values[r];return!T.isDataDriven()&&!kl(T.value)&&b?Sg(s.properties,b):b}createBucket(r){return new yf(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Lh.paint.overridableProperties){if(!Wr.hasPaintOverride(this.layout,r))continue;const s=this.paint.get(r),c=new hm(s),y=new dr(c,s.property.specification);let b=null;s.value.kind==="constant"||s.value.kind==="source"?b=new nr("source",y):b=new Fl("composite",y,s.value.zoomStops),this.paint._values[r]=new Xn(s.property,b,s.parameters)}}_handleOverridablePaintPropertyUpdate(r,s,c){return!this.layout||s.isDataDriven()||c.isDataDriven()?!1:Wr.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,s){const c=r.get("text-field"),y=Lh.paint.properties[s];let b=!1;const T=A=>{for(const F of A)if(y.overrides&&y.overrides.hasOverride(F)){b=!0;return}};if(c.value.kind==="constant"&&c.value.value instanceof jn)T(c.value.value.sections);else if(c.value.kind==="source"){const A=B=>{if(!b)if(B instanceof Fr&&kr(B.value)===ja){const U=B.value;T(U.sections)}else B instanceof Kh?T(B.sections):B.eachChild(A)},F=c.value;F._styleExpression&&A(F._styleExpression.expression)}return b}}function Wd(n,r,s,c=1){const y=n.get("icon-padding").evaluate(r,{},s),b=y&&y.values;return[b[0]*c,b[1]*c,b[2]*c,b[3]*c]}let n_;const Rh=()=>n_=n_||new Pa({"background-color":new Xe(Ht.paint_background["background-color"]),"background-pattern":new ll(Ht.paint_background["background-pattern"]),"background-opacity":new Xe(Ht.paint_background["background-opacity"])});var Eg={get paint(){return Rh()}};class Sp extends Ps{constructor(r){super(r,Eg)}}let Kd;const cm=()=>Kd=Kd||new Pa({"raster-opacity":new Xe(Ht.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xe(Ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xe(Ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xe(Ht.paint_raster["raster-brightness-max"]),"raster-saturation":new Xe(Ht.paint_raster["raster-saturation"]),"raster-contrast":new Xe(Ht.paint_raster["raster-contrast"]),"raster-resampling":new Xe(Ht.paint_raster["raster-resampling"]),"raster-fade-duration":new Xe(Ht.paint_raster["raster-fade-duration"])});var ld={get paint(){return cm()}};class Bh extends Ps{constructor(r){super(r,ld)}}function a_(n){const r=[],s=n.id;return s===void 0&&r.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&r.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&r.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),r}class s_ extends Ps{constructor(r){super(r,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}function Ig(n){if(n.type==="custom")return new s_(n);switch(n.type){case"background":return new Sp(n);case"circle":return new __(n);case"fill":return new Pm(n);case"fill-extrusion":return new op(n);case"heatmap":return new wm(n);case"hillshade":return new w_(n);case"line":return new Lm(n);case"raster":return new Bh(n);case"symbol":return new Wr(n)}}class Cg{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}class Kn{constructor(r,s){this.target=r,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Cg(()=>this.process()),this.subscription=uo(this.target,"message",c=>this.receive(c),!1),this.globalScope=sn(self)?r:window}registerMessageHandler(r,s){this.messageHandlers[r]=s}sendAsync(r,s){return new Promise((c,y)=>{const b=Math.round(Math.random()*1e18).toString(36).substring(0,10);this.resolveRejects[b]={resolve:c,reject:y},s&&s.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const F={id:b,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(F)},{once:!0});const T=[],A=Object.assign(Object.assign({},r),{id:b,sourceMapId:this.mapId,origin:location.origin,data:Nr(r.data,T)});this.target.postMessage(A,{transfer:T})})}receive(r){const s=r.data,c=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!=="resource://android"&&location.origin!=="resource://android"&&s.origin!==location.origin)&&!(s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[c];const y=this.abortControllers[c];delete this.abortControllers[c],y&&y.abort();return}if(sn(self)||s.mustQueue){this.tasks[c]=s,this.taskQueue.push(c),this.invoker.trigger();return}this.processTask(c,s)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),s=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(r,s)}processTask(r,s){return C(this,void 0,void 0,function*(){if(s.type==="<response>"){const b=this.resolveRejects[r];if(delete this.resolveRejects[r],!b)return;s.error?b.reject(na(s.error)):b.resolve(na(s.data));return}if(!this.messageHandlers[s.type]){this.completeTask(r,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));return}const c=na(s.data),y=new AbortController;this.abortControllers[r]=y;try{const b=yield this.messageHandlers[s.type](s.sourceMapId,c,y);this.completeTask(r,null,b)}catch(b){this.completeTask(r,b)}})}completeTask(r,s,c){const y=[];delete this.abortControllers[r];const b={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?Nr(s):null,data:Nr(c,y)};this.target.postMessage(b,{transfer:y})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}}const fm=63710088e-1;class io{constructor(r,s){if(isNaN(r)||isNaN(s))throw new Error(`Invalid LngLat object: (${r}, ${s})`);if(this.lng=+r,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new io(Or(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const s=Math.PI/180,c=this.lat*s,y=r.lat*s,b=Math.sin(c)*Math.sin(y)+Math.cos(c)*Math.cos(y)*Math.cos((r.lng-this.lng)*s);return fm*Math.acos(Math.min(b,1))}static convert(r){if(r instanceof io)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new io(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new io(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const dm=2*Math.PI*fm;function e(n){return dm*Math.cos(n*Math.PI/180)}function i(n){return(180+n)/360}function a(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function h(n,r){return n/e(r)}function p(n){return n*360-180}function x(n){const r=180-n*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}function E(n,r){return n*e(x(r))}function M(n){return 1/Math.cos(n*Math.PI/180)}class L{constructor(r,s,c=0){this.x=+r,this.y=+s,this.z=+c}static fromLngLat(r,s=0){const c=io.convert(r);return new L(i(c.lng),a(c.lat),h(s,c.lat))}toLngLat(){return new io(p(this.x),x(this.y))}toAltitude(){return E(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/dm*M(x(this.y))}}function V(n,r,s){r=Math.pow(2,s)-r-1;var c=Z(n*256,r*256,s),y=Z((n+1)*256,(r+1)*256,s);return c[0]+","+c[1]+","+y[0]+","+y[1]}function Z(n,r,s){var c=2*Math.PI*6378137/256/Math.pow(2,s),y=n*c-2*Math.PI*6378137/2,b=r*c-2*Math.PI*6378137/2;return[y,b]}function Y(n,r,s){return!(n<Qn||n>_n||s<0||s>=Math.pow(2,n)||r<0||r>=Math.pow(2,n))}function rt(n,r){const{x:s,y:c}=L.fromLngLat(r);return!(n<Qn||n>_n||c<0||c>=1||s<0||s>=1)}class it{constructor(r,s,c){if(!Y(r,s,c))throw new Error(`x=${s}, y=${c}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} ${Qn}<=z<=${_n} `);this.z=r,this.x=s,this.y=c,this.key=zt(0,r,r,s,c)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,s,c){const y=V(this.x,this.y,this.z),b=Ct(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,b).replace(/{bbox-epsg-3857}/g,y)}isChildOf(r){const s=this.z-r.z;return s>0&&r.x===this.x>>s&&r.y===this.y>>s}getTilePoint(r){const s=Math.pow(2,this.z);return new pe((r.x*s-this.x)*ye,(r.y*s-this.y)*ye)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ht{constructor(r,s){this.wrap=r,this.canonical=s,this.key=zt(r,s.z,s.z,s.x,s.y)}}class _t{constructor(r,s,c,y,b){if(r<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${c}`);this.overscaledZ=r,this.wrap=s,this.canonical=new it(c,+y,+b),this.key=zt(s,r,c,y,b)}clone(){return new _t(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-r;return r>this.canonical.z?new _t(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _t(r,this.wrap,r,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(r,s){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-r;return r>this.canonical.z?zt(this.wrap*+s,r,this.canonical.z,this.canonical.x,this.canonical.y):zt(this.wrap*+s,r,r,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const s=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>s&&r.canonical.y===this.canonical.y>>s}children(r){if(this.overscaledZ>=r)return[new _t(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=this.canonical.x*2,y=this.canonical.y*2;return[new _t(s,this.wrap,s,c,y),new _t(s,this.wrap,s,c+1,y),new _t(s,this.wrap,s,c,y+1),new _t(s,this.wrap,s,c+1,y+1)]}isLessThan(r){return this.wrap<r.wrap?!0:this.wrap>r.wrap?!1:this.overscaledZ<r.overscaledZ?!0:this.overscaledZ>r.overscaledZ?!1:this.canonical.x<r.canonical.x?!0:this.canonical.x>r.canonical.x?!1:this.canonical.y<r.canonical.y}wrapped(){return new _t(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new _t(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ht(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new L(r.x-this.wrap,r.y))}}function zt(n,r,s,c,y){n*=2,n<0&&(n=n*-1-1);const b=1<<s;return(b*b*n+b*y+c).toString(36)+s.toString(36)+r.toString(36)}function Ct(n,r,s){let c="",y;for(let b=n;b>0;b--)y=1<<b-1,c+=(r&y?1:0)+(s&y?2:0);return c}Xt("CanonicalTileID",it),Xt("OverscaledTileID",_t,{omit:["posMatrix"]});class jt{constructor(r,s,c,y=1,b=1,T=1,A=0){if(this.uid=r,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c)){rr(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);return}this.stride=s.height;const F=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=y,this.greenFactor=b,this.blueFactor=T,this.baseShift=A;break;case"mapbox":default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4;break}for(let B=0;B<F;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(F,B)]=this.data[this._idx(F-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,F)]=this.data[this._idx(B,F-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(F,-1)]=this.data[this._idx(F-1,0)],this.data[this._idx(-1,F)]=this.data[this._idx(0,F-1)],this.data[this._idx(F,F)]=this.data[this._idx(F-1,F-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let B=0;B<F;B++)for(let U=0;U<F;U++){const j=this.get(B,U);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(r,s){const c=new Uint8Array(this.data.buffer),y=this._idx(r,s)*4;return this.unpack(c[y],c[y+1],c[y+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,s){if(r<-1||r>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(r+1)}unpack(r,s,c){return r*this.redFactor+s*this.greenFactor+c*this.blueFactor-this.baseShift}getPixels(){return new hl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,s,c){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let y=s*this.dim,b=s*this.dim+this.dim,T=c*this.dim,A=c*this.dim+this.dim;switch(s){case-1:y=b-1;break;case 1:b=y+1;break}switch(c){case-1:T=A-1;break;case 1:A=T+1;break}const F=-s*this.dim,B=-c*this.dim;for(let U=T;U<A;U++)for(let j=y;j<b;j++)this.data[this._idx(j,U)]=r.data[this._idx(j+F,U+B)]}}Xt("DEMData",jt);class Rt{constructor(r){this._stringToNumber={},this._numberToString=[];for(let s=0;s<r.length;s++){const c=r[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class Zt{constructor(r,s,c,y,b){this.type="Feature",this._vectorTileFeature=r,r._z=s,r._x=c,r._y=y,this.properties=r.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const s in this)s==="_geometry"||s==="_vectorTileFeature"||(r[s]=this[s]);return r}}class Wt{constructor(r,s){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new tn(ye,16,0),this.grid3D=new tn(ye,16,0),this.featureIndexArray=new wi,this.promoteId=s}insert(r,s,c,y,b,T){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,y,b);const F=T?this.grid3D:this.grid;for(let B=0;B<s.length;B++){const U=s[B],j=[1/0,1/0,-1/0,-1/0];for(let $=0;$<U.length;$++){const st=U[$];j[0]=Math.min(j[0],st.x),j[1]=Math.min(j[1],st.y),j[2]=Math.max(j[2],st.x),j[3]=Math.max(j[3],st.y)}j[0]<ye&&j[1]<ye&&j[2]>=0&&j[3]>=0&&F.insert(A,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new wc.VectorTile(new im(this.rawTileData)).layers,this.sourceLayerCoder=new Rt(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,s,c,y){this.loadVTLayers();const b=r.params||{},T=ye/r.tileSize/r.scale,A=lc(b.filter),F=r.queryGeometry,B=r.queryPadding*T,U=xe(F),j=this.grid.query(U.minX-B,U.minY-B,U.maxX+B,U.maxY+B),$=xe(r.cameraQueryGeometry),st=this.grid3D.query($.minX-B,$.minY-B,$.maxX+B,$.maxY+B,(At,Ut,re,Yt)=>Xf(r.cameraQueryGeometry,At-B,Ut-B,re+B,Yt+B));for(const At of st)j.push(At);j.sort(ve);const ct={};let yt;for(let At=0;At<j.length;At++){const Ut=j[At];if(Ut===yt)continue;yt=Ut;const re=this.featureIndexArray.get(Ut);let Yt=null;this.loadMatchingFeature(ct,re.bucketIndex,re.sourceLayerIndex,re.featureIndex,A,b.layers,b.availableImages,s,c,y,(te,de,qe)=>(Yt||(Yt=Ni(te)),de.queryIntersectsFeature(F,te,qe,Yt,this.z,r.transform,T,r.pixelPosMatrix)))}return ct}loadMatchingFeature(r,s,c,y,b,T,A,F,B,U,j){const $=this.bucketLayerIDs[s];if(T&&!so(T,$))return;const st=this.sourceLayerCoder.decode(c),yt=this.vtLayers[st].feature(y);if(b.needGeometry){const Ut=Hr(yt,!0);if(!b.filter(new gr(this.tileID.overscaledZ),Ut,this.tileID.canonical))return}else if(!b.filter(new gr(this.tileID.overscaledZ),yt))return;const At=this.getId(yt,st);for(let Ut=0;Ut<$.length;Ut++){const re=$[Ut];if(T&&T.indexOf(re)<0)continue;const Yt=F[re];if(!Yt)continue;let te={};At&&U&&(te=U.getState(Yt.sourceLayer||"_geojsonTileLayer",At));const de=da({},B[re]);de.paint=le(de.paint,Yt.paint,yt,te,A),de.layout=le(de.layout,Yt.layout,yt,te,A);const qe=!j||j(yt,Yt,te);if(!qe)continue;const $e=new Zt(yt,this.z,this.x,this.y,At);$e.layer=de;let yi=r[re];yi===void 0&&(yi=r[re]=[]),yi.push({featureIndex:y,feature:$e,intersectionZ:qe})}}lookupSymbolFeatures(r,s,c,y,b,T,A,F){const B={};this.loadVTLayers();const U=lc(b);for(const j of r)this.loadMatchingFeature(B,c,y,j,U,T,A,F,s);return B}hasLayer(r){for(const s of this.bucketLayerIDs)for(const c of s)if(r===c)return!0;return!1}getId(r,s){let c=r.id;if(this.promoteId){const y=typeof this.promoteId=="string"?this.promoteId:this.promoteId[s];c=r.properties[y],typeof c=="boolean"&&(c=Number(c))}return c}}Xt("FeatureIndex",Wt,{omit:["rawTileData","sourceLayerCoder"]});function le(n,r,s,c,y){return Do(n,(b,T)=>{const A=r instanceof Qu?r.get(T):null;return A&&A.evaluate?A.evaluate(s,c,y):A})}function xe(n){let r=1/0,s=1/0,c=-1/0,y=-1/0;for(const b of n)r=Math.min(r,b.x),s=Math.min(s,b.y),c=Math.max(c,b.x),y=Math.max(y,b.y);return{minX:r,minY:s,maxX:c,maxY:y}}function ve(n,r){return r-n}function Be(n,r,s,c,y){const b=[];for(let T=0;T<n.length;T++){const A=n[T];let F;for(let B=0;B<A.length-1;B++){let U=A[B],j=A[B+1];U.x<r&&j.x<r||(U.x<r?U=new pe(r,U.y+(j.y-U.y)*((r-U.x)/(j.x-U.x)))._round():j.x<r&&(j=new pe(r,U.y+(j.y-U.y)*((r-U.x)/(j.x-U.x)))._round()),!(U.y<s&&j.y<s)&&(U.y<s?U=new pe(U.x+(j.x-U.x)*((s-U.y)/(j.y-U.y)),s)._round():j.y<s&&(j=new pe(U.x+(j.x-U.x)*((s-U.y)/(j.y-U.y)),s)._round()),!(U.x>=c&&j.x>=c)&&(U.x>=c?U=new pe(c,U.y+(j.y-U.y)*((c-U.x)/(j.x-U.x)))._round():j.x>=c&&(j=new pe(c,U.y+(j.y-U.y)*((c-U.x)/(j.x-U.x)))._round()),!(U.y>=y&&j.y>=y)&&(U.y>=y?U=new pe(U.x+(j.x-U.x)*((y-U.y)/(j.y-U.y)),y)._round():j.y>=y&&(j=new pe(U.x+(j.x-U.x)*((y-U.y)/(j.y-U.y)),y)._round()),(!F||!U.equals(F[F.length-1]))&&(F=[U],b.push(F)),F.push(j)))))}}return b}class Te extends pe{constructor(r,s,c,y){super(r,s),this.angle=c,y!==void 0&&(this.segment=y)}clone(){return new Te(this.x,this.y,this.angle,this.segment)}}Xt("Anchor",Te);function De(n,r,s,c,y){if(r.segment===void 0||s===0)return!0;let b=r,T=r.segment+1,A=0;for(;A>-s/2;){if(T--,T<0)return!1;A-=n[T].dist(b),b=n[T]}A+=n[T].dist(n[T+1]),T++;const F=[];let B=0;for(;A<s/2;){const U=n[T-1],j=n[T],$=n[T+1];if(!$)return!1;let st=U.angleTo(j)-j.angleTo($);for(st=Math.abs((st+3*Math.PI)%(Math.PI*2)-Math.PI),F.push({distance:A,angleDelta:st}),B+=st;A-F[0].distance>c;)B-=F.shift().angleDelta;if(B>y)return!1;T++,A+=j.dist($)}return!0}function oi(n){let r=0;for(let s=0;s<n.length-1;s++)r+=n[s].dist(n[s+1]);return r}function Oe(n,r,s){return n?3/5*r*s:0}function Ve(n,r){return Math.max(n?n.right-n.left:0,r?r.right-r.left:0)}function gi(n,r,s,c,y,b){const T=Oe(s,y,b),A=Ve(s,c)*b;let F=0;const B=oi(n)/2;for(let U=0;U<n.length-1;U++){const j=n[U],$=n[U+1],st=j.dist($);if(F+st>B){const ct=(B-F)/st,yt=Dn.number(j.x,$.x,ct),At=Dn.number(j.y,$.y,ct),Ut=new Te(yt,At,$.angleTo(j),U);return Ut._round(),!T||De(n,Ut,A,T,r)?Ut:void 0}F+=st}}function ni(n,r,s,c,y,b,T,A,F){const B=Oe(c,b,T),U=Ve(c,y),j=U*T,$=n[0].x===0||n[0].x===F||n[0].y===0||n[0].y===F;r-j<r/4&&(r=j+r/4);const st=b*2,ct=$?r/2*A%r:(U/2+st)*T*A%r;return qi(n,ct,r,B,s,j,$,!1,F)}function qi(n,r,s,c,y,b,T,A,F){const B=b/2,U=oi(n);let j=0,$=r-s,st=[];for(let ct=0;ct<n.length-1;ct++){const yt=n[ct],At=n[ct+1],Ut=yt.dist(At),re=At.angleTo(yt);for(;$+s<j+Ut;){$+=s;const Yt=($-j)/Ut,te=Dn.number(yt.x,At.x,Yt),de=Dn.number(yt.y,At.y,Yt);if(te>=0&&te<F&&de>=0&&de<F&&$-B>=0&&$+B<=U){const qe=new Te(te,de,re,ct);qe._round(),(!c||De(n,qe,b,c,y))&&st.push(qe)}}j+=Ut}return!A&&!st.length&&!T&&(st=qi(n,j/2,s,c,y,b,T,!0,F)),st}const $i=eo;function Zi(n,r,s,c){const y=[],b=n.image,T=b.pixelRatio,A=b.paddedRect.w-2*$i,F=b.paddedRect.h-2*$i;let B={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const U=b.stretchX||[[0,A]],j=b.stretchY||[[0,F]],$=(be,He)=>be+He[1]-He[0],st=U.reduce($,0),ct=j.reduce($,0),yt=A-st,At=F-ct;let Ut=0,re=st,Yt=0,te=ct,de=0,qe=yt,$e=0,yi=At;if(b.content&&c){const be=b.content,He=be[2]-be[0],ai=be[3]-be[1];(b.textFitWidth||b.textFitHeight)&&(B=lm(n)),Ut=Bi(U,0,be[0]),Yt=Bi(j,0,be[1]),re=Bi(U,be[0],be[2]),te=Bi(j,be[1],be[3]),de=be[0]-Ut,$e=be[1]-Yt,qe=He-re,yi=ai-te}const hi=B.x1,je=B.y1,ci=B.x2-hi,Qe=B.y2-je,li=(be,He,ai,Hi)=>{const pn=hr(be.stretch-Ut,re,ci,hi),no=pr(be.fixed-de,qe,be.stretch,st),Cr=hr(He.stretch-Yt,te,Qe,je),ua=pr(He.fixed-$e,yi,He.stretch,ct),is=hr(ai.stretch-Ut,re,ci,hi),Ds=pr(ai.fixed-de,qe,ai.stretch,st),Yl=hr(Hi.stretch-Yt,te,Qe,je),dl=pr(Hi.fixed-$e,yi,Hi.stretch,ct),l_=new pe(pn,Cr),u_=new pe(is,Cr),h_=new pe(is,Yl),c_=new pe(pn,Yl),Dg=new pe(no/T,ua/T),Cu=new pe(Ds/T,dl/T),fd=r*Math.PI/180;if(fd){const dd=Math.sin(fd),gm=Math.cos(fd),sh=[gm,-dd,dd,gm];l_._matMult(sh),u_._matMult(sh),c_._matMult(sh),h_._matMult(sh)}const _m=be.stretch+be.fixed,kg=ai.stretch+ai.fixed,f_=He.stretch+He.fixed,Fg=Hi.stretch+Hi.fixed,Pu={x:b.paddedRect.x+$i+_m,y:b.paddedRect.y+$i+f_,w:kg-_m,h:Fg-f_},pl=qe/T/ci,bf=yi/T/Qe;return{tl:l_,tr:u_,bl:c_,br:h_,tex:Pu,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Dg,pixelOffsetBR:Cu,minFontScaleX:pl,minFontScaleY:bf,isSDF:s}};if(!c||!b.stretchX&&!b.stretchY)y.push(li({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:F+1}));else{const be=Vi(U,yt,st),He=Vi(j,At,ct);for(let ai=0;ai<be.length-1;ai++){const Hi=be[ai],pn=be[ai+1];for(let no=0;no<He.length-1;no++){const Cr=He[no],ua=He[no+1];y.push(li(Hi,Cr,pn,ua))}}}return y}function Bi(n,r,s){let c=0;for(const y of n)c+=Math.max(r,Math.min(s,y[1]))-Math.max(r,Math.min(s,y[0]));return c}function Vi(n,r,s){const c=[{fixed:-1,stretch:0}];for(const[y,b]of n){const T=c[c.length-1];c.push({fixed:y-T.stretch,stretch:T.stretch}),c.push({fixed:y-T.stretch,stretch:T.stretch+(b-y)})}return c.push({fixed:r+$i,stretch:s}),c}function hr(n,r,s,c){return n/r*s+c}function pr(n,r,s,c){return n-r*s/c}function Kr(n,r,s,c,y,b,T,A){const F=c.layout.get("text-rotate").evaluate(b,{})*Math.PI/180,B=[];for(const U of r.positionedLines)for(const j of U.positionedGlyphs){if(!j.rect)continue;const $=j.rect||{};let ct=Hm+1,yt=!0,At=1,Ut=0;const re=(y||A)&&j.vertical,Yt=j.metrics.advance*j.scale/2;if(A&&r.verticalizable){const Cr=(j.scale-1)*Tr,ua=(Tr-j.metrics.width*j.scale)/2;Ut=U.lineOffset/2-(j.imageName?-ua:Cr)}if(j.imageName){const Cr=T[j.imageName];yt=Cr.sdf,At=Cr.pixelRatio,ct=eo/At}const te=y?[j.x+Yt,j.y]:[0,0];let de=y?[0,0]:[j.x+Yt+s[0],j.y+s[1]-Ut],qe=[0,0];re&&(qe=de,de=[0,0]);const $e=j.metrics.isDoubleResolution?2:1,yi=(j.metrics.left-ct)*j.scale-Yt+de[0],hi=(-j.metrics.top-ct)*j.scale+de[1],je=yi+$.w/$e*j.scale/At,ci=hi+$.h/$e*j.scale/At,Qe=new pe(yi,hi),li=new pe(je,hi),be=new pe(yi,ci),He=new pe(je,ci);if(re){const Cr=new pe(-Yt,Yt-Ec),ua=-Math.PI/2,is=Tr/2-Yt,Ds=j.imageName?is:0,Yl=new pe(5-Ec-is,-Ds),dl=new pe(...qe);Qe._rotateAround(ua,Cr)._add(Yl)._add(dl),li._rotateAround(ua,Cr)._add(Yl)._add(dl),be._rotateAround(ua,Cr)._add(Yl)._add(dl),He._rotateAround(ua,Cr)._add(Yl)._add(dl)}if(F){const Cr=Math.sin(F),ua=Math.cos(F),is=[ua,-Cr,Cr,ua];Qe._matMult(is),li._matMult(is),be._matMult(is),He._matMult(is)}const ai=new pe(0,0),Hi=new pe(0,0);B.push({tl:Qe,tr:li,bl:be,br:He,tex:$,writingMode:r.writingMode,glyphOffset:te,sectionIndex:j.sectionIndex,isSDF:yt,pixelOffsetTL:ai,pixelOffsetBR:Hi,minFontScaleX:0,minFontScaleY:0})}return B}class Br{constructor(r,s,c,y,b,T,A,F,B,U){var j;if(this.boxStartIndex=r.length,B){let $=T.top,st=T.bottom;const ct=T.collisionPadding;ct&&($-=ct[1],st+=ct[3]);let yt=st-$;yt>0&&(yt=Math.max(10,yt),this.circleDiameter=yt)}else{const $=!((j=T.image)===null||j===void 0)&&j.content&&(T.image.textFitWidth||T.image.textFitHeight)?lm(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};$.y1=$.y1*A-F[0],$.y2=$.y2*A+F[2],$.x1=$.x1*A-F[3],$.x2=$.x2*A+F[1];const st=T.collisionPadding;if(st&&($.x1-=st[0]*A,$.y1-=st[1]*A,$.x2+=st[2]*A,$.y2+=st[3]*A),U){const ct=new pe($.x1,$.y1),yt=new pe($.x2,$.y1),At=new pe($.x1,$.y2),Ut=new pe($.x2,$.y2),re=U*Math.PI/180;ct._rotate(re),yt._rotate(re),At._rotate(re),Ut._rotate(re),$.x1=Math.min(ct.x,yt.x,At.x,Ut.x),$.x2=Math.max(ct.x,yt.x,At.x,Ut.x),$.y1=Math.min(ct.y,yt.y,At.y,Ut.y),$.y2=Math.max(ct.y,yt.y,At.y,Ut.y)}r.emplaceBack(s.x,s.y,$.x1,$.y1,$.x2,$.y2,c,y,b)}this.boxEndIndex=r.length}}class Yn{constructor(r=[],s=(c,y)=>c<y?-1:c>y?1:0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:c}=this,y=s[r];for(;r>0;){const b=r-1>>1,T=s[b];if(c(y,T)>=0)break;s[r]=T,r=b}s[r]=y}_down(r){const{data:s,compare:c}=this,y=this.length>>1,b=s[r];for(;r<y;){let T=(r<<1)+1;const A=T+1;if(A<this.length&&c(s[A],s[T])<0&&(T=A),c(s[T],b)>=0)break;s[r]=s[T],r=T}s[r]=b}}function Tn(n,r=1,s=!1){let c=1/0,y=1/0,b=-1/0,T=-1/0;const A=n[0];for(let yt=0;yt<A.length;yt++){const At=A[yt];(!yt||At.x<c)&&(c=At.x),(!yt||At.y<y)&&(y=At.y),(!yt||At.x>b)&&(b=At.x),(!yt||At.y>T)&&(T=At.y)}const F=b-c,B=T-y,U=Math.min(F,B);let j=U/2;const $=new Yn([],ts);if(U===0)return new pe(c,y);for(let yt=c;yt<b;yt+=U)for(let At=y;At<T;At+=U)$.push(new En(yt+j,At+j,j,n));let st=ms(n),ct=$.length;for(;$.length;){const yt=$.pop();(yt.d>st.d||!st.d)&&(st=yt,s&&console.log("found best %d after %d probes",Math.round(1e4*yt.d)/1e4,ct)),!(yt.max-st.d<=r)&&(j=yt.h/2,$.push(new En(yt.p.x-j,yt.p.y-j,j,n)),$.push(new En(yt.p.x+j,yt.p.y-j,j,n)),$.push(new En(yt.p.x-j,yt.p.y+j,j,n)),$.push(new En(yt.p.x+j,yt.p.y+j,j,n)),ct+=4)}return s&&(console.log(`num probes: ${ct}`),console.log(`best distance: ${st.d}`)),st.p}function ts(n,r){return r.max-n.max}function En(n,r,s,c){this.p=new pe(n,r),this.h=s,this.d=Jn(this.p,c),this.max=this.d+this.h*Math.SQRT2}function Jn(n,r){let s=!1,c=1/0;for(let y=0;y<r.length;y++){const b=r[y];for(let T=0,A=b.length,F=A-1;T<A;F=T++){const B=b[T],U=b[F];B.y>n.y!=U.y>n.y&&n.x<(U.x-B.x)*(n.y-B.y)/(U.y-B.y)+B.x&&(s=!s),c=Math.min(c,Eu(n,B,U))}}return(s?1:-1)*Math.sqrt(c)}function ms(n){let r=0,s=0,c=0;const y=n[0];for(let b=0,T=y.length,A=T-1;b<T;A=b++){const F=y[b],B=y[A],U=F.x*B.y-B.x*F.y;s+=(F.x+B.x)*U,c+=(F.y+B.y)*U,r+=U*3}return new En(s/r,c/r,0,n)}v.aq=void 0,function(n){n[n.center=1]="center",n[n.left=2]="left",n[n.right=3]="right",n[n.top=4]="top",n[n.bottom=5]="bottom",n[n["top-left"]=6]="top-left",n[n["top-right"]=7]="top-right",n[n["bottom-left"]=8]="bottom-left",n[n["bottom-right"]=9]="bottom-right"}(v.aq||(v.aq={}));const fn=7,dn=Number.POSITIVE_INFINITY;function es(n,r){function s(y,b){let T=0,A=0;b<0&&(b=0);const F=b/Math.SQRT2;switch(y){case"top-right":case"top-left":A=F-fn;break;case"bottom-right":case"bottom-left":A=-F+fn;break;case"bottom":A=-b+fn;break;case"top":A=b-fn;break}switch(y){case"top-right":case"bottom-right":T=-F;break;case"top-left":case"bottom-left":T=F;break;case"left":T=b;break;case"right":T=-b;break}return[T,A]}function c(y,b,T){let A=0,F=0;switch(b=Math.abs(b),T=Math.abs(T),y){case"top-right":case"top-left":case"top":F=T-fn;break;case"bottom-right":case"bottom-left":case"bottom":F=-T+fn;break}switch(y){case"top-right":case"bottom-right":case"right":A=-b;break;case"top-left":case"bottom-left":case"left":A=b;break}return[A,F]}return r[1]!==dn?c(n,r[0],r[1]):s(n,r[0])}function ro(n,r,s){var c;const y=n.layout,b=(c=y.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(r,{},s);if(b){const A=b.values,F=[];for(let B=0;B<A.length;B+=2){const U=F[B]=A[B],j=A[B+1].map($=>$*Tr);U.startsWith("top")?j[1]-=fn:U.startsWith("bottom")&&(j[1]+=fn),F[B+1]=j}return new Pr(F)}const T=y.get("text-variable-anchor");if(T){let A;n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?A=[y.get("text-radial-offset").evaluate(r,{},s)*Tr,dn]:A=y.get("text-offset").evaluate(r,{},s).map(U=>U*Tr);const B=[];for(const U of T)B.push(U,es(U,A));return new Pr(B)}return null}function Oh(n){n.bucket.createArrays();const r=512*n.bucket.overscaling;n.bucket.tilePixelRatio=ye/r,n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const s=n.bucket.layers[0],c=s.layout,y=s._unevaluatedLayout._values,b={layoutIconSize:y["icon-size"].possiblyEvaluate(new gr(n.bucket.zoom+1),n.canonical),layoutTextSize:y["text-size"].possiblyEvaluate(new gr(n.bucket.zoom+1),n.canonical),textMaxSize:y["text-size"].possiblyEvaluate(new gr(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:U,maxZoom:j}=n.bucket.textSizeData;b.compositeTextSizes=[y["text-size"].possiblyEvaluate(new gr(U),n.canonical),y["text-size"].possiblyEvaluate(new gr(j),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:U,maxZoom:j}=n.bucket.iconSizeData;b.compositeIconSizes=[y["icon-size"].possiblyEvaluate(new gr(U),n.canonical),y["icon-size"].possiblyEvaluate(new gr(j),n.canonical)]}const T=c.get("text-line-height")*Tr,A=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",F=c.get("text-keep-upright"),B=c.get("text-size");for(const U of n.bucket.features){const j=c.get("text-font").evaluate(U,{},n.canonical).join(","),$=B.evaluate(U,{},n.canonical),st=b.layoutTextSize.evaluate(U,{},n.canonical),ct=b.layoutIconSize.evaluate(U,{},n.canonical),yt={horizontal:{},vertical:void 0},At=U.text;let Ut=[0,0];if(At){const de=At.toString(),qe=c.get("text-letter-spacing").evaluate(U,{},n.canonical)*Tr,$e=jr(de)?qe:0,yi=c.get("text-anchor").evaluate(U,{},n.canonical),hi=ro(s,U,n.canonical);if(!hi){const be=c.get("text-radial-offset").evaluate(U,{},n.canonical);be?Ut=es(yi,[be*Tr,dn]):Ut=c.get("text-offset").evaluate(U,{},n.canonical).map(He=>He*Tr)}let je=A?"center":c.get("text-justify").evaluate(U,{},n.canonical);const Qe=c.get("symbol-placement")==="point"?c.get("text-max-width").evaluate(U,{},n.canonical)*Tr:1/0,li=()=>{n.bucket.allowVerticalPlacement&&Ol(de)&&(yt.vertical=mp(At,n.glyphMap,n.glyphPositions,n.imagePositions,j,Qe,T,yi,"left",$e,Ut,v.ah.vertical,!0,st,$))};if(!A&&hi){const be=new Set;if(je==="auto")for(let ai=0;ai<hi.values.length;ai+=2)be.add(ah(hi.values[ai]));else be.add(je);let He=!1;for(const ai of be)if(!yt.horizontal[ai])if(He)yt.horizontal[ai]=yt.horizontal[0];else{const Hi=mp(At,n.glyphMap,n.glyphPositions,n.imagePositions,j,Qe,T,"center",ai,$e,Ut,v.ah.horizontal,!1,st,$);Hi&&(yt.horizontal[ai]=Hi,He=Hi.positionedLines.length===1)}li()}else{je==="auto"&&(je=ah(yi));const be=mp(At,n.glyphMap,n.glyphPositions,n.imagePositions,j,Qe,T,yi,je,$e,Ut,v.ah.horizontal,!1,st,$);be&&(yt.horizontal[je]=be),li(),Ol(de)&&A&&F&&(yt.vertical=mp(At,n.glyphMap,n.glyphPositions,n.imagePositions,j,Qe,T,yi,je,$e,Ut,v.ah.vertical,!1,st,$))}}let re,Yt=!1;if(U.icon&&U.icon.name){const de=n.imageMap[U.icon.name];de&&(re=t_(n.imagePositions[U.icon.name],c.get("icon-offset").evaluate(U,{},n.canonical),c.get("icon-anchor").evaluate(U,{},n.canonical)),Yt=!!de.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Yt:n.bucket.sdfIcons!==Yt&&rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(de.pixelRatio!==n.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const te=fl(yt.horizontal)||yt.vertical;n.bucket.iconsInText=te?te.iconsInText:!1,(te||re)&&Ic(n.bucket,U,yt,re,n.imageMap,b,st,ct,Ut,Yt,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()}function ah(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ic(n,r,s,c,y,b,T,A,F,B,U){let j=b.textMaxSize.evaluate(r,{});j===void 0&&(j=T);const $=n.layers[0].layout,st=$.get("icon-offset").evaluate(r,{},U),ct=fl(s.horizontal),yt=24,At=T/yt,Ut=n.tilePixelRatio*At,re=n.tilePixelRatio*j/yt,Yt=n.tilePixelRatio*A,te=n.tilePixelRatio*$.get("symbol-spacing"),de=$.get("text-padding")*n.tilePixelRatio,qe=Wd($,r,U,n.tilePixelRatio),$e=$.get("text-max-angle")/180*Math.PI,yi=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",hi=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",je=$.get("symbol-placement"),ci=te/2,Qe=$.get("icon-text-fit");let li;c&&Qe!=="none"&&(n.allowVerticalPlacement&&s.vertical&&(li=um(c,s.vertical,Qe,$.get("icon-text-fit-padding"),st,At)),ct&&(c=um(c,ct,Qe,$.get("icon-text-fit-padding"),st,At)));const be=(He,ai)=>{ai.x<0||ai.x>=ye||ai.y<0||ai.y>=ye||Tp(n,ai,He,s,c,y,li,n.layers[0],n.collisionBoxArray,r.index,r.sourceLayerIndex,n.index,Ut,[de,de,de,de],yi,F,Yt,qe,hi,st,r,b,B,U,T)};if(je==="line")for(const He of Be(r.geometry,0,0,ye,ye)){const ai=ni(He,te,$e,s.vertical||ct,c,yt,re,n.overscaling,ye);for(const Hi of ai){const pn=ct;(!pn||!pm(n,pn.text,ci,Hi))&&be(He,Hi)}}else if(je==="line-center"){for(const He of r.geometry)if(He.length>1){const ai=gi(He,$e,s.vertical||ct,c,yt,re);ai&&be(He,ai)}}else if(r.type==="Polygon")for(const He of Jh(r.geometry,0)){const ai=Tn(He,16);be(He[0],new Te(ai.x,ai.y,0))}else if(r.type==="LineString")for(const He of r.geometry)be(He,new Te(He[0].x,He[0].y,0));else if(r.type==="Point")for(const He of r.geometry)for(const ai of He)be([ai],new Te(ai.x,ai.y,0))}function Cc(n,r){const s=n.length,c=r==null?void 0:r.values;if((c==null?void 0:c.length)>0)for(let y=0;y<c.length;y+=2){const b=v.aq[c[y]],T=c[y+1];n.emplaceBack(b,T[0],T[1])}return[s,n.length]}function xf(n,r,s,c,y,b,T,A,F,B,U,j,$,st,ct){const yt=Kr(r,s,A,y,b,T,c,n.allowVerticalPlacement),At=n.textSizeData;let Ut=null;At.kind==="source"?(Ut=[cl*y.layout.get("text-size").evaluate(T,{})],Ut[0]>Mo&&rr(`${n.layerIds[0]}: Value for "text-size" is >= ${sd}. Reduce your "text-size".`)):At.kind==="composite"&&(Ut=[cl*st.compositeTextSizes[0].evaluate(T,{},ct),cl*st.compositeTextSizes[1].evaluate(T,{},ct)],(Ut[0]>Mo||Ut[1]>Mo)&&rr(`${n.layerIds[0]}: Value for "text-size" is >= ${sd}. Reduce your "text-size".`)),n.addSymbols(n.text,yt,Ut,A,b,T,B,r,F.lineStartIndex,F.lineLength,$,ct);for(const re of U)j[re]=n.text.placedSymbolArray.length-1;return yt.length*4}function fl(n){for(const r in n)return n[r];return null}function Tp(n,r,s,c,y,b,T,A,F,B,U,j,$,st,ct,yt,At,Ut,re,Yt,te,de,qe,$e,yi){const hi=n.addToLineVertexArray(r,s);let je,ci,Qe,li,be=0,He=0,ai=0,Hi=0,pn=-1,no=-1;const Cr={};let ua=k("");if(n.allowVerticalPlacement&&c.vertical){const pl=A.layout.get("text-rotate").evaluate(te,{},$e)+90,bf=c.vertical;Qe=new Br(F,r,B,U,j,bf,$,st,ct,pl),T&&(li=new Br(F,r,B,U,j,T,At,Ut,ct,pl))}if(y){const Pu=A.layout.get("icon-rotate").evaluate(te,{}),pl=A.layout.get("icon-text-fit")!=="none",bf=Zi(y,Pu,qe,pl),dd=T?Zi(T,Pu,qe,pl):void 0;ci=new Br(F,r,B,U,j,y,At,Ut,!1,Pu),be=bf.length*4;const gm=n.iconSizeData;let sh=null;gm.kind==="source"?(sh=[cl*A.layout.get("icon-size").evaluate(te,{})],sh[0]>Mo&&rr(`${n.layerIds[0]}: Value for "icon-size" is >= ${sd}. Reduce your "icon-size".`)):gm.kind==="composite"&&(sh=[cl*de.compositeIconSizes[0].evaluate(te,{},$e),cl*de.compositeIconSizes[1].evaluate(te,{},$e)],(sh[0]>Mo||sh[1]>Mo)&&rr(`${n.layerIds[0]}: Value for "icon-size" is >= ${sd}. Reduce your "icon-size".`)),n.addSymbols(n.icon,bf,sh,Yt,re,te,v.ah.none,r,hi.lineStartIndex,hi.lineLength,-1,$e),pn=n.icon.placedSymbolArray.length-1,dd&&(He=dd.length*4,n.addSymbols(n.icon,dd,sh,Yt,re,te,v.ah.vertical,r,hi.lineStartIndex,hi.lineLength,-1,$e),no=n.icon.placedSymbolArray.length-1)}const is=Object.keys(c.horizontal);for(const Pu of is){const pl=c.horizontal[Pu];if(!je){ua=k(pl.text);const dd=A.layout.get("text-rotate").evaluate(te,{},$e);je=new Br(F,r,B,U,j,pl,$,st,ct,dd)}const bf=pl.positionedLines.length===1;if(ai+=xf(n,r,pl,b,A,ct,te,yt,hi,c.vertical?v.ah.horizontal:v.ah.horizontalOnly,bf?is:[Pu],Cr,pn,de,$e),bf)break}c.vertical&&(Hi+=xf(n,r,c.vertical,b,A,ct,te,yt,hi,v.ah.vertical,["vertical"],Cr,no,de,$e));const Ds=je?je.boxStartIndex:n.collisionBoxArray.length,Yl=je?je.boxEndIndex:n.collisionBoxArray.length,dl=Qe?Qe.boxStartIndex:n.collisionBoxArray.length,l_=Qe?Qe.boxEndIndex:n.collisionBoxArray.length,u_=ci?ci.boxStartIndex:n.collisionBoxArray.length,h_=ci?ci.boxEndIndex:n.collisionBoxArray.length,c_=li?li.boxStartIndex:n.collisionBoxArray.length,Dg=li?li.boxEndIndex:n.collisionBoxArray.length;let Cu=-1;const fd=(Pu,pl)=>Pu&&Pu.circleDiameter?Math.max(Pu.circleDiameter,pl):pl;Cu=fd(je,Cu),Cu=fd(Qe,Cu),Cu=fd(ci,Cu),Cu=fd(li,Cu);const _m=Cu>-1?1:0;_m&&(Cu*=yi/Tr),n.glyphOffsetArray.length>=yf.MAX_GLYPHS&&rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),te.sortKey!==void 0&&n.addToSortKeyRanges(n.symbolInstances.length,te.sortKey);const kg=ro(A,te,$e),[f_,Fg]=Cc(n.textAnchorOffsets,kg);n.symbolInstances.emplaceBack(r.x,r.y,Cr.right>=0?Cr.right:-1,Cr.center>=0?Cr.center:-1,Cr.left>=0?Cr.left:-1,Cr.vertical||-1,pn,no,ua,Ds,Yl,dl,l_,u_,h_,c_,Dg,B,ai,Hi,be,He,_m,0,$,Cu,f_,Fg)}function pm(n,r,s,c){const y=n.compareText;if(!(r in y))y[r]=[];else{const b=y[r];for(let T=b.length-1;T>=0;T--)if(c.dist(b[T])<s)return!0}return y[r].push(c),!1}const Yd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Jd=1,_s=8;class Pc{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(r,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=c>>4;if(y!==Jd)throw new Error(`Got v${y} data when expected v${Jd}.`);const b=Yd[c&15];if(!b)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(r,2,1),[A]=new Uint32Array(r,4,1);return new Pc(A,T,b,r)}constructor(r,s=64,c=Float64Array,y){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const b=Yd.indexOf(this.ArrayType),T=r*2*this.ArrayType.BYTES_PER_ELEMENT,A=r*this.IndexArrayType.BYTES_PER_ELEMENT,F=(8-A%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${c}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,_s,r),this.coords=new this.ArrayType(this.data,_s+A+F,r*2),this._pos=r*2,this._finished=!0):(this.data=new ArrayBuffer(_s+T+A+F),this.ids=new this.IndexArrayType(this.data,_s,r),this.coords=new this.ArrayType(this.data,_s+A+F,r*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(Jd<<4)+b]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=r)}add(r,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=r,this.coords[this._pos++]=s,c}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return ud(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,s,c,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:T,nodeSize:A}=this,F=[0,b.length-1,0],B=[];for(;F.length;){const U=F.pop()||0,j=F.pop()||0,$=F.pop()||0;if(j-$<=A){for(let At=$;At<=j;At++){const Ut=T[2*At],re=T[2*At+1];Ut>=r&&Ut<=c&&re>=s&&re<=y&&B.push(b[At])}continue}const st=$+j>>1,ct=T[2*st],yt=T[2*st+1];ct>=r&&ct<=c&&yt>=s&&yt<=y&&B.push(b[st]),(U===0?r<=ct:s<=yt)&&(F.push($),F.push(st-1),F.push(1-U)),(U===0?c>=ct:y>=yt)&&(F.push(st+1),F.push(j),F.push(1-U))}return B}within(r,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:b,nodeSize:T}=this,A=[0,y.length-1,0],F=[],B=c*c;for(;A.length;){const U=A.pop()||0,j=A.pop()||0,$=A.pop()||0;if(j-$<=T){for(let At=$;At<=j;At++)qg(b[2*At],b[2*At+1],r,s)<=B&&F.push(y[At]);continue}const st=$+j>>1,ct=b[2*st],yt=b[2*st+1];qg(ct,yt,r,s)<=B&&F.push(y[st]),(U===0?r-c<=ct:s-c<=yt)&&(A.push($),A.push(st-1),A.push(1-U)),(U===0?r+c>=ct:s+c>=yt)&&(A.push(st+1),A.push(j),A.push(1-U))}return F}}function ud(n,r,s,c,y,b){if(y-c<=s)return;const T=c+y>>1;hd(n,r,T,c,y,b),ud(n,r,s,c,T-1,1-b),ud(n,r,s,T+1,y,1-b)}function hd(n,r,s,c,y,b){for(;y>c;){if(y-c>600){const B=y-c+1,U=s-c+1,j=Math.log(B),$=.5*Math.exp(2*j/3),st=.5*Math.sqrt(j*$*(B-$)/B)*(U-B/2<0?-1:1),ct=Math.max(c,Math.floor(s-U*$/B+st)),yt=Math.min(y,Math.floor(s+(B-U)*$/B+st));hd(n,r,s,ct,yt,b)}const T=r[2*s+b];let A=c,F=y;for(cd(n,r,c,s),r[2*y+b]>T&&cd(n,r,c,y);A<F;){for(cd(n,r,A,F),A++,F--;r[2*A+b]<T;)A++;for(;r[2*F+b]>T;)F--}r[2*c+b]===T?cd(n,r,c,F):(F++,cd(n,r,F,y)),F<=s&&(c=F+1),s<=F&&(y=F-1)}}function cd(n,r,s,c){Pg(n,s,c),Pg(r,2*s,2*c),Pg(r,2*s+1,2*c+1)}function Pg(n,r,s){const c=n[r];n[r]=n[s],n[s]=c}function qg(n,r,s,c){const y=n-s,b=r-c;return y*y+b*b}v.bg=void 0,function(n){n.create="create",n.load="load",n.fullLoad="fullLoad"}(v.bg||(v.bg={}));let o_=null,mm=[];const Ag=1e3/60,Mg="loadTime",zg="fullLoadTime",Xg={mark(n){performance.mark(n)},frame(n){const r=n;if(o_!=null){const s=r-o_;mm.push(s)}o_=r},clearMetrics(){o_=null,mm=[],performance.clearMeasures(Mg),performance.clearMeasures(zg);for(const n in v.bg)performance.clearMarks(v.bg[n])},getPerformanceMetrics(){performance.measure(Mg,v.bg.create,v.bg.load),performance.measure(zg,v.bg.create,v.bg.fullLoad);const n=performance.getEntriesByName(Mg)[0].duration,r=performance.getEntriesByName(zg)[0].duration,s=mm.length,y=1/(mm.reduce((A,F)=>A+F,0)/s/1e3),b=mm.filter(A=>A>Ag).reduce((A,F)=>A+(F-Ag)/Ag,0),T=b/(s+b)*100;return{loadTime:n,fullLoadTime:r,fps:y,percentDroppedFrames:T,totalFrames:s}}};class Wg{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}}v.$=Ti,v.A=rn,v.B=Eh,v.C=Ba,v.D=Xe,v.E=ho,v.F=Kn,v.G=Vn,v.H=ih,v.I=rm,v.J=Wl,v.K=tp,v.L=df,v.M=Ls,v.N=io,v.O=i,v.P=pe,v.Q=a,v.R=hl,v.S=_t,v.T=mc,v.U=In,v.V=Fa,v.W=lo,v.X=ye,v.Y=l,v.Z=L,v._=C,v.a=Os,v.a$=ym,v.a0=lr,v.a1=it,v.a2=_e,v.a3=vl,v.a4=gs,v.a5=Ee,v.a6=yf,v.a7=lc,v.a8=Hr,v.a9=Zt,v.aA=Ig,v.aB=qr,v.aC=Tl,v.aD=a_,v.aE=Ra,v.aF=Do,v.aG=La,v.aH=mt,v.aI=vt,v.aJ=ie,v.aK=Bt,v.aL=Ot,v.aM=cr,v.aN=Ft,v.aO=Tt,v.aP=Pp,v.aQ=zd,v.aR=Qa,v.aS=sg,v.aT=Ms,v.aU=kp,v.aV=Jl,v.aW=bm,v.aX=ir,v.aY=$a,v.aZ=gc,v.a_=d_,v.aa=Lo,v.ab=_l,v.ac=Fs,v.ad=Ad,v.ae=Ip,v.af=Kf,v.ag=wg,v.ai=od,v.aj=vp,v.ak=Ql,v.al=Be,v.am=Rr,v.an=vc,v.ao=fa,v.ap=Tr,v.ar=yp,v.as=$d,v.at=ah,v.au=om,v.av=Pc,v.aw=vu,v.ax=Ya,v.ay=Ua,v.az=Qr,v.b=Qi,v.b0=nn,v.b1=Mp,v.b2=m_,v.b3=Or,v.b4=ht,v.b5=h,v.b6=Mh,v.b7=xc,v.b8=ml,v.b9=an,v.bA=Qp,v.bB=bi,v.bC=gu,v.bD=Ln,v.ba=on,v.bb=rt,v.bc=Wf,v.bd=ri,v.be=fm,v.bf=Xg,v.bh=$n,v.bi=ln,v.bj=un,v.bk=wh,v.bl=Xt,v.bm=Rt,v.bn=Wt,v.bo=Wm,v.bp=Oh,v.bq=Sc,v.br=Np,v.bs=Hp,v.bt=wc,v.bu=im,v.bv=Wg,v.bw=zi,v.bx=jt,v.by=fe,v.bz=Yr,v.c=Ro,v.d=Oa,v.e=da,v.f=oh,v.g=ys,v.h=gl,v.i=sn,v.j=Oo,v.k=bl,v.l=yl,v.m=ta,v.n=Gm,v.o=Dd,v.p=Xm,v.q=Pa,v.r=Ku,v.s=ea,v.t=Yu,v.u=Fi,v.v=Ht,v.w=rr,v.x=Fo,v.y=Dn,v.z=gr}),Vh("worker",["./shared"],function(v){class C{constructor(tt){this.keyCache={},tt&&this.replace(tt)}replace(tt){this._layerConfigs={},this._layers={},this.update(tt,[])}update(tt,Q){for(const gt of tt){this._layerConfigs[gt.id]=gt;const Pt=this._layers[gt.id]=v.aA(gt);Pt._featureFilter=v.a7(Pt.filter),this.keyCache[gt.id]&&delete this.keyCache[gt.id]}for(const gt of Q)delete this.keyCache[gt],delete this._layerConfigs[gt],delete this._layers[gt];this.familiesBySource={};const lt=v.bk(Object.values(this._layerConfigs),this.keyCache);for(const gt of lt){const Pt=gt.map(W=>this._layers[W.id]),Nt=Pt[0];if(Nt.visibility==="none")continue;const Mt=Nt.source||"";let N=this.familiesBySource[Mt];N||(N=this.familiesBySource[Mt]={});const O=Nt.sourceLayer||"_geojsonTileLayer";let H=N[O];H||(H=N[O]=[]),H.push(Pt)}}}const fe=1;class Yr{constructor(tt){const Q={},lt=[];for(const Mt in tt){const N=tt[Mt],O=Q[Mt]={};for(const H in N){const W=N[+H];if(!W||W.bitmap.width===0||W.bitmap.height===0)continue;const nt={x:0,y:0,w:W.bitmap.width+2*fe,h:W.bitmap.height+2*fe};lt.push(nt),O[H]={rect:nt,metrics:W.metrics}}}const{w:gt,h:Pt}=v.p(lt),Nt=new v.o({width:gt||1,height:Pt||1});for(const Mt in tt){const N=tt[Mt];for(const O in N){const H=N[+O];if(!H||H.bitmap.width===0||H.bitmap.height===0)continue;const W=Q[Mt][O].rect;v.o.copy(H.bitmap,Nt,{x:0,y:0},{x:W.x+fe,y:W.y+fe},H.bitmap)}}this.image=Nt,this.positions=Q}}v.bl("GlyphAtlas",Yr);class Jr{constructor(tt){this.tileID=new v.S(tt.tileID.overscaledZ,tt.tileID.wrap,tt.tileID.canonical.z,tt.tileID.canonical.x,tt.tileID.canonical.y),this.uid=tt.uid,this.zoom=tt.zoom,this.pixelRatio=tt.pixelRatio,this.tileSize=tt.tileSize,this.source=tt.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=tt.showCollisionBoxes,this.collectResourceTiming=!!tt.collectResourceTiming,this.returnDependencies=!!tt.returnDependencies,this.promoteId=tt.promoteId,this.inFlightDependencies=[]}parse(tt,Q,lt,gt){return v._(this,void 0,void 0,function*(){this.status="parsing",this.data=tt,this.collisionBoxArray=new v.a5;const Pt=new v.bm(Object.keys(tt.layers).sort()),Nt=new v.bn(this.tileID,this.promoteId);Nt.bucketLayerIDs=[];const Mt={},N={featureIndex:Nt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:lt},O=Q.familiesBySource[this.source];for(const se in O){const Ae=tt.layers[se];if(!Ae)continue;Ae.version===1&&v.w(`Vector tile source "${this.source}" layer "${se}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ie=Pt.encode(se),We=[];for(let di=0;di<Ae.length;di++){const mi=Ae.feature(di),Ht=Nt.getId(mi,se);We.push({feature:mi,id:Ht,index:di,sourceLayerIndex:Ie})}for(const di of O[se]){const mi=di[0];if(mi.source!==this.source&&v.w(`layer.source = ${mi.source} does not equal this.source = ${this.source}`),mi.minzoom&&this.zoom<Math.floor(mi.minzoom)||mi.maxzoom&&this.zoom>=mi.maxzoom||mi.visibility==="none")continue;pe(di,this.zoom,lt),(Mt[mi.id]=mi.createBucket({index:Nt.bucketLayerIDs.length,layers:di,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ie,sourceID:this.source})).populate(We,N,this.tileID.canonical),Nt.bucketLayerIDs.push(di.map(ii=>ii.id))}}const H=v.aF(N.glyphDependencies,se=>Object.keys(se).map(Number));this.inFlightDependencies.forEach(se=>se==null?void 0:se.abort()),this.inFlightDependencies=[];let W=Promise.resolve({});if(Object.keys(H).length){const se=new AbortController;this.inFlightDependencies.push(se),W=gt.sendAsync({type:"GG",data:{stacks:H,source:this.source,tileID:this.tileID,type:"glyphs"}},se)}const nt=Object.keys(N.iconDependencies);let ft=Promise.resolve({});if(nt.length){const se=new AbortController;this.inFlightDependencies.push(se),ft=gt.sendAsync({type:"GI",data:{icons:nt,source:this.source,tileID:this.tileID,type:"icons"}},se)}const St=Object.keys(N.patternDependencies);let It=Promise.resolve({});if(St.length){const se=new AbortController;this.inFlightDependencies.push(se),It=gt.sendAsync({type:"GI",data:{icons:St,source:this.source,tileID:this.tileID,type:"patterns"}},se)}const[Lt,Vt,qt]=yield Promise.all([W,ft,It]),ee=new Yr(Lt),Jt=new v.bo(Vt,qt);for(const se in Mt){const Ae=Mt[se];Ae instanceof v.a6?(pe(Ae.layers,this.zoom,lt),v.bp({bucket:Ae,glyphMap:Lt,glyphPositions:ee.positions,imageMap:Vt,imagePositions:Jt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ae.hasPattern&&(Ae instanceof v.bq||Ae instanceof v.br||Ae instanceof v.bs)&&(pe(Ae.layers,this.zoom,lt),Ae.addFeatures(N,this.tileID.canonical,Jt.patternPositions))}return this.status="done",{buckets:Object.values(Mt).filter(se=>!se.isEmpty()),featureIndex:Nt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ee.image,imageAtlas:Jt,glyphMap:this.returnDependencies?Lt:null,iconMap:this.returnDependencies?Vt:null,glyphPositions:this.returnDependencies?ee.positions:null}})}}function pe(dt,tt,Q){const lt=new v.z(tt);for(const gt of dt)gt.recalculate(lt,Q)}class ha{constructor(tt,Q,lt){this.actor=tt,this.layerIndex=Q,this.availableImages=lt,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(tt,Q){return v._(this,void 0,void 0,function*(){const lt=yield v.l(tt.request,Q);try{return{vectorTile:new v.bt.VectorTile(new v.bu(lt.data)),rawData:lt.data,cacheControl:lt.cacheControl,expires:lt.expires}}catch(gt){const Pt=new Uint8Array(lt.data),Nt=Pt[0]===31&&Pt[1]===139;let Mt=`Unable to parse the tile at ${tt.request.url}, `;throw Nt?Mt+="please make sure the data is not gzipped and that you have configured the relevant header in the server":Mt+=`got error: ${gt.message}`,new Error(Mt)}})}loadTile(tt){return v._(this,void 0,void 0,function*(){const Q=tt.uid,lt=tt&&tt.request&&tt.request.collectResourceTiming?new v.bv(tt.request):!1,gt=new Jr(tt);this.loading[Q]=gt;const Pt=new AbortController;gt.abort=Pt;try{const Nt=yield this.loadVectorTile(tt,Pt);if(delete this.loading[Q],!Nt)return null;const Mt=Nt.rawData,N={};Nt.expires&&(N.expires=Nt.expires),Nt.cacheControl&&(N.cacheControl=Nt.cacheControl);const O={};if(lt){const W=lt.finish();W&&(O.resourceTiming=JSON.parse(JSON.stringify(W)))}gt.vectorTile=Nt.vectorTile;const H=gt.parse(Nt.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Q]=gt,this.fetching[Q]={rawTileData:Mt,cacheControl:N,resourceTiming:O};try{const W=yield H;return v.e({rawTileData:Mt.slice(0)},W,N,O)}finally{delete this.fetching[Q]}}catch(Nt){throw delete this.loading[Q],gt.status="done",this.loaded[Q]=gt,Nt}})}reloadTile(tt){return v._(this,void 0,void 0,function*(){const Q=tt.uid;if(!this.loaded||!this.loaded[Q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const lt=this.loaded[Q];if(lt.showCollisionBoxes=tt.showCollisionBoxes,lt.status==="parsing"){const gt=yield lt.parse(lt.vectorTile,this.layerIndex,this.availableImages,this.actor);let Pt;if(this.fetching[Q]){const{rawTileData:Nt,cacheControl:Mt,resourceTiming:N}=this.fetching[Q];delete this.fetching[Q],Pt=v.e({rawTileData:Nt.slice(0)},gt,Mt,N)}else Pt=gt;return Pt}if(lt.status==="done"&&lt.vectorTile)return lt.parse(lt.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(tt){return v._(this,void 0,void 0,function*(){const Q=this.loading,lt=tt.uid;Q&&Q[lt]&&Q[lt].abort&&(Q[lt].abort.abort(),delete Q[lt])})}removeTile(tt){return v._(this,void 0,void 0,function*(){this.loaded&&this.loaded[tt.uid]&&delete this.loaded[tt.uid]})}}class me{constructor(){this.loaded={}}loadTile(tt){return v._(this,void 0,void 0,function*(){const{uid:Q,encoding:lt,rawImageData:gt,redFactor:Pt,greenFactor:Nt,blueFactor:Mt,baseShift:N}=tt,O=gt.width+2,H=gt.height+2,W=v.b(gt)?new v.R({width:O,height:H},yield v.bw(gt,-1,-1,O,H)):gt,nt=new v.bx(Q,W,lt,Pt,Nt,Mt,N);return this.loaded=this.loaded||{},this.loaded[Q]=nt,nt})}removeTile(tt){const Q=this.loaded,lt=tt.uid;Q&&Q[lt]&&delete Q[lt]}}var Qt=ca;function ca(dt,tt){var Q=dt&&dt.type,lt;if(Q==="FeatureCollection")for(lt=0;lt<dt.features.length;lt++)ca(dt.features[lt],tt);else if(Q==="GeometryCollection")for(lt=0;lt<dt.geometries.length;lt++)ca(dt.geometries[lt],tt);else if(Q==="Feature")ca(dt.geometry,tt);else if(Q==="Polygon")In(dt.coordinates,tt);else if(Q==="MultiPolygon")for(lt=0;lt<dt.coordinates.length;lt++)In(dt.coordinates[lt],tt);return dt}function In(dt,tt){if(dt.length!==0){ns(dt[0],tt);for(var Q=1;Q<dt.length;Q++)ns(dt[Q],!tt)}}function ns(dt,tt){for(var Q=0,lt=0,gt=0,Pt=dt.length,Nt=Pt-1;gt<Pt;Nt=gt++){var Mt=(dt[gt][0]-dt[Nt][0])*(dt[Nt][1]+dt[gt][1]),N=Q+Mt;lt+=Math.abs(Q)>=Math.abs(Mt)?Q-N+Mt:Mt-N+Q,Q=N}Q+lt>=0!=!!tt&&dt.reverse()}var Fa=v.by(Qt);const fa=v.bt.VectorTileFeature.prototype.toGeoJSON;let zo=class{constructor(tt){this._feature=tt,this.extent=v.X,this.type=tt.type,this.properties=tt.tags,"id"in tt&&!isNaN(tt.id)&&(this.id=parseInt(tt.id,10))}loadGeometry(){if(this._feature.type===1){const tt=[];for(const Q of this._feature.geometry)tt.push([new v.P(Q[0],Q[1])]);return tt}else{const tt=[];for(const Q of this._feature.geometry){const lt=[];for(const gt of Q)lt.push(new v.P(gt[0],gt[1]));tt.push(lt)}return tt}}toGeoJSON(tt,Q,lt){return fa.call(this,tt,Q,lt)}},ml=class{constructor(tt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.X,this.length=tt.length,this._features=tt}feature(tt){return new zo(this._features[tt])}};var an={exports:{}},Fs=v.bz,Or=v.bt.VectorTileFeature,_l=da;function da(dt,tt){this.options=tt||{},this.features=dt,this.length=dt.length}da.prototype.feature=function(dt){return new Ls(this.features[dt],this.options.extent)};function Ls(dt,tt){this.id=typeof dt.id=="number"?dt.id:void 0,this.type=dt.type,this.rawGeometry=dt.type===1?[dt.geometry]:dt.geometry,this.properties=dt.tags,this.extent=tt||4096}Ls.prototype.loadGeometry=function(){var dt=this.rawGeometry;this.geometry=[];for(var tt=0;tt<dt.length;tt++){for(var Q=dt[tt],lt=[],gt=0;gt<Q.length;gt++)lt.push(new Fs(Q[gt][0],Q[gt][1]));this.geometry.push(lt)}return this.geometry},Ls.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var dt=this.geometry,tt=1/0,Q=-1/0,lt=1/0,gt=-1/0,Pt=0;Pt<dt.length;Pt++)for(var Nt=dt[Pt],Mt=0;Mt<Nt.length;Mt++){var N=Nt[Mt];tt=Math.min(tt,N.x),Q=Math.max(Q,N.x),lt=Math.min(lt,N.y),gt=Math.max(gt,N.y)}return[tt,lt,Q,gt]},Ls.prototype.toGeoJSON=Or.prototype.toGeoJSON;var pa=v.bA,gs=_l;an.exports=Rs,an.exports.fromVectorTileJs=Rs,an.exports.fromGeojsonVt=Jl,an.exports.GeoJSONWrapper=gs;function Rs(dt){var tt=new pa;return Do(dt,tt),tt.finish()}function Jl(dt,tt){tt=tt||{};var Q={};for(var lt in dt)Q[lt]=new gs(dt[lt].features,tt),Q[lt].name=lt,Q[lt].version=tt.version,Q[lt].extent=tt.extent;return Rs({layers:Q})}function Do(dt,tt){for(var Q in dt.layers)tt.writeMessage(3,La,dt.layers[Q])}function La(dt,tt){tt.writeVarintField(15,dt.version||1),tt.writeStringField(1,dt.name||""),tt.writeVarintField(5,dt.extent||4096);var Q,lt={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<dt.length;Q++)lt.feature=dt.feature(Q),tt.writeMessage(2,Ra,lt);var gt=lt.keys;for(Q=0;Q<gt.length;Q++)tt.writeStringField(3,gt[Q]);var Pt=lt.values;for(Q=0;Q<Pt.length;Q++)tt.writeMessage(4,mn,Pt[Q])}function Ra(dt,tt){var Q=dt.feature;Q.id!==void 0&&tt.writeVarintField(1,Q.id),tt.writeMessage(2,qr,dt),tt.writeVarintField(3,Q.type),tt.writeMessage(4,rr,Q)}function qr(dt,tt){var Q=dt.feature,lt=dt.keys,gt=dt.values,Pt=dt.keycache,Nt=dt.valuecache;for(var Mt in Q.properties){var N=Q.properties[Mt],O=Pt[Mt];if(N!==null){typeof O>"u"&&(lt.push(Mt),O=lt.length-1,Pt[Mt]=O),tt.writeVarint(O);var H=typeof N;H!=="string"&&H!=="boolean"&&H!=="number"&&(N=JSON.stringify(N));var W=H+":"+N,nt=Nt[W];typeof nt>"u"&&(gt.push(N),nt=gt.length-1,Nt[W]=nt),tt.writeVarint(nt)}}}function so(dt,tt){return(tt<<3)+(dt&7)}function ko(dt){return dt<<1^dt>>31}function rr(dt,tt){for(var Q=dt.loadGeometry(),lt=dt.type,gt=0,Pt=0,Nt=Q.length,Mt=0;Mt<Nt;Mt++){var N=Q[Mt],O=1;lt===1&&(O=N.length),tt.writeVarint(so(1,O));for(var H=lt===3?N.length-1:N.length,W=0;W<H;W++){W===1&&lt!==1&&tt.writeVarint(so(2,H-1));var nt=N[W].x-gt,ft=N[W].y-Pt;tt.writeVarint(ko(nt)),tt.writeVarint(ko(ft)),gt+=nt,Pt+=ft}lt===3&&tt.writeVarint(so(7,1))}}function mn(dt,tt){var Q=typeof dt;Q==="string"?tt.writeStringField(1,dt):Q==="boolean"?tt.writeBooleanField(7,dt):Q==="number"&&(dt%1!==0?tt.writeDoubleField(3,dt):dt<0?tt.writeSVarintField(6,dt):tt.writeVarintField(5,dt))}var Ql=an.exports,Fo=v.by(Ql);const sn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:dt=>dt},Lo=Math.fround||(dt=>tt=>(dt[0]=+tt,dt[0]))(new Float32Array(1)),On=2,Ba=3,Qi=4,Oa=5,oo=6;class oh{constructor(tt){this.options=Object.assign(Object.create(sn),tt),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(tt){const{log:Q,minZoom:lt,maxZoom:gt}=this.options;Q&&console.time("total time");const Pt=`prepare ${tt.length} points`;Q&&console.time(Pt),this.points=tt;const Nt=[];for(let N=0;N<tt.length;N++){const O=tt[N];if(!O.geometry)continue;const[H,W]=O.geometry.coordinates,nt=Lo(ma(H)),ft=Lo(Cn(W));Nt.push(nt,ft,1/0,N,-1,1),this.options.reduce&&Nt.push(0)}let Mt=this.trees[gt+1]=this._createTree(Nt);Q&&console.timeEnd(Pt);for(let N=gt;N>=lt;N--){const O=+Date.now();Mt=this.trees[N]=this._createTree(this._cluster(Mt,N)),Q&&console.log("z%d: %d clusters in %dms",N,Mt.numItems,+Date.now()-O)}return Q&&console.timeEnd("total time"),this}getClusters(tt,Q){let lt=((tt[0]+180)%360+360)%360-180;const gt=Math.max(-90,Math.min(90,tt[1]));let Pt=tt[2]===180?180:((tt[2]+180)%360+360)%360-180;const Nt=Math.max(-90,Math.min(90,tt[3]));if(tt[2]-tt[0]>=360)lt=-180,Pt=180;else if(lt>Pt){const W=this.getClusters([lt,gt,180,Nt],Q),nt=this.getClusters([-180,gt,Pt,Nt],Q);return W.concat(nt)}const Mt=this.trees[this._limitZoom(Q)],N=Mt.range(ma(lt),Cn(Nt),ma(Pt),Cn(gt)),O=Mt.data,H=[];for(const W of N){const nt=this.stride*W;H.push(O[nt+Oa]>1?$l(O,nt,this.clusterProps):this.points[O[nt+Ba]])}return H}getChildren(tt){const Q=this._getOriginId(tt),lt=this._getOriginZoom(tt),gt="No cluster with the specified id.",Pt=this.trees[lt];if(!Pt)throw new Error(gt);const Nt=Pt.data;if(Q*this.stride>=Nt.length)throw new Error(gt);const Mt=this.options.radius/(this.options.extent*Math.pow(2,lt-1)),N=Nt[Q*this.stride],O=Nt[Q*this.stride+1],H=Pt.within(N,O,Mt),W=[];for(const nt of H){const ft=nt*this.stride;Nt[ft+Qi]===tt&&W.push(Nt[ft+Oa]>1?$l(Nt,ft,this.clusterProps):this.points[Nt[ft+Ba]])}if(W.length===0)throw new Error(gt);return W}getLeaves(tt,Q,lt){Q=Q||10,lt=lt||0;const gt=[];return this._appendLeaves(gt,tt,Q,lt,0),gt}getTile(tt,Q,lt){const gt=this.trees[this._limitZoom(tt)],Pt=Math.pow(2,tt),{extent:Nt,radius:Mt}=this.options,N=Mt/Nt,O=(lt-N)/Pt,H=(lt+1+N)/Pt,W={features:[]};return this._addTileFeatures(gt.range((Q-N)/Pt,O,(Q+1+N)/Pt,H),gt.data,Q,lt,Pt,W),Q===0&&this._addTileFeatures(gt.range(1-N/Pt,O,1,H),gt.data,Pt,lt,Pt,W),Q===Pt-1&&this._addTileFeatures(gt.range(0,O,N/Pt,H),gt.data,-1,lt,Pt,W),W.features.length?W:null}getClusterExpansionZoom(tt){let Q=this._getOriginZoom(tt)-1;for(;Q<=this.options.maxZoom;){const lt=this.getChildren(tt);if(Q++,lt.length!==1)break;tt=lt[0].properties.cluster_id}return Q}_appendLeaves(tt,Q,lt,gt,Pt){const Nt=this.getChildren(Q);for(const Mt of Nt){const N=Mt.properties;if(N&&N.cluster?Pt+N.point_count<=gt?Pt+=N.point_count:Pt=this._appendLeaves(tt,N.cluster_id,lt,gt,Pt):Pt<gt?Pt++:tt.push(Mt),tt.length===lt)break}return Pt}_createTree(tt){const Q=new v.av(tt.length/this.stride|0,this.options.nodeSize,Float32Array);for(let lt=0;lt<tt.length;lt+=this.stride)Q.add(tt[lt],tt[lt+1]);return Q.finish(),Q.data=tt,Q}_addTileFeatures(tt,Q,lt,gt,Pt,Nt){for(const Mt of tt){const N=Mt*this.stride,O=Q[N+Oa]>1;let H,W,nt;if(O)H=lo(Q,N,this.clusterProps),W=Q[N],nt=Q[N+1];else{const It=this.points[Q[N+Ba]];H=It.properties;const[Lt,Vt]=It.geometry.coordinates;W=ma(Lt),nt=Cn(Vt)}const ft={type:1,geometry:[[Math.round(this.options.extent*(W*Pt-lt)),Math.round(this.options.extent*(nt*Pt-gt))]],tags:H};let St;O||this.options.generateId?St=Q[N+Ba]:St=this.points[Q[N+Ba]].id,St!==void 0&&(ft.id=St),Nt.features.push(ft)}}_limitZoom(tt){return Math.max(this.options.minZoom,Math.min(Math.floor(+tt),this.options.maxZoom+1))}_cluster(tt,Q){const{radius:lt,extent:gt,reduce:Pt,minPoints:Nt}=this.options,Mt=lt/(gt*Math.pow(2,Q)),N=tt.data,O=[],H=this.stride;for(let W=0;W<N.length;W+=H){if(N[W+On]<=Q)continue;N[W+On]=Q;const nt=N[W],ft=N[W+1],St=tt.within(N[W],N[W+1],Mt),It=N[W+Oa];let Lt=It;for(const Vt of St){const qt=Vt*H;N[qt+On]>Q&&(Lt+=N[qt+Oa])}if(Lt>It&&Lt>=Nt){let Vt=nt*It,qt=ft*It,ee,Jt=-1;const se=((W/H|0)<<5)+(Q+1)+this.points.length;for(const Ae of St){const Ie=Ae*H;if(N[Ie+On]<=Q)continue;N[Ie+On]=Q;const We=N[Ie+Oa];Vt+=N[Ie]*We,qt+=N[Ie+1]*We,N[Ie+Qi]=se,Pt&&(ee||(ee=this._map(N,W,!0),Jt=this.clusterProps.length,this.clusterProps.push(ee)),Pt(ee,this._map(N,Ie)))}N[W+Qi]=se,O.push(Vt/Lt,qt/Lt,1/0,se,-1,Lt),Pt&&O.push(Jt)}else{for(let Vt=0;Vt<H;Vt++)O.push(N[W+Vt]);if(Lt>1)for(const Vt of St){const qt=Vt*H;if(!(N[qt+On]<=Q)){N[qt+On]=Q;for(let ee=0;ee<H;ee++)O.push(N[qt+ee])}}}}return O}_getOriginId(tt){return tt-this.points.length>>5}_getOriginZoom(tt){return(tt-this.points.length)%32}_map(tt,Q,lt){if(tt[Q+Oa]>1){const Nt=this.clusterProps[tt[Q+oo]];return lt?Object.assign({},Nt):Nt}const gt=this.points[tt[Q+Ba]].properties,Pt=this.options.map(gt);return lt&&Pt===gt?Object.assign({},Pt):Pt}}function $l(dt,tt,Q){return{type:"Feature",id:dt[tt+Ba],properties:lo(dt,tt,Q),geometry:{type:"Point",coordinates:[Bs(dt[tt]),zi(dt[tt+1])]}}}function lo(dt,tt,Q){const lt=dt[tt+Oa],gt=lt>=1e4?`${Math.round(lt/1e3)}k`:lt>=1e3?`${Math.round(lt/100)/10}k`:lt,Pt=dt[tt+oo],Nt=Pt===-1?{}:Object.assign({},Q[Pt]);return Object.assign(Nt,{cluster:!0,cluster_id:dt[tt+Ba],point_count:lt,point_count_abbreviated:gt})}function ma(dt){return dt/360+.5}function Cn(dt){const tt=Math.sin(dt*Math.PI/180),Q=.5-.25*Math.log((1+tt)/(1-tt))/Math.PI;return Q<0?0:Q>1?1:Q}function Bs(dt){return(dt-.5)*360}function zi(dt){const tt=(180-dt*360)*Math.PI/180;return 360*Math.atan(Math.exp(tt))/Math.PI-90}function uo(dt,tt,Q,lt){let gt=lt;const Pt=tt+(Q-tt>>1);let Nt=Q-tt,Mt;const N=dt[tt],O=dt[tt+1],H=dt[Q],W=dt[Q+1];for(let nt=tt+3;nt<Q;nt+=3){const ft=on(dt[nt],dt[nt+1],N,O,H,W);if(ft>gt)Mt=nt,gt=ft;else if(ft===gt){const St=Math.abs(nt-Pt);St<Nt&&(Mt=nt,Nt=St)}}gt>lt&&(Mt-tt>3&&uo(dt,tt,Mt,lt),dt[Mt+2]=gt,Q-Mt>3&&uo(dt,Mt,Q,lt))}function on(dt,tt,Q,lt,gt,Pt){let Nt=gt-Q,Mt=Pt-lt;if(Nt!==0||Mt!==0){const N=((dt-Q)*Nt+(tt-lt)*Mt)/(Nt*Nt+Mt*Mt);N>1?(Q=gt,lt=Pt):N>0&&(Q+=Nt*N,lt+=Mt*N)}return Nt=dt-Q,Mt=tt-lt,Nt*Nt+Mt*Mt}function _n(dt,tt,Q,lt){const gt={id:dt??null,type:tt,geometry:Q,tags:lt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(tt==="Point"||tt==="MultiPoint"||tt==="LineString")Qn(gt,Q);else if(tt==="Polygon")Qn(gt,Q[0]);else if(tt==="MultiLineString")for(const Pt of Q)Qn(gt,Pt);else if(tt==="MultiPolygon")for(const Pt of Q)Qn(gt,Pt[0]);return gt}function Qn(dt,tt){for(let Q=0;Q<tt.length;Q+=3)dt.minX=Math.min(dt.minX,tt[Q]),dt.minY=Math.min(dt.minY,tt[Q+1]),dt.maxX=Math.max(dt.maxX,tt[Q]),dt.maxY=Math.max(dt.maxY,tt[Q+1])}function Va(dt,tt){const Q=[];if(dt.type==="FeatureCollection")for(let lt=0;lt<dt.features.length;lt++)bi(Q,dt.features[lt],tt,lt);else dt.type==="Feature"?bi(Q,dt,tt):bi(Q,{geometry:dt},tt);return Q}function bi(dt,tt,Q,lt){if(!tt.geometry)return;const gt=tt.geometry.coordinates;if(gt&&gt.length===0)return;const Pt=tt.geometry.type,Nt=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2);let Mt=[],N=tt.id;if(Q.promoteId?N=tt.properties[Q.promoteId]:Q.generateId&&(N=lt||0),Pt==="Point")Ro(gt,Mt);else if(Pt==="MultiPoint")for(const O of gt)Ro(O,Mt);else if(Pt==="LineString")Os(gt,Mt,Nt,!1);else if(Pt==="MultiLineString")if(Q.lineMetrics){for(const O of gt)Mt=[],Os(O,Mt,Nt,!1),dt.push(_n(N,"LineString",Mt,tt.properties));return}else ys(gt,Mt,Nt,!1);else if(Pt==="Polygon")ys(gt,Mt,Nt,!0);else if(Pt==="MultiPolygon")for(const O of gt){const H=[];ys(O,H,Nt,!0),Mt.push(H)}else if(Pt==="GeometryCollection"){for(const O of tt.geometry.geometries)bi(dt,{id:N,geometry:O,properties:tt.properties},Q,lt);return}else throw new Error("Input data is not a valid GeoJSON object.");dt.push(_n(N,Pt,Mt,tt.properties))}function Ro(dt,tt){tt.push(ln(dt[0]),un(dt[1]),0)}function Os(dt,tt,Q,lt){let gt,Pt,Nt=0;for(let N=0;N<dt.length;N++){const O=ln(dt[N][0]),H=un(dt[N][1]);tt.push(O,H,0),N>0&&(lt?Nt+=(gt*H-O*Pt)/2:Nt+=Math.sqrt(Math.pow(O-gt,2)+Math.pow(H-Pt,2))),gt=O,Pt=H}const Mt=tt.length-3;tt[2]=1,uo(tt,0,Mt,Q),tt[Mt+2]=1,tt.size=Math.abs(Nt),tt.start=0,tt.end=tt.size}function ys(dt,tt,Q,lt){for(let gt=0;gt<dt.length;gt++){const Pt=[];Os(dt[gt],Pt,Q,lt),tt.push(Pt)}}function ln(dt){return dt/360+.5}function un(dt){const tt=Math.sin(dt*Math.PI/180),Q=.5-.25*Math.log((1+tt)/(1-tt))/Math.PI;return Q<0?0:Q>1?1:Q}function Vn(dt,tt,Q,lt,gt,Pt,Nt,Mt){if(Q/=tt,lt/=tt,Pt>=Q&&Nt<lt)return dt;if(Nt<Q||Pt>=lt)return null;const N=[];for(const O of dt){const H=O.geometry;let W=O.type;const nt=gt===0?O.minX:O.minY,ft=gt===0?O.maxX:O.maxY;if(nt>=Q&&ft<lt){N.push(O);continue}else if(ft<Q||nt>=lt)continue;let St=[];if(W==="Point"||W==="MultiPoint")$n(H,St,Q,lt,gt);else if(W==="LineString")Ua(H,St,Q,lt,gt,!1,Mt.lineMetrics);else if(W==="MultiLineString")Bo(H,St,Q,lt,gt,!1);else if(W==="Polygon")Bo(H,St,Q,lt,gt,!0);else if(W==="MultiPolygon")for(const It of H){const Lt=[];Bo(It,Lt,Q,lt,gt,!0),Lt.length&&St.push(Lt)}if(St.length){if(Mt.lineMetrics&&W==="LineString"){for(const It of St)N.push(_n(O.id,W,It,O.tags));continue}(W==="LineString"||W==="MultiLineString")&&(St.length===1?(W="LineString",St=St[0]):W="MultiLineString"),(W==="Point"||W==="MultiPoint")&&(W=St.length===3?"Point":"MultiPoint"),N.push(_n(O.id,W,St,O.tags))}}return N.length?N:null}function $n(dt,tt,Q,lt,gt){for(let Pt=0;Pt<dt.length;Pt+=3){const Nt=dt[Pt+gt];Nt>=Q&&Nt<=lt&&Pn(tt,dt[Pt],dt[Pt+1],dt[Pt+2])}}function Ua(dt,tt,Q,lt,gt,Pt,Nt){let Mt=Au(dt);const N=gt===0?ta:gl;let O=dt.start,H,W;for(let Vt=0;Vt<dt.length-3;Vt+=3){const qt=dt[Vt],ee=dt[Vt+1],Jt=dt[Vt+2],se=dt[Vt+3],Ae=dt[Vt+4],Ie=gt===0?qt:ee,We=gt===0?se:Ae;let di=!1;Nt&&(H=Math.sqrt(Math.pow(qt-se,2)+Math.pow(ee-Ae,2))),Ie<Q?We>Q&&(W=N(Mt,qt,ee,se,Ae,Q),Nt&&(Mt.start=O+H*W)):Ie>lt?We<lt&&(W=N(Mt,qt,ee,se,Ae,lt),Nt&&(Mt.start=O+H*W)):Pn(Mt,qt,ee,Jt),We<Q&&Ie>=Q&&(W=N(Mt,qt,ee,se,Ae,Q),di=!0),We>lt&&Ie<=lt&&(W=N(Mt,qt,ee,se,Ae,lt),di=!0),!Pt&&di&&(Nt&&(Mt.end=O+H*W),tt.push(Mt),Mt=Au(dt)),Nt&&(O+=H)}let nt=dt.length-3;const ft=dt[nt],St=dt[nt+1],It=dt[nt+2],Lt=gt===0?ft:St;Lt>=Q&&Lt<=lt&&Pn(Mt,ft,St,It),nt=Mt.length-3,Pt&&nt>=3&&(Mt[nt]!==Mt[0]||Mt[nt+1]!==Mt[1])&&Pn(Mt,Mt[0],Mt[1],Mt[2]),Mt.length&&tt.push(Mt)}function Au(dt){const tt=[];return tt.size=dt.size,tt.start=dt.start,tt.end=dt.end,tt}function Bo(dt,tt,Q,lt,gt,Pt){for(const Nt of dt)Ua(Nt,tt,Q,lt,gt,Pt,!1)}function Pn(dt,tt,Q,lt){dt.push(tt,Q,lt)}function ta(dt,tt,Q,lt,gt,Pt){const Nt=(Pt-tt)/(lt-tt);return Pn(dt,Pt,Q+(gt-Q)*Nt,1),Nt}function gl(dt,tt,Q,lt,gt,Pt){const Nt=(Pt-Q)/(gt-Q);return Pn(dt,tt+(lt-tt)*Nt,Pt,1),Nt}function yl(dt,tt){const Q=tt.buffer/tt.extent;let lt=dt;const gt=Vn(dt,1,-1-Q,Q,0,-1,2,tt),Pt=Vn(dt,1,1-Q,2+Q,0,-1,2,tt);return(gt||Pt)&&(lt=Vn(dt,1,-Q,1+Q,0,-1,2,tt)||[],gt&&(lt=ea(gt,1).concat(lt)),Pt&&(lt=lt.concat(ea(Pt,-1)))),lt}function ea(dt,tt){const Q=[];for(let lt=0;lt<dt.length;lt++){const gt=dt[lt],Pt=gt.type;let Nt;if(Pt==="Point"||Pt==="MultiPoint"||Pt==="LineString")Nt=vl(gt.geometry,tt);else if(Pt==="MultiLineString"||Pt==="Polygon"){Nt=[];for(const Mt of gt.geometry)Nt.push(vl(Mt,tt))}else if(Pt==="MultiPolygon"){Nt=[];for(const Mt of gt.geometry){const N=[];for(const O of Mt)N.push(vl(O,tt));Nt.push(N)}}Q.push(_n(gt.id,Pt,Nt,gt.tags))}return Q}function vl(dt,tt){const Q=[];Q.size=dt.size,dt.start!==void 0&&(Q.start=dt.start,Q.end=dt.end);for(let lt=0;lt<dt.length;lt+=3)Q.push(dt[lt]+tt,dt[lt+1],dt[lt+2]);return Q}function xl(dt,tt){if(dt.transformed)return dt;const Q=1<<dt.z,lt=dt.x,gt=dt.y;for(const Pt of dt.features){const Nt=Pt.geometry,Mt=Pt.type;if(Pt.geometry=[],Mt===1)for(let N=0;N<Nt.length;N+=2)Pt.geometry.push(Un(Nt[N],Nt[N+1],tt,Q,lt,gt));else for(let N=0;N<Nt.length;N++){const O=[];for(let H=0;H<Nt[N].length;H+=2)O.push(Un(Nt[N][H],Nt[N][H+1],tt,Q,lt,gt));Pt.geometry.push(O)}}return dt.transformed=!0,dt}function Un(dt,tt,Q,lt,gt,Pt){return[Math.round(Q*(dt*lt-gt)),Math.round(Q*(tt*lt-Pt))]}function bl(dt,tt,Q,lt,gt){const Pt=tt===gt.maxZoom?0:gt.tolerance/((1<<tt)*gt.extent),Nt={features:[],numPoints:0,numSimplified:0,numFeatures:dt.length,source:null,x:Q,y:lt,z:tt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Mt of dt)Oo(Nt,Mt,Pt,gt);return Nt}function Oo(dt,tt,Q,lt){const gt=tt.geometry,Pt=tt.type,Nt=[];if(dt.minX=Math.min(dt.minX,tt.minX),dt.minY=Math.min(dt.minY,tt.minY),dt.maxX=Math.max(dt.maxX,tt.maxX),dt.maxY=Math.max(dt.maxY,tt.maxY),Pt==="Point"||Pt==="MultiPoint")for(let Mt=0;Mt<gt.length;Mt+=3)Nt.push(gt[Mt],gt[Mt+1]),dt.numPoints++,dt.numSimplified++;else if(Pt==="LineString")ho(Nt,gt,dt,Q,!1,!1);else if(Pt==="MultiLineString"||Pt==="Polygon")for(let Mt=0;Mt<gt.length;Mt++)ho(Nt,gt[Mt],dt,Q,Pt==="Polygon",Mt===0);else if(Pt==="MultiPolygon")for(let Mt=0;Mt<gt.length;Mt++){const N=gt[Mt];for(let O=0;O<N.length;O++)ho(Nt,N[O],dt,Q,!0,O===0)}if(Nt.length){let Mt=tt.tags||null;if(Pt==="LineString"&&lt.lineMetrics){Mt={};for(const O in tt.tags)Mt[O]=tt.tags[O];Mt.mapbox_clip_start=gt.start/gt.size,Mt.mapbox_clip_end=gt.end/gt.size}const N={geometry:Nt,type:Pt==="Polygon"||Pt==="MultiPolygon"?3:Pt==="LineString"||Pt==="MultiLineString"?2:1,tags:Mt};tt.id!==null&&(N.id=tt.id),dt.features.push(N)}}function ho(dt,tt,Q,lt,gt,Pt){const Nt=lt*lt;if(lt>0&&tt.size<(gt?Nt:lt)){Q.numPoints+=tt.length/3;return}const Mt=[];for(let N=0;N<tt.length;N+=3)(lt===0||tt[N+2]>Nt)&&(Q.numSimplified++,Mt.push(tt[N],tt[N+1])),Q.numPoints++;gt&&Vr(Mt,Pt),dt.push(Mt)}function Vr(dt,tt){let Q=0;for(let lt=0,gt=dt.length,Pt=gt-2;lt<gt;Pt=lt,lt+=2)Q+=(dt[lt]-dt[Pt])*(dt[lt+1]+dt[Pt+1]);if(Q>0===tt)for(let lt=0,gt=dt.length;lt<gt/2;lt+=2){const Pt=dt[lt],Nt=dt[lt+1];dt[lt]=dt[gt-2-lt],dt[lt+1]=dt[gt-1-lt],dt[gt-2-lt]=Pt,dt[gt-1-lt]=Nt}}const Vo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class tu{constructor(tt,Q){Q=this.options=Na(Object.create(Vo),Q);const lt=Q.debug;if(lt&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let gt=Va(tt,Q);this.tiles={},this.tileCoords=[],lt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),gt=yl(gt,Q),gt.length&&this.splitTile(gt,0,0,0),lt&&(gt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(tt,Q,lt,gt,Pt,Nt,Mt){const N=[tt,Q,lt,gt],O=this.options,H=O.debug;for(;N.length;){gt=N.pop(),lt=N.pop(),Q=N.pop(),tt=N.pop();const W=1<<Q,nt=Uo(Q,lt,gt);let ft=this.tiles[nt];if(!ft&&(H>1&&console.time("creation"),ft=this.tiles[nt]=bl(tt,Q,lt,gt,O),this.tileCoords.push({z:Q,x:lt,y:gt}),H)){H>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,lt,gt,ft.numFeatures,ft.numPoints,ft.numSimplified),console.timeEnd("creation"));const We=`z${Q}`;this.stats[We]=(this.stats[We]||0)+1,this.total++}if(ft.source=tt,Pt==null){if(Q===O.indexMaxZoom||ft.numPoints<=O.indexMaxPoints)continue}else{if(Q===O.maxZoom||Q===Pt)continue;if(Pt!=null){const We=Pt-Q;if(lt!==Nt>>We||gt!==Mt>>We)continue}}if(ft.source=null,tt.length===0)continue;H>1&&console.time("clipping");const St=.5*O.buffer/O.extent,It=.5-St,Lt=.5+St,Vt=1+St;let qt=null,ee=null,Jt=null,se=null,Ae=Vn(tt,W,lt-St,lt+Lt,0,ft.minX,ft.maxX,O),Ie=Vn(tt,W,lt+It,lt+Vt,0,ft.minX,ft.maxX,O);tt=null,Ae&&(qt=Vn(Ae,W,gt-St,gt+Lt,1,ft.minY,ft.maxY,O),ee=Vn(Ae,W,gt+It,gt+Vt,1,ft.minY,ft.maxY,O),Ae=null),Ie&&(Jt=Vn(Ie,W,gt-St,gt+Lt,1,ft.minY,ft.maxY,O),se=Vn(Ie,W,gt+It,gt+Vt,1,ft.minY,ft.maxY,O),Ie=null),H>1&&console.timeEnd("clipping"),N.push(qt||[],Q+1,lt*2,gt*2),N.push(ee||[],Q+1,lt*2,gt*2+1),N.push(Jt||[],Q+1,lt*2+1,gt*2),N.push(se||[],Q+1,lt*2+1,gt*2+1)}}getTile(tt,Q,lt){tt=+tt,Q=+Q,lt=+lt;const gt=this.options,{extent:Pt,debug:Nt}=gt;if(tt<0||tt>24)return null;const Mt=1<<tt;Q=Q+Mt&Mt-1;const N=Uo(tt,Q,lt);if(this.tiles[N])return xl(this.tiles[N],Pt);Nt>1&&console.log("drilling down to z%d-%d-%d",tt,Q,lt);let O=tt,H=Q,W=lt,nt;for(;!nt&&O>0;)O--,H=H>>1,W=W>>1,nt=this.tiles[Uo(O,H,W)];return!nt||!nt.source?null:(Nt>1&&(console.log("found parent tile z%d-%d-%d",O,H,W),console.time("drilling down")),this.splitTile(nt.source,O,H,W,tt,Q,lt),Nt>1&&console.timeEnd("drilling down"),this.tiles[N]?xl(this.tiles[N],Pt):null)}}function Uo(dt,tt,Q){return((1<<dt)*Q+tt)*32+dt}function Na(dt,tt){for(const Q in tt)dt[Q]=tt[Q];return dt}function co(dt,tt){return new tu(dt,tt)}function Nn(dt,tt){return tt?dt.properties[tt]:dt.id}function vs(dt,tt){if(dt==null)return!0;if(dt.type==="Feature")return Nn(dt,tt)!=null;if(dt.type==="FeatureCollection"){const Q=new Set;for(const lt of dt.features){const gt=Nn(lt,tt);if(gt==null||Q.has(gt))return!1;Q.add(gt)}return!0}return!1}function eu(dt,tt){const Q=new Map;if(dt!=null)if(dt.type==="Feature")Q.set(Nn(dt,tt),dt);else for(const lt of dt.features)Q.set(Nn(lt,tt),lt);return Q}function iu(dt,tt,Q){var lt,gt,Pt,Nt;if(tt.removeAll&&dt.clear(),tt.remove)for(const Mt of tt.remove)dt.delete(Mt);if(tt.add)for(const Mt of tt.add){const N=Nn(Mt,Q);N!=null&&dt.set(N,Mt)}if(tt.update)for(const Mt of tt.update){let N=dt.get(Mt.id);if(N==null)continue;const O=Mt.newGeometry||Mt.removeAllProperties,H=!Mt.removeAllProperties&&(((lt=Mt.removeProperties)===null||lt===void 0?void 0:lt.length)>0||((gt=Mt.addOrUpdateProperties)===null||gt===void 0?void 0:gt.length)>0);if((O||H)&&(N=Object.assign({},N),dt.set(Mt.id,N),H&&(N.properties=Object.assign({},N.properties))),Mt.newGeometry&&(N.geometry=Mt.newGeometry),Mt.removeAllProperties)N.properties={};else if(((Pt=Mt.removeProperties)===null||Pt===void 0?void 0:Pt.length)>0)for(const W of Mt.removeProperties)Object.prototype.hasOwnProperty.call(N.properties,W)&&delete N.properties[W];if(((Nt=Mt.addOrUpdateProperties)===null||Nt===void 0?void 0:Nt.length)>0)for(const{key:W,value:nt}of Mt.addOrUpdateProperties)N.properties[W]=nt}}class ru extends ha{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(tt,Q){return v._(this,void 0,void 0,function*(){const lt=tt.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const gt=this._geoJSONIndex.getTile(lt.z,lt.x,lt.y);if(!gt)return null;const Pt=new ml(gt.features);let Nt=Fo(Pt);return(Nt.byteOffset!==0||Nt.byteLength!==Nt.buffer.byteLength)&&(Nt=new Uint8Array(Nt)),{vectorTile:Pt,rawData:Nt.buffer}})}loadData(tt){return v._(this,void 0,void 0,function*(){var Q;(Q=this._pendingRequest)===null||Q===void 0||Q.abort();const lt=tt&&tt.request&&tt.request.collectResourceTiming?new v.bv(tt.request):!1;this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(tt,this._pendingRequest),this._geoJSONIndex=tt.cluster?new oh(wl(tt)).load((yield this._pendingData).features):co(yield this._pendingData,tt.geojsonVtOptions),this.loaded={};const gt={};if(lt){const Pt=lt.finish();Pt&&(gt.resourceTiming={},gt.resourceTiming[tt.source]=JSON.parse(JSON.stringify(Pt)))}return gt}catch(gt){if(delete this._pendingRequest,v.bB(gt))return{abandoned:!0};throw gt}})}getData(){return v._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(tt){const Q=this.loaded,lt=tt.uid;return Q&&Q[lt]?super.reloadTile(tt):this.loadTile(tt)}loadAndProcessGeoJSON(tt,Q){return v._(this,void 0,void 0,function*(){let lt=yield this.loadGeoJSON(tt,Q);if(delete this._pendingRequest,typeof lt!="object")throw new Error(`Input data given to '${tt.source}' is not a valid GeoJSON object.`);if(Fa(lt,!0),tt.filter){const gt=v.bC(tt.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(gt.result==="error")throw new Error(gt.value.map(Nt=>`${Nt.key}: ${Nt.message}`).join(", "));lt={type:"FeatureCollection",features:lt.features.filter(Nt=>gt.value.evaluate({zoom:0},Nt))}}return lt})}loadGeoJSON(tt,Q){return v._(this,void 0,void 0,function*(){const{promoteId:lt}=tt;if(tt.request){const gt=yield v.h(tt.request,Q);return this._dataUpdateable=vs(gt.data,lt)?eu(gt.data,lt):void 0,gt.data}if(typeof tt.data=="string")try{const gt=JSON.parse(tt.data);return this._dataUpdateable=vs(gt,lt)?eu(gt,lt):void 0,gt}catch{throw new Error(`Input data given to '${tt.source}' is not a valid GeoJSON object.`)}if(!tt.dataDiff)throw new Error(`Input data given to '${tt.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${tt.source}`);return iu(this._dataUpdateable,tt.dataDiff,lt),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(tt){return v._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(tt){return this._geoJSONIndex.getClusterExpansionZoom(tt.clusterId)}getClusterChildren(tt){return this._geoJSONIndex.getChildren(tt.clusterId)}getClusterLeaves(tt){return this._geoJSONIndex.getLeaves(tt.clusterId,tt.limit,tt.offset)}}function wl({superclusterOptions:dt,clusterProperties:tt}){if(!tt||!dt)return dt;const Q={},lt={},gt={accumulated:null,zoom:0},Pt={properties:null},Nt=Object.keys(tt);for(const Mt of Nt){const[N,O]=tt[Mt],H=v.bC(O),W=v.bC(typeof N=="string"?[N,["accumulated"],["get",Mt]]:N);Q[Mt]=H.value,lt[Mt]=W.value}return dt.map=Mt=>{Pt.properties=Mt;const N={};for(const O of Nt)N[O]=Q[O].evaluate(gt,Pt);return N},dt.reduce=(Mt,N)=>{Pt.properties=N;for(const O of Nt)gt.accumulated=Mt[O],Mt[O]=lt[O].evaluate(gt,Pt)},dt}class Sl{constructor(tt){this.self=tt,this.actor=new v.F(tt),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Q,lt)=>{if(this.externalWorkerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.externalWorkerSourceTypes[Q]=lt},this.self.addProtocol=v.bi,this.self.removeProtocol=v.bj,this.self.registerRTLTextPlugin=Q=>{if(v.bD.isParsed())throw new Error("RTL text plugin already registered.");v.bD.setMethods(Q)},this.actor.registerMessageHandler("LDT",(Q,lt)=>this._getDEMWorkerSource(Q,lt.source).loadTile(lt)),this.actor.registerMessageHandler("RDT",(Q,lt)=>v._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Q,lt.source).removeTile(lt)})),this.actor.registerMessageHandler("GCEZ",(Q,lt)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,lt.type,lt.source).getClusterExpansionZoom(lt)})),this.actor.registerMessageHandler("GCC",(Q,lt)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,lt.type,lt.source).getClusterChildren(lt)})),this.actor.registerMessageHandler("GCL",(Q,lt)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,lt.type,lt.source).getClusterLeaves(lt)})),this.actor.registerMessageHandler("LD",(Q,lt)=>this._getWorkerSource(Q,lt.type,lt.source).loadData(lt)),this.actor.registerMessageHandler("GD",(Q,lt)=>this._getWorkerSource(Q,lt.type,lt.source).getData()),this.actor.registerMessageHandler("LT",(Q,lt)=>this._getWorkerSource(Q,lt.type,lt.source).loadTile(lt)),this.actor.registerMessageHandler("RT",(Q,lt)=>this._getWorkerSource(Q,lt.type,lt.source).reloadTile(lt)),this.actor.registerMessageHandler("AT",(Q,lt)=>this._getWorkerSource(Q,lt.type,lt.source).abortTile(lt)),this.actor.registerMessageHandler("RMT",(Q,lt)=>this._getWorkerSource(Q,lt.type,lt.source).removeTile(lt)),this.actor.registerMessageHandler("RS",(Q,lt)=>v._(this,void 0,void 0,function*(){if(!this.workerSources[Q]||!this.workerSources[Q][lt.type]||!this.workerSources[Q][lt.type][lt.source])return;const gt=this.workerSources[Q][lt.type][lt.source];delete this.workerSources[Q][lt.type][lt.source],gt.removeSource!==void 0&&gt.removeSource(lt)})),this.actor.registerMessageHandler("RM",Q=>v._(this,void 0,void 0,function*(){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q]})),this.actor.registerMessageHandler("SR",(Q,lt)=>v._(this,void 0,void 0,function*(){this.referrer=lt})),this.actor.registerMessageHandler("SRPS",(Q,lt)=>this._syncRTLPluginState(Q,lt)),this.actor.registerMessageHandler("IS",(Q,lt)=>v._(this,void 0,void 0,function*(){this.self.importScripts(lt)})),this.actor.registerMessageHandler("SI",(Q,lt)=>this._setImages(Q,lt)),this.actor.registerMessageHandler("UL",(Q,lt)=>v._(this,void 0,void 0,function*(){this._getLayerIndex(Q).update(lt.layers,lt.removedIds)})),this.actor.registerMessageHandler("SL",(Q,lt)=>v._(this,void 0,void 0,function*(){this._getLayerIndex(Q).replace(lt)}))}_setImages(tt,Q){return v._(this,void 0,void 0,function*(){this.availableImages[tt]=Q;for(const lt in this.workerSources[tt]){const gt=this.workerSources[tt][lt];for(const Pt in gt)gt[Pt].availableImages=Q}})}_syncRTLPluginState(tt,Q){return v._(this,void 0,void 0,function*(){if(v.bD.isParsed())return v.bD.getState();if(Q.pluginStatus!=="loading")return v.bD.setState(Q),Q;const lt=Q.pluginURL;if(this.self.importScripts(lt),v.bD.isParsed()){const Pt={pluginStatus:"loaded",pluginURL:lt};return v.bD.setState(Pt),Pt}throw v.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${lt}`)})}_getAvailableImages(tt){let Q=this.availableImages[tt];return Q||(Q=[]),Q}_getLayerIndex(tt){let Q=this.layerIndexes[tt];return Q||(Q=this.layerIndexes[tt]=new C),Q}_getWorkerSource(tt,Q,lt){if(this.workerSources[tt]||(this.workerSources[tt]={}),this.workerSources[tt][Q]||(this.workerSources[tt][Q]={}),!this.workerSources[tt][Q][lt]){const gt={sendAsync:(Pt,Nt)=>(Pt.targetMapId=tt,this.actor.sendAsync(Pt,Nt))};switch(Q){case"vector":this.workerSources[tt][Q][lt]=new ha(gt,this._getLayerIndex(tt),this._getAvailableImages(tt));break;case"geojson":this.workerSources[tt][Q][lt]=new ru(gt,this._getLayerIndex(tt),this._getAvailableImages(tt));break;default:this.workerSources[tt][Q][lt]=new this.externalWorkerSourceTypes[Q](gt,this._getLayerIndex(tt),this._getAvailableImages(tt));break}}return this.workerSources[tt][Q][lt]}_getDEMWorkerSource(tt,Q){return this.demWorkerSources[tt]||(this.demWorkerSources[tt]={}),this.demWorkerSources[tt][Q]||(this.demWorkerSources[tt][Q]=new me),this.demWorkerSources[tt][Q]}}return v.i(self)&&(self.worker=new Sl(self)),Sl}),Vh("index",["exports","./shared"],function(v,C){var fe="4.7.1",Yr={version:fe};const Jr=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date);let pe,ha;const me={now:Jr,frameAsync(w){return new Promise((t,o)=>{const f=requestAnimationFrame(t);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(f),o(C.c())})})},getImageData(w,t=0){return this.getImageCanvasContext(w).getImageData(-t,-t,w.width+2*t,w.height+2*t)},getImageCanvasContext(w){const t=window.document.createElement("canvas"),o=t.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return t.width=w.width,t.height=w.height,o.drawImage(w,0,0,w.width,w.height),o},resolveURL(w){return pe||(pe=document.createElement("a")),pe.href=w,pe.href},hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return matchMedia?(ha==null&&(ha=matchMedia("(prefers-reduced-motion: reduce)")),ha.matches):!1}};class Qt{static testProp(t){if(!Qt.docStyle)return t[0];for(let o=0;o<t.length;o++)if(t[o]in Qt.docStyle)return t[o];return t[0]}static create(t,o,f){const g=window.document.createElement(t);return o!==void 0&&(g.className=o),f&&f.appendChild(g),g}static createNS(t,o){return window.document.createElementNS(t,o)}static disableDrag(){Qt.docStyle&&Qt.selectProp&&(Qt.userSelect=Qt.docStyle[Qt.selectProp],Qt.docStyle[Qt.selectProp]="none")}static enableDrag(){Qt.docStyle&&Qt.selectProp&&(Qt.docStyle[Qt.selectProp]=Qt.userSelect)}static setTransform(t,o){t.style[Qt.transformProp]=o}static addEventListener(t,o,f,g={}){"passive"in g?t.addEventListener(o,f,g):t.addEventListener(o,f,g.capture)}static removeEventListener(t,o,f,g={}){"passive"in g?t.removeEventListener(o,f,g):t.removeEventListener(o,f,g.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Qt.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Qt.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Qt.suppressClickInternal,!0)},0)}static getScale(t){const o=t.getBoundingClientRect();return{x:o.width/t.offsetWidth||1,y:o.height/t.offsetHeight||1,boundingClientRect:o}}static getPoint(t,o,f){const g=o.boundingClientRect;return new C.P((f.clientX-g.left)/o.x-t.clientLeft,(f.clientY-g.top)/o.y-t.clientTop)}static mousePos(t,o){const f=Qt.getScale(t);return Qt.getPoint(t,f,o)}static touchPos(t,o){const f=[],g=Qt.getScale(t);for(let S=0;S<o.length;S++)f.push(Qt.getPoint(t,g,o[S]));return f}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}Qt.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Qt.selectProp=Qt.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Qt.transformProp=Qt.testProp(["transform","WebkitTransform"]);const ca={supported:!1,testSupport:zo};let In,ns=!1,Fa,fa=!1;typeof document<"u"&&(Fa=document.createElement("img"),Fa.onload=()=>{In&&ml(In),In=null,fa=!0},Fa.onerror=()=>{ns=!0,In=null},Fa.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");function zo(w){ns||!Fa||(fa?ml(w):In=w)}function ml(w){const t=w.createTexture();w.bindTexture(w.TEXTURE_2D,t);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,Fa),w.isContextLost())return;ca.supported=!0}catch{}w.deleteTexture(t),ns=!0}var an;(function(w){let t,o,f,g;w.resetRequestQueue=()=>{t=[],o=0,f=0,g={}},w.addThrottleControl=K=>{const J=f++;return g[J]=K,J},w.removeThrottleControl=K=>{delete g[K],R()};const S=()=>{for(const K of Object.keys(g))if(g[K]())return!0;return!1};w.getImage=(K,J,ut=!0)=>new Promise((mt,vt)=>{ca.supported&&(K.headers||(K.headers={}),K.headers.accept="image/webp,*/*"),C.e(K,{type:"image"});const Tt={abortController:J,requestParameters:K,supportImageRefresh:ut,state:"queued",onError:Ft=>{vt(Ft)},onSuccess:Ft=>{mt(Ft)}};t.push(Tt),R()});const z=K=>typeof createImageBitmap=="function"?C.d(K):C.f(K),k=K=>C._(this,void 0,void 0,function*(){K.state="running";const{requestParameters:J,supportImageRefresh:ut,onError:mt,onSuccess:vt,abortController:Tt}=K,Ft=ut===!1&&!C.i(self)&&!C.g(J.url)&&(!J.headers||Object.keys(J.headers).reduce((Ot,Dt)=>Ot&&Dt==="accept",!0));o++;const Bt=Ft?X(J,Tt):C.m(J,Tt);try{const Ot=yield Bt;if(delete K.abortController,K.state="completed",Ot.data instanceof HTMLImageElement||C.b(Ot.data))vt(Ot);else if(Ot.data){const Dt=yield z(Ot.data);vt({data:Dt,cacheControl:Ot.cacheControl,expires:Ot.expires})}}catch(Ot){delete K.abortController,mt(Ot)}finally{o--,R()}}),R=()=>{const K=S()?C.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:C.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let J=o;J<K&&t.length>0;J++){const ut=t.shift();if(ut.abortController.signal.aborted){J--;continue}k(ut)}},X=(K,J)=>new Promise((ut,mt)=>{const vt=new Image,Tt=K.url,Ft=K.credentials;Ft&&Ft==="include"?vt.crossOrigin="use-credentials":(Ft&&Ft==="same-origin"||!C.s(Tt))&&(vt.crossOrigin="anonymous"),J.signal.addEventListener("abort",()=>{vt.src="",mt(C.c())}),vt.fetchPriority="high",vt.onload=()=>{vt.onerror=vt.onload=null,ut({data:vt})},vt.onerror=()=>{vt.onerror=vt.onload=null,!J.signal.aborted&&mt(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},vt.src=Tt})})(an||(an={})),an.resetRequestQueue();class Fs{constructor(t){this._transformRequestFn=t}transformRequest(t,o){return this._transformRequestFn?this._transformRequestFn(t,o)||{url:t}:{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Or(){var w=new C.A(4);return C.A!=Float32Array&&(w[1]=0,w[2]=0),w[0]=1,w[3]=1,w}function _l(w,t,o){var f=t[0],g=t[1],S=t[2],z=t[3],k=Math.sin(o),R=Math.cos(o);return w[0]=f*R+S*k,w[1]=g*R+z*k,w[2]=f*-k+S*R,w[3]=g*-k+z*R,w}function da(){var w=new C.A(9);return C.A!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[5]=0,w[6]=0,w[7]=0),w[0]=1,w[4]=1,w[8]=1,w}function Ls(w,t){var o=Math.sin(t),f=Math.cos(t);return w[0]=f,w[1]=o,w[2]=0,w[3]=-o,w[4]=f,w[5]=0,w[6]=0,w[7]=0,w[8]=1,w}function pa(){var w=new C.A(3);return C.A!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0),w}function gs(w){var t=new C.A(3);return t[0]=w[0],t[1]=w[1],t[2]=w[2],t}function Rs(w,t,o){return w[0]=t[0]+o[0],w[1]=t[1]+o[1],w[2]=t[2]+o[2],w}function Jl(w,t,o){return w[0]=t[0]-o[0],w[1]=t[1]-o[1],w[2]=t[2]-o[2],w}function Do(w,t,o){return w[0]=t[0]*o,w[1]=t[1]*o,w[2]=t[2]*o,w}function La(w,t){var o=t[0],f=t[1],g=t[2],S=o*o+f*f+g*g;return S>0&&(S=1/Math.sqrt(S)),w[0]=t[0]*S,w[1]=t[1]*S,w[2]=t[2]*S,w}function Ra(w,t){return w[0]*t[0]+w[1]*t[1]+w[2]*t[2]}function qr(w,t,o){var f=t[0],g=t[1],S=t[2],z=o[0],k=o[1],R=o[2];return w[0]=g*R-S*k,w[1]=S*z-f*R,w[2]=f*k-g*z,w}function so(w,t,o){var f=t[0],g=t[1],S=t[2];return w[0]=f*o[0]+g*o[3]+S*o[6],w[1]=f*o[1]+g*o[4]+S*o[7],w[2]=f*o[2]+g*o[5]+S*o[8],w}var ko=Jl;(function(){var w=pa();return function(t,o,f,g,S,z){var k,R;for(o||(o=3),f||(f=0),g?R=Math.min(g*o+f,t.length):R=t.length,k=f;k<R;k+=o)w[0]=t[k],w[1]=t[k+1],w[2]=t[k+2],S(w,w,z),t[k]=w[0],t[k+1]=w[1],t[k+2]=w[2];return t}})();function rr(){var w=new C.A(2);return C.A!=Float32Array&&(w[0]=0,w[1]=0),w}function mn(w){var t=w[0],o=w[1];return t*t+o*o}function Ql(w,t,o){var f=t[0],g=t[1];return w[0]=o[0]*f+o[4]*g+o[12],w[1]=o[1]*f+o[5]*g+o[13],w}var Fo=mn;(function(){var w=rr();return function(t,o,f,g,S,z){var k,R;for(o||(o=2),f||(f=0),g?R=Math.min(g*o+f,t.length):R=t.length,k=f;k<R;k+=o)w[0]=t[k],w[1]=t[k+1],S(w,w,z),t[k]=w[0],t[k+1]=w[1];return t}})();function sn(w){const t=[];if(typeof w=="string")t.push({id:"default",url:w});else if(w&&w.length>0){const o=[];for(const{id:f,url:g}of w){const S=`${f}${g}`;o.indexOf(S)===-1&&(o.push(S),t.push({id:f,url:g}))}}return t}function Lo(w,t,o){const f=w.split("?");return f[0]+=`${t}${o}`,f.join("?")}function On(w,t,o,f){return C._(this,void 0,void 0,function*(){const g=sn(w),S=o>1?"@2x":"",z={},k={};for(const{id:R,url:X}of g){const K=t.transformRequest(Lo(X,S,".json"),"SpriteJSON");z[R]=C.h(K,f);const J=t.transformRequest(Lo(X,S,".png"),"SpriteImage");k[R]=an.getImage(J,f)}return yield Promise.all([...Object.values(z),...Object.values(k)]),Ba(z,k)})}function Ba(w,t){return C._(this,void 0,void 0,function*(){const o={};for(const f in w){o[f]={};const g=me.getImageCanvasContext((yield t[f]).data),S=(yield w[f]).data;for(const z in S){const{width:k,height:R,x:X,y:K,sdf:J,pixelRatio:ut,stretchX:mt,stretchY:vt,content:Tt,textFitWidth:Ft,textFitHeight:Bt}=S[z],Ot={width:k,height:R,x:X,y:K,context:g};o[f][z]={data:null,pixelRatio:ut,sdf:J,stretchX:mt,stretchY:vt,content:Tt,textFitWidth:Ft,textFitHeight:Bt,spriteData:Ot}}}return o})}class Qi{constructor(t,o,f,g){this.context=t,this.format=f,this.texture=t.gl.createTexture(),this.update(o,g)}update(t,o,f){const{width:g,height:S}=t,z=(!this.size||this.size[0]!==g||this.size[1]!==S)&&!f,{context:k}=this,{gl:R}=k;if(this.useMipmap=!!(o&&o.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),k.pixelStoreUnpackFlipY.set(!1),k.pixelStoreUnpack.set(1),k.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!o||o.premultiply!==!1)),z)this.size=[g,S],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||C.b(t)?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,t):R.texImage2D(R.TEXTURE_2D,0,this.format,g,S,0,this.format,R.UNSIGNED_BYTE,t.data);else{const{x:X,y:K}=f||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||C.b(t)?R.texSubImage2D(R.TEXTURE_2D,0,X,K,R.RGBA,R.UNSIGNED_BYTE,t):R.texSubImage2D(R.TEXTURE_2D,0,X,K,g,S,R.RGBA,R.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D)}bind(t,o,f){const{context:g}=this,{gl:S}=g;S.bindTexture(S.TEXTURE_2D,this.texture),f===S.LINEAR_MIPMAP_NEAREST&&!this.isSizePowerOfTwo()&&(f=S.LINEAR),t!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,t),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,f||t),this.filter=t),o!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,o),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1===0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Oa(w){const{userImage:t}=w;return t&&t.render&&t.render()?(w.data.replace(new Uint8Array(t.data.buffer)),!0):!1}const oo=1;class oh extends C.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new C.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:o,promiseResolve:f}of this.requestors)f(this._getImagesForIds(o));this.requestors=[]}}getImage(t){const o=this.images[t];if(o&&!o.data&&o.spriteData){const f=o.spriteData;o.data=new C.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),o.spriteData=null}return o}addImage(t,o){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,o)&&(this.images[t]=o)}_validate(t,o){let f=!0;const g=o.data||o.spriteData;return this._validateStretch(o.stretchX,g&&g.width)||(this.fire(new C.j(new Error(`Image "${t}" has invalid "stretchX" value`))),f=!1),this._validateStretch(o.stretchY,g&&g.height)||(this.fire(new C.j(new Error(`Image "${t}" has invalid "stretchY" value`))),f=!1),this._validateContent(o.content,o)||(this.fire(new C.j(new Error(`Image "${t}" has invalid "content" value`))),f=!1),f}_validateStretch(t,o){if(!t)return!0;let f=0;for(const g of t){if(g[0]<f||g[1]<g[0]||o<g[1])return!1;f=g[1]}return!0}_validateContent(t,o){if(!t)return!0;if(t.length!==4)return!1;const f=o.spriteData,g=f&&f.width||o.data.width,S=f&&f.height||o.data.height;return!(t[0]<0||g<t[0]||t[1]<0||S<t[1]||t[2]<0||g<t[2]||t[3]<0||S<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,o,f=!0){const g=this.getImage(t);if(f&&(g.data.width!==o.data.width||g.data.height!==o.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=g.version+1,this.images[t]=o,this.updatedImages[t]=!0}removeImage(t){const o=this.images[t];delete this.images[t],delete this.patterns[t],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((o,f)=>{let g=!0;if(!this.isLoaded())for(const S of t)this.images[S]||(g=!1);this.isLoaded()||g?o(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:o})})}_getImagesForIds(t){const o={};for(const f of t){let g=this.getImage(f);g||(this.fire(new C.k("styleimagemissing",{id:f})),g=this.getImage(f)),g?o[f]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,textFitWidth:g.textFitWidth,textFitHeight:g.textFitHeight,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:C.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:t,height:o}=this.atlasImage;return{width:t,height:o}}getPattern(t){const o=this.patterns[t],f=this.getImage(t);if(!f)return null;if(o&&o.position.version===f.version)return o.position;if(o)o.position.version=f.version;else{const g=f.data.width+oo*2,S=f.data.height+oo*2,z={w:g,h:S,x:0,y:0},k=new C.I(z,f);this.patterns[t]={bin:z,position:k}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const o=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Qi(t,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const S in this.patterns)t.push(this.patterns[S].bin);const{w:o,h:f}=C.p(t),g=this.atlasImage;g.resize({width:o||1,height:f||1});for(const S in this.patterns){const{bin:z}=this.patterns[S],k=z.x+oo,R=z.y+oo,X=this.getImage(S).data,K=X.width,J=X.height;C.R.copy(X,g,{x:0,y:0},{x:k,y:R},{width:K,height:J}),C.R.copy(X,g,{x:0,y:J-1},{x:k,y:R-1},{width:K,height:1}),C.R.copy(X,g,{x:0,y:0},{x:k,y:R+J},{width:K,height:1}),C.R.copy(X,g,{x:K-1,y:0},{x:k-1,y:R},{width:1,height:J}),C.R.copy(X,g,{x:0,y:0},{x:k+K,y:R},{width:1,height:J})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const o of t){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const f=this.getImage(o);f||C.w(`Image with ID: "${o}" was not found`),Oa(f)&&this.updateImage(o,f)}}}function $l(w,t,o,f){return C._(this,void 0,void 0,function*(){const g=t*256,S=g+255,z=f.transformRequest(o.replace("{fontstack}",w).replace("{range}",`${g}-${S}`),"Glyphs"),k=yield C.l(z,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${t}, ${g}-${S}`);const R={};for(const X of C.n(k.data))R[X.id]=X;return R})}const lo=1e20;class ma{constructor({fontSize:t=24,buffer:o=3,radius:f=8,cutoff:g=.25,fontFamily:S="sans-serif",fontWeight:z="normal",fontStyle:k="normal"}={}){this.buffer=o,this.cutoff=g,this.radius=f;const R=this.size=t+o*4,X=this._createCanvas(R),K=this.ctx=X.getContext("2d",{willReadFrequently:!0});K.font=`${k} ${z} ${t}px ${S}`,K.textBaseline="alphabetic",K.textAlign="left",K.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(t){const o=document.createElement("canvas");return o.width=o.height=t,o}draw(t){const{width:o,actualBoundingBoxAscent:f,actualBoundingBoxDescent:g,actualBoundingBoxLeft:S,actualBoundingBoxRight:z}=this.ctx.measureText(t),k=Math.ceil(f),R=0,X=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(z-S))),K=Math.min(this.size-this.buffer,k+Math.ceil(g)),J=X+2*this.buffer,ut=K+2*this.buffer,mt=Math.max(J*ut,0),vt=new Uint8ClampedArray(mt),Tt={data:vt,width:J,height:ut,glyphWidth:X,glyphHeight:K,glyphTop:k,glyphLeft:R,glyphAdvance:o};if(X===0||K===0)return Tt;const{ctx:Ft,buffer:Bt,gridInner:Ot,gridOuter:Dt}=this;Ft.clearRect(Bt,Bt,X,K),Ft.fillText(t,Bt,Bt+k);const ie=Ft.getImageData(Bt,Bt,X,K);Dt.fill(lo,0,mt),Ot.fill(0,0,mt);for(let $t=0;$t<K;$t++)for(let ce=0;ce<X;ce++){const we=ie.data[4*($t*X+ce)+3]/255;if(we===0)continue;const Fe=($t+Bt)*J+ce+Bt;if(we===1)Dt[Fe]=0,Ot[Fe]=lo;else{const Ge=.5-we;Dt[Fe]=Ge>0?Ge*Ge:0,Ot[Fe]=Ge<0?Ge*Ge:0}}Cn(Dt,0,0,J,ut,J,this.f,this.v,this.z),Cn(Ot,Bt,Bt,X,K,J,this.f,this.v,this.z);for(let $t=0;$t<mt;$t++){const ce=Math.sqrt(Dt[$t])-Math.sqrt(Ot[$t]);vt[$t]=Math.round(255-255*(ce/this.radius+this.cutoff))}return Tt}}function Cn(w,t,o,f,g,S,z,k,R){for(let X=t;X<t+f;X++)Bs(w,o*S+X,S,g,z,k,R);for(let X=o;X<o+g;X++)Bs(w,X*S+t,1,f,z,k,R)}function Bs(w,t,o,f,g,S,z){S[0]=0,z[0]=-1e20,z[1]=lo,g[0]=w[t];for(let k=1,R=0,X=0;k<f;k++){g[k]=w[t+k*o];const K=k*k;do{const J=S[R];X=(g[k]-g[J]+K-J*J)/(k-J)/2}while(X<=z[R]&&--R>-1);R++,S[R]=k,z[R]=X,z[R+1]=lo}for(let k=0,R=0;k<f;k++){for(;z[R+1]<k;)R++;const X=S[R],K=k-X;w[t+k*o]=g[X]+K*K}}class zi{constructor(t,o){this.requestManager=t,this.localIdeographFontFamily=o,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return C._(this,void 0,void 0,function*(){const o=[];for(const S in t)for(const z of t[S])o.push(this._getAndCacheGlyphsPromise(S,z));const f=yield Promise.all(o),g={};for(const{stack:S,id:z,glyph:k}of f)g[S]||(g[S]={}),g[S][z]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return g})}_getAndCacheGlyphsPromise(t,o){return C._(this,void 0,void 0,function*(){let f=this.entries[t];f||(f=this.entries[t]={glyphs:{},requests:{},ranges:{}});let g=f.glyphs[o];if(g!==void 0)return{stack:t,id:o,glyph:g};if(g=this._tinySDF(f,t,o),g)return f.glyphs[o]=g,{stack:t,id:o,glyph:g};const S=Math.floor(o/256);if(S*256>65535)throw new Error("glyphs > 65535 not supported");if(f.ranges[S])return{stack:t,id:o,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!f.requests[S]){const k=zi.loadGlyphRange(t,S,this.url,this.requestManager);f.requests[S]=k}const z=yield f.requests[S];for(const k in z)this._doesCharSupportLocalGlyph(+k)||(f.glyphs[+k]=z[+k]);return f.ranges[S]=!0,{stack:t,id:o,glyph:z[o]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))}_tinySDF(t,o,f){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(f))return;const S=2;let z=t.tinySDF;if(!z){let K="400";/bold/i.test(o)?K="900":/medium/i.test(o)?K="500":/light/i.test(o)&&(K="200"),z=t.tinySDF=new zi.TinySDF({fontSize:24*S,buffer:3*S,radius:8*S,cutoff:.25,fontFamily:g,fontWeight:K})}const k=z.draw(String.fromCharCode(f));return{id:f,bitmap:new C.o({width:k.width||30*S,height:k.height||30*S},k.data),metrics:{width:k.glyphWidth/S||24,height:k.glyphHeight/S||24,left:k.glyphLeft/S+.5||0,top:k.glyphTop/S-27.5||-8,advance:k.glyphAdvance/S||24,isDoubleResolution:!0}}}}zi.loadGlyphRange=$l,zi.TinySDF=ma;class uo{constructor(){this.specification=C.v.light.position}possiblyEvaluate(t,o){return C.x(t.expression.evaluate(o))}interpolate(t,o,f){return{x:C.y.number(t.x,o.x,f),y:C.y.number(t.y,o.y,f),z:C.y.number(t.z,o.z,f)}}}const on="-transition";let _n;class Qn extends C.E{constructor(t){super(),_n=_n||new C.q({anchor:new C.D(C.v.light.anchor),position:new uo,color:new C.D(C.v.light.color),intensity:new C.D(C.v.light.intensity)}),this._transitionable=new C.T(_n),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o={}){if(!this._validate(C.r,t,o))for(const f in t){const g=t[f];f.endsWith(on)?this._transitionable.setTransition(f.slice(0,-on.length),g):this._transitionable.setValue(f,g)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,f){return f&&f.validate===!1?!1:C.t(this,t.call(C.u,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:C.v}))}}const Va=new C.q({"sky-color":new C.D(C.v.sky["sky-color"]),"horizon-color":new C.D(C.v.sky["horizon-color"]),"fog-color":new C.D(C.v.sky["fog-color"]),"fog-ground-blend":new C.D(C.v.sky["fog-ground-blend"]),"horizon-fog-blend":new C.D(C.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new C.D(C.v.sky["sky-horizon-blend"]),"atmosphere-blend":new C.D(C.v.sky["atmosphere-blend"])}),bi="-transition";class Ro extends C.E{constructor(t){super(),this._transitionable=new C.T(Va),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new C.z(0))}setSky(t,o={}){if(!this._validate(C.B,t,o)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const f in t){const g=t[f];f.endsWith(bi)?this._transitionable.setTransition(f.slice(0,-bi.length),g):this._transitionable.setValue(f,g)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,f={}){return(f==null?void 0:f.validate)===!1?!1:C.t(this,t.call(C.u,C.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:C.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Os{constructor(t,o){this.width=t,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,o){const f=t.join(",")+String(o);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(t,o)),this.dashEntry[f]}getDashRanges(t,o,f){const g=t.length%2===1,S=[];let z=g?-t[t.length-1]*f:0,k=t[0]*f,R=!0;S.push({left:z,right:k,isDash:R,zeroLength:t[0]===0});let X=t[0];for(let K=1;K<t.length;K++){R=!R;const J=t[K];z=X*f,X+=J,k=X*f,S.push({left:z,right:k,isDash:R,zeroLength:J===0})}return S}addRoundDash(t,o,f){const g=o/2;for(let S=-f;S<=f;S++){const z=this.nextRow+f+S,k=this.width*z;let R=0,X=t[R];for(let K=0;K<this.width;K++){K/X.right>1&&(X=t[++R]);const J=Math.abs(K-X.left),ut=Math.abs(K-X.right),mt=Math.min(J,ut);let vt;const Tt=S/f*(g+1);if(X.isDash){const Ft=g-Math.abs(Tt);vt=Math.sqrt(mt*mt+Ft*Ft)}else vt=g-Math.sqrt(mt*mt+Tt*Tt);this.data[k+K]=Math.max(0,Math.min(255,vt+128))}}}addRegularDash(t){for(let k=t.length-1;k>=0;--k){const R=t[k],X=t[k+1];R.zeroLength?t.splice(k,1):X&&X.isDash===R.isDash&&(X.left=R.left,t.splice(k,1))}const o=t[0],f=t[t.length-1];o.isDash===f.isDash&&(o.left=f.left-this.width,f.right=o.right+this.width);const g=this.width*this.nextRow;let S=0,z=t[S];for(let k=0;k<this.width;k++){k/z.right>1&&(z=t[++S]);const R=Math.abs(k-z.left),X=Math.abs(k-z.right),K=Math.min(R,X),J=z.isDash?K:-K;this.data[g+k]=Math.max(0,Math.min(255,J+128))}}addDash(t,o){const f=o?7:0,g=2*f+1;if(this.nextRow+g>this.height)return C.w("LineAtlas out of space"),null;let S=0;for(let k=0;k<t.length;k++)S+=t[k];if(S!==0){const k=this.width/S,R=this.getDashRanges(t,this.width,k);o?this.addRoundDash(R,k,f):this.addRegularDash(R)}const z={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:S};return this.nextRow+=g,this.dirty=!0,z}bind(t){const o=t.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}function ys(){return new Worker(C.a.WORKER_URL)}const ln="maplibre_preloaded_worker_pool";class un{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<un.workerCount;)this.workers.push(ys());return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ln]}numActive(){return Object.keys(this.active).length}}const Vn=Math.floor(me.hardwareConcurrency/2);un.workerCount=C.C(globalThis)?Math.max(Math.min(Vn,3),1):1;let $n;function Ua(){return $n||($n=new un),$n}function Au(){Ua().acquire(ln)}function Bo(){const w=$n;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(ln),$n=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))}class Pn{constructor(t,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o;const f=this.workerPool.acquire(o);for(let g=0;g<f.length;g++){const S=f[g],z=new C.F(S,o);z.name=`Worker ${g}`,this.actors.push(z)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,o){const f=[];for(const g of this.actors)f.push(g.sendAsync({type:t,data:o}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,o){for(const f of this.actors)f.registerMessageHandler(t,o)}}let ta;function gl(){return ta||(ta=new Pn(Ua(),C.G),ta.registerMessageHandler("GR",(w,t,o)=>C.m(t,o))),ta}function yl(w,t){const o=C.H();return C.J(o,o,[1,1,0]),C.K(o,o,[w.width*.5,w.height*.5,1]),C.L(o,o,w.calculatePosMatrix(t.toUnwrapped()))}function ea(w,t,o){if(w)for(const f of w){const g=t[f];if(g&&g.source===o&&g.type==="fill-extrusion")return!0}else for(const f in t){const g=t[f];if(g.source===o&&g.type==="fill-extrusion")return!0}return!1}function vl(w,t,o,f,g,S){const z=ea(g&&g.layers,t,w.id),k=S.maxPitchScaleFactor(),R=w.tilesIn(f,k,z);R.sort(bl);const X=[];for(const J of R)X.push({wrappedTileID:J.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(t,o,w._state,J.queryGeometry,J.cameraQueryGeometry,J.scale,g,S,k,yl(w.transform,J.tileID))});const K=Oo(X);for(const J in K)K[J].forEach(ut=>{const mt=ut.feature,vt=w.getFeatureState(mt.layer["source-layer"],mt.id);mt.source=mt.layer.source,mt.layer["source-layer"]&&(mt.sourceLayer=mt.layer["source-layer"]),mt.state=vt});return K}function xl(w,t,o,f,g,S,z){const k={},R=S.queryRenderedSymbols(f),X=[];for(const K of Object.keys(R).map(Number))X.push(z[K]);X.sort(bl);for(const K of X){const J=K.featureIndex.lookupSymbolFeatures(R[K.bucketInstanceId],t,K.bucketIndex,K.sourceLayerIndex,g.filter,g.layers,g.availableImages,w);for(const ut in J){const mt=k[ut]=k[ut]||[],vt=J[ut];vt.sort((Tt,Ft)=>{const Bt=K.featureSortOrder;if(Bt){const Ot=Bt.indexOf(Tt.featureIndex);return Bt.indexOf(Ft.featureIndex)-Ot}else return Ft.featureIndex-Tt.featureIndex});for(const Tt of vt)mt.push(Tt)}}for(const K in k)k[K].forEach(J=>{const ut=J.feature,mt=w[K],Tt=o[mt.source].getFeatureState(ut.layer["source-layer"],ut.id);ut.source=ut.layer.source,ut.layer["source-layer"]&&(ut.sourceLayer=ut.layer["source-layer"]),ut.state=Tt});return k}function Un(w,t){const o=w.getRenderableIds().map(S=>w.getTileByID(S)),f=[],g={};for(let S=0;S<o.length;S++){const z=o[S],k=z.tileID.canonical.key;g[k]||(g[k]=!0,z.querySourceFeatures(f,t))}return f}function bl(w,t){const o=w.tileID,f=t.tileID;return o.overscaledZ-f.overscaledZ||o.canonical.y-f.canonical.y||o.wrap-f.wrap||o.canonical.x-f.canonical.x}function Oo(w){const t={},o={};for(const f of w){const g=f.queryResults,S=f.wrappedTileID,z=o[S]=o[S]||{};for(const k in g){const R=g[k],X=z[k]=z[k]||{},K=t[k]=t[k]||[];for(const J of R)X[J.featureIndex]||(X[J.featureIndex]=!0,K.push(J))}}return t}function ho(w,t,o){return C._(this,void 0,void 0,function*(){let f=w;if(w.url?f=(yield C.h(t.transformRequest(w.url,"Source"),o)).data:yield me.frameAsync(o),!f)return null;const g=C.M(C.e(f,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(g.vectorLayerIds=f.vector_layers.map(S=>S.id)),g})}class Vr{constructor(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof C.N?new C.N(t.lng,t.lat):C.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof C.N?new C.N(t.lng,t.lat):C.N.convert(t),this}extend(t){const o=this._sw,f=this._ne;let g,S;if(t instanceof C.N)g=t,S=t;else if(t instanceof Vr){if(g=t._sw,S=t._ne,!g||!S)return this}else{if(Array.isArray(t))if(t.length===4||t.every(Array.isArray)){const z=t;return this.extend(Vr.convert(z))}else{const z=t;return this.extend(C.N.convert(z))}else if(t&&("lng"in t||"lon"in t)&&"lat"in t)return this.extend(C.N.convert(t));return this}return!o&&!f?(this._sw=new C.N(g.lng,g.lat),this._ne=new C.N(S.lng,S.lat)):(o.lng=Math.min(g.lng,o.lng),o.lat=Math.min(g.lat,o.lat),f.lng=Math.max(S.lng,f.lng),f.lat=Math.max(S.lat,f.lat)),this}getCenter(){return new C.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new C.N(this.getWest(),this.getNorth())}getSouthEast(){return new C.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:f}=C.N.convert(t),g=this._sw.lat<=f&&f<=this._ne.lat;let S=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(S=this._sw.lng>=o&&o>=this._ne.lng),g&&S}static convert(t){return t instanceof Vr||!t?t:new Vr(t)}static fromLngLat(t,o=0){const g=360*o/40075017,S=g/Math.cos(Math.PI/180*t.lat);return new Vr(new C.N(t.lng-S,t.lat-g),new C.N(t.lng+S,t.lat+g))}adjustAntiMeridian(){const t=new C.N(this._sw.lng,this._sw.lat),o=new C.N(this._ne.lng,this._ne.lat);return t.lng>o.lng?new Vr(t,new C.N(o.lng+360,o.lat)):new Vr(t,o)}}class Vo{constructor(t,o,f){this.bounds=Vr.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=f||24}validateBounds(t){return!Array.isArray(t)||t.length!==4?[-180,-90,180,90]:[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]}contains(t){const o=Math.pow(2,t.z),f={minX:Math.floor(C.O(this.bounds.getWest())*o),minY:Math.floor(C.Q(this.bounds.getNorth())*o),maxX:Math.ceil(C.O(this.bounds.getEast())*o),maxY:Math.ceil(C.Q(this.bounds.getSouth())*o)};return t.x>=f.minX&&t.x<f.maxX&&t.y>=f.minY&&t.y<f.maxY}}class tu extends C.E{constructor(t,o,f,g){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,C.e(this,C.M(o,["url","scheme","tileSize","promoteId"])),this._options=C.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return C._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new C.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ho(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(C.e(this,t),t.bounds&&(this.tileBounds=new Vo(t.bounds,this.minzoom,this.maxzoom)),this.fire(new C.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new C.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new C.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return C.e({},this._options)}loadTile(t){return C._(this,void 0,void 0,function*(){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(o,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};f.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(!t.actor||t.state==="expired")t.actor=this.dispatcher.getActor(),g="LT";else if(t.state==="loading")return new Promise((S,z)=>{t.reloadPromise={resolve:S,reject:z}});t.abortController=new AbortController;try{const S=yield t.actor.sendAsync({type:g,data:f},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,S)}catch(S){if(delete t.abortController,t.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,o){if(o&&o.resourceTiming&&(t.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&t.setExpiryData(o),t.loadVectorData(o,this.map.painter),t.reloadPromise){const f=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(f.resolve).catch(f.reject)}}abortTile(t){return C._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return C._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Uo extends C.E{constructor(t,o,f,g){super(),this.id=t,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=C.e({type:"raster"},o),C.e(this,C.M(o,["url","scheme","tileSize"]))}load(){return C._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new C.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ho(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(C.e(this,t),t.bounds&&(this.tileBounds=new Vo(t.bounds,this.minzoom,this.maxzoom)),this.fire(new C.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new C.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new C.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return C.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return C._(this,void 0,void 0,function*(){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const f=yield an.getImage(this.map._requestManager.transformRequest(o,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted){t.state="unloaded";return}if(f&&f.data){this.map._refreshExpiredTiles&&f.cacheControl&&f.expires&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const g=this.map.painter.context,S=g.gl,z=f.data;t.texture=this.map.painter.getTileTexture(z.width),t.texture?t.texture.update(z,{useMipmap:!0}):(t.texture=new Qi(g,z,S.RGBA,{useMipmap:!0}),t.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}})}abortTile(t){return C._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return C._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Na extends Uo{constructor(t,o,f,g){super(t,o,f,g),this.type="raster-dem",this.maxzoom=22,this._options=C.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(t){return C._(this,void 0,void 0,function*(){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(o,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const g=yield an.getImage(f,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted){t.state="unloaded";return}if(g&&g.data){const S=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&t.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const k=C.b(S)&&C.U()?S:yield this.readImageNow(S),R={type:this.type,uid:t.uid,source:this.id,rawImageData:k,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const X=yield t.actor.sendAsync({type:"LDT",data:R});t.dem=X,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(g){if(delete t.abortController,t.aborted)t.state="unloaded";else if(g)throw t.state="errored",g}})}readImageNow(t){return C._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&C.V()){const o=t.width+2,f=t.height+2;try{return new C.R({width:o,height:f},yield C.W(t,-1,-1,o,f))}catch{}}return me.getImageData(t,1)})}_getNeighboringTiles(t){const o=t.canonical,f=Math.pow(2,o.z),g=(o.x-1+f)%f,S=o.x===0?t.wrap-1:t.wrap,z=(o.x+1+f)%f,k=o.x+1===f?t.wrap+1:t.wrap,R={};return R[new C.S(t.overscaledZ,S,o.z,g,o.y).key]={backfilled:!1},R[new C.S(t.overscaledZ,k,o.z,z,o.y).key]={backfilled:!1},o.y>0&&(R[new C.S(t.overscaledZ,S,o.z,g,o.y-1).key]={backfilled:!1},R[new C.S(t.overscaledZ,t.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},R[new C.S(t.overscaledZ,k,o.z,z,o.y-1).key]={backfilled:!1}),o.y+1<f&&(R[new C.S(t.overscaledZ,S,o.z,g,o.y+1).key]={backfilled:!1},R[new C.S(t.overscaledZ,t.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},R[new C.S(t.overscaledZ,k,o.z,z,o.y+1).key]={backfilled:!1}),R}unloadTile(t){return C._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class co extends C.E{constructor(t,o,f,g){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(g),this._data=o.data,this._options=C.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const S=C.X/this.tileSize;o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&C.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=C.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*S,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*S,extent:C.X,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:C.X,radius:(o.clusterRadius||50)*S,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return C._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return C._(this,void 0,void 0,function*(){const t=C.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,o,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:o,offset:f}})}_updateWorkerData(t){return C._(this,void 0,void 0,function*(){const o=C.e({type:this.type},this.workerOptions);t?o.dataDiff=t:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(me.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new C.k("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||f.abandoned){this.fire(new C.k("dataabort",{dataType:"source"}));return}let g=null;f.resourceTiming&&f.resourceTiming[this.id]&&(g=f.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&C.e(S,{resourceTiming:g}),this.fire(new C.k("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new C.k("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(f){if(this._pendingLoads--,this._removed){this.fire(new C.k("dataabort",{dataType:"source"}));return}this.fire(new C.j(f))}})}loaded(){return this._pendingLoads===0}loadTile(t){return C._(this,void 0,void 0,function*(){const o=t.actor?"RT":"LT";t.actor=this.actor;const f={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const g=yield this.actor.sendAsync({type:o,data:f},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(g,this.map.painter,o==="RT")})}abortTile(t){return C._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return C._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return C.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Nn=C.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class vs extends C.E{constructor(t,o,f,g){super(),this.id=t,this.dispatcher=f,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=o}load(t){return C._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new C.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield an.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,t&&(this.coordinates=t),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new C.j(o))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new C.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const o=t.map(C.Z.fromLngLat);this.tileID=eu(o),this.minzoom=this.maxzoom=this.tileID.z;const f=o.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new C.$,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,C.X,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,C.X),this._boundsArray.emplaceBack(f[2].x,f[2].y,C.X,C.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new C.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,o=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Nn.members)),this.boundsSegments||(this.boundsSegments=C.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Qi(t,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let f=!1;for(const g in this.tiles){const S=this.tiles[g];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,f=!0)}f&&this.fire(new C.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return C._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}function eu(w){let t=1/0,o=1/0,f=-1/0,g=-1/0;for(const K of w)t=Math.min(t,K.x),o=Math.min(o,K.y),f=Math.max(f,K.x),g=Math.max(g,K.y);const S=f-t,z=g-o,k=Math.max(S,z),R=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),X=Math.pow(2,R);return new C.a1(R,Math.floor((t+f)/2*X),Math.floor((o+g)/2*X))}class iu extends vs{constructor(t,o,f,g){super(t,o,f,g),this.roundZoom=!0,this.type="video",this.options=o}load(){return C._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const o of t.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield C.a3(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new C.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const o=this.video.seekable;t<o.start(0)||t>o.end(0)?this.fire(new C.j(new C.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,o=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Nn.members)),this.boundsSegments||(this.boundsSegments=C.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new Qi(t,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let f=!1;for(const g in this.tiles){const S=this.tiles[g];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,f=!0)}f&&this.fire(new C.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ru extends vs{constructor(t,o,f,g){super(t,o,f,g),o.coordinates?(!Array.isArray(o.coordinates)||o.coordinates.length!==4||o.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(z=>typeof z!="number")))&&this.fire(new C.j(new C.a2(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new C.j(new C.a2(`sources.${t}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new C.j(new C.a2(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas!="string"&&!(o.canvas instanceof HTMLCanvasElement)&&this.fire(new C.j(new C.a2(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new C.j(new C.a2(`sources.${t}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate!==void 0?o.animate:!0}load(){return C._(this,void 0,void 0,function*(){if(this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()){this.fire(new C.j(new Error("Canvas dimensions cannot be less than or equal to zero.")));return}this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading()})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,f=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Nn.members)),this.boundsSegments||(this.boundsSegments=C.a0.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Qi(o,this.canvas,f.RGBA,{premultiply:!0});let g=!1;for(const S in this.tiles){const z=this.tiles[S];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture,g=!0)}g&&this.fire(new C.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const wl={},Sl=(w,t,o,f)=>{const g=dt(t.type),S=new g(w,t,o,f);if(S.id!==w)throw new Error(`Expected Source id to be ${w} instead of ${S.id}`);return S},dt=w=>{switch(w){case"geojson":return co;case"image":return vs;case"raster":return Uo;case"raster-dem":return Na;case"vector":return tu;case"video":return iu;case"canvas":return ru}return wl[w]},tt=(w,t)=>{wl[w]=t},Q=(w,t)=>C._(void 0,void 0,void 0,function*(){if(dt(w))throw new Error(`A source type called "${w}" already exists.`);tt(w,t)});function lt(w,t){const o={};if(!t)return o;for(const f of w){const g=f.layerIds.map(S=>t.getLayer(S)).filter(Boolean);if(g.length!==0){f.layers=g,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(S=>g.filter(z=>z.id===S)[0]));for(const S of g)o[S.id]=f}}return o}const gt="RTLPluginLoaded";class Pt extends C.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=gl()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return C._(this,arguments,void 0,function*(o,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=me.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable")if(f)this.status="deferred",this._syncState(this.status);else return this._requestImport();else if(this.status==="requested")return this._requestImport()})}_requestImport(){return C._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new C.k(gt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Nt=null;function Mt(){return Nt||(Nt=new Pt),Nt}const N=3e4;class O{constructor(t,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=C.a4(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const o=t+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,o,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",!t){this.collisionBoxArray=new C.a5;return}t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=lt(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const S=this.buckets[g];if(S instanceof C.a6)if(this.hasSymbolBuckets=!0,f)S.justReloaded=!0;else break}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const S=this.buckets[g];if(S instanceof C.a6&&S.hasRTLText){this.hasRTLText=!0,Mt().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const S=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(g).queryRadius(S))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const f in this.buckets){const g=this.buckets[f];g.uploadPending()&&g.upload(t)}const o=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Qi(t,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Qi(t,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,o,f,g,S,z,k,R,X,K){return!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData?{}:this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:S,scale:z,tileSize:this.tileSize,pixelPosMatrix:K,transform:R,params:k,queryPadding:this.queryPadding*X},t,o,f)}querySourceFeatures(t,o){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const g=f.loadVTLayers(),S=o&&o.sourceLayer?o.sourceLayer:"",z=g._geojsonTileLayer||g[S];if(!z)return;const k=C.a7(o&&o.filter),{z:R,x:X,y:K}=this.tileID.canonical,J={z:R,x:X,y:K};for(let ut=0;ut<z.length;ut++){const mt=z.feature(ut);if(k.needGeometry){const Ft=C.a8(mt,!0);if(!k.filter(new C.z(this.tileID.overscaledZ),Ft,this.tileID.canonical))continue}else if(!k.filter(new C.z(this.tileID.overscaledZ),mt))continue;const vt=f.getId(mt,S),Tt=new C.a9(mt,R,X,K,vt);Tt.tile=J,t.push(Tt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const f=C.aa(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+f["max-age"]*1e3)}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const f=Date.now();let g=!1;if(this.expirationTime>f)g=!1;else if(!o)g=!0;else if(this.expirationTime<o)g=!0;else{const S=this.expirationTime-o;S?this.expirationTime=f+Math.max(S,N):g=!0}g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!o.style.hasLayer(g))continue;const S=this.buckets[g],z=S.layers[0].sourceLayer||"_geojsonTileLayer",k=f[z],R=t[z];if(!k||!R||Object.keys(R).length===0)continue;S.update(R,k,this.imageAtlas&&this.imageAtlas.patternPositions||{});const X=o&&o.style&&o.style.getLayer(g);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<me.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=me.now()+t}setDependencies(t,o){const f={};for(const g of o)f[g]=!0;this.dependencies[t]=f}hasDependency(t,o){for(const f of t){const g=this.dependencies[f];if(g){for(const S of o)if(g[S])return!0}}return!1}}class H{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,f){const g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const S={value:o,timeout:void 0};if(f!==void 0&&(S.timeout=setTimeout(()=>{this.remove(t,S)},f)),this.data[g].push(S),this.order.push(g),this.order.length>this.max){const z=this._getAndRemoveByKey(this.order[0]);z&&this.onRemove(z)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const f=t.wrapped().key,g=o===void 0?0:this.data[f].indexOf(o),S=this.data[f][g];return this.data[f].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(S.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const f in this.data)for(const g of this.data[f])t(g.value)||o.push(g);for(const f of o)this.remove(f.value.tileID,f)}}class W{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,f){const g=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},C.e(this.stateChanges[t][g],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(const S in this.state[t])S!==g&&(this.deletedStates[t][S]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(const z in this.state[t][g])f[z]||(this.deletedStates[t][g][z]=null)}else for(const z in f)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][z]===null&&delete this.deletedStates[t][g][z]}removeFeatureState(t,o,f){if(this.deletedStates[t]===null)return;const S=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&o!==void 0)this.deletedStates[t][S]!==null&&(this.deletedStates[t][S]=this.deletedStates[t][S]||{},this.deletedStates[t][S][f]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][S]){this.deletedStates[t][S]={};for(f in this.stateChanges[t][S])this.deletedStates[t][S][f]=null}else this.deletedStates[t][S]=null;else this.deletedStates[t]=null}getState(t,o){const f=String(o),g=this.state[t]||{},S=this.stateChanges[t]||{},z=C.e({},g[f],S[f]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const k=this.deletedStates[t][o];if(k===null)return{};for(const R in k)delete z[R]}return z}initializeTileState(t,o){t.setFeatureState(this.state,o)}coalesceChanges(t,o){const f={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const S={};for(const z in this.stateChanges[g])this.state[g][z]||(this.state[g][z]={}),C.e(this.state[g][z],this.stateChanges[g][z]),S[z]=this.state[g][z];f[g]=S}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const S={};if(this.deletedStates[g]===null)for(const z in this.state[g])S[z]={},this.state[g][z]={};else for(const z in this.deletedStates[g]){if(this.deletedStates[g][z]===null)this.state[g][z]={};else for(const R of Object.keys(this.deletedStates[g][z]))delete this.state[g][z][R];S[z]=this.state[g][z]}f[g]=f[g]||{},C.e(f[g],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const g in t)t[g].setFeatureState(f,o)}}class nt extends C.E{constructor(t,o,f){super(),this.id=t,this.dispatcher=f,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=Sl(t,o,f,this),this._tiles={},this._cache=new H(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new W,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if((this.used!==void 0||this.usedForTerrain!==void 0)&&!this.used&&!this.usedForTerrain)return!0;if(!this._updated)return!1;for(const t in this._tiles){const o=this._tiles[t];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,o,f){return C._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,o,f)}catch(g){t.state="errored",g.status!==404?this._source.fire(new C.j(g,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new C.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const f=this._tiles[o];f.upload(t),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(ft).map(t=>t.key)}getRenderableIds(t){const o=[];for(const f in this._tiles)this._isIdRenderable(f,t)&&o.push(this._tiles[f]);return t?o.sort((f,g)=>{const S=f.tileID,z=g.tileID,k=new C.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),R=new C.P(z.canonical.x,z.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-z.overscaledZ||R.y-k.y||R.x-k.x}).map(f=>f.tileID.key):o.map(f=>f.tileID).sort(ft).map(f=>f.key)}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return o?this._isIdRenderable(o.tileID.key):!1}_isIdRenderable(t,o){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())}reload(){if(this._paused){this._shouldReloadOnResume=!0;return}this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}_reloadTile(t,o){return C._(this,void 0,void 0,function*(){const f=this._tiles[t];f&&(f.state!=="loading"&&(f.state=o),yield this._loadTile(f,t,o))})}_tileLoaded(t,o,f){t.timeAdded=me.now(),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new C.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const o=this.getRenderableIds();for(let g=0;g<o.length;g++){const S=o[g];if(t.neighboringTiles&&t.neighboringTiles[S]){const z=this.getTileByID(S);f(t,z),f(z,t)}}function f(g,S){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let z=S.tileID.canonical.x-g.tileID.canonical.x;const k=S.tileID.canonical.y-g.tileID.canonical.y,R=Math.pow(2,g.tileID.canonical.z),X=S.tileID.key;z===0&&k===0||Math.abs(k)>1||(Math.abs(z)>1&&(Math.abs(z+R)===1?z+=R:Math.abs(z-R)===1&&(z-=R)),!(!S.dem||!g.dem)&&(g.dem.backfillBorder(S.dem,z,k),g.neighboringTiles&&g.neighboringTiles[X]&&(g.neighboringTiles[X].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,f,g){for(const S in this._tiles){let z=this._tiles[S];if(g[S]||!z.hasData()||z.tileID.overscaledZ<=o||z.tileID.overscaledZ>f)continue;let k=z.tileID;for(;z&&z.tileID.overscaledZ>o+1;){const X=z.tileID.scaledTo(z.tileID.overscaledZ-1);z=this._tiles[X.key],z&&z.hasData()&&(k=X)}let R=k;for(;R.overscaledZ>o;)if(R=R.scaledTo(R.overscaledZ-1),t[R.key]){g[k.key]=k;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const f=this._loadedParentTiles[t.key];return f&&f.tileID.overscaledZ>=o?f:null}for(let f=t.overscaledZ-1;f>=o;f--){const g=t.scaledTo(f),S=this._getLoadedTile(g);if(S)return S}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const o=Math.ceil(t.width/this._source.tileSize)+1,f=Math.ceil(t.height/this._source.tileSize)+1,g=o*f,S=this._maxTileCacheZoomLevels===null?C.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels,z=Math.floor(g*S),k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,z):z;this._cache.setMaxSize(k)}handleWrapJump(t){const o=this._prevLng===void 0?t:this._prevLng,g=(t-o)/360,S=Math.round(g);if(this._prevLng=t,S){const z={};for(const k in this._tiles){const R=this._tiles[k];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+S),z[R.tileID.key]=R}this._tiles=z;for(const k in this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(const k in this._tiles){const R=this._tiles[k];this._setTileReloadTimer(k,R)}}}_updateCoveredAndRetainedTiles(t,o,f,g,S,z){const k={},R={},X=Object.keys(t),K=me.now();for(const J of X){const ut=t[J],mt=this._tiles[J];if(!mt||mt.fadeEndTime!==0&&mt.fadeEndTime<=K)continue;const vt=this.findLoadedParent(ut,o),Tt=this.findLoadedSibling(ut),Ft=vt||Tt||null;Ft&&(this._addTile(Ft.tileID),k[Ft.tileID.key]=Ft.tileID),R[J]=ut}this._retainLoadedChildren(R,g,f,t);for(const J in k)t[J]||(this._coveredTiles[J]=!0,t[J]=k[J]);if(z){const J={},ut={};for(const mt of S)this._tiles[mt.key].hasData()?J[mt.key]=mt:ut[mt.key]=mt;for(const mt in ut){const vt=ut[mt].children(this._source.maxzoom);this._tiles[vt[0].key]&&this._tiles[vt[1].key]&&this._tiles[vt[2].key]&&this._tiles[vt[3].key]&&(J[vt[0].key]=t[vt[0].key]=vt[0],J[vt[1].key]=t[vt[1].key]=vt[1],J[vt[2].key]=t[vt[2].key]=vt[2],J[vt[3].key]=t[vt[3].key]=vt[3],delete ut[mt])}for(const mt in ut){const vt=ut[mt],Tt=this.findLoadedParent(vt,this._source.minzoom),Ft=this.findLoadedSibling(vt),Bt=Tt||Ft||null;if(Bt){J[Bt.tileID.key]=t[Bt.tileID.key]=Bt.tileID;for(const Ot in J)J[Ot].isChildOf(Bt.tileID)&&delete J[Ot]}}for(const mt in this._tiles)J[mt]||(this._coveredTiles[mt]=!0)}}update(t,o){if(!this._sourceLoaded||this._paused)return;this.transform=t,this.terrain=o,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={};let f;!this.used&&!this.usedForTerrain?f=[]:this._source.tileID?f=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(K=>new C.S(K.canonical.z,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y)):(f=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this.usedForTerrain?!1:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(f=f.filter(K=>this._source.hasTile(K))));const g=t.coveringZoomLevel(this._source),S=Math.max(g-nt.maxOverzooming,this._source.minzoom),z=Math.max(g+nt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const K={};for(const J of f)if(J.canonical.z>this._source.minzoom){const ut=J.scaledTo(J.canonical.z-1);K[ut.key]=ut;const mt=J.scaledTo(Math.max(this._source.minzoom,Math.min(J.canonical.z,5)));K[mt.key]=mt}f=f.concat(Object.values(K))}const k=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,k&&this.fire(new C.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const R=this._updateRetainedTiles(f,g);St(this._source.type)&&this._updateCoveredAndRetainedTiles(R,S,z,g,f,o);for(const K in R)this._tiles[K].clearFadeHold();const X=C.ab(this._tiles,R);for(const K of X){const J=this._tiles[K];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):(!J.hasSymbolBuckets||J.symbolFadeFinished())&&this._removeTile(K)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,o){var f;const g={},S={},z=Math.max(o-nt.maxOverzooming,this._source.minzoom),k=Math.max(o+nt.maxUnderzooming,this._source.minzoom),R={};for(const X of t){const K=this._addTile(X);g[X.key]=X,!K.hasData()&&o<this._source.maxzoom&&(R[X.key]=X)}this._retainLoadedChildren(R,o,k,g);for(const X of t){let K=this._tiles[X.key];if(K.hasData())continue;if(o+1>this._source.maxzoom){const ut=X.children(this._source.maxzoom)[0],mt=this.getTile(ut);if(mt&&mt.hasData()){g[ut.key]=ut;continue}}else{const ut=X.children(this._source.maxzoom);if(g[ut[0].key]&&g[ut[1].key]&&g[ut[2].key]&&g[ut[3].key])continue}let J=K.wasRequested();for(let ut=X.overscaledZ-1;ut>=z;--ut){const mt=X.scaledTo(ut);if(S[mt.key])break;if(S[mt.key]=!0,K=this.getTile(mt),!K&&J&&(K=this._addTile(mt)),K){const vt=K.hasData();if((vt||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||J)&&(g[mt.key]=mt),J=K.wasRequested(),vt)break}}}return g}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let f,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}o.push(g.key);const S=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(S),f)break;g=S}for(const S of o)this._loadedParentTiles[S]=f}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const o=this._tiles[t].tileID,f=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=f}}_addTile(t){let o=this._tiles[t.key];if(o)return o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const f=o;return o||(o=new O(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(o,t.key,o.state)),o.uses++,this._tiles[t.key]=o,f||this._source.fire(new C.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const f=o.getExpiryTimeout();f&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},f))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),!(o.uses>0)&&(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(t){const o=t.sourceDataType;t.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,o,f){const g=[],S=this.transform;if(!S)return g;const z=f?S.getCameraQueryGeometry(t):t,k=t.map(vt=>S.pointCoordinate(vt,this.terrain)),R=z.map(vt=>S.pointCoordinate(vt,this.terrain)),X=this.getIds();let K=1/0,J=1/0,ut=-1/0,mt=-1/0;for(const vt of R)K=Math.min(K,vt.x),J=Math.min(J,vt.y),ut=Math.max(ut,vt.x),mt=Math.max(mt,vt.y);for(let vt=0;vt<X.length;vt++){const Tt=this._tiles[X[vt]];if(Tt.holdingForFade())continue;const Ft=Tt.tileID,Bt=Math.pow(2,S.zoom-Tt.tileID.overscaledZ),Ot=o*Tt.queryPadding*C.X/Tt.tileSize/Bt,Dt=[Ft.getTilePoint(new C.Z(K,J)),Ft.getTilePoint(new C.Z(ut,mt))];if(Dt[0].x-Ot<C.X&&Dt[0].y-Ot<C.X&&Dt[1].x+Ot>=0&&Dt[1].y+Ot>=0){const ie=k.map(ce=>Ft.getTilePoint(ce)),$t=R.map(ce=>Ft.getTilePoint(ce));g.push({tile:Tt,tileID:Ft,queryGeometry:ie,cameraQueryGeometry:$t,scale:Bt})}}return g}getVisibleCoordinates(t){const o=this.getRenderableIds(t).map(f=>this._tiles[f].tileID);for(const f of o)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(St(this._source.type)){const t=me.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=t)return!0}return!1}setFeatureState(t,o,f){t=t||"_geojsonTileLayer",this._state.updateState(t,o,f)}removeFeatureState(t,o,f){t=t||"_geojsonTileLayer",this._state.removeFeatureState(t,o,f)}getFeatureState(t,o){return t=t||"_geojsonTileLayer",this._state.getState(t,o)}setDependencies(t,o,f){const g=this._tiles[t];g&&g.setDependencies(o,f)}reloadTilesForDependencies(t,o){for(const f in this._tiles)this._tiles[f].hasDependency(t,o)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(t,o))}}nt.maxOverzooming=10,nt.maxUnderzooming=3;function ft(w,t){const o=Math.abs(w.wrap*2)-+(w.wrap<0),f=Math.abs(t.wrap*2)-+(t.wrap<0);return w.overscaledZ-t.overscaledZ||f-o||t.canonical.y-w.canonical.y||t.canonical.x-w.canonical.x}function St(w){return w==="raster"||w==="image"||w==="video"}class It{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,this.length*.5),this.paddedLength=this.length-this.padding*2}lerp(t){if(this.points.length===1)return this.points[0];t=C.ac(t,0,1);let o=1,f=this._distances[o];const g=t*this.paddedLength+this.padding;for(;f<g&&o<this._distances.length;)f=this._distances[++o];const S=o-1,z=this._distances[S],k=f-z,R=k>0?(g-z)/k:0;return this.points[S].mult(1-R).add(this.points[o].mult(R))}}function Lt(w,t){let o=!0;return w==="always"||(w==="never"||t==="never")&&(o=!1),o}class Vt{constructor(t,o,f){const g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(o/f);for(let z=0;z<this.xCellCount*this.yCellCount;z++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,f,g,S){this._forEachCell(o,f,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(S)}insertCircle(t,o,f,g){this._forEachCell(o-g,f-g,o+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(f),this.circles.push(g)}_insertBoxCell(t,o,f,g,S,z){this.boxCells[S].push(z)}_insertCircleCell(t,o,f,g,S,z){this.circleCells[S].push(z)}_query(t,o,f,g,S,z,k){if(f<0||t>this.width||g<0||o>this.height)return[];const R=[];if(t<=0&&o<=0&&this.width<=f&&this.height<=g){if(S)return[{key:null,x1:t,y1:o,x2:f,y2:g}];for(let X=0;X<this.boxKeys.length;X++)R.push({key:this.boxKeys[X],x1:this.bboxes[X*4],y1:this.bboxes[X*4+1],x2:this.bboxes[X*4+2],y2:this.bboxes[X*4+3]});for(let X=0;X<this.circleKeys.length;X++){const K=this.circles[X*3],J=this.circles[X*3+1],ut=this.circles[X*3+2];R.push({key:this.circleKeys[X],x1:K-ut,y1:J-ut,x2:K+ut,y2:J+ut})}}else{const X={hitTest:S,overlapMode:z,seenUids:{box:{},circle:{}}};this._forEachCell(t,o,f,g,this._queryCell,R,X,k)}return R}query(t,o,f,g){return this._query(t,o,f,g,!1,null)}hitTest(t,o,f,g,S,z){return this._query(t,o,f,g,!0,S,z).length>0}hitTestCircle(t,o,f,g,S){const z=t-f,k=t+f,R=o-f,X=o+f;if(k<0||z>this.width||X<0||R>this.height)return!1;const K=[],J={hitTest:!0,overlapMode:g,circle:{x:t,y:o,radius:f},seenUids:{box:{},circle:{}}};return this._forEachCell(z,R,k,X,this._queryCellCircle,K,J,S),K.length>0}_queryCell(t,o,f,g,S,z,k,R){const{seenUids:X,hitTest:K,overlapMode:J}=k,ut=this.boxCells[S];if(ut!==null){const vt=this.bboxes;for(const Tt of ut)if(!X.box[Tt]){X.box[Tt]=!0;const Ft=Tt*4,Bt=this.boxKeys[Tt];if(t<=vt[Ft+2]&&o<=vt[Ft+3]&&f>=vt[Ft+0]&&g>=vt[Ft+1]&&(!R||R(Bt))&&(!K||!Lt(J,Bt.overlapMode))&&(z.push({key:Bt,x1:vt[Ft],y1:vt[Ft+1],x2:vt[Ft+2],y2:vt[Ft+3]}),K))return!0}}const mt=this.circleCells[S];if(mt!==null){const vt=this.circles;for(const Tt of mt)if(!X.circle[Tt]){X.circle[Tt]=!0;const Ft=Tt*3,Bt=this.circleKeys[Tt];if(this._circleAndRectCollide(vt[Ft],vt[Ft+1],vt[Ft+2],t,o,f,g)&&(!R||R(Bt))&&(!K||!Lt(J,Bt.overlapMode))){const Ot=vt[Ft],Dt=vt[Ft+1],ie=vt[Ft+2];if(z.push({key:Bt,x1:Ot-ie,y1:Dt-ie,x2:Ot+ie,y2:Dt+ie}),K)return!0}}}return!1}_queryCellCircle(t,o,f,g,S,z,k,R){const{circle:X,seenUids:K,overlapMode:J}=k,ut=this.boxCells[S];if(ut!==null){const vt=this.bboxes;for(const Tt of ut)if(!K.box[Tt]){K.box[Tt]=!0;const Ft=Tt*4,Bt=this.boxKeys[Tt];if(this._circleAndRectCollide(X.x,X.y,X.radius,vt[Ft+0],vt[Ft+1],vt[Ft+2],vt[Ft+3])&&(!R||R(Bt))&&!Lt(J,Bt.overlapMode))return z.push(!0),!0}}const mt=this.circleCells[S];if(mt!==null){const vt=this.circles;for(const Tt of mt)if(!K.circle[Tt]){K.circle[Tt]=!0;const Ft=Tt*3,Bt=this.circleKeys[Tt];if(this._circlesCollide(vt[Ft],vt[Ft+1],vt[Ft+2],X.x,X.y,X.radius)&&(!R||R(Bt))&&!Lt(J,Bt.overlapMode))return z.push(!0),!0}}}_forEachCell(t,o,f,g,S,z,k,R){const X=this._convertToXCellCoord(t),K=this._convertToYCellCoord(o),J=this._convertToXCellCoord(f),ut=this._convertToYCellCoord(g);for(let mt=X;mt<=J;mt++)for(let vt=K;vt<=ut;vt++){const Tt=this.xCellCount*vt+mt;if(S.call(this,t,o,f,g,Tt,z,k,R))return}}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,f,g,S,z){const k=g-t,R=S-o,X=f+z;return X*X>k*k+R*R}_circleAndRectCollide(t,o,f,g,S,z,k){const R=(z-g)/2,X=Math.abs(t-(g+R));if(X>R+f)return!1;const K=(k-S)/2,J=Math.abs(o-(S+K));if(J>K+f)return!1;if(X<=R||J<=K)return!0;const ut=X-R,mt=J-K;return ut*ut+mt*mt<=f*f}}function qt(w,t,o,f,g){const S=C.H();return t?(C.K(S,S,[1/g,1/g,1]),o||C.ad(S,S,f.angle)):C.L(S,f.labelPlaneMatrix,w),S}function ee(w,t,o,f,g){if(t){const S=C.ae(w);return C.K(S,S,[g,g,1]),o||C.ad(S,S,-f.angle),S}else return f.glCoordMatrix}function Jt(w,t,o,f){let g;f?(g=[w,t,f(w,t),1],C.af(g,g,o)):(g=[w,t,0,1],No(g,g,o));const S=g[3];return{point:new C.P(g[0]/S,g[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function se(w,t){return .5+.5*(w/t)}function Ae(w,t){return w.x>=-t[0]&&w.x<=t[0]&&w.y>=-t[1]&&w.y<=t[1]}function Ie(w,t,o,f,g,S,z,k,R,X,K,J,ut,mt,vt){const Tt=f?w.textSizeData:w.iconSizeData,Ft=C.ag(Tt,o.transform.zoom),Bt=[256/o.width*2+1,256/o.height*2+1],Ot=f?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;Ot.clear();const Dt=w.lineVertexArray,ie=f?w.text.placedSymbolArray:w.icon.placedSymbolArray,$t=o.transform.width/o.transform.height;let ce=!1;for(let we=0;we<ie.length;we++){const Fe=ie.get(we);if(Fe.hidden||Fe.writingMode===C.ah.vertical&&!ce){as(Fe.numGlyphs,Ot);continue}ce=!1;const Ge=Jt(Fe.anchorX,Fe.anchorY,t,vt);if(!Ae(Ge.point,Bt)){as(Fe.numGlyphs,Ot);continue}const Ze=Ge.signedDistanceFromCamera,ei=se(o.transform.cameraToCenterDistance,Ze),Le=C.ai(Tt,Ft,Fe),ui=z?Le/ei:Le*ei,ti=new C.P(Fe.anchorX,Fe.anchorY),ye={getElevation:vt,labelPlaneMatrix:g,lineVertexArray:Dt,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:X,tileAnchorPoint:ti,unwrappedTileID:K,width:J,height:ut,translation:mt},Pe=mi(ye,Fe,ui,!1,k,t,S,w.glyphOffsetArray,Ot,$t,R);ce=Pe.useVertical,(Pe.notEnoughRoom||ce||Pe.needsFlipping&&mi(ye,Fe,ui,!0,k,t,S,w.glyphOffsetArray,Ot,$t,R).notEnoughRoom)&&as(Fe.numGlyphs,Ot)}f?w.text.dynamicLayoutVertexBuffer.updateData(Ot):w.icon.dynamicLayoutVertexBuffer.updateData(Ot)}function We(w,t,o,f,g,S,z,k){const R=S.glyphStartIndex+S.numGlyphs,X=S.lineStartIndex,K=S.lineStartIndex+S.lineLength,J=t.getoffsetX(S.glyphStartIndex),ut=t.getoffsetX(R-1),mt=qn(w*J,o,f,g,S.segment,X,K,k,z);if(!mt)return null;const vt=qn(w*ut,o,f,g,S.segment,X,K,k,z);return!vt||k.projectionCache.anyProjectionOccluded?null:{first:mt,last:vt}}function di(w,t,o,f){if(w===C.ah.horizontal){const g=Math.abs(o.y-t.y),S=Math.abs(o.x-t.x)*f;if(g>S)return{useVertical:!0}}return(w===C.ah.vertical?t.y<o.y:t.x>o.x)?{needsFlipping:!0}:null}function mi(w,t,o,f,g,S,z,k,R,X,K){const J=o/24,ut=t.lineOffsetX*J,mt=t.lineOffsetY*J;let vt;if(t.numGlyphs>1){const Tt=t.glyphStartIndex+t.numGlyphs,Ft=t.lineStartIndex,Bt=t.lineStartIndex+t.lineLength,Ot=We(J,k,ut,mt,f,t,K,w);if(!Ot)return{notEnoughRoom:!0};const Dt=Jt(Ot.first.point.x,Ot.first.point.y,z,w.getElevation).point,ie=Jt(Ot.last.point.x,Ot.last.point.y,z,w.getElevation).point;if(g&&!f){const $t=di(t.writingMode,Dt,ie,X);if($t)return $t}vt=[Ot.first];for(let $t=t.glyphStartIndex+1;$t<Tt-1;$t++)vt.push(qn(J*k.getoffsetX($t),ut,mt,f,t.segment,Ft,Bt,w,K));vt.push(Ot.last)}else{if(g&&!f){const Ft=Jt(w.tileAnchorPoint.x,w.tileAnchorPoint.y,S,w.getElevation).point,Bt=t.lineStartIndex+t.segment+1,Ot=new C.P(w.lineVertexArray.getx(Bt),w.lineVertexArray.gety(Bt)),Dt=Jt(Ot.x,Ot.y,S,w.getElevation),ie=Dt.signedDistanceFromCamera>0?Dt.point:Ht(w.tileAnchorPoint,Ot,Ft,1,S,w),$t=di(t.writingMode,Ft,ie,X);if($t)return $t}const Tt=qn(J*k.getoffsetX(t.glyphStartIndex),ut,mt,f,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,w,K);if(!Tt||w.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};vt=[Tt]}for(const Tt of vt)C.aj(R,Tt.point,Tt.angle);return{}}function Ht(w,t,o,f,g,S){return tr(w,t,o,f,g,S)}function ii(w,t,o,f,g){return tr(w,t,o,f,void 0,g)}function tr(w,t,o,f,g,S){const z=w.add(w.sub(t)._unit()),k=g!==void 0?Jt(z.x,z.y,g,S.getElevation).point:Ei(z.x,z.y,S).point,R=o.sub(k);return o.add(R._mult(f/R.mag()))}function Qr(w,t,o){const f=t.projectionCache;if(f.projections[w])return f.projections[w];const g=new C.P(t.lineVertexArray.getx(w),t.lineVertexArray.gety(w)),S=Ei(g.x,g.y,t);if(S.signedDistanceFromCamera>0)return f.projections[w]=S.point,f.anyProjectionOccluded=f.anyProjectionOccluded||S.isOccluded,S.point;const z=w-o.direction,k=o.distanceFromAnchor===0?t.tileAnchorPoint:new C.P(t.lineVertexArray.getx(z),t.lineVertexArray.gety(z)),R=o.absOffsetX-o.distanceFromAnchor+1;return ii(k,g,o.previousVertex,R,t)}function Ei(w,t,o){const f=w+o.translation[0],g=t+o.translation[1];let S;return!o.pitchWithMap&&o.projection.useSpecialProjectionForSymbols?(S=o.projection.projectTileCoordinates(f,g,o.unwrappedTileID,o.getElevation),S.point.x=(S.point.x*.5+.5)*o.width,S.point.y=(-S.point.y*.5+.5)*o.height):(S=Jt(f,g,o.labelPlaneMatrix,o.getElevation),S.isOccluded=!1),S}function er(w,t,o){return w._unit()._perp()._mult(t*o)}function xs(w,t,o,f,g,S,z,k,R){if(k.projectionCache.offsets[w])return k.projectionCache.offsets[w];const X=o.add(t);if(w+R.direction<f||w+R.direction>=g)return k.projectionCache.offsets[w]=X,X;const K=Qr(w+R.direction,k,R),J=er(K.sub(o),z,R.direction),ut=o.add(J),mt=K.add(J);return k.projectionCache.offsets[w]=C.ak(S,X,ut,mt)||X,k.projectionCache.offsets[w]}function qn(w,t,o,f,g,S,z,k,R){const X=f?w-t:w+t;let K=X>0?1:-1,J=0;f&&(K*=-1,J=Math.PI),K<0&&(J+=Math.PI);let ut=K>0?S+g:S+g+1,mt;k.projectionCache.cachedAnchorPoint?mt=k.projectionCache.cachedAnchorPoint:(mt=Ei(k.tileAnchorPoint.x,k.tileAnchorPoint.y,k).point,k.projectionCache.cachedAnchorPoint=mt);let vt=mt,Tt=mt,Ft,Bt,Ot=0,Dt=0;const ie=Math.abs(X),$t=[];let ce;for(;Ot+Dt<=ie;){if(ut+=K,ut<S||ut>=z)return null;Ot+=Dt,Tt=vt,Bt=Ft;const Ze={absOffsetX:ie,direction:K,distanceFromAnchor:Ot,previousVertex:Tt};if(vt=Qr(ut,k,Ze),o===0)$t.push(Tt),ce=vt.sub(Tt);else{let ei;const Le=vt.sub(Tt);if(Le.mag()===0){const ui=Qr(ut+K,k,Ze);ei=er(ui.sub(vt),o,K)}else ei=er(Le,o,K);Bt||(Bt=Tt.add(ei)),Ft=xs(ut,ei,vt,S,z,Bt,o,k,Ze),$t.push(Bt),ce=Ft.sub(Bt)}Dt=ce.mag()}const we=(ie-Ot)/Dt,Fe=ce._mult(we)._add(Bt||Tt),Ge=J+Math.atan2(vt.y-Tt.y,vt.x-Tt.x);return $t.push(Fe),{point:Fe,angle:R?Ge:0,path:$t}}const _a=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function as(w,t){for(let o=0;o<w;o++){const f=t.length;t.resize(f+4),t.float32.set(_a,f*3)}}function No(w,t,o){const f=t[0],g=t[1];return w[0]=o[0]*f+o[4]*g+o[12],w[1]=o[1]*f+o[5]*g+o[13],w[3]=o[3]*f+o[7]*g+o[15],w}const mr=100;class Vs{constructor(t,o,f=new Vt(t.width+2*mr,t.height+2*mr,25),g=new Vt(t.width+2*mr,t.height+2*mr,25)){this.transform=t,this.mapProjection=o,this.grid=f,this.ignoredGrid=g,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+mr,this.screenBottomBoundary=t.height+mr,this.gridRightBoundary=t.width+2*mr,this.gridBottomBoundary=t.height+2*mr,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,o,f,g,S,z,k,R,X,K,J){const ut=t.anchorPointX+R[0],mt=t.anchorPointY+R[1],vt=this.projectAndGetPerspectiveRatio(g,ut,mt,S,K),Tt=f*vt.perspectiveRatio;let Ft;if(!z&&!k){const ce=vt.point.x+(J?J.x*Tt:0),we=vt.point.y+(J?J.y*Tt:0);Ft={allPointsOccluded:!1,box:[ce+t.x1*Tt,we+t.y1*Tt,ce+t.x2*Tt,we+t.y2*Tt]}}else Ft=this._projectCollisionBox(t,Tt,g,S,z,k,R,vt,K,J);const[Bt,Ot,Dt,ie]=Ft.box;return(this.mapProjection.useSpecialProjectionForSymbols?z?Ft.allPointsOccluded:this.mapProjection.isOccluded(ut,mt,S):!1)||vt.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Bt,Ot,Dt,ie)||o!=="always"&&this.grid.hitTest(Bt,Ot,Dt,ie,o,X)?{box:[Bt,Ot,Dt,ie],placeable:!1,offscreen:!1}:{box:[Bt,Ot,Dt,ie],placeable:!0,offscreen:this.isOffscreen(Bt,Ot,Dt,ie)}}placeCollisionCircles(t,o,f,g,S,z,k,R,X,K,J,ut,mt,vt,Tt,Ft){const Bt=[],Ot=new C.P(o.anchorX,o.anchorY),Dt=this.getPerspectiveRatio(z,Ot.x,Ot.y,k,Ft),$t=(J?S/Dt:S*Dt)/C.ap,ce={projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},we=o.lineOffsetX*$t,Fe=o.lineOffsetY*$t,Ge={getElevation:Ft,labelPlaneMatrix:R,lineVertexArray:f,pitchWithMap:J,projectionCache:ce,projection:this.mapProjection,tileAnchorPoint:Ot,unwrappedTileID:k,width:this.transform.width,height:this.transform.height,translation:Tt},Ze=We($t,g,we,Fe,!1,o,!1,Ge);let ei=!1,Le=!1,ui=!0;if(Ze){const ti=mt*.5*Dt+vt,Gi=new C.P(-100,-100),ye=new C.P(this.screenRightBoundary,this.screenBottomBoundary),Pe=new It,Ui=Ze.first,Wi=Ze.last;let Ni=[];for(let ur=Ui.path.length-1;ur>=1;ur--)Ni.push(Ui.path[ur]);for(let ur=1;ur<Wi.path.length;ur++)Ni.push(Wi.path[ur]);const Hr=ti*2.5;if(X){const ur=this.projectPathToScreenSpace(Ni,Ge,X);ur.some(Rr=>Rr.signedDistanceFromCamera<=0)?Ni=[]:Ni=ur.map(Rr=>Rr.point)}let Xr=[];if(Ni.length>0){const ur=Ni[0].clone(),Rr=Ni[0].clone();for(let yr=1;yr<Ni.length;yr++)ur.x=Math.min(ur.x,Ni[yr].x),ur.y=Math.min(ur.y,Ni[yr].y),Rr.x=Math.max(Rr.x,Ni[yr].x),Rr.y=Math.max(Rr.y,Ni[yr].y);ur.x>=Gi.x&&Rr.x<=ye.x&&ur.y>=Gi.y&&Rr.y<=ye.y?Xr=[Ni]:Rr.x<Gi.x||ur.x>ye.x||Rr.y<Gi.y||ur.y>ye.y?Xr=[]:Xr=C.al([Ni],Gi.x,Gi.y,ye.x,ye.y)}for(const ur of Xr){Pe.reset(ur,ti*.25);let Rr=0;Pe.length<=.5*ti?Rr=1:Rr=Math.ceil(Pe.paddedLength/Hr)+1;for(let yr=0;yr<Rr;yr++){const ul=yr/Math.max(Rr-1,1),ds=Pe.lerp(ul),sa=ds.x+mr,Rn=ds.y+mr;Bt.push(sa,Rn,ti,0);const Gl=sa-ti,Js=Rn-ti,Eu=sa+ti,Bn=Rn+ti;if(ui=ui&&this.isOffscreen(Gl,Js,Eu,Bn),Le=Le||this.isInsideGrid(Gl,Js,Eu,Bn),t!=="always"&&this.grid.hitTestCircle(sa,Rn,ti,t,ut)&&(ei=!0,!K))return{circles:[],offscreen:!1,collisionDetected:ei}}}}return{circles:!K&&ei||!Le||Dt<this.perspectiveRatioCutoff?[]:Bt,offscreen:ui,collisionDetected:ei}}projectPathToScreenSpace(t,o,f){return t.map(g=>Jt(g.x,g.y,f,o.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let f=1/0,g=1/0,S=-1/0,z=-1/0;for(const K of t){const J=new C.P(K.x+mr,K.y+mr);f=Math.min(f,J.x),g=Math.min(g,J.y),S=Math.max(S,J.x),z=Math.max(z,J.y),o.push(J)}const k=this.grid.query(f,g,S,z).concat(this.ignoredGrid.query(f,g,S,z)),R={},X={};for(const K of k){const J=K.key;if(R[J.bucketInstanceId]===void 0&&(R[J.bucketInstanceId]={}),R[J.bucketInstanceId][J.featureIndex])continue;const ut=[new C.P(K.x1,K.y1),new C.P(K.x2,K.y1),new C.P(K.x2,K.y2),new C.P(K.x1,K.y2)];C.am(o,ut)&&(R[J.bucketInstanceId][J.featureIndex]=!0,X[J.bucketInstanceId]===void 0&&(X[J.bucketInstanceId]=[]),X[J.bucketInstanceId].push(J.featureIndex))}return X}insertCollisionBox(t,o,f,g,S,z){const k=f?this.ignoredGrid:this.grid,R={bucketInstanceId:g,featureIndex:S,collisionGroupID:z,overlapMode:o};k.insert(R,t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,f,g,S,z){const k=f?this.ignoredGrid:this.grid,R={bucketInstanceId:g,featureIndex:S,collisionGroupID:z,overlapMode:o};for(let X=0;X<t.length;X+=4)k.insertCircle(R,t[X],t[X+1],t[X+2])}projectAndGetPerspectiveRatio(t,o,f,g,S){let z;S?(z=[o,f,S(o,f),1],C.af(z,z,t)):(z=[o,f,0,1],No(z,z,t));const k=z[3];return{point:new C.P((z[0]/k+1)/2*this.transform.width+mr,(-z[1]/k+1)/2*this.transform.height+mr),perspectiveRatio:.5+.5*(this.transform.cameraToCenterDistance/k),isOccluded:!1,signedDistanceFromCamera:k}}getPerspectiveRatio(t,o,f,g,S){const z=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(o,f,g,S):Jt(o,f,t,S);return .5+.5*(this.transform.cameraToCenterDistance/z.signedDistanceFromCamera)}isOffscreen(t,o,f,g){return f<mr||t>=this.screenRightBoundary||g<mr||o>this.screenBottomBoundary}isInsideGrid(t,o,f,g){return f>=0&&t<this.gridRightBoundary&&g>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=C.an([]);return C.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,o,f,g,S,z,k,R,X,K){let J=new C.P(1,0),ut=new C.P(0,1);const mt=new C.P(t.anchorPointX+k[0],t.anchorPointY+k[1]);if(z&&!S){const Ze=this.projectAndGetPerspectiveRatio(f,mt.x+1,mt.y,g,X).point.sub(R.point).unit(),ei=Math.atan(Ze.y/Ze.x)+(Ze.x<0?Math.PI:0),Le=Math.sin(ei),ui=Math.cos(ei);J=new C.P(ui,Le),ut=new C.P(-Le,ui)}else if(!z&&S){const Ge=-this.transform.angle,Ze=Math.sin(Ge),ei=Math.cos(Ge);J=new C.P(ei,Ze),ut=new C.P(-Ze,ei)}let vt=R.point,Tt=o;if(S){vt=mt;const Ge=this.transform.zoom-Math.floor(this.transform.zoom);if(Tt=Math.pow(2,-Ge),Tt*=this.mapProjection.getPitchedTextCorrection(this.transform,mt,g),!K){const Ze=R.signedDistanceFromCamera/this.transform.cameraToCenterDistance,ei=C.ac(.5+.5*Ze,0,4);Tt*=ei}}K&&(vt=vt.add(J.mult(K.x*Tt)).add(ut.mult(K.y*Tt)));const Ft=t.x1*Tt,Bt=t.x2*Tt,Ot=(Ft+Bt)/2,Dt=t.y1*Tt,ie=t.y2*Tt,$t=(Dt+ie)/2,ce=[{offsetX:Ft,offsetY:Dt},{offsetX:Ot,offsetY:Dt},{offsetX:Bt,offsetY:Dt},{offsetX:Bt,offsetY:$t},{offsetX:Bt,offsetY:ie},{offsetX:Ot,offsetY:ie},{offsetX:Ft,offsetY:ie},{offsetX:Ft,offsetY:$t}];let we=[];for(const{offsetX:Ge,offsetY:Ze}of ce)we.push(new C.P(vt.x+J.x*Ge+ut.x*Ze,vt.y+J.y*Ge+ut.y*Ze));let Fe=!1;if(S){const Ge=we.map(Ze=>this.projectAndGetPerspectiveRatio(f,Ze.x,Ze.y,g,X));Fe=Ge.some(Ze=>!Ze.isOccluded),we=Ge.map(Ze=>Ze.point)}else Fe=!0;return{box:C.ao(we),allPointsOccluded:!Fe}}}function pi(w,t,o){return t*(C.X/(w.tileSize*Math.pow(2,o-w.tileID.overscaledZ)))}class qa{constructor(t,o,f,g){t?this.opacity=Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):this.opacity=g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Tl{constructor(t,o,f,g,S){this.text=new qa(t?t.text:null,o,f,S),this.icon=new qa(t?t.icon:null,o,g,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _e{constructor(t,o,f){this.text=t,this.icon=o,this.skipFade=f}}class fo{constructor(){this.invProjMatrix=C.H(),this.viewportMatrix=C.H(),this.circles=[]}}class po{constructor(t,o,f,g,S){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=S}}class Ac{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:f=>f.collisionGroupID===o}}return this.collisionGroups[t]}}function nu(w,t,o,f,g){const{horizontalAlign:S,verticalAlign:z}=C.au(w),k=-(S-.5)*t,R=-(z-.5)*o;return new C.P(k+f[0]*g,R+f[1]*g)}class Me{constructor(t,o,f,g,S,z){this.transform=t.clone(),this.terrain=f,this.collisionIndex=new Vs(this.transform,o),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Ac(S),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=z,z&&(z.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const o=this.terrain;return o?(f,g)=>o.getElevation(t,f,g):null}getBucketParts(t,o,f,g){const S=f.getBucket(o),z=f.latestFeatureIndex;if(!S||!z||o.id!==S.layerIds[0])return;const k=f.collisionBoxArray,R=S.layers[0].layout,X=S.layers[0].paint,K=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),J=f.tileSize/C.X,ut=f.tileID.toUnwrapped(),mt=this.transform.calculatePosMatrix(ut),vt=R.get("text-pitch-alignment")==="map",Tt=R.get("text-rotation-alignment")==="map",Ft=pi(f,1,this.transform.zoom),Bt=this.collisionIndex.mapProjection.translatePosition(this.transform,f,X.get("text-translate"),X.get("text-translate-anchor")),Ot=this.collisionIndex.mapProjection.translatePosition(this.transform,f,X.get("icon-translate"),X.get("icon-translate-anchor")),Dt=qt(mt,vt,Tt,this.transform,Ft);let ie=null;if(vt){const ce=ee(mt,vt,Tt,this.transform,Ft);ie=C.L([],this.transform.labelPlaneMatrix,ce)}this.retainedQueryData[S.bucketInstanceId]=new po(S.bucketInstanceId,z,S.sourceLayerIndex,S.index,f.tileID);const $t={bucket:S,layout:R,translationText:Bt,translationIcon:Ot,posMatrix:mt,unwrappedTileID:ut,textLabelPlaneMatrix:Dt,labelToScreenMatrix:ie,scale:K,textPixelRatio:J,holdingForFade:f.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:C.ag(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(const ce of S.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Fe,symbolInstanceEnd:Ge}=ce;t.push({sortKey:we,symbolInstanceStart:Fe,symbolInstanceEnd:Ge,parameters:$t})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:$t})}attemptAnchorPlacement(t,o,f,g,S,z,k,R,X,K,J,ut,mt,vt,Tt,Ft,Bt,Ot,Dt){const ie=C.aq[t.textAnchor],$t=[t.textOffset0,t.textOffset1],ce=nu(ie,f,g,$t,S),we=this.collisionIndex.placeCollisionBox(o,ut,R,X,K,k,z,Ft,J.predicate,Dt,ce);if(!(Ot&&!this.collisionIndex.placeCollisionBox(Ot,ut,R,X,K,k,z,Bt,J.predicate,Dt,ce).placeable)&&we.placeable){let Fe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[mt.crossTileID]&&this.prevPlacement.placements[mt.crossTileID]&&this.prevPlacement.placements[mt.crossTileID].text&&(Fe=this.prevPlacement.variableOffsets[mt.crossTileID].anchor),mt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[mt.crossTileID]={textOffset:$t,width:f,height:g,anchor:ie,textBoxScale:S,prevAnchor:Fe},this.markUsedJustification(vt,ie,mt,Tt),vt.allowVerticalPlacement&&(this.markUsedOrientation(vt,Tt,mt),this.placedOrientations[mt.crossTileID]=Tt),{shift:ce,placedGlyphBoxes:we}}}placeLayerBucketPart(t,o,f){const{bucket:g,layout:S,translationText:z,translationIcon:k,posMatrix:R,unwrappedTileID:X,textLabelPlaneMatrix:K,labelToScreenMatrix:J,textPixelRatio:ut,holdingForFade:mt,collisionBoxArray:vt,partiallyEvaluatedTextSize:Tt,collisionGroup:Ft}=t.parameters,Bt=S.get("text-optional"),Ot=S.get("icon-optional"),Dt=C.ar(S,"text-overlap","text-allow-overlap"),ie=Dt==="always",$t=C.ar(S,"icon-overlap","icon-allow-overlap"),ce=$t==="always",we=S.get("text-rotation-alignment")==="map",Fe=S.get("text-pitch-alignment")==="map",Ge=S.get("icon-text-fit")!=="none",Ze=S.get("symbol-z-order")==="viewport-y",ei=ie&&(ce||!g.hasIconData()||Ot),Le=ce&&(ie||!g.hasTextData()||Bt);!g.collisionArrays&&vt&&g.deserializeCollisionBoxes(vt);const ui=this.retainedQueryData[g.bucketInstanceId].tileID,ti=this._getTerrainElevationFunc(ui),Gi=(ye,Pe,Ui)=>{var Wi,Ni;if(o[ye.crossTileID])return;if(mt){this.placements[ye.crossTileID]=new _e(!1,!1,!1);return}let Hr=!1,Xr=!1,ur=!0,Rr=null,yr={box:null,placeable:!1,offscreen:null},ul={placeable:!1},ds=null,sa=null,Rn=null,Gl=0,Js=0,Eu=0;Pe.textFeatureIndex?Gl=Pe.textFeatureIndex:ye.useRuntimeCollisionCircles&&(Gl=ye.featureIndex),Pe.verticalTextFeatureIndex&&(Js=Pe.verticalTextFeatureIndex);const Bn=Pe.textBox;if(Bn){const Co=oa=>{let to=C.ah.horizontal;if(g.allowVerticalPlacement&&!oa&&this.prevPlacement){const ps=this.prevPlacement.placedOrientations[ye.crossTileID];ps&&(this.placedOrientations[ye.crossTileID]=ps,to=ps,this.markUsedOrientation(g,to,ye))}return to},$s=(oa,to)=>{if(g.allowVerticalPlacement&&ye.numVerticalGlyphVertices>0&&Pe.verticalTextBox){for(const ps of g.writingModes)if(ps===C.ah.vertical?(yr=to(),ul=yr):yr=oa(),yr&&yr.placeable)break}else yr=oa()},eh=ye.textAnchorOffsetStartIndex,Ah=ye.textAnchorOffsetEndIndex;if(Ah===eh){const oa=(Xl,en)=>{const rn=this.collisionIndex.placeCollisionBox(Xl,Dt,ut,R,X,Fe,we,z,Ft.predicate,ti);return rn&&rn.placeable&&(this.markUsedOrientation(g,en,ye),this.placedOrientations[ye.crossTileID]=en),rn};$s(()=>oa(Bn,C.ah.horizontal),()=>{const Xl=Pe.verticalTextBox;return g.allowVerticalPlacement&&ye.numVerticalGlyphVertices>0&&Xl?oa(Xl,C.ah.vertical):{box:null,offscreen:null}}),Co(yr&&yr.placeable)}else{let oa=C.aq[(Ni=(Wi=this.prevPlacement)===null||Wi===void 0?void 0:Wi.variableOffsets[ye.crossTileID])===null||Ni===void 0?void 0:Ni.anchor];const to=(rn,ih,Ip)=>{const nn=rn.x2-rn.x1,vc=rn.y2-rn.y1,$d=ye.textBoxScale,df=Ge&&$t==="never"?ih:null;let Wl=null,tp=Dt==="never"?1:2,xc="never";oa&&tp++;for(let Ad=0;Ad<tp;Ad++){for(let Wf=eh;Wf<Ah;Wf++){const Md=g.textAnchorOffsets.get(Wf);if(oa&&Md.textAnchor!==oa)continue;const Mh=this.attemptAnchorPlacement(Md,rn,nn,vc,$d,we,Fe,ut,R,X,Ft,xc,ye,g,Ip,z,k,df,ti);if(Mh&&(Wl=Mh.placedGlyphBoxes,Wl&&Wl.placeable))return Hr=!0,Rr=Mh.shift,Wl}oa?oa=null:xc=Dt}return f&&!Wl&&(Wl={box:this.collisionIndex.placeCollisionBox(Bn,"always",ut,R,X,Fe,we,z,Ft.predicate,ti,new C.P(0,0)).box,offscreen:!1,placeable:!1}),Wl};$s(()=>to(Bn,Pe.iconBox,C.ah.horizontal),()=>{const rn=Pe.verticalTextBox,ih=yr&&yr.placeable;return g.allowVerticalPlacement&&!ih&&ye.numVerticalGlyphVertices>0&&rn?to(rn,Pe.verticalIconBox,C.ah.vertical):{box:null,occluded:!0,offscreen:null}}),yr&&(Hr=yr.placeable,ur=yr.offscreen);const en=Co(yr&&yr.placeable);if(!Hr&&this.prevPlacement){const rn=this.prevPlacement.variableOffsets[ye.crossTileID];rn&&(this.variableOffsets[ye.crossTileID]=rn,this.markUsedJustification(g,rn.anchor,ye,en))}}}if(ds=yr,Hr=ds&&ds.placeable,ur=ds&&ds.offscreen,ye.useRuntimeCollisionCircles){const Co=g.text.placedSymbolArray.get(ye.centerJustifiedTextSymbolIndex),$s=C.ai(g.textSizeData,Tt,Co),eh=S.get("text-padding"),Ah=ye.collisionCircleDiameter;sa=this.collisionIndex.placeCollisionCircles(Dt,Co,g.lineVertexArray,g.glyphOffsetArray,$s,R,X,K,J,f,Fe,Ft.predicate,Ah,eh,z,ti),sa.circles.length&&sa.collisionDetected&&!f&&C.w("Collisions detected, but collision boxes are not shown"),Hr=ie||sa.circles.length>0&&!sa.collisionDetected,ur=ur&&sa.offscreen}if(Pe.iconFeatureIndex&&(Eu=Pe.iconFeatureIndex),Pe.iconBox){const Co=$s=>this.collisionIndex.placeCollisionBox($s,$t,ut,R,X,Fe,we,k,Ft.predicate,ti,Ge&&Rr?Rr:void 0);ul&&ul.placeable&&Pe.verticalIconBox?(Rn=Co(Pe.verticalIconBox),Xr=Rn.placeable):(Rn=Co(Pe.iconBox),Xr=Rn.placeable),ur=ur&&Rn.offscreen}const Qs=Bt||ye.numHorizontalGlyphVertices===0&&ye.numVerticalGlyphVertices===0,Xf=Ot||ye.numIconVertices===0;!Qs&&!Xf?Xr=Hr=Xr&&Hr:Xf?Qs||(Xr=Xr&&Hr):Hr=Xr&&Hr;const ff=Hr&&ds.placeable,Hl=Xr&&Rn.placeable;if(ff&&(ul&&ul.placeable&&Js?this.collisionIndex.insertCollisionBox(ds.box,Dt,S.get("text-ignore-placement"),g.bucketInstanceId,Js,Ft.ID):this.collisionIndex.insertCollisionBox(ds.box,Dt,S.get("text-ignore-placement"),g.bucketInstanceId,Gl,Ft.ID)),Hl&&this.collisionIndex.insertCollisionBox(Rn.box,$t,S.get("icon-ignore-placement"),g.bucketInstanceId,Eu,Ft.ID),sa&&Hr&&this.collisionIndex.insertCollisionCircles(sa.circles,Dt,S.get("text-ignore-placement"),g.bucketInstanceId,Gl,Ft.ID),f&&this.storeCollisionData(g.bucketInstanceId,Ui,Pe,ds,Rn,sa),ye.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ye.crossTileID]=new _e(Hr||ei,Xr||Le,ur||g.justReloaded),o[ye.crossTileID]=!0};if(Ze){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ye=g.getSortedSymbolIndexes(this.transform.angle);for(let Pe=ye.length-1;Pe>=0;--Pe){const Ui=ye[Pe];Gi(g.symbolInstances.get(Ui),g.collisionArrays[Ui],Ui)}}else for(let ye=t.symbolInstanceStart;ye<t.symbolInstanceEnd;ye++)Gi(g.symbolInstances.get(ye),g.collisionArrays[ye],ye);if(f&&g.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[g.bucketInstanceId];C.as(ye.invProjMatrix,R),ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}storeCollisionData(t,o,f,g,S,z){if(f.textBox||f.iconBox){let k;this.collisionBoxArrays.has(t)?k=this.collisionBoxArrays.get(t):(k=new Map,this.collisionBoxArrays.set(t,k));let R;k.has(o)?R=k.get(o):(R={text:null,icon:null},k.set(o,R)),f.textBox&&(R.text=g.box),f.iconBox&&(R.icon=S.box)}if(z){let k=this.collisionCircleArrays[t];k===void 0&&(k=this.collisionCircleArrays[t]=new fo);for(let R=0;R<z.circles.length;R+=4)k.circles.push(z.circles[R+0]),k.circles.push(z.circles[R+1]),k.circles.push(z.circles[R+2]),k.circles.push(z.collisionDetected?1:0)}}markUsedJustification(t,o,f,g){const S={left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex};let z;g===C.ah.vertical?z=f.verticalPlacedTextSymbolIndex:z=S[C.at(o)];const k=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const R of k)R>=0&&(z>=0&&R!==z?t.text.placedSymbolArray.get(R).crossTileID=0:t.text.placedSymbolArray.get(R).crossTileID=f.crossTileID)}markUsedOrientation(t,o,f){const g=o===C.ah.horizontal||o===C.ah.horizontalOnly?o:0,S=o===C.ah.vertical?o:0,z=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const k of z)t.text.placedSymbolArray.get(k).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let f=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const g=o?o.symbolFadeChange(t):1,S=o?o.opacities:{},z=o?o.variableOffsets:{},k=o?o.placedOrientations:{};for(const R in this.placements){const X=this.placements[R],K=S[R];K?(this.opacities[R]=new Tl(K,g,X.text,X.icon),f=f||X.text!==K.text.placed||X.icon!==K.icon.placed):(this.opacities[R]=new Tl(null,g,X.text,X.icon,X.skipFade),f=f||X.text||X.icon)}for(const R in S){const X=S[R];if(!this.opacities[R]){const K=new Tl(X,g,!1,!1);K.isHidden()||(this.opacities[R]=K,f=f||X.text.placed||X.icon.placed)}}for(const R in z)!this.variableOffsets[R]&&this.opacities[R]&&!this.opacities[R].isHidden()&&(this.variableOffsets[R]=z[R]);for(const R in k)!this.placedOrientations[R]&&this.opacities[R]&&!this.opacities[R].isHidden()&&(this.placedOrientations[R]=k[R]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o){const f={};for(const g of o){const S=g.getBucket(t);S&&g.latestFeatureIndex&&t.id===S.layerIds[0]&&this.updateBucketOpacities(S,g.tileID,f,g.collisionBoxArray)}}updateBucketOpacities(t,o,f,g){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const S=t.layers[0],z=S.layout,k=new Tl(null,0,!1,!1,!0),R=z.get("text-allow-overlap"),X=z.get("icon-allow-overlap"),K=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),J=z.get("text-rotation-alignment")==="map",ut=z.get("text-pitch-alignment")==="map",mt=z.get("icon-text-fit")!=="none",vt=new Tl(null,0,R&&(X||!t.hasIconData()||z.get("icon-optional")),X&&(R||!t.hasTextData()||z.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);const Tt=(Bt,Ot,Dt)=>{for(let ie=0;ie<Ot/4;ie++)Bt.opacityVertexArray.emplaceBack(Dt);Bt.hasVisibleVertices=Bt.hasVisibleVertices||Dt!==Us},Ft=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Bt=0;Bt<t.symbolInstances.length;Bt++){const Ot=t.symbolInstances.get(Bt),{numHorizontalGlyphVertices:Dt,numVerticalGlyphVertices:ie,crossTileID:$t}=Ot,ce=f[$t];let we=this.opacities[$t];ce?we=k:we||(we=vt,this.opacities[$t]=we),f[$t]=!0;const Fe=Dt>0||ie>0,Ge=Ot.numIconVertices>0,Ze=this.placedOrientations[Ot.crossTileID],ei=Ze===C.ah.vertical,Le=Ze===C.ah.horizontal||Ze===C.ah.horizontalOnly;if(Fe){const ti=Zn(we.text),Gi=ei?Us:ti;Tt(t.text,Dt,Gi);const ye=Le?Us:ti;Tt(t.text,ie,ye);const Pe=we.text.isHidden();[Ot.rightJustifiedTextSymbolIndex,Ot.centerJustifiedTextSymbolIndex,Ot.leftJustifiedTextSymbolIndex].forEach(Ni=>{Ni>=0&&(t.text.placedSymbolArray.get(Ni).hidden=Pe||ei?1:0)}),Ot.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Ot.verticalPlacedTextSymbolIndex).hidden=Pe||Le?1:0);const Ui=this.variableOffsets[Ot.crossTileID];Ui&&this.markUsedJustification(t,Ui.anchor,Ot,Ze);const Wi=this.placedOrientations[Ot.crossTileID];Wi&&(this.markUsedJustification(t,"left",Ot,Wi),this.markUsedOrientation(t,Wi,Ot))}if(Ge){const ti=Zn(we.icon),Gi=!(mt&&Ot.verticalPlacedIconSymbolIndex&&ei);if(Ot.placedIconSymbolIndex>=0){const ye=Gi?ti:Us;Tt(t.icon,Ot.numIconVertices,ye),t.icon.placedSymbolArray.get(Ot.placedIconSymbolIndex).hidden=we.icon.isHidden()}if(Ot.verticalPlacedIconSymbolIndex>=0){const ye=Gi?Us:ti;Tt(t.icon,Ot.numVerticalIconVertices,ye),t.icon.placedSymbolArray.get(Ot.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden()}}const ui=Ft&&Ft.has(Bt)?Ft.get(Bt):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ti=t.collisionArrays[Bt];if(ti){let Gi=new C.P(0,0);if(ti.textBox||ti.verticalTextBox){let ye=!0;if(K){const Pe=this.variableOffsets[$t];Pe?(Gi=nu(Pe.anchor,Pe.width,Pe.height,Pe.textOffset,Pe.textBoxScale),J&&Gi._rotate(ut?this.transform.angle:-this.transform.angle)):ye=!1}if(ti.textBox||ti.verticalTextBox){let Pe;ti.textBox&&(Pe=ei),ti.verticalTextBox&&(Pe=Le),Di(t.textCollisionBox.collisionVertexArray,we.text.placed,!ye||Pe,ui.text,Gi.x,Gi.y)}}if(ti.iconBox||ti.verticalIconBox){const ye=!!(!Le&&ti.verticalIconBox);let Pe;ti.iconBox&&(Pe=ye),ti.verticalIconBox&&(Pe=!ye),Di(t.iconCollisionBox.collisionVertexArray,we.icon.placed,Pe,ui.icon,mt?Gi.x:0,mt?Gi.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Bt=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Bt.invProjMatrix,t.placementViewportMatrix=Bt.viewportMatrix,t.collisionCircleArray=Bt.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const f=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function Di(w,t,o,f,g,S){(!f||f.length===0)&&(f=[0,0,0,0]);const z=f[0]-mr,k=f[1]-mr,R=f[2]-mr,X=f[3]-mr;w.emplaceBack(t?1:0,o?1:0,g||0,S||0,z,k),w.emplaceBack(t?1:0,o?1:0,g||0,S||0,R,k),w.emplaceBack(t?1:0,o?1:0,g||0,S||0,R,X),w.emplaceBack(t?1:0,o?1:0,g||0,S||0,z,X)}const Ci=Math.pow(2,25),Za=Math.pow(2,24),Mu=Math.pow(2,17),vi=Math.pow(2,16),wf=Math.pow(2,9),gn=Math.pow(2,8),ja=Math.pow(2,1);function Zn(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const t=w.placed?1:0,o=Math.floor(w.opacity*127);return o*Ci+t*Za+o*Mu+t*vi+o*wf+t*gn+o*ja+t}const Us=0;function Ns(){return{isOccluded(w,t,o){return!1},getPitchedTextCorrection(w,t,o){return 1},get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(w,t,o,f){throw new Error("Not implemented.")},translatePosition(w,t,o,f){return Ga(w,t,o,f)},getCircleRadiusCorrection(w){return 1}}}function Ga(w,t,o,f,g=!1){if(!o[0]&&!o[1])return[0,0];const S=g?f==="map"?w.angle:0:f==="viewport"?-w.angle:0;if(S){const z=Math.sin(S),k=Math.cos(S);o=[o[0]*k-o[1]*z,o[0]*z+o[1]*k]}return[g?o[0]:pi(t,o[0],w.zoom),g?o[1]:pi(t,o[1],w.zoom)]}class zr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,o,f,g,S){const z=this._bucketParts;for(;this._currentTileIndex<t.length;){const k=t[this._currentTileIndex];if(o.getBucketParts(z,g,k,this._sortAcrossTiles),this._currentTileIndex++,S())return!0}for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,z.sort((k,R)=>k.sortKey-R.sortKey));this._currentPartIndex<z.length;){const k=z[this._currentPartIndex];if(o.placeLayerBucketPart(k,this._seenCrossTileIDs,f),this._currentPartIndex++,S())return!0}return!1}}class pd{constructor(t,o,f,g,S,z,k,R){this.placement=new Me(t,Ns(),o,z,k,R),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(t,o,f){const g=me.now(),S=()=>this._forceFullPlacement?!1:me.now()-g>2;for(;this._currentPlacementIndex>=0;){const z=t[this._currentPlacementIndex],k=o[z],R=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=R)&&(!k.maxzoom||k.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new zr(k)),this._inProgressLayer.continuePlacement(f[k.source],this.placement,this._showCollisionBoxes,k,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const mo=512/C.X/2,Uh=128;class qo{constructor(t,o,f){this.tileID=t,this.bucketInstanceId=f,this._symbolsByKey={};const g=new Map;for(let S=0;S<o.length;S++){const z=o.get(S),k=z.key,R=g.get(k);R?R.push(z):g.set(k,[z])}for(const[S,z]of g){const k=z.map(K=>({x:Math.floor(K.anchorX*mo),y:Math.floor(K.anchorY*mo)})),R=z.map(K=>K.crossTileID),X={positions:k,crossTileIDs:R};if(X.positions.length>Uh){const K=new C.av(X.positions.length,16,Uint16Array);for(const{x:J,y:ut}of X.positions)K.add(J,ut);K.finish(),delete X.positions,X.index=K}this._symbolsByKey[S]=X}}getScaledCoordinates(t,o){const{x:f,y:g,z:S}=this.tileID.canonical,{x:z,y:k,z:R}=o.canonical,X=R-S,K=mo/Math.pow(2,X),J=(z*C.X+t.anchorX)*K,ut=(k*C.X+t.anchorY)*K,mt=f*C.X*mo,vt=g*C.X*mo;return{x:Math.floor(J-mt),y:Math.floor(ut-vt)}}findMatches(t,o,f){const g=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let S=0;S<t.length;S++){const z=t.get(S);if(z.crossTileID)continue;const k=this._symbolsByKey[z.key];if(!k)continue;const R=this.getScaledCoordinates(z,o);if(k.index){const X=k.index.range(R.x-g,R.y-g,R.x+g,R.y+g).sort();for(const K of X){const J=k.crossTileIDs[K];if(!f[J]){f[J]=!0,z.crossTileID=J;break}}}else if(k.positions)for(let X=0;X<k.positions.length;X++){const K=k.positions[X],J=k.crossTileIDs[X];if(Math.abs(K.x-R.x)<=g&&Math.abs(K.y-R.y)<=g&&!f[J]){f[J]=!0,z.crossTileID=J;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class An{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ue{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const f in this.indexes){const g=this.indexes[f],S={};for(const z in g){const k=g[z];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+o),S[k.tileID.key]=k}this.indexes[f]=S}this.lng=t}addBucket(t,o,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let S=0;S<o.symbolInstances.length;S++){const z=o.symbolInstances.get(S);z.crossTileID=0}this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const g=this.usedCrossTileIDs[t.overscaledZ];for(const S in this.indexes){const z=this.indexes[S];if(Number(S)>t.overscaledZ)for(const k in z){const R=z[k];R.tileID.isChildOf(t)&&R.findMatches(o.symbolInstances,t,g)}else{const k=t.scaledTo(Number(S)),R=z[k.key];R&&R.findMatches(o.symbolInstances,t,g)}}for(let S=0;S<o.symbolInstances.length;S++){const z=o.symbolInstances.get(S);z.crossTileID||(z.crossTileID=f.generate(),g[z.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new qo(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const f of o.getCrossTileIDsLists())for(const g of f)delete this.usedCrossTileIDs[t][g]}removeStaleBuckets(t){let o=!1;for(const f in this.indexes){const g=this.indexes[f];for(const S in g)t[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[S]),delete g[S],o=!0)}return o}}class Ue{constructor(){this.layerIndexes={},this.crossTileIDs=new An,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,f){let g=this.layerIndexes[t.id];g===void 0&&(g=this.layerIndexes[t.id]=new ue);let S=!1;const z={};g.handleWrapJump(f);for(const k of o){const R=k.getBucket(t);!R||t.id!==R.layerIds[0]||(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(k.tileID,R,this.crossTileIDs)&&(S=!0),z[R.bucketInstanceId]=!0)}return g.removeStaleBuckets(z)&&(S=!0),S}pruneUnusedLayers(t){const o={};t.forEach(f=>{o[f]=!0});for(const f in this.layerIndexes)o[f]||delete this.layerIndexes[f]}}const zu=(w,t)=>C.t(w,t&&t.filter(o=>o.identifier!=="source.canvas")),au=C.aw();class vr extends C.E{constructor(t,o={}){super(),this._rtlPluginLoaded=()=>{for(const f in this.sourceCaches){const g=this.sourceCaches[f].getSource().type;(g==="vector"||g==="geojson")&&this.sourceCaches[f].reload()}},this.map=t,this.dispatcher=new Pn(Ua(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(f,g)=>this.getGlyphs(f,g)),this.dispatcher.registerMessageHandler("GI",(f,g)=>this.getImages(f,g)),this.imageManager=new oh,this.imageManager.setEventedParent(this),this.glyphManager=new zi(t._requestManager,o.localIdeographFontFamily),this.lineAtlas=new Os(256,512),this.crossTileSymbolIndex=new Ue,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new C.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",C.ay()),Mt().on(gt,this._rtlPluginLoaded),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const g=this.sourceCaches[f.sourceId];if(!g)return;const S=g.getSource();if(!(!S||!S.vectorLayerIds))for(const z in this._layers){const k=this._layers[z];k.source===S.id&&this._validateLayer(k)}})}loadURL(t,o={},f){this.fire(new C.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate=="boolean"?o.validate:!0;const g=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const S=this._loadStyleRequest;C.h(g,this._loadStyleRequest).then(z=>{this._loadStyleRequest=null,this._load(z.data,o,f)}).catch(z=>{this._loadStyleRequest=null,z&&!S.signal.aborted&&this.fire(new C.j(z))})}loadJSON(t,o={},f){this.fire(new C.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,me.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(t,o,f)}).catch(()=>{})}loadEmpty(){this.fire(new C.k("dataloading",{dataType:"style"})),this._load(au,{validate:!1})}_load(t,o,f){var g;const S=o.transformStyle?o.transformStyle(f,t):t;if(!(o.validate&&zu(this,C.u(S)))){this._loaded=!0,this.stylesheet=S;for(const z in S.sources)this.addSource(z,S.sources[z],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new Qn(this.stylesheet.light),this.sky=new Ro(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new C.k("data",{dataType:"style"})),this.fire(new C.k("style.load"))}}_createLayers(){const t=C.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of t){const f=C.aA(o);f.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=f}}_loadSprite(t,o=!1,f=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController;let g;On(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(S=>{if(this._spriteRequest=null,S)for(const z in S){this._spritesImagesIds[z]=[];const k=this._spritesImagesIds[z]?this._spritesImagesIds[z].filter(R=>!(R in S)):[];for(const R of k)this.imageManager.removeImage(R),this._changedImages[R]=!0;for(const R in S[z]){const X=z==="default"?R:`${z}:${R}`;this._spritesImagesIds[z].push(X),X in this.imageManager.images?this.imageManager.updateImage(X,S[z][R],!1):this.imageManager.addImage(X,S[z][R]),o&&(this._changedImages[X]=!0)}}}).catch(S=>{this._spriteRequest=null,g=S,this.fire(new C.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new C.k("data",{dataType:"style"})),f&&f(g)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new C.k("data",{dataType:"style"}))}_validateLayer(t){const o=this.sourceCaches[t.source];if(!o)return;const f=t.sourceLayer;if(!f)return;const g=o.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(f)===-1)&&this.fire(new C.j(new Error(`Source layer "${f}" does not exist on source "${g.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,o=!1){const f=this._serializedAllLayers();if(!t||t.length===0)return Object.values(o?C.aB(f):f);const g=[];for(const S of t)if(f[S]){const z=o?C.aB(f[S]):f[S];g.push(z)}return g}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const o=Object.keys(this._layers);for(const f of o){const g=this._layers[f];g.type!=="custom"&&(t[f]=g.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const o=this._changed;if(o){const g=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(g.length||S.length)&&this._updateWorkerLayers(g,S);for(const z in this._updatedSources){const k=this._updatedSources[z];if(k==="reload")this._reloadSource(z);else if(k==="clear")this._clearSource(z);else throw new Error(`Invalid action ${k}`)}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const z in this._updatedPaintProps)this._layers[z].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const f={};for(const g in this.sourceCaches){const S=this.sourceCaches[g];f[g]=S.used,S.used=!1}for(const g of this._order){const S=this._layers[g];S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(const g in f){const S=this.sourceCaches[g];!!f[g]!=!!S.used&&S.fire(new C.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(t),this.sky.recalculate(t),this.z=t.zoom,o&&this.fire(new C.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,o={}){var f;this._checkLoaded();const g=this.serialize();if(t=o.transformStyle?o.transformStyle(g,t):t,((f=o.validate)!==null&&f!==void 0?f:!0)&&zu(this,C.u(t)))return!1;t=C.aB(t),t.layers=C.az(t.layers);const z=C.aC(g,t),k=this._getOperationsToPerform(z);if(k.unimplemented.length>0)throw new Error(`Unimplemented: ${k.unimplemented.join(", ")}.`);if(k.operations.length===0)return!1;for(const R of k.operations)R();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const o=[],f=[];for(const g of t)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":o.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":o.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,g.args));break;case"setSky":o.push(()=>this.setSky.apply(this,g.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":o.push(()=>{});break;default:f.push(g.command);break}return{operations:o,unimplemented:f}}addImage(t,o){if(this.getImage(t))return this.fire(new C.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,o),this._afterImageUpdated(t)}updateImage(t,o){this.imageManager.updateImage(t,o)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new C.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new C.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,o,f={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(C.u.source,`sources.${t}`,o,null,f))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const z=this.sourceCaches[t]=new nt(t,o,this.dispatcher);z.style=this,z.setEventedParent(this,()=>({isSourceLoaded:z.loaded(),source:z.serialize(),sourceId:t})),z.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new C.j(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));const o=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],o.fire(new C.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,o){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const f=this.sourceCaches[t].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(o),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,o,f={}){this._checkLoaded();const g=t.id;if(this.getLayer(g)){this.fire(new C.j(new Error(`Layer "${g}" already exists on this map.`)));return}let S;if(t.type==="custom"){if(zu(this,C.aD(t)))return;S=C.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(g,t.source),t=C.aB(t),t=C.e(t,{source:g})),this._validate(C.u.layer,`layers.${g}`,t,{arrayIndex:-1},f))return;S=C.aA(t),this._validateLayer(S),S.setEventedParent(this,{layer:{id:g}})}const z=o?this._order.indexOf(o):this._order.length;if(o&&z===-1){this.fire(new C.j(new Error(`Cannot add layer "${g}" before non-existing layer "${o}".`)));return}if(this._order.splice(z,0,g),this._layerOrderChanged=!0,this._layers[g]=S,this._removedLayers[g]&&S.source&&S.type!=="custom"){const k=this._removedLayers[g];delete this._removedLayers[g],k.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}moveLayer(t,o){if(this._checkLoaded(),this._changed=!0,!this._layers[t]){this.fire(new C.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));return}if(t===o)return;const g=this._order.indexOf(t);this._order.splice(g,1);const S=o?this._order.indexOf(o):this._order.length;if(o&&S===-1){this.fire(new C.j(new Error(`Cannot move layer "${t}" before non-existing layer "${o}".`)));return}this._order.splice(S,0,t),this._layerOrderChanged=!0}removeLayer(t){this._checkLoaded();const o=this._layers[t];if(!o){this.fire(new C.j(new Error(`Cannot remove non-existing layer "${t}".`)));return}o.setEventedParent(null);const f=this._order.indexOf(t);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=o,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],o.onRemove&&o.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,o,f){this._checkLoaded();const g=this.getLayer(t);if(!g){this.fire(new C.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)));return}g.minzoom===o&&g.maxzoom===f||(o!=null&&(g.minzoom=o),f!=null&&(g.maxzoom=f),this._updateLayer(g))}setFilter(t,o,f={}){this._checkLoaded();const g=this.getLayer(t);if(!g){this.fire(new C.j(new Error(`Cannot filter non-existing layer "${t}".`)));return}if(!C.aE(g.filter,o)){if(o==null){g.filter=void 0,this._updateLayer(g);return}this._validate(C.u.filter,`layers.${g.id}.filter`,o,null,f)||(g.filter=C.aB(o),this._updateLayer(g))}}getFilter(t){return C.aB(this.getLayer(t).filter)}setLayoutProperty(t,o,f,g={}){this._checkLoaded();const S=this.getLayer(t);if(!S){this.fire(new C.j(new Error(`Cannot style non-existing layer "${t}".`)));return}C.aE(S.getLayoutProperty(o),f)||(S.setLayoutProperty(o,f,g),this._updateLayer(S))}getLayoutProperty(t,o){const f=this.getLayer(t);if(!f){this.fire(new C.j(new Error(`Cannot get style of non-existing layer "${t}".`)));return}return f.getLayoutProperty(o)}setPaintProperty(t,o,f,g={}){this._checkLoaded();const S=this.getLayer(t);if(!S){this.fire(new C.j(new Error(`Cannot style non-existing layer "${t}".`)));return}if(C.aE(S.getPaintProperty(o),f))return;S.setPaintProperty(o,f,g)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null}getPaintProperty(t,o){return this.getLayer(t).getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();const f=t.source,g=t.sourceLayer,S=this.sourceCaches[f];if(S===void 0){this.fire(new C.j(new Error(`The source '${f}' does not exist in the map's style.`)));return}const z=S.getSource().type;if(z==="geojson"&&g){this.fire(new C.j(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));return}if(z==="vector"&&!g){this.fire(new C.j(new Error("The sourceLayer parameter must be provided for vector source types.")));return}t.id===void 0&&this.fire(new C.j(new Error("The feature id parameter must be provided."))),S.setFeatureState(g,t.id,o)}removeFeatureState(t,o){this._checkLoaded();const f=t.source,g=this.sourceCaches[f];if(g===void 0){this.fire(new C.j(new Error(`The source '${f}' does not exist in the map's style.`)));return}const S=g.getSource().type,z=S==="vector"?t.sourceLayer:void 0;if(S==="vector"&&!z){this.fire(new C.j(new Error("The sourceLayer parameter must be provided for vector source types.")));return}if(o&&typeof t.id!="string"&&typeof t.id!="number"){this.fire(new C.j(new Error("A feature id is required to remove its specific state property.")));return}g.removeFeatureState(z,t.id,o)}getFeatureState(t){this._checkLoaded();const o=t.source,f=t.sourceLayer,g=this.sourceCaches[o];if(g===void 0){this.fire(new C.j(new Error(`The source '${o}' does not exist in the map's style.`)));return}if(g.getSource().type==="vector"&&!f){this.fire(new C.j(new Error("The sourceLayer parameter must be provided for vector source types.")));return}return t.id===void 0&&this.fire(new C.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(f,t.id)}getTransition(){return C.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=C.aF(this.sourceCaches,S=>S.serialize()),o=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,g=this.stylesheet;return C.aG({version:g.version,name:g.name,metadata:g.metadata,light:g.light,sky:g.sky,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:t,layers:o,terrain:f},S=>S!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const o=z=>this._layers[z].type==="fill-extrusion",f={},g=[];for(let z=this._order.length-1;z>=0;z--){const k=this._order[z];if(o(k)){f[k]=z;for(const R of t){const X=R[k];if(X)for(const K of X)g.push(K)}}}g.sort((z,k)=>k.intersectionZ-z.intersectionZ);const S=[];for(let z=this._order.length-1;z>=0;z--){const k=this._order[z];if(o(k))for(let R=g.length-1;R>=0;R--){const X=g[R].feature;if(f[X.layer.id]<z)break;S.push(X),g.pop()}else for(const R of t){const X=R[k];if(X)for(const K of X)S.push(K.feature)}}return S}queryRenderedFeatures(t,o,f){o&&o.filter&&this._validate(C.u.filter,"queryRenderedFeatures.filter",o.filter,null,o);const g={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new C.j(new Error("parameters.layers must be an Array."))),[];for(const k of o.layers){const R=this._layers[k];if(!R)return this.fire(new C.j(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];g[R.source]=!0}}const S=[];o.availableImages=this._availableImages;const z=this._serializedAllLayers();for(const k in this.sourceCaches)o.layers&&!g[k]||S.push(vl(this.sourceCaches[k],this._layers,z,t,o,f));return this.placement&&S.push(xl(this._layers,z,this.sourceCaches,t,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(t,o){o&&o.filter&&this._validate(C.u.filter,"querySourceFeatures.filter",o.filter,null,o);const f=this.sourceCaches[t];return f?Un(f,o):[]}getLight(){return this.light.getLight()}setLight(t,o={}){this._checkLoaded();const f=this.light.getLight();let g=!1;for(const z in t)if(!C.aE(t[z],f[z])){g=!0;break}if(!g)return;const S={now:me.now(),transition:C.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,o),this.light.updateTransitions(S)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,o={}){const f=this.getSky();let g=!1;if(!t&&!f)return;if(t&&!f)g=!0;else if(!t&&f)g=!0;else for(const z in t)if(!C.aE(t[z],f[z])){g=!0;break}if(!g)return;const S={now:me.now(),transition:C.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,o),this.sky.updateTransitions(S)}_validate(t,o,f,g,S={}){return S&&S.validate===!1?!1:zu(this,t.call(C.u,C.e({key:o,style:this.serialize(),value:f,styleSpec:C.v},g)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Mt().off(gt,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const f=this.sourceCaches[o];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const o in this.sourceCaches)this.sourceCaches[o].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,o,f,g,S=!1){let z=!1,k=!1;const R={};for(const K of this._order){const J=this._layers[K];if(J.type!=="symbol")continue;if(!R[J.source]){const mt=this.sourceCaches[J.source];R[J.source]=mt.getRenderableIds(!0).map(vt=>mt.getTileByID(vt)).sort((vt,Tt)=>Tt.tileID.overscaledZ-vt.tileID.overscaledZ||(vt.tileID.isLessThan(Tt.tileID)?-1:1))}const ut=this.crossTileSymbolIndex.addLayer(J,R[J.source],t.center.lng);z=z||ut}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),S=S||this._layerOrderChanged||f===0,(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(me.now(),t.zoom))&&(this.pauseablePlacement=new pd(t,this.map.terrain,this._order,S,o,f,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(me.now()),k=!0),z&&this.pauseablePlacement.placement.setStale()),k||z)for(const K of this._order){const J=this._layers[K];J.type==="symbol"&&this.placement.updateLayerOpacities(J,R[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(me.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,o){return C._(this,void 0,void 0,function*(){const f=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[o.source];return g&&g.setDependencies(o.tileID.key,o.type,o.icons),f})}getGlyphs(t,o){return C._(this,void 0,void 0,function*(){const f=yield this.glyphManager.getGlyphs(o.stacks),g=this.sourceCaches[o.source];return g&&g.setDependencies(o.tileID.key,o.type,[""]),f})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,o={}){this._checkLoaded(),!(t&&this._validate(C.u.glyphs,"glyphs",t,null,o))&&(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,o,f={},g){this._checkLoaded();const S=[{id:t,url:o}],z=[...sn(this.stylesheet.sprite),...S];this._validate(C.u.sprite,"sprite",z,null,f)||(this.stylesheet.sprite=z,this._loadSprite(S,!0,g))}removeSprite(t){this._checkLoaded();const o=sn(this.stylesheet.sprite);if(!o.find(f=>f.id===t)){this.fire(new C.j(new Error(`Sprite "${t}" doesn't exists on this map.`)));return}if(this._spritesImagesIds[t])for(const f of this._spritesImagesIds[t])this.imageManager.removeImage(f),this._changedImages[f]=!0;o.splice(o.findIndex(f=>f.id===t),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new C.k("data",{dataType:"style"}))}getSprite(){return sn(this.stylesheet.sprite)}setSprite(t,o={},f){this._checkLoaded(),!(t&&this._validate(C.u.sprite,"sprite",t,null,o))&&(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,f):(this._unloadSprite(),f&&f(null)))}}var qs=C.Y([{name:"a_pos",type:"Int16",components:2}]),_o=`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,lh=`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`,Du=`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ze="attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}",ki=`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,xi="uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}",bs=`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zo=`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`,Si="void main() {gl_FragColor=vec4(1.0);}",su="attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}",ou=`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,El=`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`,uh=`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,ws="uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}",br="varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}",lu="attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}",Ss="varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",Nh="attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}",hh="uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",cr="attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}",qh=`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ki=`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`,jn=`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ga=`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`,Mn=`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Pr=`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`,ss=`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ch=`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`,Dr=`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,kr=`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`,ya=`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Fr=`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`,Ur=`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,zn="uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}",yn=`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,jo="uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}",Il=`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ts=`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`,Sf=`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zs=`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`,hn=`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zh=`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`,go=`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,yo=`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`,ku=`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Mc="uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}",zc=`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,uu=`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`,jh=`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,fh=`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`,md=`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Dc=`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`,Tf="varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",_d="precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ef="uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}",hu="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}",gd="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}",dh="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}",yd="uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}",kc="attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}";const Dn={prelude:Pi(_o,lh),background:Pi(Du,ze),backgroundPattern:Pi(ki,xi),circle:Pi(bs,Zo),clippingMask:Pi(Si,su),heatmap:Pi(ou,El),heatmapTexture:Pi(uh,ws),collisionBox:Pi(br,lu),collisionCircle:Pi(Ss,Nh),debug:Pi(hh,cr),fill:Pi(qh,Ki),fillOutline:Pi(jn,ga),fillOutlinePattern:Pi(Mn,Pr),fillPattern:Pi(ss,ch),fillExtrusion:Pi(Dr,kr),fillExtrusionPattern:Pi(ya,Fr),hillshadePrepare:Pi(Ur,zn),hillshade:Pi(yn,jo),line:Pi(Il,Ts),lineGradient:Pi(Sf,Zs),linePattern:Pi(hn,Zh),lineSDF:Pi(go,yo),raster:Pi(ku,Mc),symbolIcon:Pi(zc,uu),symbolSDF:Pi(jh,fh),symbolTextAndIcon:Pi(md,Dc),terrain:Pi(Ef,dh),terrainDepth:Pi(Tf,hu),terrainCoords:Pi(_d,gd),sky:Pi(yd,kc)};function Pi(w,t){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=t.match(/attribute ([\w]+) ([\w]+)/g),g=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),z=S?S.concat(g):g,k={};return w=w.replace(o,(R,X,K,J,ut)=>(k[ut]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_${ut}
varying ${K} ${J} ${ut};
#else
uniform ${K} ${J} u_${ut};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ut}
    ${K} ${J} ${ut} = u_${ut};
#endif
`)),t=t.replace(o,(R,X,K,J,ut)=>{const mt=J==="float"?"vec2":"vec4",vt=ut.match(/color/)?"color":mt;return k[ut]?X==="define"?`
#ifndef HAS_UNIFORM_u_${ut}
uniform lowp float u_${ut}_t;
attribute ${K} ${mt} a_${ut};
varying ${K} ${J} ${ut};
#else
uniform ${K} ${J} u_${ut};
#endif
`:vt==="vec4"?`
#ifndef HAS_UNIFORM_u_${ut}
    ${ut} = a_${ut};
#else
    ${K} ${J} ${ut} = u_${ut};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ut}
    ${ut} = unpack_mix_${vt}(a_${ut}, u_${ut}_t);
#else
    ${K} ${J} ${ut} = u_${ut};
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_${ut}
uniform lowp float u_${ut}_t;
attribute ${K} ${mt} a_${ut};
#else
uniform ${K} ${J} u_${ut};
#endif
`:vt==="vec4"?`
#ifndef HAS_UNIFORM_u_${ut}
    ${K} ${J} ${ut} = a_${ut};
#else
    ${K} ${J} ${ut} = u_${ut};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ut}
    ${K} ${J} ${ut} = unpack_mix_${vt}(a_${ut}, u_${ut}_t);
#else
    ${K} ${J} ${ut} = u_${ut};
#endif
`}),{fragmentSource:w,vertexSource:t,staticAttributes:f,staticUniforms:z}}class Fc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,o,f,g,S,z,k,R,X){this.context=t;let K=this.boundPaintVertexBuffers.length!==g.length;for(let ut=0;!K&&ut<g.length;ut++)this.boundPaintVertexBuffers[ut]!==g[ut]&&(K=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==f||K||this.boundIndexBuffer!==S||this.boundVertexOffset!==z||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==R||this.boundDynamicVertexBuffer3!==X?this.freshBind(o,f,g,S,z,k,R,X):(t.bindVertexArray.set(this.vao),k&&k.bind(),S&&S.dynamicDraw&&S.bind(),R&&R.bind(),X&&X.bind())}freshBind(t,o,f,g,S,z,k,R){const X=t.numAttributes,K=this.context,J=K.gl;this.vao&&this.destroy(),this.vao=K.createVertexArray(),K.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=z,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=R,o.enableAttributes(J,t);for(const ut of f)ut.enableAttributes(J,t);z&&z.enableAttributes(J,t),k&&k.enableAttributes(J,t),R&&R.enableAttributes(J,t),o.bind(),o.setVertexAttribPointers(J,t,S);for(const ut of f)ut.bind(),ut.setVertexAttribPointers(J,t,S);z&&(z.bind(),z.setVertexAttribPointers(J,t,S)),g&&g.bind(),k&&(k.bind(),k.setVertexAttribPointers(J,t,S)),R&&(R.bind(),R.setVertexAttribPointers(J,t,S)),K.currentNumAttributes=X}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Fu=(w,t)=>({u_depth:new C.aH(w,t.u_depth),u_terrain:new C.aH(w,t.u_terrain),u_terrain_dim:new C.aI(w,t.u_terrain_dim),u_terrain_matrix:new C.aJ(w,t.u_terrain_matrix),u_terrain_unpack:new C.aK(w,t.u_terrain_unpack),u_terrain_exaggeration:new C.aI(w,t.u_terrain_exaggeration)}),Lc=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_texture:new C.aH(w,t.u_texture),u_ele_delta:new C.aI(w,t.u_ele_delta),u_fog_matrix:new C.aJ(w,t.u_fog_matrix),u_fog_color:new C.aL(w,t.u_fog_color),u_fog_ground_blend:new C.aI(w,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new C.aI(w,t.u_fog_ground_blend_opacity),u_horizon_color:new C.aL(w,t.u_horizon_color),u_horizon_fog_blend:new C.aI(w,t.u_horizon_fog_blend)}),vd=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_ele_delta:new C.aI(w,t.u_ele_delta)}),xd=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_texture:new C.aH(w,t.u_texture),u_terrain_coords_id:new C.aI(w,t.u_terrain_coords_id),u_ele_delta:new C.aI(w,t.u_ele_delta)}),js=(w,t,o,f,g)=>({u_matrix:w,u_texture:0,u_ele_delta:t,u_fog_matrix:o,u_fog_color:f?f.properties.get("fog-color"):C.aM.white,u_fog_ground_blend:f?f.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?f.calculateFogBlendOpacity(g):0,u_horizon_color:f?f.properties.get("horizon-color"):C.aM.white,u_horizon_fog_blend:f?f.properties.get("horizon-fog-blend"):1}),Gh=(w,t)=>({u_matrix:w,u_ele_delta:t}),cu=(w,t,o)=>({u_matrix:w,u_terrain_coords_id:t/255,u_texture:0,u_ele_delta:o});function Lu(w){const t=[];for(let o=0;o<w.length;o++){if(w[o]===null)continue;const f=w[o].split(" ");t.push(f.pop())}return t}class Go{constructor(t,o,f,g,S,z){const k=t.gl;this.program=k.createProgram();const R=Lu(o.staticAttributes),X=f?f.getBinderAttributes():[],K=R.concat(X),J=Dn.prelude.staticUniforms?Lu(Dn.prelude.staticUniforms):[],ut=o.staticUniforms?Lu(o.staticUniforms):[],mt=f?f.getBinderUniforms():[],vt=J.concat(ut).concat(mt),Tt=[];for(const ce of vt)Tt.indexOf(ce)<0&&Tt.push(ce);const Ft=f?f.defines():[];S&&Ft.push("#define OVERDRAW_INSPECTOR;"),z&&Ft.push("#define TERRAIN3D;");const Bt=Ft.concat(Dn.prelude.fragmentSource,o.fragmentSource).join(`
`),Ot=Ft.concat(Dn.prelude.vertexSource,o.vertexSource).join(`
`),Dt=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost()){this.failedToCreate=!0;return}if(k.shaderSource(Dt,Bt),k.compileShader(Dt),!k.getShaderParameter(Dt,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(Dt)}`);k.attachShader(this.program,Dt);const ie=k.createShader(k.VERTEX_SHADER);if(k.isContextLost()){this.failedToCreate=!0;return}if(k.shaderSource(ie,Ot),k.compileShader(ie),!k.getShaderParameter(ie,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(ie)}`);k.attachShader(this.program,ie),this.attributes={};const $t={};this.numAttributes=K.length;for(let ce=0;ce<this.numAttributes;ce++)K[ce]&&(k.bindAttribLocation(this.program,ce,K[ce]),this.attributes[K[ce]]=ce);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(ie),k.deleteShader(Dt);for(let ce=0;ce<Tt.length;ce++){const we=Tt[ce];if(we&&!$t[we]){const Fe=k.getUniformLocation(this.program,we);Fe&&($t[we]=Fe)}}this.fixedUniforms=g(t,$t),this.terrainUniforms=Fu(t,$t),this.binderUniforms=f?f.getUniforms(t,$t):[]}draw(t,o,f,g,S,z,k,R,X,K,J,ut,mt,vt,Tt,Ft,Bt,Ot){const Dt=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(f),t.setStencilMode(g),t.setColorMode(S),t.setCullFace(z),R){t.activeTexture.set(Dt.TEXTURE2),Dt.bindTexture(Dt.TEXTURE_2D,R.depthTexture),t.activeTexture.set(Dt.TEXTURE3),Dt.bindTexture(Dt.TEXTURE_2D,R.texture);for(const $t in this.terrainUniforms)this.terrainUniforms[$t].set(R[$t])}for(const $t in this.fixedUniforms)this.fixedUniforms[$t].set(k[$t]);Tt&&Tt.setUniforms(t,this.binderUniforms,mt,{zoom:vt});let ie=0;switch(o){case Dt.LINES:ie=2;break;case Dt.TRIANGLES:ie=3;break;case Dt.LINE_STRIP:ie=1;break}for(const $t of ut.get()){const ce=$t.vaos||($t.vaos={});(ce[X]||(ce[X]=new Fc)).bind(t,this,K,Tt?Tt.getPaintVertexBuffers():[],J,$t.vertexOffset,Ft,Bt,Ot),Dt.drawElements(o,$t.primitiveLength*ie,Dt.UNSIGNED_SHORT,$t.primitiveOffset*ie*2)}}}function Ho(w,t,o){const f=1/pi(o,1,t.transform.tileZoom),g=Math.pow(2,o.tileID.overscaledZ),S=o.tileSize*Math.pow(2,t.transform.tileZoom)/g,z=S*(o.tileID.canonical.x+o.tileID.wrap*g),k=S*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[f,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[z>>16,k>>16],u_pixel_coord_lower:[z&65535,k&65535]}}function Rc(w,t,o,f){const g=o.imageManager.getPattern(w.from.toString()),S=o.imageManager.getPattern(w.to.toString()),{width:z,height:k}=o.imageManager.getPixelSize(),R=Math.pow(2,f.tileID.overscaledZ),X=f.tileSize*Math.pow(2,o.transform.tileZoom)/R,K=X*(f.tileID.canonical.x+f.tileID.wrap*R),J=X*f.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:g.tl,u_pattern_br_a:g.br,u_pattern_tl_b:S.tl,u_pattern_br_b:S.br,u_texsize:[z,k],u_mix:t.t,u_pattern_size_a:g.displaySize,u_pattern_size_b:S.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/pi(f,1,o.transform.tileZoom),u_pixel_coord_upper:[K>>16,J>>16],u_pixel_coord_lower:[K&65535,J&65535]}}const Hh=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_lightpos:new C.aN(w,t.u_lightpos),u_lightintensity:new C.aI(w,t.u_lightintensity),u_lightcolor:new C.aN(w,t.u_lightcolor),u_vertical_gradient:new C.aI(w,t.u_vertical_gradient),u_opacity:new C.aI(w,t.u_opacity)}),Xo=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_lightpos:new C.aN(w,t.u_lightpos),u_lightintensity:new C.aI(w,t.u_lightintensity),u_lightcolor:new C.aN(w,t.u_lightcolor),u_vertical_gradient:new C.aI(w,t.u_vertical_gradient),u_height_factor:new C.aI(w,t.u_height_factor),u_image:new C.aH(w,t.u_image),u_texsize:new C.aO(w,t.u_texsize),u_pixel_coord_upper:new C.aO(w,t.u_pixel_coord_upper),u_pixel_coord_lower:new C.aO(w,t.u_pixel_coord_lower),u_scale:new C.aN(w,t.u_scale),u_fade:new C.aI(w,t.u_fade),u_opacity:new C.aI(w,t.u_opacity)}),$r=(w,t,o,f)=>{const g=t.style.light,S=g.properties.get("position"),z=[S.x,S.y,S.z],k=da();g.properties.get("anchor")==="viewport"&&Ls(k,-t.transform.angle),so(z,z,k);const R=g.properties.get("color");return{u_matrix:w,u_lightpos:z,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+o,u_opacity:f}},Ru=(w,t,o,f,g,S,z)=>C.e($r(w,t,o,f),Ho(S,t,z),{u_height_factor:-Math.pow(2,g.overscaledZ)/z.tileSize/8}),bd=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix)}),Xh=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_image:new C.aH(w,t.u_image),u_texsize:new C.aO(w,t.u_texsize),u_pixel_coord_upper:new C.aO(w,t.u_pixel_coord_upper),u_pixel_coord_lower:new C.aO(w,t.u_pixel_coord_lower),u_scale:new C.aN(w,t.u_scale),u_fade:new C.aI(w,t.u_fade)}),If=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_world:new C.aO(w,t.u_world)}),Cf=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_world:new C.aO(w,t.u_world),u_image:new C.aH(w,t.u_image),u_texsize:new C.aO(w,t.u_texsize),u_pixel_coord_upper:new C.aO(w,t.u_pixel_coord_upper),u_pixel_coord_lower:new C.aO(w,t.u_pixel_coord_lower),u_scale:new C.aN(w,t.u_scale),u_fade:new C.aI(w,t.u_fade)}),Bc=w=>({u_matrix:w}),Oc=(w,t,o,f)=>C.e(Bc(w),Ho(o,t,f)),Wo=(w,t)=>({u_matrix:w,u_world:t}),Wh=(w,t,o,f,g)=>C.e(Oc(w,t,o,f),{u_world:g}),Kh=(w,t)=>({u_camera_to_center_distance:new C.aI(w,t.u_camera_to_center_distance),u_scale_with_map:new C.aH(w,t.u_scale_with_map),u_pitch_with_map:new C.aH(w,t.u_pitch_with_map),u_extrude_scale:new C.aO(w,t.u_extrude_scale),u_device_pixel_ratio:new C.aI(w,t.u_device_pixel_ratio),u_matrix:new C.aJ(w,t.u_matrix)}),Vc=(w,t,o,f)=>{const g=w.transform;let S,z;if(f.paint.get("circle-pitch-alignment")==="map"){const k=pi(o,1,g.zoom);S=!0,z=[k,k]}else S=!1,z=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(t.posMatrix,o,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:z}},Uc=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_pixel_extrude_scale:new C.aO(w,t.u_pixel_extrude_scale)}),Es=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_inv_matrix:new C.aJ(w,t.u_inv_matrix),u_camera_to_center_distance:new C.aI(w,t.u_camera_to_center_distance),u_viewport_size:new C.aO(w,t.u_viewport_size)}),Nc=(w,t)=>({u_matrix:t,u_pixel_extrude_scale:[1/w.width,1/w.height]}),ph=(w,t,o)=>({u_matrix:w,u_inv_matrix:t,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}),qc=(w,t)=>({u_color:new C.aL(w,t.u_color),u_matrix:new C.aJ(w,t.u_matrix),u_overlay:new C.aH(w,t.u_overlay),u_overlay_scale:new C.aI(w,t.u_overlay_scale)}),Zc=(w,t,o=1)=>({u_matrix:w,u_color:t,u_overlay:0,u_overlay_scale:o}),Pf=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix)}),wr=w=>({u_matrix:w}),mh=(w,t)=>({u_extrude_scale:new C.aI(w,t.u_extrude_scale),u_intensity:new C.aI(w,t.u_intensity),u_matrix:new C.aJ(w,t.u_matrix)}),Cl=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_world:new C.aO(w,t.u_world),u_image:new C.aH(w,t.u_image),u_color_ramp:new C.aH(w,t.u_color_ramp),u_opacity:new C.aI(w,t.u_opacity)}),jc=(w,t,o,f)=>({u_matrix:w,u_extrude_scale:pi(t,1,o),u_intensity:f}),Gc=(w,t,o,f)=>{const g=C.H();C.aP(g,0,w.width,w.height,0,0,1);const S=w.context.gl;return{u_matrix:g,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:o,u_color_ramp:f,u_opacity:t.paint.get("heatmap-opacity")}},Ko=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_image:new C.aH(w,t.u_image),u_latrange:new C.aO(w,t.u_latrange),u_light:new C.aO(w,t.u_light),u_shadow:new C.aL(w,t.u_shadow),u_highlight:new C.aL(w,t.u_highlight),u_accent:new C.aL(w,t.u_accent)}),_h=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_image:new C.aH(w,t.u_image),u_dimension:new C.aO(w,t.u_dimension),u_zoom:new C.aI(w,t.u_zoom),u_unpack:new C.aK(w,t.u_unpack)}),fu=(w,t,o,f)=>{const g=o.paint.get("hillshade-shadow-color"),S=o.paint.get("hillshade-highlight-color"),z=o.paint.get("hillshade-accent-color");let k=o.paint.get("hillshade-illumination-direction")*(Math.PI/180);o.paint.get("hillshade-illumination-anchor")==="viewport"&&(k-=w.transform.angle);const R=!w.options.moving;return{u_matrix:f?f.posMatrix:w.transform.calculatePosMatrix(t.tileID.toUnwrapped(),R),u_image:0,u_latrange:gh(w,t.tileID),u_light:[o.paint.get("hillshade-exaggeration"),k],u_shadow:g,u_highlight:S,u_accent:z}},kn=(w,t)=>{const o=t.stride,f=C.H();return C.aP(f,0,C.X,-C.X,0,0,1),C.J(f,f,[0,-C.X,0]),{u_matrix:f,u_image:1,u_dimension:[o,o],u_zoom:w.overscaledZ,u_unpack:t.getUnpackVector()}};function gh(w,t){const o=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new C.Z(0,f/o).toLngLat().lat,new C.Z(0,(f+1)/o).toLngLat().lat]}const Yo=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_ratio:new C.aI(w,t.u_ratio),u_device_pixel_ratio:new C.aI(w,t.u_device_pixel_ratio),u_units_to_pixels:new C.aO(w,t.u_units_to_pixels)}),Pl=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_ratio:new C.aI(w,t.u_ratio),u_device_pixel_ratio:new C.aI(w,t.u_device_pixel_ratio),u_units_to_pixels:new C.aO(w,t.u_units_to_pixels),u_image:new C.aH(w,t.u_image),u_image_height:new C.aI(w,t.u_image_height)}),Al=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_texsize:new C.aO(w,t.u_texsize),u_ratio:new C.aI(w,t.u_ratio),u_device_pixel_ratio:new C.aI(w,t.u_device_pixel_ratio),u_image:new C.aH(w,t.u_image),u_units_to_pixels:new C.aO(w,t.u_units_to_pixels),u_scale:new C.aN(w,t.u_scale),u_fade:new C.aI(w,t.u_fade)}),Jo=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_ratio:new C.aI(w,t.u_ratio),u_device_pixel_ratio:new C.aI(w,t.u_device_pixel_ratio),u_units_to_pixels:new C.aO(w,t.u_units_to_pixels),u_patternscale_a:new C.aO(w,t.u_patternscale_a),u_patternscale_b:new C.aO(w,t.u_patternscale_b),u_sdfgamma:new C.aI(w,t.u_sdfgamma),u_image:new C.aH(w,t.u_image),u_tex_y_a:new C.aI(w,t.u_tex_y_a),u_tex_y_b:new C.aI(w,t.u_tex_y_b),u_mix:new C.aI(w,t.u_mix)}),Gs=(w,t,o,f)=>{const g=w.transform;return{u_matrix:Af(w,t,o,f),u_ratio:1/pi(t,1,g.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Qo=(w,t,o,f,g)=>C.e(Gs(w,t,o,g),{u_image:0,u_image_height:f}),Ml=(w,t,o,f,g)=>{const S=w.transform,z=Yh(t,S);return{u_matrix:Af(w,t,o,g),u_texsize:t.imageAtlasTexture.size,u_ratio:1/pi(t,1,S.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[z,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},$o=(w,t,o,f,g,S)=>{const z=w.transform,k=w.lineAtlas,R=Yh(t,z),X=o.layout.get("line-cap")==="round",K=k.getDash(f.from,X),J=k.getDash(f.to,X),ut=K.width*g.fromScale,mt=J.width*g.toScale;return C.e(Gs(w,t,o,S),{u_patternscale_a:[R/ut,-K.height/2],u_patternscale_b:[R/mt,-J.height/2],u_sdfgamma:k.width/(Math.min(ut,mt)*256*w.pixelRatio)/2,u_image:0,u_tex_y_a:K.y,u_tex_y_b:J.y,u_mix:g.t})};function Yh(w,t){return 1/pi(w,1,t.tileZoom)}function Af(w,t,o,f){return w.translatePosMatrix(f?f.posMatrix:t.tileID.posMatrix,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const wd=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_tl_parent:new C.aO(w,t.u_tl_parent),u_scale_parent:new C.aI(w,t.u_scale_parent),u_buffer_scale:new C.aI(w,t.u_buffer_scale),u_fade_t:new C.aI(w,t.u_fade_t),u_opacity:new C.aI(w,t.u_opacity),u_image0:new C.aH(w,t.u_image0),u_image1:new C.aH(w,t.u_image1),u_brightness_low:new C.aI(w,t.u_brightness_low),u_brightness_high:new C.aI(w,t.u_brightness_high),u_saturation_factor:new C.aI(w,t.u_saturation_factor),u_contrast_factor:new C.aI(w,t.u_contrast_factor),u_spin_weights:new C.aN(w,t.u_spin_weights)}),du=(w,t,o,f,g)=>({u_matrix:w,u_tl_parent:t,u_scale_parent:o,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:zf(g.paint.get("raster-saturation")),u_contrast_factor:Sd(g.paint.get("raster-contrast")),u_spin_weights:Mf(g.paint.get("raster-hue-rotate"))});function Mf(w){w*=Math.PI/180;const t=Math.sin(w),o=Math.cos(w);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}function Sd(w){return w>0?1/(1-w):1+w}function zf(w){return w>0?1-1/(1.001-w):-w}const Bu=(w,t)=>({u_is_size_zoom_constant:new C.aH(w,t.u_is_size_zoom_constant),u_is_size_feature_constant:new C.aH(w,t.u_is_size_feature_constant),u_size_t:new C.aI(w,t.u_size_t),u_size:new C.aI(w,t.u_size),u_camera_to_center_distance:new C.aI(w,t.u_camera_to_center_distance),u_pitch:new C.aI(w,t.u_pitch),u_rotate_symbol:new C.aH(w,t.u_rotate_symbol),u_aspect_ratio:new C.aI(w,t.u_aspect_ratio),u_fade_change:new C.aI(w,t.u_fade_change),u_matrix:new C.aJ(w,t.u_matrix),u_label_plane_matrix:new C.aJ(w,t.u_label_plane_matrix),u_coord_matrix:new C.aJ(w,t.u_coord_matrix),u_is_text:new C.aH(w,t.u_is_text),u_pitch_with_map:new C.aH(w,t.u_pitch_with_map),u_is_along_line:new C.aH(w,t.u_is_along_line),u_is_variable_anchor:new C.aH(w,t.u_is_variable_anchor),u_texsize:new C.aO(w,t.u_texsize),u_texture:new C.aH(w,t.u_texture),u_translation:new C.aO(w,t.u_translation),u_pitched_scale:new C.aI(w,t.u_pitched_scale)}),Df=(w,t)=>({u_is_size_zoom_constant:new C.aH(w,t.u_is_size_zoom_constant),u_is_size_feature_constant:new C.aH(w,t.u_is_size_feature_constant),u_size_t:new C.aI(w,t.u_size_t),u_size:new C.aI(w,t.u_size),u_camera_to_center_distance:new C.aI(w,t.u_camera_to_center_distance),u_pitch:new C.aI(w,t.u_pitch),u_rotate_symbol:new C.aH(w,t.u_rotate_symbol),u_aspect_ratio:new C.aI(w,t.u_aspect_ratio),u_fade_change:new C.aI(w,t.u_fade_change),u_matrix:new C.aJ(w,t.u_matrix),u_label_plane_matrix:new C.aJ(w,t.u_label_plane_matrix),u_coord_matrix:new C.aJ(w,t.u_coord_matrix),u_is_text:new C.aH(w,t.u_is_text),u_pitch_with_map:new C.aH(w,t.u_pitch_with_map),u_is_along_line:new C.aH(w,t.u_is_along_line),u_is_variable_anchor:new C.aH(w,t.u_is_variable_anchor),u_texsize:new C.aO(w,t.u_texsize),u_texture:new C.aH(w,t.u_texture),u_gamma_scale:new C.aI(w,t.u_gamma_scale),u_device_pixel_ratio:new C.aI(w,t.u_device_pixel_ratio),u_is_halo:new C.aH(w,t.u_is_halo),u_translation:new C.aO(w,t.u_translation),u_pitched_scale:new C.aI(w,t.u_pitched_scale)}),Jh=(w,t)=>({u_is_size_zoom_constant:new C.aH(w,t.u_is_size_zoom_constant),u_is_size_feature_constant:new C.aH(w,t.u_is_size_feature_constant),u_size_t:new C.aI(w,t.u_size_t),u_size:new C.aI(w,t.u_size),u_camera_to_center_distance:new C.aI(w,t.u_camera_to_center_distance),u_pitch:new C.aI(w,t.u_pitch),u_rotate_symbol:new C.aH(w,t.u_rotate_symbol),u_aspect_ratio:new C.aI(w,t.u_aspect_ratio),u_fade_change:new C.aI(w,t.u_fade_change),u_matrix:new C.aJ(w,t.u_matrix),u_label_plane_matrix:new C.aJ(w,t.u_label_plane_matrix),u_coord_matrix:new C.aJ(w,t.u_coord_matrix),u_is_text:new C.aH(w,t.u_is_text),u_pitch_with_map:new C.aH(w,t.u_pitch_with_map),u_is_along_line:new C.aH(w,t.u_is_along_line),u_is_variable_anchor:new C.aH(w,t.u_is_variable_anchor),u_texsize:new C.aO(w,t.u_texsize),u_texsize_icon:new C.aO(w,t.u_texsize_icon),u_texture:new C.aH(w,t.u_texture),u_texture_icon:new C.aH(w,t.u_texture_icon),u_gamma_scale:new C.aI(w,t.u_gamma_scale),u_device_pixel_ratio:new C.aI(w,t.u_device_pixel_ratio),u_is_halo:new C.aH(w,t.u_is_halo),u_translation:new C.aO(w,t.u_translation),u_pitched_scale:new C.aI(w,t.u_pitched_scale)}),Hc=(w,t,o,f,g,S,z,k,R,X,K,J,ut,mt)=>{const vt=z.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:vt.cameraToCenterDistance,u_pitch:vt.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:vt.width/vt.height,u_fade_change:z.options.fadeDuration?z.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:R,u_coord_matrix:X,u_is_text:+J,u_pitch_with_map:+f,u_is_along_line:g,u_is_variable_anchor:S,u_texsize:ut,u_texture:0,u_translation:K,u_pitched_scale:mt}},kf=(w,t,o,f,g,S,z,k,R,X,K,J,ut,mt,vt)=>{const Tt=z.transform;return C.e(Hc(w,t,o,f,g,S,z,k,R,X,K,J,ut,vt),{u_gamma_scale:f?Math.cos(Tt._pitch)*Tt.cameraToCenterDistance:1,u_device_pixel_ratio:z.pixelRatio,u_is_halo:1})},Td=(w,t,o,f,g,S,z,k,R,X,K,J,ut,mt)=>C.e(kf(w,t,o,f,g,S,z,k,R,X,K,!0,J,!0,mt),{u_texsize_icon:ut,u_texture_icon:1}),pu=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_opacity:new C.aI(w,t.u_opacity),u_color:new C.aL(w,t.u_color)}),Ff=(w,t)=>({u_matrix:new C.aJ(w,t.u_matrix),u_opacity:new C.aI(w,t.u_opacity),u_image:new C.aH(w,t.u_image),u_pattern_tl_a:new C.aO(w,t.u_pattern_tl_a),u_pattern_br_a:new C.aO(w,t.u_pattern_br_a),u_pattern_tl_b:new C.aO(w,t.u_pattern_tl_b),u_pattern_br_b:new C.aO(w,t.u_pattern_br_b),u_texsize:new C.aO(w,t.u_texsize),u_mix:new C.aI(w,t.u_mix),u_pattern_size_a:new C.aO(w,t.u_pattern_size_a),u_pattern_size_b:new C.aO(w,t.u_pattern_size_b),u_scale_a:new C.aI(w,t.u_scale_a),u_scale_b:new C.aI(w,t.u_scale_b),u_pixel_coord_upper:new C.aO(w,t.u_pixel_coord_upper),u_pixel_coord_lower:new C.aO(w,t.u_pixel_coord_lower),u_tile_units_to_pixels:new C.aI(w,t.u_tile_units_to_pixels)}),Lf=(w,t,o)=>({u_matrix:w,u_opacity:t,u_color:o}),Xc=(w,t,o,f,g,S)=>C.e(Rc(f,S,o,g),{u_matrix:w,u_opacity:t}),Wc=(w,t)=>({u_sky_color:new C.aL(w,t.u_sky_color),u_horizon_color:new C.aL(w,t.u_horizon_color),u_horizon:new C.aI(w,t.u_horizon),u_sky_horizon_blend:new C.aI(w,t.u_sky_horizon_blend)}),Kc=(w,t,o)=>({u_sky_color:w.properties.get("sky-color"),u_horizon_color:w.properties.get("horizon-color"),u_horizon:(t.height/2+t.getHorizon())*o,u_sky_horizon_blend:w.properties.get("sky-horizon-blend")*t.height/2*o}),Rf={fillExtrusion:Hh,fillExtrusionPattern:Xo,fill:bd,fillPattern:Xh,fillOutline:If,fillOutlinePattern:Cf,circle:Kh,collisionBox:Uc,collisionCircle:Es,debug:qc,clippingMask:Pf,heatmap:mh,heatmapTexture:Cl,hillshade:Ko,hillshadePrepare:_h,line:Yo,lineGradient:Pl,linePattern:Al,lineSDF:Jo,raster:wd,symbolIcon:Bu,symbolSDF:Df,symbolTextAndIcon:Jh,background:pu,backgroundPattern:Ff,terrain:Lc,terrainDepth:vd,terrainCoords:xd,sky:Wc};class vo{constructor(t,o,f){this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){const t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)}}const va={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zl{constructor(t,o,f,g){this.length=o.length,this.attributes=f,this.itemSize=o.bytesPerElement,this.dynamicDraw=g,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let f=0;f<this.attributes.length;f++){const g=this.attributes[f],S=o.attributes[g.name];S!==void 0&&t.enableVertexAttribArray(S)}}setVertexAttribPointers(t,o,f){for(let g=0;g<this.attributes.length;g++){const S=this.attributes[g],z=o.attributes[S.name];z!==void 0&&t.vertexAttribPointer(z,S.components,t[va[S.type]],!1,this.itemSize,S.offset+this.itemSize*(f||0))}}destroy(){const t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)}}const Ou=new WeakMap;function tl(w){var t;if(Ou.has(w))return Ou.get(w);{const o=(t=w.getParameter(w.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ou.set(w,o),o}}class Yi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yc extends Yi{getDefault(){return C.aM.transparent}set(t){const o=this.current;t.r===o.r&&t.g===o.g&&t.b===o.b&&t.a===o.a&&!this.dirty||(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class os extends Yi{getDefault(){return 1}set(t){t===this.current&&!this.dirty||(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Vu extends Yi{getDefault(){return 0}set(t){t===this.current&&!this.dirty||(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class mu extends Yi{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;t[0]===o[0]&&t[1]===o[1]&&t[2]===o[2]&&t[3]===o[3]&&!this.dirty||(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Uu extends Yi{getDefault(){return!0}set(t){t===this.current&&!this.dirty||(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Bf extends Yi{getDefault(){return 255}set(t){t===this.current&&!this.dirty||(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Jc extends Yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;t.func===o.func&&t.ref===o.ref&&t.mask===o.mask&&!this.dirty||(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class fr extends Yi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;t[0]===o[0]&&t[1]===o[1]&&t[2]===o[2]&&!this.dirty||(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Qh extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class Of extends Yi{getDefault(){return[0,1]}set(t){const o=this.current;t[0]===o[0]&&t[1]===o[1]&&!this.dirty||(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class yh extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class Dl extends Yi{getDefault(){return this.gl.LESS}set(t){t===this.current&&!this.dirty||(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class vh extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class Vf extends Yi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const o=this.current;t[0]===o[0]&&t[1]===o[1]&&!this.dirty||(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Uf extends Yi{getDefault(){return C.aM.transparent}set(t){const o=this.current;t.r===o.r&&t.g===o.g&&t.b===o.b&&t.a===o.a&&!this.dirty||(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ed extends Yi{getDefault(){return this.gl.FUNC_ADD}set(t){t===this.current&&!this.dirty||(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Qc extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class Hs extends Yi{getDefault(){return this.gl.BACK}set(t){t===this.current&&!this.dirty||(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class el extends Yi{getDefault(){return this.gl.CCW}set(t){t===this.current&&!this.dirty||(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class xa extends Yi{getDefault(){return null}set(t){t===this.current&&!this.dirty||(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class xo extends Yi{getDefault(){return this.gl.TEXTURE0}set(t){t===this.current&&!this.dirty||(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class il extends Yi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;t[0]===o[0]&&t[1]===o[1]&&t[2]===o[2]&&t[3]===o[3]&&!this.dirty||(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $h extends Yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class xh extends Yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _u extends Yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class tc extends Yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ec extends Yi{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ic extends Yi{getDefault(){return null}set(t){var o;if(t===this.current&&!this.dirty)return;const f=this.gl;tl(f)?f.bindVertexArray(t):(o=f.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class ba extends Yi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Nu extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class bh extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class rl extends Yi{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Xs extends rl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Nf extends rl{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $c extends rl{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ji{constructor(t,o,f,g,S){this.context=t,this.width=o,this.height=f;const z=t.gl,k=this.framebuffer=z.createFramebuffer();if(this.colorAttachment=new Xs(t,k),g)this.depthAttachment=S?new $c(t,k):new Nf(t,k);else if(S)throw new Error("Stencil cannot be set without depth");if(z.checkFramebufferStatus(z.FRAMEBUFFER)!==z.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,o=this.colorAttachment.get();if(o&&t.deleteTexture(o),this.depthAttachment){const f=this.depthAttachment.get();f&&t.deleteRenderbuffer(f)}t.deleteFramebuffer(this.framebuffer)}}const qu=0,qf=1,Zu=771;class Ir{constructor(t,o,f){this.blendFunction=t,this.blendColor=o,this.mask=f}}Ir.Replace=[qf,qu],Ir.disabled=new Ir(Ir.Replace,C.aM.transparent,[!1,!1,!1,!1]),Ir.unblended=new Ir(Ir.Replace,C.aM.transparent,[!0,!0,!0,!0]),Ir.alphaBlended=new Ir([qf,Zu],C.aM.transparent,[!0,!0,!0,!0]);class rc{constructor(t){var o,f;if(this.gl=t,this.clearColor=new Yc(this),this.clearDepth=new os(this),this.clearStencil=new Vu(this),this.colorMask=new mu(this),this.depthMask=new Uu(this),this.stencilMask=new Bf(this),this.stencilFunc=new Jc(this),this.stencilOp=new fr(this),this.stencilTest=new Qh(this),this.depthRange=new Of(this),this.depthTest=new yh(this),this.depthFunc=new Dl(this),this.blend=new vh(this),this.blendFunc=new Vf(this),this.blendColor=new Uf(this),this.blendEquation=new Ed(this),this.cullFace=new Qc(this),this.cullFaceSide=new Hs(this),this.frontFace=new el(this),this.program=new xa(this),this.activeTexture=new xo(this),this.viewport=new il(this),this.bindFramebuffer=new $h(this),this.bindRenderbuffer=new xh(this),this.bindTexture=new _u(this),this.bindVertexBuffer=new tc(this),this.bindElementBuffer=new ec(this),this.bindVertexArray=new ic(this),this.pixelStoreUnpack=new ba(this),this.pixelStoreUnpackPremultiplyAlpha=new Nu(this),this.pixelStoreUnpackFlipY=new bh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),tl(t)){this.HALF_FLOAT=t.HALF_FLOAT;const g=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=t.RGBA16F)!==null&&o!==void 0?o:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(f=t.RGB16F)!==null&&f!==void 0?f:g==null?void 0:g.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const g=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o){return new vo(this,t,o)}createVertexBuffer(t,o,f){return new zl(this,t,o,f)}createRenderbuffer(t,o,f){const g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,t,o,f),this.bindRenderbuffer.set(null),S}createFramebuffer(t,o,f,g){return new ji(this,t,o,f,g)}clear({color:t,depth:o,stencil:f}){const g=this.gl;let S=0;t&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),typeof o<"u"&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),typeof f<"u"&&(S|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),g.clear(S)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func===this.gl.ALWAYS&&!t.mask?this.depthTest.set(!1):(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range))}setStencilMode(t){t.test.func===this.gl.ALWAYS&&!t.mask?this.stencilTest.set(!1):(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask}))}setColorMode(t){C.aE(t.blendFunction,Ir.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return tl(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var o;return tl(this.gl)?this.gl.deleteVertexArray(t):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}const nc=519;class Ii{constructor(t,o,f){this.func=t,this.mask=o,this.range=f}}Ii.ReadOnly=!1,Ii.ReadWrite=!0,Ii.disabled=new Ii(nc,Ii.ReadOnly,[0,1]);const Id=519,ac=7680;class dr{constructor(t,o,f,g,S,z){this.test=t,this.ref=o,this.mask=f,this.fail=g,this.depthFail=S,this.pass=z}}dr.disabled=new dr({func:Id,mask:0},0,0,ac,ac,ac);const kl=1029,gu=2305;class nr{constructor(t,o,f){this.enable=t,this.mode=o,this.frontFace=f}}nr.disabled=new nr(!1,kl,gu),nr.backCCW=new nr(!0,kl,gu);let Fl;function tf(w,t,o,f,g){const S=w.context,z=S.gl,k=w.useProgram("collisionBox"),R=[];let X=0,K=0;for(let Ft=0;Ft<f.length;Ft++){const Bt=f[Ft],Dt=t.getTile(Bt).getBucket(o);if(!Dt)continue;const ie=g?Dt.textCollisionBox:Dt.iconCollisionBox,$t=Dt.collisionCircleArray;if($t.length>0){const ce=C.H();C.aQ(ce,Dt.placementInvProjMatrix,w.transform.glCoordMatrix),C.aQ(ce,ce,Dt.placementViewportMatrix),R.push({circleArray:$t,circleOffset:K,transform:Bt.posMatrix,invTransform:ce,coord:Bt}),X+=$t.length/4,K=X}ie&&k.draw(S,z.LINES,Ii.disabled,dr.disabled,w.colorModeForRenderPass(),nr.disabled,Nc(w.transform,Bt.posMatrix),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Bt),o.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,null,w.transform.zoom,null,null,ie.collisionVertexBuffer)}if(!g||!R.length)return;const J=w.useProgram("collisionCircle"),ut=new C.aR;ut.resize(X*4),ut._trim();let mt=0;for(const Ft of R)for(let Bt=0;Bt<Ft.circleArray.length/4;Bt++){const Ot=Bt*4,Dt=Ft.circleArray[Ot+0],ie=Ft.circleArray[Ot+1],$t=Ft.circleArray[Ot+2],ce=Ft.circleArray[Ot+3];ut.emplace(mt++,Dt,ie,$t,ce,0),ut.emplace(mt++,Dt,ie,$t,ce,1),ut.emplace(mt++,Dt,ie,$t,ce,2),ut.emplace(mt++,Dt,ie,$t,ce,3)}(!Fl||Fl.length<X*2)&&(Fl=ef(X));const vt=S.createIndexBuffer(Fl,!0),Tt=S.createVertexBuffer(ut,C.aS.members,!0);for(const Ft of R){const Bt=ph(Ft.transform,Ft.invTransform,w.transform);J.draw(S,z.TRIANGLES,Ii.disabled,dr.disabled,w.colorModeForRenderPass(),nr.disabled,Bt,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ft.coord),o.id,Tt,vt,C.a0.simpleSegment(0,Ft.circleOffset*2,Ft.circleArray.length,Ft.circleArray.length/2),null,w.transform.zoom,null,null,null)}Tt.destroy(),vt.destroy()}function ef(w){const t=w*2,o=new C.aT;o.resize(t),o._trim();for(let f=0;f<t;f++){const g=f*6;o.uint16[g+0]=f*4+0,o.uint16[g+1]=f*4+1,o.uint16[g+2]=f*4+2,o.uint16[g+3]=f*4+2,o.uint16[g+4]=f*4+3,o.uint16[g+5]=f*4+0}return o}const ju=C.an(new Float32Array(16));function Gu(w,t,o,f,g){if(w.renderPass!=="translucent")return;const S=dr.disabled,z=w.colorModeForRenderPass();(o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&rf(f,w,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),g),o.paint.get("icon-opacity").constantOr(1)!==0&&lc(w,t,o,f,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),S,z),o.paint.get("text-opacity").constantOr(1)!==0&&lc(w,t,o,f,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),S,z),t.map.showCollisionBoxes&&(tf(w,t,o,f,!0),tf(w,t,o,f,!1))}function Hu(w,t,o,f,g,S){const{horizontalAlign:z,verticalAlign:k}=C.au(w),R=-(z-.5)*t,X=-(k-.5)*o;return new C.P((R/g+f[0])*S,(X/g+f[1])*S)}function rf(w,t,o,f,g,S,z,k,R){const X=t.transform,K=Ns(),J=g==="map",ut=S==="map";for(const mt of w){const vt=f.getTile(mt),Tt=vt.getBucket(o);if(!Tt||!Tt.text||!Tt.text.segments.get().length)continue;const Ft=Tt.textSizeData,Bt=C.ag(Ft,X.zoom),Ot=pi(vt,1,t.transform.zoom),Dt=qt(mt.posMatrix,ut,J,t.transform,Ot),ie=o.layout.get("icon-text-fit")!=="none"&&Tt.hasIconData();if(Bt){const $t=Math.pow(2,X.zoom-vt.tileID.overscaledZ),ce=t.style.map.terrain?(Fe,Ge)=>t.style.map.terrain.getElevation(mt,Fe,Ge):null,we=K.translatePosition(X,vt,z,k);oc(Tt,J,ut,R,X,Dt,mt.posMatrix,$t,Bt,ie,K,we,mt.toUnwrapped(),ce)}}}function sc(w,t,o,f,g,S){const z=t.tileAnchorPoint.add(new C.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let k=f.mult(S);o||(k=k.rotate(-g));const R=z.add(k);return Jt(R.x,R.y,t.labelPlaneMatrix,t.getElevation).point}else if(o){const R=Ei(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(w),X=Math.atan(R.y/R.x)+(R.x<0?Math.PI:0);return w.add(f.rotate(X))}else return w.add(f)}function oc(w,t,o,f,g,S,z,k,R,X,K,J,ut,mt){const vt=w.text.placedSymbolArray,Tt=w.text.dynamicLayoutVertexArray,Ft=w.icon.dynamicLayoutVertexArray,Bt={};Tt.clear();for(let Ot=0;Ot<vt.length;Ot++){const Dt=vt.get(Ot),ie=w.allowVerticalPlacement&&!Dt.placedOrientation,$t=!Dt.hidden&&Dt.crossTileID&&!ie?f[Dt.crossTileID]:null;if(!$t)as(Dt.numGlyphs,Tt);else{const ce=new C.P(Dt.anchorX,Dt.anchorY),we={getElevation:mt,width:g.width,height:g.height,labelPlaneMatrix:S,pitchWithMap:o,projection:K,tileAnchorPoint:ce,translation:J,unwrappedTileID:ut},Fe=o?Jt(ce.x,ce.y,z,mt):Ei(ce.x,ce.y,we),Ge=se(g.cameraToCenterDistance,Fe.signedDistanceFromCamera);let Ze=C.ai(w.textSizeData,R,Dt)*Ge/C.ap;o&&(Ze*=w.tilePixelRatio/k);const{width:ei,height:Le,anchor:ui,textOffset:ti,textBoxScale:Gi}=$t,ye=Hu(ui,ei,Le,ti,Gi,Ze),Pe=K.getPitchedTextCorrection(g,ce.add(new C.P(J[0],J[1])),ut),Ui=sc(Fe.point,we,t,ye,g.angle,Pe),Wi=w.allowVerticalPlacement&&Dt.placedOrientation===C.ah.vertical?Math.PI/2:0;for(let Ni=0;Ni<Dt.numGlyphs;Ni++)C.aj(Tt,Ui,Wi);X&&Dt.associatedIconIndex>=0&&(Bt[Dt.associatedIconIndex]={shiftedAnchor:Ui,angle:Wi})}}if(X){Ft.clear();const Ot=w.icon.placedSymbolArray;for(let Dt=0;Dt<Ot.length;Dt++){const ie=Ot.get(Dt);if(ie.hidden)as(ie.numGlyphs,Ft);else{const $t=Bt[Dt];if(!$t)as(ie.numGlyphs,Ft);else for(let ce=0;ce<ie.numGlyphs;ce++)C.aj(Ft,$t.shiftedAnchor,$t.angle)}}w.icon.dynamicLayoutVertexBuffer.updateData(Ft)}w.text.dynamicLayoutVertexBuffer.updateData(Tt)}function Cd(w,t,o){return o.iconsInText&&t?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function lc(w,t,o,f,g,S,z,k,R,X,K,J){const ut=w.context,mt=ut.gl,vt=w.transform,Tt=Ns(),Ft=k==="map",Bt=R==="map",Ot=k!=="viewport"&&o.layout.get("symbol-placement")!=="point",Dt=Ft&&!Bt&&!Ot,ie=!Bt&&Ot,$t=!o.layout.get("symbol-sort-key").isConstant();let ce=!1;const we=w.depthModeForSublayer(0,Ii.ReadOnly),Fe=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ge=[],Ze=Tt.getCircleRadiusCorrection(vt);for(const ei of f){const Le=t.getTile(ei),ui=Le.getBucket(o);if(!ui)continue;const ti=g?ui.text:ui.icon;if(!ti||!ti.segments.get().length||!ti.hasVisibleVertices)continue;const Gi=ti.programConfigurations.get(o.id),ye=g||ui.sdfIcons,Pe=g?ui.textSizeData:ui.iconSizeData,Ui=Bt||vt.pitch!==0,Wi=w.useProgram(Cd(ye,g,ui),Gi),Ni=C.ag(Pe,vt.zoom),Hr=w.style.map.terrain&&w.style.map.terrain.getTerrainData(ei);let Xr,ur=[0,0],Rr,yr,ul=null,ds;if(g){if(Rr=Le.glyphAtlasTexture,yr=mt.LINEAR,Xr=Le.glyphAtlasTexture.size,ui.iconsInText){ur=Le.imageAtlasTexture.size,ul=Le.imageAtlasTexture;const ps=Pe.kind==="composite"||Pe.kind==="camera";ds=Ui||w.options.rotating||w.options.zooming||ps?mt.LINEAR:mt.NEAREST}}else{const ps=o.layout.get("icon-size").constantOr(0)!==1||ui.iconsNeedLinear;Rr=Le.imageAtlasTexture,yr=ye||w.options.rotating||w.options.zooming||ps||Ui?mt.LINEAR:mt.NEAREST,Xr=Le.imageAtlasTexture.size}const sa=pi(Le,1,w.transform.zoom),Rn=ie?ei.posMatrix:ju,Gl=qt(Rn,Bt,Ft,w.transform,sa),Js=ee(Rn,Bt,Ft,w.transform,sa),Eu=ee(ei.posMatrix,Bt,Ft,w.transform,sa),Bn=Tt.translatePosition(w.transform,Le,S,z),Qs=Fe&&ui.hasTextData(),Xf=o.layout.get("icon-text-fit")!=="none"&&Qs&&ui.hasIconData();if(Ot){const ps=w.style.map.terrain?(en,rn)=>w.style.map.terrain.getElevation(ei,en,rn):null,Xl=o.layout.get("text-rotation-alignment")==="map";Ie(ui,ei.posMatrix,w,g,Gl,Eu,Bt,X,Xl,Tt,ei.toUnwrapped(),vt.width,vt.height,Bn,ps)}const ff=ei.posMatrix,Hl=g&&Fe||Xf,$s=Ot||Hl?ju:Gl,eh=Js,Ah=ye&&o.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let oa;ye?ui.iconsInText?oa=Td(Pe.kind,Ni,Dt,Bt,Ot,Hl,w,ff,$s,eh,Bn,Xr,ur,Ze):oa=kf(Pe.kind,Ni,Dt,Bt,Ot,Hl,w,ff,$s,eh,Bn,g,Xr,!0,Ze):oa=Hc(Pe.kind,Ni,Dt,Bt,Ot,Hl,w,ff,$s,eh,Bn,g,Xr,Ze);const to={program:Wi,buffers:ti,uniformValues:oa,atlasTexture:Rr,atlasTextureIcon:ul,atlasInterpolation:yr,atlasInterpolationIcon:ds,isSDF:ye,hasHalo:Ah};if($t&&ui.canOverlap){ce=!0;const ps=ti.segments.get();for(const Xl of ps)Ge.push({segments:new C.a0([Xl]),sortKey:Xl.sortKey,state:to,terrainData:Hr})}else Ge.push({segments:ti.segments,sortKey:0,state:to,terrainData:Hr})}ce&&Ge.sort((ei,Le)=>ei.sortKey-Le.sortKey);for(const ei of Ge){const Le=ei.state;if(ut.activeTexture.set(mt.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,mt.CLAMP_TO_EDGE),Le.atlasTextureIcon&&(ut.activeTexture.set(mt.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,mt.CLAMP_TO_EDGE)),Le.isSDF){const ui=Le.uniformValues;Le.hasHalo&&(ui.u_is_halo=1,nf(Le.buffers,ei.segments,o,w,Le.program,we,K,J,ui,ei.terrainData)),ui.u_is_halo=0}nf(Le.buffers,ei.segments,o,w,Le.program,we,K,J,Le.uniformValues,ei.terrainData)}}function nf(w,t,o,f,g,S,z,k,R,X){const K=f.context,J=K.gl;g.draw(K,J.TRIANGLES,S,z,k,nr.disabled,R,X,o.id,w.layoutVertexBuffer,w.indexBuffer,t,o.paint,f.transform.zoom,w.programConfigurations.get(o.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function ls(w,t,o,f){if(w.renderPass!=="translucent")return;const g=o.paint.get("circle-opacity"),S=o.paint.get("circle-stroke-width"),z=o.paint.get("circle-stroke-opacity"),k=!o.layout.get("circle-sort-key").isConstant();if(g.constantOr(1)===0&&(S.constantOr(1)===0||z.constantOr(1)===0))return;const R=w.context,X=R.gl,K=w.depthModeForSublayer(0,Ii.ReadOnly),J=dr.disabled,ut=w.colorModeForRenderPass(),mt=[];for(let vt=0;vt<f.length;vt++){const Tt=f[vt],Ft=t.getTile(Tt),Bt=Ft.getBucket(o);if(!Bt)continue;const Ot=Bt.programConfigurations.get(o.id),Dt=w.useProgram("circle",Ot),ie=Bt.layoutVertexBuffer,$t=Bt.indexBuffer,ce=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Tt),we=Vc(w,Tt,Ft,o),Fe={programConfiguration:Ot,program:Dt,layoutVertexBuffer:ie,indexBuffer:$t,uniformValues:we,terrainData:ce};if(k){const Ge=Bt.segments.get();for(const Ze of Ge)mt.push({segments:new C.a0([Ze]),sortKey:Ze.sortKey,state:Fe})}else mt.push({segments:Bt.segments,sortKey:0,state:Fe})}k&&mt.sort((vt,Tt)=>vt.sortKey-Tt.sortKey);for(const vt of mt){const{programConfiguration:Tt,program:Ft,layoutVertexBuffer:Bt,indexBuffer:Ot,uniformValues:Dt,terrainData:ie}=vt.state,$t=vt.segments;Ft.draw(R,X.TRIANGLES,K,J,ut,nr.disabled,Dt,ie,o.id,Bt,Ot,$t,o.paint,w.transform.zoom,Tt)}}function _r(w,t,o,f){if(o.paint.get("heatmap-opacity")===0)return;const g=w.context;if(w.style.map.terrain){for(const S of f){const z=t.getTile(S);t.hasRenderableParent(S)||(w.renderPass==="offscreen"?us(w,z,o,S):w.renderPass==="translucent"&&Xi(w,o,S))}g.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?Ws(w,t,o,f):w.renderPass==="translucent"&&yu(w,o)}function Ws(w,t,o,f){const g=w.context,S=g.gl,z=dr.disabled,k=new Ir([S.ONE,S.ONE],C.aM.transparent,[!0,!0,!0,!0]);ar(g,w,o),g.clear({color:C.aM.transparent});for(let R=0;R<f.length;R++){const X=f[R];if(t.hasRenderableParent(X))continue;const K=t.getTile(X),J=K.getBucket(o);if(!J)continue;const ut=J.programConfigurations.get(o.id),mt=w.useProgram("heatmap",ut),{zoom:vt}=w.transform;mt.draw(g,S.TRIANGLES,Ii.disabled,z,k,nr.disabled,jc(X.posMatrix,K,vt,o.paint.get("heatmap-intensity")),null,o.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,o.paint,w.transform.zoom,ut)}g.viewport.set([0,0,w.width,w.height])}function yu(w,t){const o=w.context,f=o.gl;o.setColorMode(w.colorModeForRenderPass());const g=t.heatmapFbos.get(C.aU);if(!g)return;o.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,g.colorAttachment.get()),o.activeTexture.set(f.TEXTURE1),Ll(o,t).bind(f.LINEAR,f.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(o,f.TRIANGLES,Ii.disabled,dr.disabled,w.colorModeForRenderPass(),nr.disabled,Gc(w,t,0,1),null,t.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,t.paint,w.transform.zoom)}function us(w,t,o,f){const g=w.context,S=g.gl,z=dr.disabled,k=new Ir([S.ONE,S.ONE],C.aM.transparent,[!0,!0,!0,!0]),R=t.getBucket(o);if(!R)return;const X=f.key;let K=o.heatmapFbos.get(X);K||(K=uc(g,t.tileSize,t.tileSize),o.heatmapFbos.set(X,K)),g.bindFramebuffer.set(K.framebuffer),g.viewport.set([0,0,t.tileSize,t.tileSize]),g.clear({color:C.aM.transparent});const J=R.programConfigurations.get(o.id),ut=w.useProgram("heatmap",J),mt=w.style.map.terrain.getTerrainData(f);ut.draw(g,S.TRIANGLES,Ii.disabled,z,k,nr.disabled,jc(f.posMatrix,t,w.transform.zoom,o.paint.get("heatmap-intensity")),mt,o.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,o.paint,w.transform.zoom,J)}function Xi(w,t,o){const f=w.context,g=f.gl;f.setColorMode(w.colorModeForRenderPass());const S=Ll(f,t),z=o.key,k=t.heatmapFbos.get(z);k&&(f.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,k.colorAttachment.get()),f.activeTexture.set(g.TEXTURE1),S.bind(g.LINEAR,g.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(f,g.TRIANGLES,Ii.disabled,dr.disabled,w.colorModeForRenderPass(),nr.disabled,Gc(w,t,0,1),null,t.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments,t.paint,w.transform.zoom),k.destroy(),t.heatmapFbos.delete(z))}function ar(w,t,o){const f=w.gl;w.activeTexture.set(f.TEXTURE1),w.viewport.set([0,0,t.width/4,t.height/4]);let g=o.heatmapFbos.get(C.aU);g?(f.bindTexture(f.TEXTURE_2D,g.colorAttachment.get()),w.bindFramebuffer.set(g.framebuffer)):(g=uc(w,t.width/4,t.height/4),o.heatmapFbos.set(C.aU,g))}function uc(w,t,o){var f,g;const S=w.gl,z=S.createTexture();S.bindTexture(S.TEXTURE_2D,z),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);const k=(f=w.HALF_FLOAT)!==null&&f!==void 0?f:S.UNSIGNED_BYTE,R=(g=w.RGBA16F)!==null&&g!==void 0?g:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,R,t,o,0,S.RGBA,k,null);const X=w.createFramebuffer(t,o,!1,!1);return X.colorAttachment.set(z),X}function Ll(w,t){return t.colorRampTexture||(t.colorRampTexture=new Qi(w,t.colorRamp,w.gl.RGBA)),t.colorRampTexture}function wh(w,t,o,f){if(w.renderPass!=="translucent")return;const g=o.paint.get("line-opacity"),S=o.paint.get("line-width");if(g.constantOr(1)===0||S.constantOr(1)===0)return;const z=w.depthModeForSublayer(0,Ii.ReadOnly),k=w.colorModeForRenderPass(),R=o.paint.get("line-dasharray"),X=o.paint.get("line-pattern"),K=X.constantOr(1),J=o.paint.get("line-gradient"),ut=o.getCrossfadeParameters(),mt=K?"linePattern":R?"lineSDF":J?"lineGradient":"line",vt=w.context,Tt=vt.gl;let Ft=!0;for(const Bt of f){const Ot=t.getTile(Bt);if(K&&!Ot.patternsLoaded())continue;const Dt=Ot.getBucket(o);if(!Dt)continue;const ie=Dt.programConfigurations.get(o.id),$t=w.context.program.get(),ce=w.useProgram(mt,ie),we=Ft||ce.program!==$t,Fe=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Bt),Ge=X.constantOr(null);if(Ge&&Ot.imageAtlas){const Le=Ot.imageAtlas,ui=Le.patternPositions[Ge.to.toString()],ti=Le.patternPositions[Ge.from.toString()];ui&&ti&&ie.setConstantPatternPositions(ui,ti)}const Ze=Fe?Bt:null,ei=K?Ml(w,Ot,o,ut,Ze):R?$o(w,Ot,o,R,ut,Ze):J?Qo(w,Ot,o,Dt.lineClipsArray.length,Ze):Gs(w,Ot,o,Ze);if(K)vt.activeTexture.set(Tt.TEXTURE0),Ot.imageAtlasTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE),ie.updatePaintBuffers(ut);else if(R&&(we||w.lineAtlas.dirty))vt.activeTexture.set(Tt.TEXTURE0),w.lineAtlas.bind(vt);else if(J){const Le=Dt.gradients[o.id];let ui=Le.texture;if(o.gradientVersion!==Le.version){let ti=256;if(o.stepInterpolant){const Gi=t.getSource().maxzoom,ye=Bt.canonical.z===Gi?Math.ceil(1<<w.transform.maxZoom-Bt.canonical.z):1,Wi=Dt.maxLineLength/C.X*1024*ye;ti=C.ac(C.aV(Wi),256,vt.maxTextureSize)}Le.gradient=C.aW({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:ti,image:Le.gradient||void 0,clips:Dt.lineClipsArray}),Le.texture?Le.texture.update(Le.gradient):Le.texture=new Qi(vt,Le.gradient,Tt.RGBA),Le.version=o.gradientVersion,ui=Le.texture}vt.activeTexture.set(Tt.TEXTURE0),ui.bind(o.stepInterpolant?Tt.NEAREST:Tt.LINEAR,Tt.CLAMP_TO_EDGE)}ce.draw(vt,Tt.TRIANGLES,z,w.stencilModeForClipping(Bt),k,nr.disabled,ei,Fe,o.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,o.paint,w.transform.zoom,ie,Dt.layoutVertexBuffer2),Ft=!1}}function vu(w,t,o,f,g){if(!o||!f||!f.imageAtlas)return;const S=f.imageAtlas.patternPositions;let z=S[o.to.toString()],k=S[o.from.toString()];if(!z&&k&&(z=k),!k&&z&&(k=z),!z||!k){const R=g.getPaintProperty(t);z=S[R],k=S[R]}z&&k&&w.setConstantPatternPositions(z,k)}function nl(w,t,o,f){const g=o.paint.get("fill-color"),S=o.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const z=w.colorModeForRenderPass(),k=o.paint.get("fill-pattern"),R=w.opaquePassEnabledForLayer()&&!k.constantOr(1)&&g.constantOr(C.aM.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===R){const X=w.depthModeForSublayer(1,w.renderPass==="opaque"?Ii.ReadWrite:Ii.ReadOnly);sr(w,t,o,f,X,z,!1)}if(w.renderPass==="translucent"&&o.paint.get("fill-antialias")){const X=w.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,Ii.ReadOnly);sr(w,t,o,f,X,z,!0)}}function sr(w,t,o,f,g,S,z){const k=w.context.gl,R="fill-pattern",X=o.paint.get(R),K=X&&X.constantOr(1),J=o.getCrossfadeParameters();let ut,mt,vt,Tt,Ft;z?(mt=K&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ut=k.LINES):(mt=K?"fillPattern":"fill",ut=k.TRIANGLES);const Bt=X.constantOr(null);for(const Ot of f){const Dt=t.getTile(Ot);if(K&&!Dt.patternsLoaded())continue;const ie=Dt.getBucket(o);if(!ie)continue;const $t=ie.programConfigurations.get(o.id),ce=w.useProgram(mt,$t),we=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ot);K&&(w.context.activeTexture.set(k.TEXTURE0),Dt.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),$t.updatePaintBuffers(J)),vu($t,R,Bt,Dt,o);const Fe=we?Ot:null,Ge=Fe?Fe.posMatrix:Ot.posMatrix,Ze=w.translatePosMatrix(Ge,Dt,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(!z)Tt=ie.indexBuffer,Ft=ie.segments,vt=K?Oc(Ze,w,J,Dt):Bc(Ze);else{Tt=ie.indexBuffer2,Ft=ie.segments2;const ei=[k.drawingBufferWidth,k.drawingBufferHeight];vt=mt==="fillOutlinePattern"&&K?Wh(Ze,w,J,Dt,ei):Wo(Ze,ei)}ce.draw(w.context,ut,g,w.stencilModeForClipping(Ot),S,nr.disabled,vt,we,o.id,ie.layoutVertexBuffer,Tt,Ft,o.paint,w.transform.zoom,$t)}}function Rl(w,t,o,f){const g=o.paint.get("fill-extrusion-opacity");if(g!==0&&w.renderPass==="translucent"){const S=new Ii(w.context.gl.LEQUAL,Ii.ReadWrite,w.depthRangeFor3D);if(g===1&&!o.paint.get("fill-extrusion-pattern").constantOr(1)){const z=w.colorModeForRenderPass();vn(w,t,o,f,S,dr.disabled,z)}else vn(w,t,o,f,S,dr.disabled,Ir.disabled),vn(w,t,o,f,S,w.stencilModeFor3D(),w.colorModeForRenderPass())}}function vn(w,t,o,f,g,S,z){const k=w.context,R=k.gl,X="fill-extrusion-pattern",K=o.paint.get(X),J=K.constantOr(1),ut=o.getCrossfadeParameters(),mt=o.paint.get("fill-extrusion-opacity"),vt=K.constantOr(null);for(const Tt of f){const Ft=t.getTile(Tt),Bt=Ft.getBucket(o);if(!Bt)continue;const Ot=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Tt),Dt=Bt.programConfigurations.get(o.id),ie=w.useProgram(J?"fillExtrusionPattern":"fillExtrusion",Dt);J&&(w.context.activeTexture.set(R.TEXTURE0),Ft.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Dt.updatePaintBuffers(ut)),vu(Dt,X,vt,Ft,o);const $t=w.translatePosMatrix(Tt.posMatrix,Ft,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ce=o.paint.get("fill-extrusion-vertical-gradient"),we=J?Ru($t,w,ce,mt,Tt,ut,Ft):$r($t,w,ce,mt);ie.draw(k,k.gl.TRIANGLES,g,S,z,nr.backCCW,we,Ot,o.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,o.paint,w.transform.zoom,Dt,w.style.map.terrain&&Bt.centroidVertexBuffer)}}function bo(w,t,o,f){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const g=w.context,S=w.depthModeForSublayer(0,Ii.ReadOnly),z=w.colorModeForRenderPass(),[k,R]=w.renderPass==="translucent"?w.stencilConfigForOverlap(f):[{},f];for(const X of R){const K=t.getTile(X);typeof K.needsHillshadePrepare<"u"&&K.needsHillshadePrepare&&w.renderPass==="offscreen"?wa(w,K,o,S,dr.disabled,z):w.renderPass==="translucent"&&Ne(w,X,K,o,S,k[X.overscaledZ],z)}g.viewport.set([0,0,w.width,w.height])}function Ne(w,t,o,f,g,S,z){const k=w.context,R=k.gl,X=o.fbo;if(!X)return;const K=w.useProgram("hillshade"),J=w.style.map.terrain&&w.style.map.terrain.getTerrainData(t);k.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,X.colorAttachment.get());const ut=J?t:null;K.draw(k,R.TRIANGLES,g,S,z,nr.disabled,fu(w,o,f,ut),J,f.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function wa(w,t,o,f,g,S){const z=w.context,k=z.gl,R=t.dem;if(R&&R.data){const X=R.dim,K=R.stride,J=R.getPixels();if(z.activeTexture.set(k.TEXTURE1),z.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||w.getTileTexture(K),t.demTexture){const mt=t.demTexture;mt.update(J,{premultiply:!1}),mt.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else t.demTexture=new Qi(z,J,k.RGBA,{premultiply:!1}),t.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);z.activeTexture.set(k.TEXTURE0);let ut=t.fbo;if(!ut){const mt=new Qi(z,{width:X,height:X,data:null},k.RGBA);mt.bind(k.LINEAR,k.CLAMP_TO_EDGE),ut=t.fbo=z.createFramebuffer(X,X,!0,!1),ut.colorAttachment.set(mt.texture)}z.bindFramebuffer.set(ut.framebuffer),z.viewport.set([0,0,X,X]),w.useProgram("hillshadePrepare").draw(z,k.TRIANGLES,f,g,S,nr.disabled,kn(t.tileID,R),null,o.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function wo(w,t,o,f){if(w.renderPass!=="translucent"||o.paint.get("raster-opacity")===0||!f.length)return;const g=w.context,S=g.gl,z=t.getSource(),k=w.useProgram("raster"),R=w.colorModeForRenderPass(),[X,K]=z instanceof vs?[{},f]:w.stencilConfigForOverlap(f),J=K[K.length-1].overscaledZ,ut=!w.options.moving;for(const mt of K){const vt=w.depthModeForSublayer(mt.overscaledZ-J,o.paint.get("raster-opacity")===1?Ii.ReadWrite:Ii.ReadOnly,S.LESS),Tt=t.getTile(mt);Tt.registerFadeDuration(o.paint.get("raster-fade-duration"));const Ft=t.findLoadedParent(mt,0),Bt=t.findLoadedSibling(mt),Dt=Zf(Tt,Ft||Bt||null,t,o,w.transform,w.style.map.terrain);let ie,$t;const ce=o.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;g.activeTexture.set(S.TEXTURE0),Tt.texture.bind(ce,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(S.TEXTURE1),Ft?(Ft.texture.bind(ce,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),ie=Math.pow(2,Ft.tileID.overscaledZ-Tt.tileID.overscaledZ),$t=[Tt.tileID.canonical.x*ie%1,Tt.tileID.canonical.y*ie%1]):Tt.texture.bind(ce,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),Tt.texture.useMipmap&&g.extTextureFilterAnisotropic&&w.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax);const we=w.style.map.terrain&&w.style.map.terrain.getTerrainData(mt),Fe=we?mt:null,Ge=Fe?Fe.posMatrix:w.transform.calculatePosMatrix(mt.toUnwrapped(),ut),Ze=du(Ge,$t||[0,0],ie||1,Dt,o);z instanceof vs?k.draw(g,S.TRIANGLES,vt,dr.disabled,R,nr.disabled,Ze,we,o.id,z.boundsBuffer,w.quadTriangleIndexBuffer,z.boundsSegments):k.draw(g,S.TRIANGLES,vt,X[mt.overscaledZ],R,nr.disabled,Ze,we,o.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}}function Zf(w,t,o,f,g,S){const z=f.paint.get("raster-fade-duration");if(!S&&z>0){const k=me.now(),R=(k-w.timeAdded)/z,X=t?(k-t.timeAdded)/z:-1,K=o.getSource(),J=g.coveringZoomLevel({tileSize:K.tileSize,roundZoom:K.roundZoom}),ut=!t||Math.abs(t.tileID.overscaledZ-J)>Math.abs(w.tileID.overscaledZ-J),mt=ut&&w.refreshedUponExpiration?1:C.ac(ut?R:1-X,0,1);return w.refreshedUponExpiration&&R>=1&&(w.refreshedUponExpiration=!1),t?{opacity:1,mix:1-mt}:{opacity:mt,mix:0}}else return{opacity:1,mix:0}}function Zr(w,t,o,f){const g=o.paint.get("background-color"),S=o.paint.get("background-opacity");if(S===0)return;const z=w.context,k=z.gl,R=w.transform,X=R.tileSize,K=o.paint.get("background-pattern");if(w.isPatternMissing(K))return;const J=!K&&g.a===1&&S===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==J)return;const ut=dr.disabled,mt=w.depthModeForSublayer(0,J==="opaque"?Ii.ReadWrite:Ii.ReadOnly),vt=w.colorModeForRenderPass(),Tt=w.useProgram(K?"backgroundPattern":"background"),Ft=f||R.coveringTiles({tileSize:X,terrain:w.style.map.terrain});K&&(z.activeTexture.set(k.TEXTURE0),w.imageManager.bind(w.context));const Bt=o.getCrossfadeParameters();for(const Ot of Ft){const Dt=f?Ot.posMatrix:w.transform.calculatePosMatrix(Ot.toUnwrapped()),ie=K?Xc(Dt,S,w,K,{tileID:Ot,tileSize:X},Bt):Lf(Dt,S,g),$t=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ot);Tt.draw(z,k.TRIANGLES,mt,ut,vt,nr.disabled,ie,$t,o.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}}const Fn=new C.aM(1,0,0,1),Sa=new C.aM(0,1,0,1),ke=new C.aM(0,0,1,1),hc=new C.aM(1,0,1,1),af=new C.aM(0,1,1,1);function jf(w){const t=w.transform.padding,o=3;Ha(w,w.transform.height-(t.top||0),o,Fn),Ha(w,t.bottom||0,o,Sa),Bl(w,t.left||0,o,ke),Bl(w,w.transform.width-(t.right||0),o,hc);const f=w.transform.centerPoint;sf(w,f.x,w.transform.height-f.y,af)}function sf(w,t,o,f){Ta(w,t-2/2,o-20/2,2,20,f),Ta(w,t-20/2,o-2/2,20,2,f)}function Ha(w,t,o,f){Ta(w,0,t+o/2,w.transform.width,o,f)}function Bl(w,t,o,f){Ta(w,t-o/2,0,o,w.transform.height,f)}function Ta(w,t,o,f,g,S){const z=w.context,k=z.gl;k.enable(k.SCISSOR_TEST),k.scissor(t*w.pixelRatio,o*w.pixelRatio,f*w.pixelRatio,g*w.pixelRatio),z.clear({color:S}),k.disable(k.SCISSOR_TEST)}function Sh(w,t,o){for(let f=0;f<o.length;f++)cc(w,t,o[f])}function cc(w,t,o){const f=w.context,g=f.gl,S=o.posMatrix,z=w.useProgram("debug"),k=Ii.disabled,R=dr.disabled,X=w.colorModeForRenderPass(),K="$debug",J=w.style.map.terrain&&w.style.map.terrain.getTerrainData(o);f.activeTexture.set(g.TEXTURE0);const ut=t.getTileByID(o.key).latestRawTileData,mt=ut&&ut.byteLength||0,vt=Math.floor(mt/1024),Tt=t.getTile(o).tileSize,Ft=512/Math.min(Tt,512)*(o.overscaledZ/w.transform.zoom)*.5;let Bt=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Bt+=` => ${o.overscaledZ}`);const Ot=`${Bt} ${vt}kB`;fc(w,Ot),z.draw(f,g.TRIANGLES,k,R,Ir.alphaBlended,nr.disabled,Zc(S,C.aM.transparent,Ft),null,K,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),z.draw(f,g.LINE_STRIP,k,R,X,nr.disabled,Zc(S,C.aM.red),J,K,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function fc(w,t){w.initDebugOverlayCanvas();const o=w.debugOverlayCanvas,f=w.context.gl,g=w.debugOverlayCanvas.getContext("2d");g.clearRect(0,0,o.width,o.height),g.shadowColor="white",g.shadowBlur=2,g.lineWidth=1.5,g.strokeStyle="white",g.textBaseline="top",g.font="bold 36px Open Sans, sans-serif",g.fillText(t,5,5),g.strokeText(t,5,5),w.debugOverlayTexture.update(o),w.debugOverlayTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}function Gf(w,t){let o=null;const g=Object.values(w._layers).flatMap(R=>R.source&&!R.isHidden(t)?[w.sourceCaches[R.source]]:[]),S=g.filter(R=>R.getSource().type==="vector"),z=g.filter(R=>R.getSource().type!=="vector"),k=R=>{(!o||o.getSource().maxzoom<R.getSource().maxzoom)&&(o=R)};return S.forEach(R=>k(R)),o||z.forEach(R=>k(R)),o}function Xa(w,t,o){const f=w.context,g=o.implementation;if(w.renderPass==="offscreen"){const S=g.prerender;S&&(w.setCustomLayerDefaults(),f.setColorMode(w.colorModeForRenderPass()),S.call(g,f.gl,w.transform.customLayerMatrix()),f.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),f.setColorMode(w.colorModeForRenderPass()),f.setStencilMode(dr.disabled);const S=g.renderingMode==="3d"?new Ii(w.context.gl.LEQUAL,Ii.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,Ii.ReadOnly);f.setDepthMode(S),g.render(f.gl,w.transform.customLayerMatrix(),{farZ:w.transform.farZ,nearZ:w.transform.nearZ,fov:w.transform._fov,modelViewProjectionMatrix:w.transform.modelViewProjectionMatrix,projectionMatrix:w.transform.projectionMatrix}),f.setDirty(),w.setBaseState(),f.bindFramebuffer.set(null)}}function Ks(w,t){const o=w.context,f=o.gl,g=Ir.unblended,S=new Ii(f.LEQUAL,Ii.ReadWrite,[0,1]),z=t.getTerrainMesh(),k=t.sourceCache.getRenderableTiles(),R=w.useProgram("terrainDepth");o.bindFramebuffer.set(t.getFramebuffer("depth").framebuffer),o.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),o.clear({color:C.aM.transparent,depth:1});for(const X of k){const K=t.getTerrainData(X.tileID),J=w.transform.calculatePosMatrix(X.tileID.toUnwrapped()),ut=Gh(J,t.getMeshFrameDelta(w.transform.zoom));R.draw(o,f.TRIANGLES,S,dr.disabled,g,nr.backCCW,ut,K,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}o.bindFramebuffer.set(null),o.viewport.set([0,0,w.width,w.height])}function dc(w,t){const o=w.context,f=o.gl,g=Ir.unblended,S=new Ii(f.LEQUAL,Ii.ReadWrite,[0,1]),z=t.getTerrainMesh(),k=t.getCoordsTexture(),R=t.sourceCache.getRenderableTiles(),X=w.useProgram("terrainCoords");o.bindFramebuffer.set(t.getFramebuffer("coords").framebuffer),o.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),o.clear({color:C.aM.transparent,depth:1}),t.coordsIndex=[];for(const K of R){const J=t.getTerrainData(K.tileID);o.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,k.texture);const ut=w.transform.calculatePosMatrix(K.tileID.toUnwrapped()),mt=cu(ut,255-t.coordsIndex.length,t.getMeshFrameDelta(w.transform.zoom));X.draw(o,f.TRIANGLES,S,dr.disabled,g,nr.backCCW,mt,J,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),t.coordsIndex.push(K.tileID.key)}o.bindFramebuffer.set(null),o.viewport.set([0,0,w.width,w.height])}function ia(w,t,o){const f=w.context,g=f.gl,S=w.colorModeForRenderPass(),z=new Ii(g.LEQUAL,Ii.ReadWrite,w.depthRangeFor3D),k=w.useProgram("terrain"),R=t.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,w.width,w.height]);for(const X of o){const K=w.renderToTexture.getTexture(X),J=t.getTerrainData(X.tileID);f.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,K.texture);const ut=w.transform.calculatePosMatrix(X.tileID.toUnwrapped()),mt=t.getMeshFrameDelta(w.transform.zoom),vt=w.transform.calculateFogMatrix(X.tileID.toUnwrapped()),Tt=js(ut,mt,vt,w.style.sky,w.transform.pitch);k.draw(f,g.TRIANGLES,z,dr.disabled,S,nr.backCCW,Tt,J,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}}class xn{constructor(t,o,f){this.vertexBuffer=t,this.indexBuffer=o,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}function ra(w,t){const o=w.context,f=o.gl,g=Kc(t,w.style.map.transform,w.pixelRatio),S=new Ii(f.LEQUAL,Ii.ReadWrite,[0,1]),z=dr.disabled,k=w.colorModeForRenderPass(),R=w.useProgram("sky");if(!t.mesh){const X=new C.aX;X.emplaceBack(-1,-1),X.emplaceBack(1,-1),X.emplaceBack(1,1),X.emplaceBack(-1,1);const K=new C.aY;K.emplaceBack(0,1,2),K.emplaceBack(0,2,3),t.mesh=new xn(o.createVertexBuffer(X,qs.members),o.createIndexBuffer(K),C.a0.simpleSegment(0,0,X.length,K.length))}R.draw(o,f.TRIANGLES,S,z,k,nr.disabled,g,void 0,"sky",t.mesh.vertexBuffer,t.mesh.indexBuffer,t.mesh.segments)}class Xu{constructor(t,o){this.context=new rc(t),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:C.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=nt.maxUnderzooming+nt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ue}resize(t,o,f){if(this.width=Math.floor(t*f),this.height=Math.floor(o*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const t=this.context,o=new C.aX;o.emplaceBack(0,0),o.emplaceBack(C.X,0),o.emplaceBack(0,C.X),o.emplaceBack(C.X,C.X),this.tileExtentBuffer=t.createVertexBuffer(o,qs.members),this.tileExtentSegments=C.a0.simpleSegment(0,0,4,2);const f=new C.aX;f.emplaceBack(0,0),f.emplaceBack(C.X,0),f.emplaceBack(0,C.X),f.emplaceBack(C.X,C.X),this.debugBuffer=t.createVertexBuffer(f,qs.members),this.debugSegments=C.a0.simpleSegment(0,0,4,5);const g=new C.$;g.emplaceBack(0,0,0,0),g.emplaceBack(C.X,0,C.X,0),g.emplaceBack(0,C.X,0,C.X),g.emplaceBack(C.X,C.X,C.X,C.X),this.rasterBoundsBuffer=t.createVertexBuffer(g,Nn.members),this.rasterBoundsSegments=C.a0.simpleSegment(0,0,4,2);const S=new C.aX;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(S,qs.members),this.viewportSegments=C.a0.simpleSegment(0,0,4,2);const z=new C.aZ;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(z);const k=new C.aY;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(k);const R=this.context.gl;this.stencilClearMode=new dr({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)}clearStencil(){const t=this.context,o=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=C.H();C.aP(f,0,this.width,this.height,0,0,1),C.K(f,f,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,o.TRIANGLES,Ii.disabled,this.stencilClearMode,Ir.disabled,nr.disabled,wr(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,o){if(this.currentStencilSource===t.source||!t.isTileClipped()||!o||!o.length)return;this.currentStencilSource=t.source;const f=this.context,g=f.gl;this.nextStencilID+o.length>256&&this.clearStencil(),f.setColorMode(Ir.disabled),f.setDepthMode(Ii.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const z of o){const k=this._tileClippingMaskIDs[z.key]=this.nextStencilID++,R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z);S.draw(f,g.TRIANGLES,Ii.disabled,new dr({func:g.ALWAYS,mask:0},k,255,g.KEEP,g.KEEP,g.REPLACE),Ir.disabled,nr.disabled,wr(z.posMatrix),R,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new dr({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){const o=this.context.gl;return new dr({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,f=t.sort((z,k)=>k.overscaledZ-z.overscaledZ),g=f[f.length-1].overscaledZ,S=f[0].overscaledZ-g+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const z={};for(let k=0;k<S;k++)z[k+g]=new dr({func:o.GEQUAL,mask:255},k+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=S,[z,f]}return[{[g]:dr.disabled},f]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ir([t.CONSTANT_COLOR,t.ONE],new C.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ir.unblended:Ir.alphaBlended}depthModeForSublayer(t,o,f){if(!this.opaquePassEnabledForLayer())return Ii.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ii(f||this.context.gl.LEQUAL,o,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,o){this.style=t,this.options=o,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(me.now()),this.imageManager.beginFrame();const f=this.style._order,g=this.style.sourceCaches,S={},z={},k={};for(const R in g){const X=g[R];X.used&&X.prepare(this.context),S[R]=X.getVisibleCoordinates(),z[R]=S[R].slice().reverse(),k[R]=X.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<f.length;R++){const X=f[R];if(this.style._layers[X].is3D()){this.opaquePassCutoff=R;break}}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const R of f){const X=this.style._layers[R];if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const K=z[X.source];X.type!=="custom"&&!K.length||this.renderLayer(this,g[X.source],X,K)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?C.aM.black:C.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&ra(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[f[this.currentLayer]],X=g[R.source],K=S[R.source];this._renderTileClippingMasks(R,K),this.renderLayer(this,X,R,K)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const R=this.style._layers[f[this.currentLayer]],X=g[R.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(R))continue;const K=(R.type==="symbol"?k:z)[R.source];this._renderTileClippingMasks(R,S[R.source]),this.renderLayer(this,X,R,K)}if(this.options.showTileBoundaries){const R=Gf(this.style,this.transform.zoom);R&&Sh(this,R,R.getVisibleCoordinates())}this.options.showPadding&&jf(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix;let g=this.terrainFacilitator.dirty;g||(g=t?!C.a_(o,f):!C.a$(o,f)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(C.b0(o,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,Ks(this,this.style.map.terrain),dc(this,this.style.map.terrain))}renderLayer(t,o,f,g){if(!f.isHidden(this.transform.zoom)&&!(f.type!=="background"&&f.type!=="custom"&&!(g||[]).length))switch(this.id=f.id,f.type){case"symbol":Gu(t,o,f,g,this.style.placement.variableOffsets);break;case"circle":ls(t,o,f,g);break;case"heatmap":_r(t,o,f,g);break;case"line":wh(t,o,f,g);break;case"fill":nl(t,o,f,g);break;case"fill-extrusion":Rl(t,o,f,g);break;case"hillshade":bo(t,o,f,g);break;case"raster":wo(t,o,f,g);break;case"background":Zr(t,o,f,g);break;case"custom":Xa(t,o,f);break}}translatePosMatrix(t,o,f,g,S){if(!f[0]&&!f[1])return t;const z=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(z){const X=Math.sin(z),K=Math.cos(z);f=[f[0]*K-f[1]*X,f[0]*X+f[1]*K]}const k=[S?f[0]:pi(o,f[0],this.transform.zoom),S?f[1]:pi(o,f[1],this.transform.zoom),0],R=new Float32Array(16);return C.J(R,t,k),R}saveTileTexture(t){const o=this._tileTextures[t.size[0]];o?o.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const o=this.imageManager.getPattern(t.from.toString()),f=this.imageManager.getPattern(t.to.toString());return!o||!f}useProgram(t,o){this.cache=this.cache||{};const f=t+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new Go(this.context,Dn[t],o,Rf[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){if(this.debugOverlayCanvas==null){this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512;const t=this.context.gl;this.debugOverlayTexture=new Qi(this.context,this.debugOverlayCanvas,t.RGBA)}}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:o}=this.context.gl;return this.width!==t||this.height!==o}}class Wu{constructor(t,o){this.points=t,this.planes=o}static fromInvProjectionMatrix(t,o,f){const g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]],S=Math.pow(2,f),z=g.map(X=>{X=C.af([],X,t);const K=1/X[3]/o*S;return C.b1(X,X,[K,K,1/X[3],K])}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(X=>{const K=ko([],z[X[0]],z[X[1]]),J=ko([],z[X[2]],z[X[1]]),ut=La([],qr([],K,J)),mt=-Ra(ut,z[X[1]]);return ut.concat(mt)});return new Wu(z,R)}}class So{constructor(t,o){this.min=t,this.max=o,this.center=Do([],Rs([],this.min,this.max),.5)}quadrant(t){const o=[t%2===0,t<2],f=gs(this.min),g=gs(this.max);for(let S=0;S<o.length;S++)f[S]=o[S]?this.min[S]:this.center[S],g[S]=o[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new So(f,g)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let g=0;g<t.planes.length;g++){const S=t.planes[g];let z=0;for(let k=0;k<o.length;k++)C.b2(S,o[k])>=0&&z++;if(z===0)return 0;z!==o.length&&(f=!1)}if(f)return 2;for(let g=0;g<3;g++){let S=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(let k=0;k<t.points.length;k++){const R=t.points[k][g]-this.min[g];S=Math.min(S,R),z=Math.max(z,R)}if(z<0||S>this.max[g]-this.min[g])return 0}return 1}}class Th{constructor(t=0,o=0,f=0,g=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=f,this.right=g}interpolate(t,o,f){return o.top!=null&&t.top!=null&&(this.top=C.y.number(t.top,o.top,f)),o.bottom!=null&&t.bottom!=null&&(this.bottom=C.y.number(t.bottom,o.bottom,f)),o.left!=null&&t.left!=null&&(this.left=C.y.number(t.left,o.left,f)),o.right!=null&&t.right!=null&&(this.right=C.y.number(t.right,o.right,f)),this}getCenter(t,o){const f=C.ac((this.left+t-this.right)/2,0,t),g=C.ac((this.top+o-this.bottom)/2,0,o);return new C.P(f,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Th(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Is=85.051129;class Wa{constructor(t,o,f,g,S){this.tileSize=512,this._renderWorldCopies=S===void 0?!0:!!S,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=f??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new C.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Th,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new Wa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.lngRange=t.lngRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new C.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const o=-C.b3(t,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=Or(),_l(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=C.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,f){this._unmodified=!1,this._edgeInsets.interpolate(t,o,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new C.b4(0,t)];if(this._renderWorldCopies){const f=this.pointCoordinate(new C.P(0,0)),g=this.pointCoordinate(new C.P(this.width,0)),S=this.pointCoordinate(new C.P(this.width,this.height)),z=this.pointCoordinate(new C.P(0,this.height)),k=Math.floor(Math.min(f.x,g.x,S.x,z.x)),R=Math.floor(Math.max(f.x,g.x,S.x,z.x)),X=1;for(let K=k-X;K<=R+X;K++)K!==0&&o.push(new C.b4(K,t))}return o}coveringTiles(t){var o,f;let g=this.coveringZoomLevel(t);const S=g;if(t.minzoom!==void 0&&g<t.minzoom)return[];t.maxzoom!==void 0&&g>t.maxzoom&&(g=t.maxzoom);const z=this.pointCoordinate(this.getCameraPoint()),k=C.Z.fromLngLat(this.center),R=Math.pow(2,g),X=[R*z.x,R*z.y,0],K=[R*k.x,R*k.y,0],J=Wu.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,g);let ut=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ut=g);const mt=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,vt=Dt=>({aabb:new So([Dt*R,0,0],[(Dt+1)*R,R,0]),zoom:0,x:0,y:0,wrap:Dt,fullyVisible:!1}),Tt=[],Ft=[],Bt=g,Ot=t.reparseOverscaled?S:g;if(this._renderWorldCopies)for(let Dt=1;Dt<=3;Dt++)Tt.push(vt(-Dt)),Tt.push(vt(Dt));for(Tt.push(vt(0));Tt.length>0;){const Dt=Tt.pop(),ie=Dt.x,$t=Dt.y;let ce=Dt.fullyVisible;if(!ce){const Le=Dt.aabb.intersects(J);if(Le===0)continue;ce=Le===2}const we=t.terrain?X:K,Fe=Dt.aabb.distanceX(we),Ge=Dt.aabb.distanceY(we),Ze=Math.max(Math.abs(Fe),Math.abs(Ge)),ei=mt+(1<<Bt-Dt.zoom)-2;if(Dt.zoom===Bt||Ze>ei&&Dt.zoom>=ut){const Le=Bt-Dt.zoom,ui=X[0]-.5-(ie<<Le),ti=X[1]-.5-($t<<Le);Ft.push({tileID:new C.S(Dt.zoom===Bt?Ot:Dt.zoom,Dt.wrap,Dt.zoom,ie,$t),distanceSq:Fo([K[0]-.5-ie,K[1]-.5-$t]),tileDistanceToCamera:Math.sqrt(ui*ui+ti*ti)});continue}for(let Le=0;Le<4;Le++){const ui=(ie<<1)+Le%2,ti=($t<<1)+(Le>>1),Gi=Dt.zoom+1;let ye=Dt.aabb.quadrant(Le);if(t.terrain){const Pe=new C.S(Gi,Dt.wrap,Gi,ui,ti),Ui=t.terrain.getMinMaxElevation(Pe),Wi=(o=Ui.minElevation)!==null&&o!==void 0?o:this.elevation,Ni=(f=Ui.maxElevation)!==null&&f!==void 0?f:this.elevation;ye=new So([ye.min[0],ye.min[1],Wi],[ye.max[0],ye.max[1],Ni])}Tt.push({aabb:ye,zoom:Gi,x:ui,y:ti,wrap:Dt.wrap,fullyVisible:ce})}}return Ft.sort((Dt,ie)=>Dt.distanceSq-ie.distanceSq).map(Dt=>Dt.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const o=C.ac(t.lat,-85.051129,Is);return new C.P(C.O(t.lng)*this.worldSize,C.Q(o)*this.worldSize)}unproject(t){return new C.Z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){const t=this.pointLocation(this.getCameraPoint()),o=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter;return{lngLat:t,altitude:o+this.elevation}}recalculateZoom(t){const o=this.elevation,f=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,t),S=t.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-S))return;const k=f+o-S,K=Math.cos(this._pitch)*this.cameraToCenterDistance/k/C.b5(1,g.lat)/this.tileSize,J=this.scaleZoom(K);this._elevation=S,this._center=g,this.zoom=J}setLocationAtPoint(t,o){const f=this.pointCoordinate(o),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(t),z=new C.Z(S.x-(f.x-g.x),S.y-(f.y-g.y));this.center=this.coordinateLocation(z),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,o){return o?this.coordinatePoint(this.locationCoordinate(t),o.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,o){return this.coordinateLocation(this.pointCoordinate(t,o))}locationCoordinate(t){return C.Z.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,o){if(o){const Tt=o.pointCoordinate(t);if(Tt!=null)return Tt}const f=0,g=[t.x,t.y,0,1],S=[t.x,t.y,1,1];C.af(g,g,this.pixelMatrixInverse),C.af(S,S,this.pixelMatrixInverse);const z=g[3],k=S[3],R=g[0]/z,X=S[0]/k,K=g[1]/z,J=S[1]/k,ut=g[2]/z,mt=S[2]/k,vt=ut===mt?0:(f-ut)/(mt-ut);return new C.Z(C.y.number(R,X,vt)/this.worldSize,C.y.number(K,J,vt)/this.worldSize)}coordinatePoint(t,o=0,f=this.pixelMatrix){const g=[t.x*this.worldSize,t.y*this.worldSize,o,1];return C.af(g,g,f),new C.P(g[0]/g[3],g[1]/g[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Vr().extend(this.pointLocation(new C.P(0,t))).extend(this.pointLocation(new C.P(this.width,t))).extend(this.pointLocation(new C.P(this.width,this.height))).extend(this.pointLocation(new C.P(0,this.height)))}getMaxBounds(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new Vr([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Is])}calculateTileMatrix(t){const o=t.canonical,f=this.worldSize/this.zoomScale(o.z),g=o.x+Math.pow(2,o.z)*t.wrap,S=C.an(new Float64Array(16));return C.J(S,S,[g*f,o.y*f,0]),C.K(S,S,[f/C.X,f/C.X,1]),S}calculatePosMatrix(t,o=!1){const f=t.key,g=o?this._alignedPosMatrixCache:this._posMatrixCache;if(g[f])return g[f];const S=this.calculateTileMatrix(t);return C.L(S,o?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,S),g[f]=new Float32Array(S),g[f]}calculateFogMatrix(t){const o=t.key,f=this._fogMatrixCache;if(f[o])return f[o];const g=this.calculateTileMatrix(t);return C.L(g,this.fogMatrix,g),f[o]=new Float32Array(g),f[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,o){o=C.ac(+o,this.minZoom,this.maxZoom);const f={center:new C.N(t.lng,t.lat),zoom:o};let g=this.lngRange;!this._renderWorldCopies&&g===null&&(g=[-179.9999999999,179.9999999999]);const S=this.tileSize*this.zoomScale(f.zoom);let z=0,k=S,R=0,X=S,K=0,J=0;const{x:ut,y:mt}=this.size;if(this.latRange){const Dt=this.latRange;z=C.Q(Dt[1])*S,k=C.Q(Dt[0])*S,k-z<mt&&(K=mt/(k-z))}g&&(R=C.b3(C.O(g[0])*S,0,S),X=C.b3(C.O(g[1])*S,0,S),X<R&&(X+=S),X-R<ut&&(J=ut/(X-R)));const{x:vt,y:Tt}=this.project.call({worldSize:S},t);let Ft,Bt;const Ot=Math.max(J||0,K||0);if(Ot){const Dt=new C.P(J?(X+R)/2:vt,K?(k+z)/2:Tt);return f.center=this.unproject.call({worldSize:S},Dt).wrap(),f.zoom+=this.scaleZoom(Ot),f}if(this.latRange){const Dt=mt/2;Tt-Dt<z&&(Bt=z+Dt),Tt+Dt>k&&(Bt=k-Dt)}if(g){const Dt=(R+X)/2;let ie=vt;this._renderWorldCopies&&(ie=C.b3(vt,Dt-S/2,Dt+S/2));const $t=ut/2;ie-$t<R&&(Ft=R+$t),ie+$t>X&&(Ft=X-$t)}if(Ft!==void 0||Bt!==void 0){const Dt=new C.P(Ft??vt,Bt??Tt);f.center=this.unproject.call({worldSize:S},Dt).wrap()}return f}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:o,zoom:f}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=f,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this._fov/2,o=this.centerOffset,f=this.point.x,g=this.point.y;this.cameraToCenterDistance=.5/Math.tan(t)*this.height,this._pixelPerMeter=C.b5(1,this.center.lat)*this.worldSize;let S=C.an(new Float64Array(16));C.K(S,S,[this.width/2,-this.height/2,1]),C.J(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=C.an(new Float64Array(16)),C.K(S,S,[1,-1,1]),C.J(S,S,[-1,-1,0]),C.K(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S;const z=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),k=Math.min(this.elevation,this.minElevationForCurrentTile),R=z-k*this._pixelPerMeter/Math.cos(this._pitch),X=k<0?R:z,K=Math.PI/2+this._pitch,J=this._fov*(.5+o.y/this.height),ut=Math.sin(J)*X/Math.sin(C.ac(Math.PI-K-J,.01,Math.PI-.01)),mt=this.getHorizon(),Tt=2*Math.atan(mt/this.cameraToCenterDistance)*(.5+o.y/(mt*2)),Ft=Math.sin(Tt)*X/Math.sin(C.ac(Math.PI-K-Tt,.01,Math.PI-.01)),Bt=Math.min(ut,Ft);this.farZ=(Math.cos(Math.PI/2-this._pitch)*Bt+X)*1.01,this.nearZ=this.height/50,S=new Float64Array(16),C.b6(S,this._fov,this.width/this.height,this.nearZ,this.farZ),S[8]=-o.x*2/this.width,S[9]=o.y*2/this.height,this.projectionMatrix=C.ae(S),C.K(S,S,[1,-1,1]),C.J(S,S,[0,0,-this.cameraToCenterDistance]),C.b7(S,S,this._pitch),C.ad(S,S,this.angle),C.J(S,S,[-f,-g,0]),this.mercatorMatrix=C.K([],S,[this.worldSize,this.worldSize,this.worldSize]),C.K(S,S,[1,1,this._pixelPerMeter]),this.pixelMatrix=C.L(new Float64Array(16),this.labelPlaneMatrix,S),C.J(S,S,[0,0,-this.elevation]),this.modelViewProjectionMatrix=S,this.invModelViewProjectionMatrix=C.as([],S),this.fogMatrix=new Float64Array(16),C.b6(this.fogMatrix,this._fov,this.width/this.height,z,this.farZ),this.fogMatrix[8]=-o.x*2/this.width,this.fogMatrix[9]=o.y*2/this.height,C.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),C.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),C.b7(this.fogMatrix,this.fogMatrix,this._pitch),C.ad(this.fogMatrix,this.fogMatrix,this.angle),C.J(this.fogMatrix,this.fogMatrix,[-f,-g,0]),C.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),C.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=C.L(new Float64Array(16),this.labelPlaneMatrix,S);const Ot=this.width%2/2,Dt=this.height%2/2,ie=Math.cos(this.angle),$t=Math.sin(this.angle),ce=f-Math.round(f)+ie*Ot+$t*Dt,we=g-Math.round(g)+ie*Dt+$t*Ot,Fe=new Float64Array(S);if(C.J(Fe,Fe,[ce>.5?ce-1:ce,we>.5?we-1:we,0]),this.alignedModelViewProjectionMatrix=Fe,S=C.as(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");this.pixelMatrixInverse=S,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new C.P(0,0)),o=[t.x*this.worldSize,t.y*this.worldSize,0,1];return C.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=this._pitch,o=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new C.P(0,o))}getCameraQueryGeometry(t){const o=this.getCameraPoint();if(t.length===1)return[t[0],o];{let f=o.x,g=o.y,S=o.x,z=o.y;for(const k of t)f=Math.min(f,k.x),g=Math.min(g,k.y),S=Math.max(S,k.x),z=Math.max(z,k.y);return[new C.P(f,g),new C.P(S,g),new C.P(S,z),new C.P(f,z),new C.P(f,g)]}}lngLatToCameraDepth(t,o){const f=this.locationCoordinate(t),g=[f.x*this.worldSize,f.y*this.worldSize,o,1];return C.af(g,g,this.modelViewProjectionMatrix),g[2]/g[3]}}function Ea(w,t){let o=!1,f=null,g=null,S;const z=()=>{f=null,o&&(w.apply(g,S),f=setTimeout(z,t),o=!1)};return(...k)=>(o=!0,g=this,S=k,f||z(),f)}class hs{constructor(t){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let f;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(f=g)}),(f&&f[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(f=>isNaN(f))){const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:f,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const f=o.join("/");let g=f;g.split("&").length>0&&(g=g.split("&")[0]),this._hashName&&(g=`${this._hashName}=${f}`);let S=window.location.hash.replace(g,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let z=window.location.href.replace(/(#.+)?$/,S);z=z.replace("&&","&"),window.history.replaceState(window.history.state,null,z)},this._updateHash=Ea(this._updateHashUnthrottled,30*1e3/100),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const o=this._map.getCenter(),f=Math.round(this._map.getZoom()*100)/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),z=Math.round(o.lng*S)/S,k=Math.round(o.lat*S)/S,R=this._map.getBearing(),X=this._map.getPitch();let K="";if(t?K+=`/${z}/${k}/${f}`:K+=`${f}/${k}/${z}`,(R||X)&&(K+=`/${Math.round(R*10)/10}`),X&&(K+=`/${Math.round(X)}`),this._hashName){const J=this._hashName;let ut=!1;const mt=window.location.hash.slice(1).split("&").map(vt=>{const Tt=vt.split("=")[0];return Tt===J?(ut=!0,`${Tt}=${K}`):vt}).filter(vt=>vt);return ut||mt.push(`${J}=${K}`),`#${mt.join("&")}`}return`#${K}`}}const Fi={linearity:.3,easing:C.b8(0,0,.3,1)},Ku=C.e({deceleration:2500,maxSpeed:1400},Fi),Eh=C.e({deceleration:20,maxSpeed:1400},Fi),Gn=C.e({deceleration:1e3,maxSpeed:360},Fi),of=C.e({deceleration:1e3,maxSpeed:90},Fi);class Yu{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:me.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=me.now(),f=160;for(;t.length>0&&o-t[0].time>f;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new C.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:z}of this._inertiaBuffer)o.zoom+=z.zoomDelta||0,o.bearing+=z.bearingDelta||0,o.pitch+=z.pitchDelta||0,z.panDelta&&o.pan._add(z.panDelta),z.around&&(o.around=z.around),z.pinchAround&&(o.pinchAround=z.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(o.pan.mag()){const z=tn(o.pan.mag(),g,C.e({},Ku,t||{}));S.offset=o.pan.mult(z.amount/o.pan.mag()),S.center=this._map.transform.center,Ia(S,z)}if(o.zoom){const z=tn(o.zoom,g,Eh);S.zoom=this._map.transform.zoom+z.amount,Ia(S,z)}if(o.bearing){const z=tn(o.bearing,g,Gn);S.bearing=this._map.transform.bearing+C.ac(z.amount,-179,179),Ia(S,z)}if(o.pitch){const z=tn(o.pitch,g,of);S.pitch=this._map.transform.pitch+z.amount,Ia(S,z)}if(S.zoom||S.bearing){const z=o.pinchAround===void 0?o.around:o.pinchAround;S.around=z?this._map.unproject(z):this._map.getCenter()}return this.clear(),C.e(S,{noMoveStart:!0})}}function Ia(w,t){(!w.duration||w.duration<t.duration)&&(w.duration=t.duration,w.easing=t.easing)}function tn(w,t,o){const{maxSpeed:f,linearity:g,deceleration:S}=o,z=C.ac(w*g/(t/1e3),-f,f),k=Math.abs(z)/(S*g);return{easing:o.easing,duration:k*1e3,amount:z*(k/2)}}class Ar extends C.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,f,g={}){const S=Qt.mousePos(o.getCanvas(),f),z=o.unproject(S);super(t,C.e({point:S,lngLat:z,originalEvent:f},g)),this._defaultPrevented=!1,this.target=o}}class Xt extends C.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,f){const g=t==="touchend"?f.changedTouches:f.touches,S=Qt.touchPos(o.getCanvasContainer(),g),z=S.map(X=>o.unproject(X)),k=S.reduce((X,K,J,ut)=>X.add(K.div(ut.length)),new C.P(0,0)),R=o.unproject(k);super(t,{points:S,point:k,lngLats:z,lngLat:R,originalEvent:f}),this._defaultPrevented=!1}}class Ke extends C.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,f){super(t,{originalEvent:f}),this._defaultPrevented=!1}}class Cs{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ke(t.type,this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new Ar(t.type,this._map,t))}mouseup(t){this._map.fire(new Ar(t.type,this._map,t))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Ar(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ar(t.type,this._map,t))}mouseover(t){this._map.fire(new Ar(t.type,this._map,t))}mouseout(t){this._map.fire(new Ar(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Xt(t.type,this._map,t))}touchmove(t){this._map.fire(new Xt(t.type,this._map,t))}touchend(t){this._map.fire(new Xt(t.type,this._map,t))}touchcancel(t){this._map.fire(new Xt(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ca{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ar(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ar(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ka{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(C.P.convert(t),this._map.terrain)}}class Nr{constructor(t,o){this._map=t,this._tr=new Ka(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(Qt.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const f=o;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=f,this._box||(this._box=Qt.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const S=Math.min(g.x,f.x),z=Math.max(g.x,f.x),k=Math.min(g.y,f.y),R=Math.max(g.y,f.y);Qt.setTransform(this._box,`translate(${S}px,${k}px)`),this._box.style.width=`${z-S}px`,this._box.style.height=`${R-k}px`}mouseupWindow(t,o){if(!this._active||t.button!==0)return;const f=this._startPos,g=o;if(this.reset(),Qt.suppressClick(),f.x===g.x&&f.y===g.y)this._fireEvent("boxzoomcancel",t);else return this._map.fire(new C.k("boxzoomend",{originalEvent:t})),{cameraAnimation:S=>S.fitScreenCoordinates(f,g,this._tr.bearing,{linear:!0})}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Qt.remove(this._box),this._box=null),Qt.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new C.k(t,{originalEvent:o}))}}function na(w,t){if(w.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${t.length}`);const o={};for(let f=0;f<w.length;f++)o[w[f].identifier]=t[f];return o}function Ya(w){const t=new C.P(0,0);for(const o of w)t._add(o);return t.div(w.length)}const Oi=500,Ol=500,jr=30;class lf{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,o,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=Ya(o),this.touches=na(f,o)))}touchmove(t,o,f){if(this.aborted||!this.centroid)return;const g=na(f,o);for(const S in this.touches){const z=this.touches[S],k=g[S];(!k||k.dist(z)>jr)&&(this.aborted=!0)}}touchend(t,o,f){if((!this.centroid||t.timeStamp-this.startTime>Ol)&&(this.aborted=!0),f.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Ri{constructor(t){this.singleTap=new lf(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,o,f){this.singleTap.touchstart(t,o,f)}touchmove(t,o,f){this.singleTap.touchmove(t,o,f)}touchend(t,o,f){const g=this.singleTap.touchend(t,o,f);if(g){const S=t.timeStamp-this.lastTime<Oi,z=!this.lastTap||this.lastTap.dist(g)<jr;if((!S||!z)&&this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Mr{constructor(t){this._tr=new Ka(t),this._zoomIn=new Ri({numTouches:1,numTaps:2}),this._zoomOut=new Ri({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,f){this._zoomIn.touchstart(t,o,f),this._zoomOut.touchstart(t,o,f)}touchmove(t,o,f){this._zoomIn.touchmove(t,o,f),this._zoomOut.touchmove(t,o,f)}touchend(t,o,f){const g=this._zoomIn.touchend(t,o,f),S=this._zoomOut.touchend(t,o,f),z=this._tr;if(g)return this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:z.zoom+1,around:z.unproject(g)},{originalEvent:t})};if(S)return this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:z.zoom-1,around:z.unproject(S)},{originalEvent:t})}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class al{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const o=this._moveFunction(...t);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(t,o){!this.isEnabled()||this._lastPoint||this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,o){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t)){this.reset(t);return}const g=o.length?o[0]:o;if(!(!this._moved&&g.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=g,this._move(f,g)}dragEnd(t){!this.isEnabled()||!this._lastPoint||this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Qt.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Pd=0,Vl=2,uf={[Pd]:1,[Vl]:2};function To(w,t){const o=uf[t];return w.buttons===void 0||(w.buttons&o)!==o}class Ul{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const o=Qt.mouseButton(t);this._eventButton=o}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!To(t,this._eventButton)}isValidEndEvent(t){return Qt.mouseButton(t)===this._eventButton}}class Nl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){const o=t.targetTouches[0].identifier;this._firstTouch=o}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Hn=0,ql=2,Ih=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=t=>{t.preventDefault()}},pc=({enable:w,clickTolerance:t})=>{const o=new Ul({checkCorrectEvent:f=>Qt.mouseButton(f)===Hn&&!f.ctrlKey});return new al({clickTolerance:t,move:(f,g)=>({around:g,panDelta:g.sub(f)}),activateOnStart:!0,moveStateManager:o,enable:w,assignEvents:Ih})},Ju=({enable:w,clickTolerance:t,bearingDegreesPerPixelMoved:o=.8})=>{const f=new Ul({checkCorrectEvent:g=>Qt.mouseButton(g)===Hn&&g.ctrlKey||Qt.mouseButton(g)===ql});return new al({clickTolerance:t,move:(g,S)=>({bearingDelta:(S.x-g.x)*o}),moveStateManager:f,enable:w,assignEvents:Ih})},Ch=({enable:w,clickTolerance:t,pitchDegreesPerPixelMoved:o=-.5})=>{const f=new Ul({checkCorrectEvent:g=>Qt.mouseButton(g)===Hn&&g.ctrlKey||Qt.mouseButton(g)===ql});return new al({clickTolerance:t,move:(g,S)=>({pitchDelta:(S.y-g.y)*o}),moveStateManager:f,enable:w,assignEvents:Ih})};class sl{constructor(t,o){this._clickTolerance=t.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new C.P(0,0)}_shouldBePrevented(t){const o=this._map.cooperativeGestures.isEnabled()?2:1;return t<o}touchstart(t,o,f){return this._calculateTransform(t,o,f)}touchmove(t,o,f){if(this._active){if(this._shouldBePrevented(f.length)){this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t);return}return t.preventDefault(),this._calculateTransform(t,o,f)}}touchend(t,o,f){this._calculateTransform(t,o,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,f){f.length>0&&(this._active=!0);const g=na(f,o),S=new C.P(0,0),z=new C.P(0,0);let k=0;for(const K in g){const J=g[K],ut=this._touches[K];ut&&(S._add(J),z._add(J.sub(ut)),k++,g[K]=J)}if(this._touches=g,this._shouldBePrevented(k)||!z.mag())return;const R=z.div(k);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(k),panDelta:R}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class aa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,o,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,f){if(!this._firstTwoTouches)return;t.preventDefault();const[g,S]=this._firstTwoTouches,z=Ln(f,o,g),k=Ln(f,o,S);if(!z||!k)return;const R=this._aroundCenter?null:z.add(k).div(2);return this._move([z,k],R,t)}touchend(t,o,f){if(!this._firstTwoTouches)return;const[g,S]=this._firstTwoTouches,z=Ln(f,o,g),k=Ln(f,o,S);z&&k||(this._active&&Qt.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ln(w,t,o){for(let f=0;f<w.length;f++)if(w[f].identifier===o)return t[f]}const gr=.1;function Zl(w,t){return Math.log(w/t)/Math.LN2}class ol extends aa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const f=this._distance;if(this._distance=t[0].dist(t[1]),!(!this._active&&Math.abs(Zl(this._distance,this._startDistance))<gr))return this._active=!0,{zoomDelta:Zl(this._distance,f),pinchAround:o}}}const mc=25;function Eo(w,t){return w.angleWith(t)*180/Math.PI}class xu extends aa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o,f){const g=this._vector;if(this._vector=t[0].sub(t[1]),!(!this._active&&this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Eo(this._vector,g),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=Math.PI*this._minDiameter,f=mc/o*360,g=Eo(t,this._startVector);return Math.abs(g)<f}}function jl(w){return Math.abs(w.y)>Math.abs(w.x)}const Xn=100;class Qu extends aa{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,o,f){super.touchstart(t,o,f),this._currentTouchCount=f.length}_start(t){this._lastPoints=t,jl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=t[0].sub(this._lastPoints[0]),S=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,S,f.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(t,o,f){if(this._valid!==void 0)return this._valid;const g=2,S=t.mag()>=g,z=o.mag()>=g;if(!S&&!z)return;if(!S||!z)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<Xn?void 0:!1;const k=t.y>0==o.y>0;return jl(t)&&jl(o)&&k}}const Xe={panStep:100,bearingStep:15,pitchStep:10};class Ye{constructor(t){this._tr=new Ka(t);const o=Xe;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,f=0,g=0,S=0,z=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),S=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),S=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),z=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),z=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:k=>{const R=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:$u,zoom:o?Math.round(R.zoom)+o*(t.shiftKey?2:1):R.zoom,bearing:R.bearing+f*this._bearingStep,pitch:R.pitch+g*this._pitchStep,offset:[-S*this._panStep,-z*this._panStep],center:R.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $u(w){return w*(2-w)}const ll=4.000244140625,_c=1/100,Pa=1/450,Ja=2;class Ps{constructor(t,o){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=t,this._tr=new Ka(t),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=_c,this._wheelZoomRate=Pa}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return this._map.cooperativeGestures.isEnabled()?!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t)):!1}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t)){this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);return}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?t.deltaY*40:t.deltaY;const f=me.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,o!==0&&o%ll===0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o=o/4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Qt.mousePos(this._map.getCanvas(),t),f=this._tr;o.y>f.transform.height/2-f.transform.getHorizon()?this._around=C.N.convert(this._aroundCenter?f.center:f.unproject(o)):this._around=C.N.convert(f.center),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>ll?this._wheelZoomRate:this._defaultZoomRate;let X=Ja/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&X!==0&&(X=1/X);const K=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(K*X))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,f=this._startZoom,g=this._easing;let S=!1,z;const k=me.now()-this._lastWheelEventTime;if(this._type==="wheel"&&f&&g&&k){const R=Math.min(k/200,1),X=g(R);z=C.y.number(f,o,X),R<1?this._frameId||(this._frameId=!0):S=!0}else z=o,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:z-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=C.b9;if(this._prevEase){const f=this._prevEase,g=(me.now()-f.start)/f.duration,S=f.easing(g+.01)-f.easing(g),z=.27/Math.sqrt(S*S+1e-4)*.01,k=Math.sqrt(.27*.27-z*z);o=C.b8(z,k,.25,1)}return this._prevEase={start:me.now(),duration:t,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class hf{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ph{constructor(t){this._tr=new Ka(t),this.reset()}reset(){this._active=!1}dblclick(t,o){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hf{constructor(){this._tap=new Ri({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,o,f){if(!this._swipePoint)if(!this._tapTime)this._tap.touchstart(t,o,f);else{const g=o[0],S=t.timeStamp-this._tapTime<Oi,z=this._tapPoint.dist(g)<jr;!S||!z?this.reset():f.length>0&&(this._swipePoint=g,this._swipeTouch=f[0].identifier)}}touchmove(t,o,f){if(!this._tapTime)this._tap.touchmove(t,o,f);else if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const g=o[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:S/128}}}touchend(t,o,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const g=this._tap.touchend(t,o,f);g&&(this._tapTime=t.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gr{constructor(t,o,f){this._el=t,this._mousePan=o,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class d{constructor(t,o,f){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class l{constructor(t,o,f,g){this._el=t,this._touchZoom=o,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class m{constructor(t,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Qt.create("div","maplibregl-cooperative-gesture-screen",t);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=o,this._container.appendChild(g);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=f,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Qt.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,o){this._enabled&&(this._map.fire(new C.k("cooperativegestureprevented",{gestureType:t,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const u=w=>w.zoom||w.drag||w.pitch||w.rotate;class _ extends C.k{}function I(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class P{constructor(t,o){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,S)=>{if(g.type==="blur"){this.stop(!0);return}this._updatingCamera=!0;const z=g.type==="renderFrame"?void 0:g,k={needsRenderFrame:!1},R={},X={},K=g.touches,J=K?this._getMapTouches(K):void 0,ut=J?Qt.touchPos(this._map.getCanvas(),J):Qt.mousePos(this._map.getCanvas(),g);for(const{handlerName:Tt,handler:Ft,allowed:Bt}of this._handlers){if(!Ft.isEnabled())continue;let Ot;this._blockedByActive(X,Bt,Tt)?Ft.reset():Ft[S||g.type]&&(Ot=Ft[S||g.type](g,ut,J),this.mergeHandlerResult(k,R,Ot,Tt,z),Ot&&Ot.needsRenderFrame&&this._triggerRenderFrame()),(Ot||Ft.isActive())&&(X[Tt]=Ft)}const mt={};for(const Tt in this._previousActiveHandlers)X[Tt]||(mt[Tt]=z);this._previousActiveHandlers=X,(Object.keys(mt).length||I(k))&&(this._changes.push([k,R,mt]),this._triggerRenderFrame()),(Object.keys(X).length||I(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:vt}=k;vt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],vt(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yu(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,S,z]of this._listeners)Qt.addEventListener(g,S,g===document?this.handleWindowEvent:this.handleEvent,z)}destroy(){for(const[t,o,f]of this._listeners)Qt.removeEventListener(t,o,t===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(t){const o=this._map,f=o.getCanvasContainer();this._add("mapEvent",new Cs(o,t));const g=o.boxZoom=new Nr(o,t);this._add("boxZoom",g),t.interactive&&t.boxZoom&&g.enable();const S=o.cooperativeGestures=new m(o,t.cooperativeGestures);this._add("cooperativeGestures",S),t.cooperativeGestures&&S.enable();const z=new Mr(o),k=new Ph(o);o.doubleClickZoom=new hf(k,z),this._add("tapZoom",z),this._add("clickZoom",k),t.interactive&&t.doubleClickZoom&&o.doubleClickZoom.enable();const R=new Hf;this._add("tapDragZoom",R);const X=o.touchPitch=new Qu(o);this._add("touchPitch",X),t.interactive&&t.touchPitch&&o.touchPitch.enable(t.touchPitch);const K=Ju(t),J=Ch(t);o.dragRotate=new d(t,K,J),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]),t.interactive&&t.dragRotate&&o.dragRotate.enable();const ut=pc(t),mt=new sl(t,o);o.dragPan=new Gr(f,ut,mt),this._add("mousePan",ut),this._add("touchPan",mt,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&o.dragPan.enable(t.dragPan);const vt=new xu,Tt=new ol;o.touchZoomRotate=new l(f,Tt,vt,R),this._add("touchRotate",vt,["touchPan","touchZoom"]),this._add("touchZoom",Tt,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&o.touchZoomRotate.enable(t.touchZoomRotate);const Ft=o.scrollZoom=new Ps(o,()=>this._triggerRenderFrame());this._add("scrollZoom",Ft,["mousePan"]),t.interactive&&t.scrollZoom&&o.scrollZoom.enable(t.scrollZoom);const Bt=o.keyboard=new Ye(o);this._add("keyboard",Bt),t.interactive&&t.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Ca(o))}_add(t,o,f){this._handlers.push({handlerName:t,handler:o,allowed:f}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!u(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,o,f){for(const g in t)if(g!==f&&(!o||o.indexOf(g)<0))return!0;return!1}_getMapTouches(t){const o=[];for(const f of t){const g=f.target;this._el.contains(g)&&o.push(f)}return o}mergeHandlerResult(t,o,f,g,S){if(!f)return;C.e(t,f);const z={handlerName:g,originalEvent:f.originalEvent||S};f.zoomDelta!==void 0&&(o.zoom=z),f.panDelta!==void 0&&(o.drag=z),f.pitchDelta!==void 0&&(o.pitch=z),f.bearingDelta!==void 0&&(o.rotate=z)}_applyChanges(){const t={},o={},f={};for(const[g,S,z]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new C.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),C.e(o,S),C.e(f,z);this._updateMapTransform(t,o,f),this._changes=[]}_updateMapTransform(t,o,f){const g=this._map,S=g._getTransformForUpdate(),z=g.terrain;if(!I(t)&&!(z&&this._terrainMovement))return this._fireEvents(o,f,!0);let{panDelta:k,zoomDelta:R,bearingDelta:X,pitchDelta:K,around:J,pinchAround:ut}=t;ut!==void 0&&(J=ut),g._stop(!0),J=J||g.transform.centerPoint;const mt=S.pointLocation(k?J.sub(k):J);X&&(S.bearing+=X),K&&(S.pitch+=K),R&&(S.zoom+=R),z?!this._terrainMovement&&(o.drag||o.zoom)?(this._terrainMovement=!0,this._map._elevationFreeze=!0,S.setLocationAtPoint(mt,J)):o.drag&&this._terrainMovement?S.center=S.pointLocation(S.centerPoint.sub(k)):S.setLocationAtPoint(mt,J):S.setLocationAtPoint(mt,J),g._applyUpdatedTransform(S),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,f,!0)}_fireEvents(t,o,f){const g=u(this._eventsInProgress),S=u(t),z={};for(const J in t){const{originalEvent:ut}=t[J];this._eventsInProgress[J]||(z[`${J}start`]=ut),this._eventsInProgress[J]=t[J]}!g&&S&&this._fireEvent("movestart",S.originalEvent);for(const J in z)this._fireEvent(J,z[J]);S&&this._fireEvent("move",S.originalEvent);for(const J in t){const{originalEvent:ut}=t[J];this._fireEvent(J,ut)}const k={};let R;for(const J in this._eventsInProgress){const{handlerName:ut,originalEvent:mt}=this._eventsInProgress[J];this._handlersById[ut].isActive()||(delete this._eventsInProgress[J],R=o[ut]||mt,k[`${J}end`]=R)}for(const J in k)this._fireEvent(J,k[J]);const X=u(this._eventsInProgress),K=(g||S)&&!X;if(K&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const J=this._map._getTransformForUpdate();J.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(J)}if(f&&K){this._updatingCamera=!0;const J=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ut=mt=>mt!==0&&-this._bearingSnap<mt&&mt<this._bearingSnap;J&&(J.essential||!me.prefersReducedMotion)?(ut(J.bearing||this._map.getBearing())&&(J.bearing=0),J.freezeElevation=!0,this._map.easeTo(J,{originalEvent:R})):(this._map.fire(new C.k("moveend",{originalEvent:R})),ut(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new C.k(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new _("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class D extends C.E{constructor(t,o){super(),this._renderFrameCallback=()=>{const f=Math.min((me.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new C.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,f){return t=C.P.convert(t).mult(-1),this.panTo(this.transform.center,C.e({offset:t},o),f)}panTo(t,o,f){return this.easeTo(C.e({center:t},o),f)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,f){return this.easeTo(C.e({zoom:t},o),f)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,f){return this.easeTo(C.e({bearing:t},o),f)}resetNorth(t,o){return this.rotateTo(0,C.e({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(C.e({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=Vr.convert(t).adjustAntiMeridian();const f=o&&o.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),f,o)}_cameraForBoxAndBearing(t,o,f,g){const S={top:0,bottom:0,right:0,left:0};if(g=C.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},g),typeof g.padding=="number"){const ye=g.padding;g.padding={top:ye,bottom:ye,right:ye,left:ye}}g.padding=C.e(S,g.padding);const z=this.transform,k=z.padding,R=new Vr(t,o),X=z.project(R.getNorthWest()),K=z.project(R.getNorthEast()),J=z.project(R.getSouthEast()),ut=z.project(R.getSouthWest()),mt=C.ba(-f),vt=X.rotate(mt),Tt=K.rotate(mt),Ft=J.rotate(mt),Bt=ut.rotate(mt),Ot=new C.P(Math.max(vt.x,Tt.x,Bt.x,Ft.x),Math.max(vt.y,Tt.y,Bt.y,Ft.y)),Dt=new C.P(Math.min(vt.x,Tt.x,Bt.x,Ft.x),Math.min(vt.y,Tt.y,Bt.y,Ft.y)),ie=Ot.sub(Dt),$t=(z.width-(k.left+k.right+g.padding.left+g.padding.right))/ie.x,ce=(z.height-(k.top+k.bottom+g.padding.top+g.padding.bottom))/ie.y;if(ce<0||$t<0){C.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");return}const we=Math.min(z.scaleZoom(z.scale*Math.min($t,ce)),g.maxZoom),Fe=C.P.convert(g.offset),Ge=(g.padding.left-g.padding.right)/2,Ze=(g.padding.top-g.padding.bottom)/2,Le=new C.P(Ge,Ze).rotate(C.ba(f)),ti=Fe.add(Le).mult(z.scale/z.zoomScale(we));return{center:z.unproject(X.add(J).div(2).sub(ti)),zoom:we,bearing:f}}fitBounds(t,o,f){return this._fitInternal(this.cameraForBounds(t,o),o,f)}fitScreenCoordinates(t,o,f,g,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(C.P.convert(t)),this.transform.pointLocation(C.P.convert(o)),f,g),g,S)}_fitInternal(t,o,f){return t?(o=C.e(t,o),delete o.padding,o.linear?this.easeTo(o,f):this.flyTo(o,f)):this}jumpTo(t,o){this.stop();const f=this._getTransformForUpdate();let g=!1,S=!1,z=!1;return"zoom"in t&&f.zoom!==+t.zoom&&(g=!0,f.zoom=+t.zoom),t.center!==void 0&&(f.center=C.N.convert(t.center)),"bearing"in t&&f.bearing!==+t.bearing&&(S=!0,f.bearing=+t.bearing),"pitch"in t&&f.pitch!==+t.pitch&&(z=!0,f.pitch=+t.pitch),t.padding!=null&&!f.isPaddingEqual(t.padding)&&(f.padding=t.padding),this._applyUpdatedTransform(f),this.fire(new C.k("movestart",o)).fire(new C.k("move",o)),g&&this.fire(new C.k("zoomstart",o)).fire(new C.k("zoom",o)).fire(new C.k("zoomend",o)),S&&this.fire(new C.k("rotatestart",o)).fire(new C.k("rotate",o)).fire(new C.k("rotateend",o)),z&&this.fire(new C.k("pitchstart",o)).fire(new C.k("pitch",o)).fire(new C.k("pitchend",o)),this.fire(new C.k("moveend",o))}calculateCameraOptionsFromTo(t,o,f,g=0){const S=C.Z.fromLngLat(t,o),z=C.Z.fromLngLat(f,g),k=z.x-S.x,R=z.y-S.y,X=z.z-S.z,K=Math.hypot(k,R,X);if(K===0)throw new Error("Can't calculate camera options with same From and To");const J=Math.hypot(k,R),ut=this.transform.scaleZoom(this.transform.cameraToCenterDistance/K/this.transform.tileSize),mt=Math.atan2(k,-R)*180/Math.PI;let vt=Math.acos(J/K)*180/Math.PI;return vt=X<0?90-vt:90+vt,{center:z.toLngLat(),zoom:ut,pitch:vt,bearing:mt}}easeTo(t,o){var f;this._stop(!1,t.easeId),t=C.e({offset:[0,0],duration:500,easing:C.b9},t),(t.animate===!1||!t.essential&&me.prefersReducedMotion)&&(t.duration=0);const g=this._getTransformForUpdate(),S=g.zoom,z=g.bearing,k=g.pitch,R=g.padding,X="bearing"in t?this._normalizeBearing(t.bearing,z):z,K="pitch"in t?+t.pitch:k,J="padding"in t?t.padding:g.padding,ut=C.P.convert(t.offset);let mt=g.centerPoint.add(ut);const vt=g.pointLocation(mt),{center:Tt,zoom:Ft}=g.getConstrained(C.N.convert(t.center||vt),(f=t.zoom)!==null&&f!==void 0?f:S);this._normalizeCenter(Tt,g);const Bt=g.project(vt),Ot=g.project(Tt).sub(Bt),Dt=g.zoomScale(Ft-S);let ie,$t;t.around&&(ie=C.N.convert(t.around),$t=g.locationPoint(ie));const ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ft!==S,this._rotating=this._rotating||z!==X,this._pitching=this._pitching||K!==k,this._padding=!g.isPaddingEqual(J),this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,ce),this.terrain&&this._prepareElevation(Tt),this._ease(we=>{if(this._zooming&&(g.zoom=C.y.number(S,Ft,we)),this._rotating&&(g.bearing=C.y.number(z,X,we)),this._pitching&&(g.pitch=C.y.number(k,K,we)),this._padding&&(g.interpolatePadding(R,J,we),mt=g.centerPoint.add(ut)),this.terrain&&!t.freezeElevation&&this._updateElevation(we),ie)g.setLocationAtPoint(ie,$t);else{const Fe=g.zoomScale(g.zoom-S),Ge=Ft>S?Math.min(2,Dt):Math.max(.5,Dt),Ze=Math.pow(Ge,1-we),ei=g.unproject(Bt.add(Ot.mult(we*Ze)).mult(Fe));g.setLocationAtPoint(g.renderWorldCopies?ei.wrap():ei,mt)}this._applyUpdatedTransform(g),this._fireMoveEvents(o)},we=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(o,we)},t),this}_prepareEase(t,o,f={}){this._moving=!0,!o&&!f.moving&&this.fire(new C.k("movestart",t)),this._zooming&&!f.zooming&&this.fire(new C.k("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new C.k("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new C.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&o!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart,g=(o-(f*t+this._elevationStart))/(1-t);this._elevationStart+=t*(f-g),this._elevationTarget=o}this.transform.elevation=C.y.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return!this.transformCameraUpdate&&!this.terrain?this.transform:(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState)}_elevateCameraIfInsideTerrain(t){const o=t.getCameraPosition(),f=this.terrain.getElevationForLngLatZoom(o.lngLat,t.zoom);if(o.altitude<f){const g=this.calculateCameraOptionsFromTo(o.lngLat,f,t.center,t.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(t){const o=[];if(this.terrain&&o.push(g=>this._elevateCameraIfInsideTerrain(g)),this.transformCameraUpdate&&o.push(g=>this.transformCameraUpdate(g)),!o.length)return;const f=t.clone();for(const g of o){const S=f.clone(),{center:z,zoom:k,pitch:R,bearing:X,elevation:K}=g(S);z&&(S.center=z),k!==void 0&&(S.zoom=k),R!==void 0&&(S.pitch=R),X!==void 0&&(S.bearing=X),K!==void 0&&(S.elevation=K),f.apply(S)}this.transform.apply(f)}_fireMoveEvents(t){this.fire(new C.k("move",t)),this._zooming&&this.fire(new C.k("zoom",t)),this._rotating&&this.fire(new C.k("rotate",t)),this._pitching&&this.fire(new C.k("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const f=this._zooming,g=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new C.k("zoomend",t)),g&&this.fire(new C.k("rotateend",t)),S&&this.fire(new C.k("pitchend",t)),this.fire(new C.k("moveend",t))}flyTo(t,o){var f;if(!t.essential&&me.prefersReducedMotion){const Pe=C.M(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Pe,o)}this.stop(),t=C.e({offset:[0,0],speed:1.2,curve:1.42,easing:C.b9},t);const g=this._getTransformForUpdate(),S=g.zoom,z=g.bearing,k=g.pitch,R=g.padding,X="bearing"in t?this._normalizeBearing(t.bearing,z):z,K="pitch"in t?+t.pitch:k,J="padding"in t?t.padding:g.padding,ut=C.P.convert(t.offset);let mt=g.centerPoint.add(ut);const vt=g.pointLocation(mt),{center:Tt,zoom:Ft}=g.getConstrained(C.N.convert(t.center||vt),(f=t.zoom)!==null&&f!==void 0?f:S);this._normalizeCenter(Tt,g);const Bt=g.zoomScale(Ft-S),Ot=g.project(vt),Dt=g.project(Tt).sub(Ot);let ie=t.curve;const $t=Math.max(g.width,g.height),ce=$t/Bt,we=Dt.mag();if("minZoom"in t){const Pe=C.ac(Math.min(t.minZoom,S,Ft),g.minZoom,g.maxZoom),Ui=$t/g.zoomScale(Pe-S);ie=Math.sqrt(Ui/we*2)}const Fe=ie*ie;function Ge(Pe){const Ui=(ce*ce-$t*$t+(Pe?-1:1)*Fe*Fe*we*we)/(2*(Pe?ce:$t)*Fe*we);return Math.log(Math.sqrt(Ui*Ui+1)-Ui)}function Ze(Pe){return(Math.exp(Pe)-Math.exp(-Pe))/2}function ei(Pe){return(Math.exp(Pe)+Math.exp(-Pe))/2}function Le(Pe){return Ze(Pe)/ei(Pe)}const ui=Ge(!1);let ti=function(Pe){return ei(ui)/ei(ui+ie*Pe)},Gi=function(Pe){return $t*((ei(ui)*Le(ui+ie*Pe)-Ze(ui))/Fe)/we},ye=(Ge(!0)-ui)/ie;if(Math.abs(we)<1e-6||!isFinite(ye)){if(Math.abs($t-ce)<1e-6)return this.easeTo(t,o);const Pe=ce<$t?-1:1;ye=Math.abs(Math.log(ce/$t))/ie,Gi=()=>0,ti=Ui=>Math.exp(Pe*ie*Ui)}if("duration"in t)t.duration=+t.duration;else{const Pe="screenSpeed"in t?+t.screenSpeed/ie:+t.speed;t.duration=1e3*ye/Pe}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=z!==X,this._pitching=K!==k,this._padding=!g.isPaddingEqual(J),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(Tt),this._ease(Pe=>{const Ui=Pe*ye,Wi=1/ti(Ui);g.zoom=Pe===1?Ft:S+g.scaleZoom(Wi),this._rotating&&(g.bearing=C.y.number(z,X,Pe)),this._pitching&&(g.pitch=C.y.number(k,K,Pe)),this._padding&&(g.interpolatePadding(R,J,Pe),mt=g.centerPoint.add(ut)),this.terrain&&!t.freezeElevation&&this._updateElevation(Pe);const Ni=Pe===1?Tt:g.unproject(Ot.add(Dt.mult(Gi(Ui))).mult(Wi));g.setLocationAtPoint(g.renderWorldCopies?Ni.wrap():Ni,mt),this._applyUpdatedTransform(g),this._fireMoveEvents(o)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(o)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,o){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,o)}return t||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(t,o,f){f.animate===!1||f.duration===0?(t(1),o()):(this._easeStart=me.now(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,o){t=C.b3(t,-180,180);const f=Math.abs(t-o);return Math.abs(t-360-o)<f&&(t-=360),Math.abs(t+360-o)<f&&(t+=360),t}_normalizeCenter(t,o){if(!o.renderWorldCopies||o.lngRange)return;const f=t.lng-o.center.lng;t.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(C.N.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const q={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class G{constructor(t=q){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{o&&(o.sourceDataType==="metadata"||o.sourceDataType==="visibility"||o.dataType==="style"||o.type==="terrain")&&this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):!this._container.classList.contains("maplibregl-compact")&&!this._container.classList.contains("maplibregl-attrib-empty")&&(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Qt.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Qt.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Qt.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Qt.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,o){const f=this._map._getUIString(`AttributionControl.${o}`);t.title=f,t.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const o=this._map.style.sourceCaches;for(const g in o){const S=o[g];if(S.used||S.usedForTerrain){const z=S.getSource();z.attribution&&t.indexOf(z.attribution)<0&&t.push(z.attribution)}}t=t.filter(g=>String(g).trim()),t.sort((g,S)=>g.length-S.length),t=t.filter((g,S)=>{for(let z=S+1;z<t.length;z++)if(t[z].indexOf(g)>=0)return!1;return!0});const f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class et{constructor(t={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const f=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Qt.create("div","maplibregl-ctrl");const o=Qt.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Qt.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ot{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,f=o?this._queue.concat(o):this._queue;for(const g of f)if(g.id===t){g.cancelled=!0;return}}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const f of o)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var at=C.Y([{name:"a_pos3d",type:"Int16",components:3}]);class pt extends C.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,o){this.sourceCache.update(t,o),this._renderableTilesKeys=[];const f={};for(const g of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))f[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),C.aP(g.posMatrix,0,C.X,0,C.X,0,1),this._tiles[g.key]=new O(g,this.tileSize));for(const g in this._tiles)f[g]||delete this._tiles[g]}freeRtt(t){for(const o in this._tiles){const f=this._tiles[o];(!t||f.tileID.equals(t)||f.tileID.isChildOf(t)||t.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const o={};for(const f of this._renderableTilesKeys){const g=this._tiles[f].tileID;if(g.canonical.equals(t.canonical)){const S=t.clone();S.posMatrix=new Float64Array(16),C.aP(S.posMatrix,0,C.X,0,C.X,0,1),o[f]=S}else if(g.canonical.isChildOf(t.canonical)){const S=t.clone();S.posMatrix=new Float64Array(16);const z=g.canonical.z-t.canonical.z,k=g.canonical.x-(g.canonical.x>>z<<z),R=g.canonical.y-(g.canonical.y>>z<<z),X=C.X>>z;C.aP(S.posMatrix,0,X,0,X,0,1),C.J(S.posMatrix,S.posMatrix,[-k*X,-R*X,0]),o[f]=S}else if(t.canonical.isChildOf(g.canonical)){const S=t.clone();S.posMatrix=new Float64Array(16);const z=t.canonical.z-g.canonical.z,k=t.canonical.x-(t.canonical.x>>z<<z),R=t.canonical.y-(t.canonical.y>>z<<z),X=C.X>>z;C.aP(S.posMatrix,0,C.X,0,C.X,0,1),C.J(S.posMatrix,S.posMatrix,[k*X,R*X,0]),C.K(S.posMatrix,S.posMatrix,[1/2**z,1/2**z,0]),o[f]=S}}return o}getSourceTile(t,o){const f=this.sourceCache._source;let g=t.overscaledZ-this.deltaZoom;if(g>f.maxzoom&&(g=f.maxzoom),g<f.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(g).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if(!(S&&S.dem)&&o)for(;g>=f.minzoom&&!(S&&S.dem);)S=this.sourceCache.getTileByID(t.scaledTo(g--).key);return S}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=t)}}class wt{constructor(t,o,f){this.painter=t,this.sourceCache=new pt(o),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,o,f,g=C.X){var S;if(!(o>=0&&o<g&&f>=0&&f<g))return 0;const z=this.getTerrainData(t),k=(S=z.tile)===null||S===void 0?void 0:S.dem;if(!k)return 0;const R=Ql([],[o/g*C.X,f/g*C.X],z.u_terrain_matrix),X=[R[0]*k.dim,R[1]*k.dim],K=Math.floor(X[0]),J=Math.floor(X[1]),ut=X[0]-K,mt=X[1]-J;return k.get(K,J)*(1-ut)*(1-mt)+k.get(K+1,J)*ut*(1-mt)+k.get(K,J+1)*(1-ut)*mt+k.get(K+1,J+1)*ut*mt}getElevationForLngLatZoom(t,o){if(!C.bb(o,t.wrap()))return 0;const{tileID:f,mercatorX:g,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(t,o);return this.getElevation(f,g%C.X,S%C.X,C.X)}getElevation(t,o,f,g=C.X){return this.getDEMElevation(t,o,f,g)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const g=this.painter.context,S=new C.R({width:1,height:1},new Uint8Array(1*4));this._emptyDepthTexture=new Qi(g,S,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Qi(g,new C.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=C.an([])}const o=this.sourceCache.getSourceTile(t,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const g=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new Qi(g,o.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),o.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const f=o&&o+o.tileID.key+t.key;if(f&&!this._demMatrixCache[f]){const g=this.sourceCache.sourceCache._source.maxzoom;let S=t.canonical.z-o.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=g?S=t.canonical.z-g:C.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const z=t.canonical.x-(t.canonical.x>>S<<S),k=t.canonical.y-(t.canonical.y>>S<<S),R=C.bc(new Float64Array(16),[1/(C.X<<S),1/(C.X<<S),0]);C.J(R,R,[z*C.X,k*C.X,0]),this._demMatrixCache[t.key]={matrix:R,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(t){const o=this.painter,f=o.width/devicePixelRatio,g=o.height/devicePixelRatio;return this._fbo&&(this._fbo.width!==f||this._fbo.height!==g)&&(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Qi(o.context,{width:f,height:g,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Qi(o.context,{width:f,height:g,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(f,g,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,f,g))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,z=0;S<this._coordsTextureSize;S++)for(let k=0;k<this._coordsTextureSize;k++,z+=4)o[z+0]=k&255,o[z+1]=S&255,o[z+2]=k>>8<<4|S>>8,o[z+3]=0;const f=new C.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),g=new Qi(t,f,t.gl.RGBA,{premultiply:!1});return g.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),f=this.painter.context,g=f.gl,S=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),z=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(S,k-z-1,1,1,g.RGBA,g.UNSIGNED_BYTE,o),f.bindFramebuffer.set(null);const R=o[0]+(o[2]>>4<<8),X=o[1]+((o[2]&15)<<8),K=this.coordsIndex[255-o[3]],J=K&&this.sourceCache.getTileByID(K);if(!J)return null;const ut=this._coordsTextureSize,mt=(1<<J.tileID.canonical.z)*ut;return new C.Z((J.tileID.canonical.x*ut+R)/mt+J.tileID.wrap,(J.tileID.canonical.y*ut+X)/mt,this.getElevation(J.tileID,R,X,ut))}depthAtPoint(t){const o=new Uint8Array(4),f=this.painter.context,g=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,o),f.bindFramebuffer.set(null),(o[0]/(256*256*256)+o[1]/(256*256)+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,o=new C.bd,f=new C.aY,g=this.meshSize,S=C.X/g,z=g*g;for(let J=0;J<=g;J++)for(let ut=0;ut<=g;ut++)o.emplaceBack(ut*S,J*S,0);for(let J=0;J<z;J+=g+1)for(let ut=0;ut<g;ut++)f.emplaceBack(ut+J,g+ut+J+1,g+ut+J+2),f.emplaceBack(ut+J,g+ut+J+2,ut+J+1);const k=o.length,R=k+(g+1)*2;for(const J of[0,1])for(let ut=0;ut<=g;ut++)for(const mt of[0,1])o.emplaceBack(ut*S,J*C.X,mt);for(let J=0;J<g*2;J+=2)f.emplaceBack(R+J,R+J+1,R+J+3),f.emplaceBack(R+J,R+J+3,R+J+2),f.emplaceBack(k+J,k+J+3,k+J+1),f.emplaceBack(k+J,k+J+2,k+J+3);const X=o.length,K=X+(g+1)*2;for(const J of[0,1])for(let ut=0;ut<=g;ut++)for(const mt of[0,1])o.emplaceBack(J*C.X,ut*S,mt);for(let J=0;J<g*2;J+=2)f.emplaceBack(X+J,X+J+1,X+J+3),f.emplaceBack(X+J,X+J+3,X+J+2),f.emplaceBack(K+J,K+J+3,K+J+1),f.emplaceBack(K+J,K+J+2,K+J+3);return this._mesh=new xn(t.createVertexBuffer(o,at.members),t.createIndexBuffer(f),C.a0.simpleSegment(0,0,o.length,f.length)),this._mesh}getMeshFrameDelta(t){return 2*Math.PI*C.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,o){var f;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(t,o);return(f=this.getMinMaxElevation(g).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(t){const o=this.getTerrainData(t).tile,f={minElevation:null,maxElevation:null};return o&&o.dem&&(f.minElevation=o.dem.min*this.exaggeration,f.maxElevation=o.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(t,o){const f=C.Z.fromLngLat(t.wrap()),g=(1<<o)*C.X,S=f.x*g,z=f.y*g,k=Math.floor(S/C.X),R=Math.floor(z/C.X);return{tileID:new C.S(o,0,o,k,R),mercatorX:S,mercatorY:z}}}class bt{constructor(t,o,f){this._context=t,this._size=o,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new Qi(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(f.texture),{id:t,fbo:o,texture:f,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>t.id!==o),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return this._objects.length<this._size?!1:this._objects.some(t=>!t.inUse)===!1}}const xt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Et{constructor(t,o){this.painter=t,this.terrain=o,this.pool=new bt(t.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(f=>!t._layers[f].isHidden(o)),this._coordsDescendingInv={};for(const f in t.sourceCaches){this._coordsDescendingInv[f]={};const g=t.sourceCaches[f].getVisibleCoordinates();for(const S of g){const z=this.terrain.sourceCache.getTerrainCoords(S);for(const k in z)this._coordsDescendingInv[f][k]||(this._coordsDescendingInv[f][k]=[]),this._coordsDescendingInv[f][k].push(z[k])}}this._coordsDescendingInvStr={};for(const f of t._order){const g=t._layers[f],S=g.source;if(xt[g.type]&&!this._coordsDescendingInvStr[S]){this._coordsDescendingInvStr[S]={};for(const z in this._coordsDescendingInv[S])this._coordsDescendingInvStr[S][z]=this._coordsDescendingInv[S][z].map(k=>k.key).sort().join()}}for(const f of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const S=this._coordsDescendingInvStr[g][f.tileID.key];S&&S!==f.rttCoords[g]&&(f.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const o=t.type,f=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(xt[o]&&((!this._prevType||!xt[this._prevType])&&this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(t.id),!g))return!0;if(xt[this._prevType]||xt[o]&&g){this._prevType=o;const S=this._stacks.length-1,z=this._stacks[S]||[];for(const k of this._renderableTiles){if(this.pool.isFull()&&(ia(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[S]){const X=this.pool.getObjectForId(k.rtt[S].id);if(X.stamp===k.rtt[S].stamp){this.pool.useObject(X);continue}}const R=this.pool.getOrCreateFreeObject();this.pool.useObject(R),this.pool.stampObject(R),k.rtt[S]={id:R.id,stamp:R.stamp},f.context.bindFramebuffer.set(R.fbo.framebuffer),f.context.clear({color:C.aM.transparent,stencil:0}),f.currentStencilSource=void 0;for(let X=0;X<z.length;X++){const K=f.style._layers[z[X]],J=K.source?this._coordsDescendingInv[K.source][k.tileID.key]:[k.tileID];f.context.viewport.set([0,0,R.fbo.width,R.fbo.height]),f._renderTileClippingMasks(K,J),f.renderLayer(f,f.style.sourceCaches[K.source],K,J),K.source&&(k.rttCoords[K.source]=this._coordsDescendingInvStr[K.source][k.tileID.key])}}return ia(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),xt[o]}return!1}}const kt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gt=Yr.version,Kt=-2,ae=22,oe=0,ne=60,he=85,ge={hash:!1,interactive:!0,bearingSnap:7,attributionControl:q,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:Kt,maxZoom:ae,minPitch:oe,maxPitch:ne,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:C.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0};let Se=class extends D{constructor(t){C.bf.mark(C.bg.create);const o=Object.assign(Object.assign({},ge),t);if(o.minZoom!=null&&o.maxZoom!=null&&o.minZoom>o.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(o.minPitch!=null&&o.maxPitch!=null&&o.minPitch>o.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(o.minPitch!=null&&o.minPitch<oe)throw new Error(`minPitch must be greater than or equal to ${oe}`);if(o.maxPitch!=null&&o.maxPitch>he)throw new Error(`maxPitch must be less than or equal to ${he}`);const f=new Wa(o.minZoom,o.maxZoom,o.minPitch,o.maxPitch,o.renderWorldCopies);if(super(f,{bearingSnap:o.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ot,this._controls=[],this._mapId=C.a4(),this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new C.k("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._setupPainter(),this.resize(),this._update(),this.fire(new C.k("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=o.interactive,this._maxTileCacheSize=o.maxTileCacheSize,this._maxTileCacheZoomLevels=o.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=o.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=o.preserveDrawingBuffer===!0,this._antialias=o.antialias===!0,this._trackResize=o.trackResize===!0,this._bearingSnap=o.bearingSnap,this._refreshExpiredTiles=o.refreshExpiredTiles===!0,this._fadeDuration=o.fadeDuration,this._crossSourceCollisions=o.crossSourceCollisions===!0,this._collectResourceTiming=o.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},kt),o.locale),this._clickTolerance=o.clickTolerance,this._overridePixelRatio=o.pixelRatio,this._maxCanvasSize=o.maxCanvasSize,this.transformCameraUpdate=o.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=o.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=an.addThrottleControl(()=>this.isMoving()),this._requestManager=new Fs(o.transformRequest),typeof o.container=="string"){if(this._container=document.getElementById(o.container),!this._container)throw new Error(`Container '${o.container}' not found.`)}else if(o.container instanceof HTMLElement)this._container=o.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");if(o.maxBounds&&this.setMaxBounds(o.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1;const z=Ea(k=>{this._trackResize&&!this._removed&&(this.resize(k),this.redraw())},50);this._resizeObserver=new ResizeObserver(k=>{if(!S){S=!0;return}z(k)}),this._resizeObserver.observe(this._container)}this.handlers=new P(this,o);const g=typeof o.hash=="string"&&o.hash||void 0;this._hash=o.hash&&new hs(g).addTo(this),(!this._hash||!this._hash._onHashChange())&&(this.jumpTo({center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch}),o.bounds&&(this.resize(),this.fitBounds(o.bounds,C.e({},o.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=o.localIdeographFontFamily,this._validateStyle=o.validateStyle,o.style&&this.setStyle(o.style,{localIdeographFontFamily:o.localIdeographFontFamily}),o.attributionControl&&this.addControl(new G(typeof o.attributionControl=="boolean"?void 0:o.attributionControl)),o.maplibreLogo&&this.addControl(new et,o.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",S=>{this._update(S.dataType==="style"),this.fire(new C.k(`${S.dataType}data`,S))}),this.on("dataloading",S=>{this.fire(new C.k(`${S.dataType}dataloading`,S))}),this.on("dataabort",S=>{this.fire(new C.k("sourcedataabort",S))})}_getMapId(){return this._mapId}addControl(t,o){if(o===void 0&&(t.getDefaultPosition?o=t.getDefaultPosition():o="top-right"),!t||!t.onAdd)return this.fire(new C.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=t.onAdd(this);this._controls.push(t);const g=this._controlPositions[o];return o.indexOf("bottom")!==-1?g.insertBefore(f,g.firstChild):g.appendChild(f),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new C.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(t);return o>-1&&this._controls.splice(o,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}calculateCameraOptionsFromTo(t,o,f,g){return g==null&&this.terrain&&(g=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(t,o,f,g)}resize(t){var o;const f=this._containerDimensions(),g=f[0],S=f[1],z=this._getClampedPixelRatio(g,S);if(this._resizeCanvas(g,S,z),this.painter.resize(g,S,z),this.painter.overLimit()){const R=this.painter.context.gl;this._maxCanvasSize=[R.drawingBufferWidth,R.drawingBufferHeight];const X=this._getClampedPixelRatio(g,S);this._resizeCanvas(g,S,X),this.painter.resize(g,S,X)}this.transform.resize(g,S),(o=this._requestedCameraState)===null||o===void 0||o.resize(g,S);const k=!this._moving;return k&&(this.stop(),this.fire(new C.k("movestart",t)).fire(new C.k("move",t))),this.fire(new C.k("resize",t)),k&&this.fire(new C.k("moveend",t)),this}_getClampedPixelRatio(t,o){const{0:f,1:g}=this._maxCanvasSize,S=this.getPixelRatio(),z=t*S,k=o*S,R=z>f?f/z:1,X=k>g?g/k:1;return Math.min(R,X)*S}getPixelRatio(){var t;return(t=this._overridePixelRatio)!==null&&t!==void 0?t:devicePixelRatio}setPixelRatio(t){this._overridePixelRatio=t,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(Vr.convert(t)),this._update()}setMinZoom(t){if(t=t??Kt,t>=Kt&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error(`minZoom must be between ${Kt} and the current maxZoom, inclusive`)}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if(t=t??ae,t>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if(t=t??oe,t<oe)throw new Error(`minPitch must be greater than or equal to ${oe}`);if(t>=oe&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error(`minPitch must be between ${oe} and the current maxPitch, inclusive`)}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if(t=t??ne,t>he)throw new Error(`maxPitch must be less than or equal to ${he}`);if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}project(t){return this.transform.locationPoint(C.N.convert(t),this.style&&this.terrain)}unproject(t){return this.transform.pointLocation(C.P.convert(t),this.terrain)}isMoving(){var t;return this._moving||((t=this.handlers)===null||t===void 0?void 0:t.isMoving())}isZooming(){var t;return this._zooming||((t=this.handlers)===null||t===void 0?void 0:t.isZooming())}isRotating(){var t;return this._rotating||((t=this.handlers)===null||t===void 0?void 0:t.isRotating())}_createDelegatedListener(t,o,f){if(t==="mouseenter"||t==="mouseover"){let g=!1;return{layers:o,listener:f,delegates:{mousemove:k=>{const R=o.filter(K=>this.getLayer(K)),X=R.length!==0?this.queryRenderedFeatures(k.point,{layers:R}):[];X.length?g||(g=!0,f.call(this,new Ar(t,this,k.originalEvent,{features:X}))):g=!1},mouseout:()=>{g=!1}}}}else if(t==="mouseleave"||t==="mouseout"){let g=!1;return{layers:o,listener:f,delegates:{mousemove:k=>{const R=o.filter(K=>this.getLayer(K));(R.length!==0?this.queryRenderedFeatures(k.point,{layers:R}):[]).length?g=!0:g&&(g=!1,f.call(this,new Ar(t,this,k.originalEvent)))},mouseout:k=>{g&&(g=!1,f.call(this,new Ar(t,this,k.originalEvent)))}}}}else{const g=S=>{const z=o.filter(R=>this.getLayer(R)),k=z.length!==0?this.queryRenderedFeatures(S.point,{layers:z}):[];k.length&&(S.features=k,f.call(this,S),delete S.features)};return{layers:o,listener:f,delegates:{[t]:g}}}}_saveDelegatedListener(t,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(o)}_removeDelegatedListener(t,o,f){if(!this._delegatedListeners||!this._delegatedListeners[t])return;const g=this._delegatedListeners[t];for(let S=0;S<g.length;S++){const z=g[S];if(z.listener===f&&z.layers.length===o.length&&z.layers.every(k=>o.includes(k))){for(const k in z.delegates)this.off(k,z.delegates[k]);g.splice(S,1);return}}}on(t,o,f){if(f===void 0)return super.on(t,o);const g=typeof o=="string"?[o]:o,S=this._createDelegatedListener(t,g,f);this._saveDelegatedListener(t,S);for(const z in S.delegates)this.on(z,S.delegates[z]);return this}once(t,o,f){if(f===void 0)return super.once(t,o);const g=typeof o=="string"?[o]:o,S=this._createDelegatedListener(t,g,f);for(const z in S.delegates){const k=S.delegates[z];S.delegates[z]=(...R)=>{this._removeDelegatedListener(t,g,f),k(...R)}}this._saveDelegatedListener(t,S);for(const z in S.delegates)this.once(z,S.delegates[z]);return this}off(t,o,f){if(f===void 0)return super.off(t,o);const g=typeof o=="string"?[o]:o;return this._removeDelegatedListener(t,g,f),this}queryRenderedFeatures(t,o){if(!this.style)return[];let f;const g=t instanceof C.P||Array.isArray(t),S=g?t:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(g?{}:t)||{},S instanceof C.P||typeof S[0]=="number")f=[C.P.convert(S)];else{const z=C.P.convert(S[0]),k=C.P.convert(S[1]);f=[z,new C.P(k.x,z.y),k,new C.P(z.x,k.y),z]}return this.style.queryRenderedFeatures(f,o,this.transform)}querySourceFeatures(t,o){return this.style.querySourceFeatures(t,o)}setStyle(t,o){return o=C.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o),o.diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(t,o))}setTransformRequest(t){return this._requestManager.setTransformRequest(t),this}_getUIString(t){const o=this._locale[t];if(o==null)throw new Error(`Missing UI string '${t}'`);return o}_updateStyle(t,o){if(o.transformStyle&&this.style&&!this.style._loaded){this.style.once("style.load",()=>this._updateStyle(t,o));return}const f=this.style&&o.transformStyle?this.style.serialize():void 0;if(this.style&&(this.style.setEventedParent(null),this.style._remove(!t)),t)this.style=new vr(this,o||{});else return delete this.style,this;return this.style.setEventedParent(this,{style:this.style}),typeof t=="string"?this.style.loadURL(t,o,f):this.style.loadJSON(t,o,f),this}_lazyInitEmptyStyle(){this.style||(this.style=new vr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,o){if(typeof t=="string"){const f=t,g=this._requestManager.transformRequest(f,"Style");C.h(g,new AbortController).then(S=>{this._updateDiff(S.data,o)}).catch(S=>{S&&this.fire(new C.j(S))})}else typeof t=="object"&&this._updateDiff(t,o)}_updateDiff(t,o){try{this.style.setState(t,o)&&this._update(!0)}catch(f){C.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(t,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():C.w("There is no style added to the map.")}addSource(t,o){return this._lazyInitEmptyStyle(),this.style.addSource(t,o),this._update(!0)}isSourceLoaded(t){const o=this.style&&this.style.sourceCaches[t];if(o===void 0){this.fire(new C.j(new Error(`There is no source with ID '${t}'`)));return}return o.loaded()}setTerrain(t){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),!t)this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;else{const o=this.style.sourceCaches[t.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain===null&&o.reload();for(const f in this.style._layers){const g=this.style._layers[f];g.type==="hillshade"&&g.source===t.source&&C.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new wt(this.painter,o,t),this.painter.renderToTexture=new Et(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId===t.source&&!this._elevationFreeze&&(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}return this.fire(new C.k("terrain",{terrain:t})),this}getTerrain(){var t,o;return(o=(t=this.terrain)===null||t===void 0?void 0:t.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const t=this.style&&this.style.sourceCaches;for(const o in t){const g=t[o]._tiles;for(const S in g){const z=g[S];if(!(z.state==="loaded"||z.state==="errored"))return!1}}return!0}removeSource(t){return this.style.removeSource(t),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(t,o,f={}){const{pixelRatio:g=1,sdf:S=!1,stretchX:z,stretchY:k,content:R,textFitWidth:X,textFitHeight:K}=f;this._lazyInitEmptyStyle();const J=0;if(o instanceof HTMLImageElement||C.b(o)){const{width:ut,height:mt,data:vt}=me.getImageData(o);this.style.addImage(t,{data:new C.R({width:ut,height:mt},vt),pixelRatio:g,stretchX:z,stretchY:k,content:R,textFitWidth:X,textFitHeight:K,sdf:S,version:J})}else{if(o.width===void 0||o.height===void 0)return this.fire(new C.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:ut,height:mt,data:vt}=o,Tt=o;return this.style.addImage(t,{data:new C.R({width:ut,height:mt},new Uint8Array(vt)),pixelRatio:g,stretchX:z,stretchY:k,content:R,textFitWidth:X,textFitHeight:K,sdf:S,version:J,userImage:Tt}),Tt.onAdd&&Tt.onAdd(this,t),this}}}updateImage(t,o){const f=this.style.getImage(t);if(!f)return this.fire(new C.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=o instanceof HTMLImageElement||C.b(o)?me.getImageData(o):o,{width:S,height:z,data:k}=g;if(S===void 0||z===void 0)return this.fire(new C.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(S!==f.data.width||z!==f.data.height)return this.fire(new C.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(o instanceof HTMLImageElement||C.b(o));return f.data.replace(k,R),this.style.updateImage(t,f),this}getImage(t){return this.style.getImage(t)}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new C.j(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t){return an.getImage(this._requestManager.transformRequest(t,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(t,o){return this._lazyInitEmptyStyle(),this.style.addLayer(t,o),this._update(!0)}moveLayer(t,o){return this.style.moveLayer(t,o),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(t,o,f){return this.style.setLayerZoomRange(t,o,f),this._update(!0)}setFilter(t,o,f={}){return this.style.setFilter(t,o,f),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,o,f,g={}){return this.style.setPaintProperty(t,o,f,g),this._update(!0)}getPaintProperty(t,o){return this.style.getPaintProperty(t,o)}setLayoutProperty(t,o,f,g={}){return this.style.setLayoutProperty(t,o,f,g),this._update(!0)}getLayoutProperty(t,o){return this.style.getLayoutProperty(t,o)}setGlyphs(t,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(t,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(t,o,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(t,o,f,g=>{g||this._update(!0)}),this}removeSprite(t){return this._lazyInitEmptyStyle(),this.style.removeSprite(t),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(t,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(t,o,f=>{f||this._update(!0)}),this}setLight(t,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(t){return this._lazyInitEmptyStyle(),this.style.setSky(t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(t,o){return this.style.setFeatureState(t,o),this._update()}removeFeatureState(t,o){return this.style.removeFeatureState(t,o),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,o=0;return this._container&&(t=this._container.clientWidth||400,o=this._container.clientHeight||300),[t,o]}_setupContainer(){const t=this._container;t.classList.add("maplibregl-map");const o=this._canvasContainer=Qt.create("div","maplibregl-canvas-container",t);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=Qt.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),g=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],g);const S=this._controlContainer=Qt.create("div","maplibregl-control-container",t),z=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(k=>{z[k]=Qt.create("div",`maplibregl-ctrl-${k} `,S)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,o,f){this._canvas.width=Math.floor(f*t),this._canvas.height=Math.floor(f*o),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const t={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",g=>{o={requestedAttributes:t},g&&(o.statusMessage=g.statusMessage,o.type=g.type)},{once:!0});const f=this._canvas.getContext("webgl2",t)||this._canvas.getContext("webgl",t);if(!f){const g="Failed to initialize WebGL";throw o?(o.message=g,new Error(JSON.stringify(o))):new Error(g)}this.painter=new Xu(f,this.transform),ca.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return!this.style||!this.style._loaded?this:(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this)}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(t){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,z=me.now();this.style.zoomHistory.update(S,z);const k=new C.z(S,{now:z,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=k.crossFadingFactor();(R!==1||R!==this._crossFadingFactor)&&(f=!0,this._crossFadingFactor=R),this.style.update(k)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new C.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,C.bf.mark(C.bg.load),this.fire(new C.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new C.k("idle")),this._loaded&&!this._fullyLoaded&&!g&&(this._fullyLoaded=!0,C.bf.mark(C.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var t;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),an.removeThrottleControl(this._imageQueueHandle),(t=this._resizeObserver)===null||t===void 0||t.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o!=null&&o.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Qt.remove(this._canvasContainer),Qt.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),C.bf.clearMetrics(),this._removed=!0,this.fire(new C.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,me.frameAsync(this._frameRequest).then(t=>{C.bf.frame(t),this._frameRequest=null,this._render(t)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get version(){return Gt}getCameraTargetElevation(){return this.transform.elevation}};const Ce=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},Ee=({enable:w,clickTolerance:t,bearingDegreesPerPixelMoved:o=.8})=>{const f=new Nl;return new al({clickTolerance:t,move:(g,S)=>({bearingDelta:(S.x-g.x)*o}),moveStateManager:f,enable:w,assignEvents:Ce})},Je=({enable:w,clickTolerance:t,pitchDegreesPerPixelMoved:o=-.5})=>{const f=new Nl;return new al({clickTolerance:t,move:(g,S)=>({pitchDelta:(S.y-g.y)*o}),moveStateManager:f,enable:w,assignEvents:Ce})},Ai={showCompass:!0,showZoom:!0,visualizePitch:!1};class _i{constructor(t){this._updateZoomButtons=()=>{const o=this._map.getZoom(),f=o===this._map.getMaxZoom(),g=o===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,f)=>{const g=this._map._getUIString(`NavigationControl.${f}`);o.title=g,o.setAttribute("aria-label",g)},this.options=C.e({},Ai,t),this._container=Qt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),Qt.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),Qt.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=Qt.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Re(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Qt.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,o){const f=Qt.create("button",t,this._container);return f.type="button",f.addEventListener("click",o),f}}class Re{constructor(t,o,f=!1){this.mousedown=z=>{this.startMouse(C.e({},z,{ctrlKey:!0,preventDefault:()=>z.preventDefault()}),Qt.mousePos(this.element,z)),Qt.addEventListener(window,"mousemove",this.mousemove),Qt.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=z=>{this.moveMouse(z,Qt.mousePos(this.element,z))},this.mouseup=z=>{this.mouseRotate.dragEnd(z),this.mousePitch&&this.mousePitch.dragEnd(z),this.offTemp()},this.touchstart=z=>{z.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Qt.touchPos(this.element,z.targetTouches)[0],this.startTouch(z,this._startPos),Qt.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Qt.addEventListener(window,"touchend",this.touchend))},this.touchmove=z=>{z.targetTouches.length!==1?this.reset():(this._lastPos=Qt.touchPos(this.element,z.targetTouches)[0],this.moveTouch(z,this._lastPos))},this.touchend=z=>{z.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=t.dragRotate._mouseRotate.getClickTolerance(),S=t.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=Ju({clickTolerance:g,enable:!0}),this.touchRotate=Ee({clickTolerance:g,enable:!0}),this.map=t,f&&(this.mousePitch=Ch({clickTolerance:S,enable:!0}),this.touchPitch=Je({clickTolerance:S,enable:!0})),Qt.addEventListener(o,"mousedown",this.mousedown),Qt.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),Qt.addEventListener(o,"touchcancel",this.reset)}startMouse(t,o){this.mouseRotate.dragStart(t,o),this.mousePitch&&this.mousePitch.dragStart(t,o),Qt.disableDrag()}startTouch(t,o){this.touchRotate.dragStart(t,o),this.touchPitch&&this.touchPitch.dragStart(t,o),Qt.disableDrag()}moveMouse(t,o){const f=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(t,o)||{};if(g&&f.setBearing(f.getBearing()+g),this.mousePitch){const{pitchDelta:S}=this.mousePitch.dragMove(t,o)||{};S&&f.setPitch(f.getPitch()+S)}}moveTouch(t,o){const f=this.map,{bearingDelta:g}=this.touchRotate.dragMove(t,o)||{};if(g&&f.setBearing(f.getBearing()+g),this.touchPitch){const{pitchDelta:S}=this.touchPitch.dragMove(t,o)||{};S&&f.setPitch(f.getPitch()+S)}}off(){const t=this.element;Qt.removeEventListener(t,"mousedown",this.mousedown),Qt.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Qt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Qt.removeEventListener(window,"touchend",this.touchend),Qt.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Qt.enableDrag(),Qt.removeEventListener(window,"mousemove",this.mousemove),Qt.removeEventListener(window,"mouseup",this.mouseup),Qt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Qt.removeEventListener(window,"touchend",this.touchend)}}let fi;function si(){return C._(this,arguments,void 0,function*(w=!1){if(fi!==void 0&&!w)return fi;if(window.navigator.permissions===void 0)return fi=!!window.navigator.geolocation,fi;try{fi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{fi=!!window.navigator.geolocation}return fi})}function Li(w,t,o){const f=new C.N(w.lng,w.lat);if(w=new C.N(w.lng,w.lat),t){const g=new C.N(w.lng-360,w.lat),S=new C.N(w.lng+360,w.lat),z=o.locationPoint(w).distSqr(t);o.locationPoint(g).distSqr(t)<z?w=g:o.locationPoint(S).distSqr(t)<z&&(w=S)}for(;Math.abs(w.lng-o.center.lng)>180;){const g=o.locationPoint(w);if(g.x>=0&&g.y>=0&&g.x<=o.width&&g.y<=o.height)break;w.lng>o.center.lng?w.lng-=360:w.lng+=360}return w.lng!==f.lng&&o.locationPoint(w).y>o.height/2-o.getHorizon()?w:f}const Mi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function or(w,t,o){const f=w.classList;for(const g in Mi)f.remove(`maplibregl-${o}-anchor-${g}`);f.add(`maplibregl-${o}-anchor-${t}`)}class wi extends C.E{constructor(t){if(super(),this._onKeyPress=o=>{const f=o.code,g=o.charCode||o.keyCode;(f==="Space"||f==="Enter"||g===32||g===13)&&this.togglePopup()},this._onMapClick=o=>{const f=o.originalEvent.target,g=this._element;this._popup&&(f===g||g.contains(f))&&this.togglePopup()},this._update=o=>{var f;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!g)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies?this._lngLat=Li(this._lngLat,this._flatPos,this._map.transform):this._lngLat=(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let S="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?S=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(S=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let z="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?z="rotateX(0deg)":this._pitchAlignment==="map"&&(z=`rotateX(${this._map.getPitch()}deg)`),!this._subpixelPositioning&&(!o||o.type==="moveend")&&(this._pos=this._pos.round()),Qt.setTransform(this._element,`${Mi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${z} ${S}`),me.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new C.k("dragstart"))),this.fire(new C.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new C.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),!t||!t.element){this._defaultMarker=!0,this._element=Qt.create("div");const o=Qt.createNS("http://www.w3.org/2000/svg","svg"),f=41,g=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${f}px`),o.setAttributeNS(null,"width",`${g}px`),o.setAttributeNS(null,"viewBox",`0 0 ${g} ${f}`);const S=Qt.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const z=Qt.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill-rule","nonzero");const k=Qt.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const R=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Bt of R){const Ot=Qt.createNS("http://www.w3.org/2000/svg","ellipse");Ot.setAttributeNS(null,"opacity","0.04"),Ot.setAttributeNS(null,"cx","10.5"),Ot.setAttributeNS(null,"cy","5.80029008"),Ot.setAttributeNS(null,"rx",Bt.rx),Ot.setAttributeNS(null,"ry",Bt.ry),k.appendChild(Ot)}const X=Qt.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"fill",this._color);const K=Qt.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),X.appendChild(K);const J=Qt.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"fill","#000000");const ut=Qt.createNS("http://www.w3.org/2000/svg","path");ut.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),J.appendChild(ut);const mt=Qt.createNS("http://www.w3.org/2000/svg","g");mt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),mt.setAttributeNS(null,"fill","#FFFFFF");const vt=Qt.createNS("http://www.w3.org/2000/svg","g");vt.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Tt=Qt.createNS("http://www.w3.org/2000/svg","circle");Tt.setAttributeNS(null,"fill","#000000"),Tt.setAttributeNS(null,"opacity","0.25"),Tt.setAttributeNS(null,"cx","5.5"),Tt.setAttributeNS(null,"cy","5.5"),Tt.setAttributeNS(null,"r","5.4999962");const Ft=Qt.createNS("http://www.w3.org/2000/svg","circle");Ft.setAttributeNS(null,"fill","#FFFFFF"),Ft.setAttributeNS(null,"cx","5.5"),Ft.setAttributeNS(null,"cy","5.5"),Ft.setAttributeNS(null,"r","5.4999962"),vt.appendChild(Tt),vt.appendChild(Ft),z.appendChild(k),z.appendChild(X),z.appendChild(J),z.appendChild(mt),z.appendChild(vt),o.appendChild(z),o.setAttributeNS(null,"height",`${f*this._scale}px`),o.setAttributeNS(null,"width",`${g*this._scale}px`),this._element.appendChild(o),this._offset=C.P.convert(t&&t.offset||[0,-14])}else this._element=t.element,this._offset=C.P.convert(t&&t.offset||[0,0]);if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),or(this._element,this._anchor,"marker"),t&&t.className)for(const o of t.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Qt.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=C.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const g=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,(38.1-13.5+g)*-1],"bottom-right":[-g,(38.1-13.5+g)*-1],left:[13.5,(38.1-13.5)*-1],right:[-13.5,(38.1-13.5)*-1]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;if(this._element.style.opacity===this._opacityWhenCovered)return this;if(t)t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map));else return this;return this}_updateOpacity(t=!1){var o,f;if(!((o=this._map)===null||o===void 0?void 0:o.terrain)){this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity);return}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const S=this._map,z=S.terrain.depthAtPoint(this._pos),k=S.terrain.getElevationForLngLatZoom(this._lngLat,S.transform.tileZoom),R=S.transform.lngLatToCameraDepth(this._lngLat,k),X=.006;if(R-z<X){this._element.style.opacity=this._opacity;return}const K=-this._offset.y/S.transform._pixelPerMeter,J=Math.sin(S.getPitch()*Math.PI/180)*K,ut=S.terrain.depthAtPoint(new C.P(this._pos.x,this._pos.y-this._offset.y)),vt=S.transform.lngLatToCameraDepth(this._lngLat,k+J)-ut>X;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&vt&&this._popup.remove(),this._element.style.opacity=vt?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=C.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,o){return t===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const ir={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ri=0,Ti=!1;class Lr extends C.E{constructor(t){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o)){this._setErrorState(),this.fire(new C.k("outofmaxbounds",o)),this._updateMarker(),this._finish();return}if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new C.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const f=new C.N(o.coords.longitude,o.coords.latitude),g=o.coords.accuracy,S=this._map.getBearing(),z=C.e({bearing:S},this.options.fitBoundsOptions),k=Vr.fromLngLat(f,g);this._map.fitBounds(k,z,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const f=new C.N(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&Ti)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new C.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Qt.create("button","maplibregl-ctrl-geolocate",this._container),Qt.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){C.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Qt.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new wi({element:this._dotElement}),this._circleElement=Qt.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{const g=f.originalEvent&&f.originalEvent.type==="resize";!f.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!g&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new C.k("trackuserlocationend")),this.fire(new C.k("userlocationlostfocus")))})}},this.options=C.e({},ir,t)}onAdd(t){return this._map=t,this._container=Qt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),si().then(o=>this._finishSetupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Qt.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ri=0,Ti=!1}_isOutOfMapMaxBounds(t){const o=this._map.getMaxBounds(),f=t.coords;return o&&(f.longitude<o.getWest()||f.longitude>o.getEast()||f.latitude<o.getSouth()||f.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const t=this._map.getBounds(),o=t.getSouthEast(),f=t.getNorthEast(),g=o.distanceTo(f),S=this._map._container.clientHeight,z=Math.ceil(2*(this._accuracy/(g/S)));this._circleElement.style.width=`${z}px`,this._circleElement.style.height=`${z}px`}trigger(){if(!this._setup)return C.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new C.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ri--,Ti=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new C.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new C.k("trackuserlocationstart")),this.fire(new C.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ri++;let t;ri>1?(t={maximumAge:6e5,timeout:0},Ti=!0):(t=this.options.positionOptions,Ti=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}}const cn={maxWidth:100,unit:"metric"};class As{constructor(t){this._onMove=()=>{cs(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,cs(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},cn),t)}getDefaultPosition(){return"bottom-left"}onAdd(t){return this._map=t,this._container=Qt.create("div","maplibregl-ctrl maplibregl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Qt.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}}function cs(w,t,o){const f=o&&o.maxWidth||100,g=w._container.clientHeight/2,S=w.unproject([0,g]),z=w.unproject([f,g]),k=S.distanceTo(z);if(o&&o.unit==="imperial"){const R=3.2808*k;if(R>5280){const X=R/5280;Aa(t,f,X,w._getUIString("ScaleControl.Miles"))}else Aa(t,f,R,w._getUIString("ScaleControl.Feet"))}else if(o&&o.unit==="nautical"){const R=k/1852;Aa(t,f,R,w._getUIString("ScaleControl.NauticalMiles"))}else k>=1e3?Aa(t,f,k/1e3,w._getUIString("ScaleControl.Kilometers")):Aa(t,f,k,w._getUIString("ScaleControl.Meters"))}function Aa(w,t,o,f){const g=bu(o),S=g/o;w.style.width=`${t*S}px`,w.innerHTML=`${g}&nbsp;${f}`}function Ma(w){const t=Math.pow(10,Math.ceil(-Math.log(w)/Math.LN10));return Math.round(w*t)/t}function bu(w){const t=Math.pow(10,`${Math.floor(w)}`.length-1);let o=w/t;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:Ma(o),t*o}class Io extends C.E{constructor(t={}){super(),this._onFullscreenChange=()=>{var o;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=f==null?void 0:f.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:C.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=Qt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Qt.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const t=this._fullscreenButton=Qt.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Qt.create("span","maplibregl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new C.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new C.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}}class za{constructor(t){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=t}onAdd(t){return this._map=t,this._container=Qt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Qt.create("button","maplibregl-ctrl-terrain",this._container),Qt.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Qt.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}}const Ys={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Qa=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");class Da extends C.E{constructor(t){super(),this.remove=()=>(this._content&&Qt.remove(this._content),this._container&&(Qt.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new C.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var f;const g=this._lngLat||this._trackPointer;if(!this._map||!g||!this._content)return;if(!this._container){if(this._container=Qt.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Qt.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const X of this.options.className.split(" "))this._container.classList.add(X);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer?this._lngLat=Li(this._lngLat,this._flatPos,this._map.transform):this._lngLat=(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!o)return;const S=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let z=this.options.anchor;const k=Ms(this.options.offset);if(!z){const X=this._container.offsetWidth,K=this._container.offsetHeight;let J;S.y+k.bottom.y<K?J=["top"]:S.y>this._map.transform.height-K?J=["bottom"]:J=[],S.x<X/2?J.push("left"):S.x>this._map.transform.width-X/2&&J.push("right"),J.length===0?z="bottom":z=J.join("-")}let R=S.add(k[z]);this.options.subpixelPositioning||(R=R.round()),Qt.setTransform(this._container,`${Mi[z]} translate(${R.x}px,${R.y}px)`),or(this._container,z,"popup")},this._onClose=()=>{this.remove()},this.options=C.e(Object.create(Ys),t)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new C.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=C.N.convert(t),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const o=document.createDocumentFragment(),f=document.createElement("body");let g;for(f.innerHTML=t;g=f.firstChild,!!g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){var t;return(t=this._container)===null||t===void 0?void 0:t.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Qt.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){return this._container&&this._container.classList.add(t),this}removeClassName(t){return this._container&&this._container.classList.remove(t),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}setSubpixelPositioning(t){this.options.subpixelPositioning=t}_createCloseButton(){this.options.closeButton&&(this._closeButton=Qt.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(Qa);t&&t.focus()}}function Ms(w){if(w)if(typeof w=="number"){const t=Math.round(Math.abs(w)/Math.SQRT2);return{center:new C.P(0,0),top:new C.P(0,w),"top-left":new C.P(t,t),"top-right":new C.P(-t,t),bottom:new C.P(0,-w),"bottom-left":new C.P(t,-t),"bottom-right":new C.P(-t,-t),left:new C.P(w,0),right:new C.P(-w,0)}}else if(w instanceof C.P||Array.isArray(w)){const t=C.P.convert(w);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}else return{center:C.P.convert(w.center||[0,0]),top:C.P.convert(w.top||[0,0]),"top-left":C.P.convert(w["top-left"]||[0,0]),"top-right":C.P.convert(w["top-right"]||[0,0]),bottom:C.P.convert(w.bottom||[0,0]),"bottom-left":C.P.convert(w["bottom-left"]||[0,0]),"bottom-right":C.P.convert(w["bottom-right"]||[0,0]),left:C.P.convert(w.left||[0,0]),right:C.P.convert(w.right||[0,0])};else return Ms(new C.P(0,0))}const $a=Yr.version;function fs(w,t){return Mt().setRTLTextPlugin(w,t)}function gc(){return Mt().getRTLTextPluginStatus()}function th(){return $a}function bn(){return un.workerCount}function cf(w){un.workerCount=w}function yc(){return C.a.MAX_PARALLEL_IMAGE_REQUESTS}function lr(w){C.a.MAX_PARALLEL_IMAGE_REQUESTS=w}function wu(){return C.a.WORKER_URL}function Su(w){C.a.WORKER_URL=w}function Tu(w){return gl().broadcast("IS",w)}v.AJAXError=C.bh,v.Evented=C.E,v.LngLat=C.N,v.MercatorCoordinate=C.Z,v.Point=C.P,v.addProtocol=C.bi,v.config=C.a,v.removeProtocol=C.bj,v.AttributionControl=G,v.BoxZoomHandler=Nr,v.CanvasSource=ru,v.CooperativeGesturesHandler=m,v.DoubleClickZoomHandler=hf,v.DragPanHandler=Gr,v.DragRotateHandler=d,v.EdgeInsets=Th,v.FullscreenControl=Io,v.GeoJSONSource=co,v.GeolocateControl=Lr,v.Hash=hs,v.ImageSource=vs,v.KeyboardHandler=Ye,v.LngLatBounds=Vr,v.LogoControl=et,v.Map=Se,v.MapMouseEvent=Ar,v.MapTouchEvent=Xt,v.MapWheelEvent=Ke,v.Marker=wi,v.NavigationControl=_i,v.Popup=Da,v.RasterDEMTileSource=Na,v.RasterTileSource=Uo,v.ScaleControl=As,v.ScrollZoomHandler=Ps,v.Style=vr,v.TerrainControl=za,v.TwoFingersTouchPitchHandler=Qu,v.TwoFingersTouchRotateHandler=xu,v.TwoFingersTouchZoomHandler=ol,v.TwoFingersTouchZoomRotateHandler=l,v.VectorTileSource=tu,v.VideoSource=iu,v.addSourceType=Q,v.clearPrewarmedResources=Bo,v.getMaxParallelImageRequests=yc,v.getRTLTextPluginStatus=gc,v.getVersion=th,v.getWorkerCount=bn,v.getWorkerUrl=wu,v.importScriptInWorkers=Tu,v.prewarm=Au,v.setMaxParallelImageRequests=lr,v.setRTLTextPlugin=fs,v.setWorkerCount=cf,v.setWorkerUrl=Su});var Ep=ks;return Ep})}(Rg)),Rg.exports}export{Jg as a,ry as b,Gg as c,Yg as g,Qg as r};
//# sourceMappingURL=maps-yMw3Pr4N.js.map
